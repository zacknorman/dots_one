function a(a,d,e,f,g,h){var i=document.getElementById(a),j=i.naturalWidth,k=i.naturalHeight,l=document.getElementById(d);l.style.width=j+"px",l.style.height=k+"px",l.width=j,l.height=k;var m=l.getContext("2d");m.clearRect(0,0,j,k),m.drawImage(i,0,0),isNaN(e)||1>e||(f?b(d,0,0,j,k,e,function(){g&&(l.style.width=g+"px",l.style.height=g+"px"),h&&h()}):c(d,0,0,j,k,e,function(){g&&(l.style.width=g+"px",l.style.height=g+"px"),h&&h()}))}function b(a,b,c,e,f,g,j,k){if(!(isNaN(g)||1>g)){g|=0;var l,m=document.getElementById(a),n=m.getContext("2d");try{l=n.getImageData(b,c,e,f)}catch(o){throw new Error("unable to access image data: "+o)}var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N=l.data,O=g+g+1,P=e-1,Q=f-1,R=g+1,S=R*(R+1)/2,T=new d,U=T;for(r=1;O>r;r++)if(U=U.next=new d,r==R)var V=U;U.next=T;var W=null,X=null;v=u=0;var Y=h[g],Z=i[g];for(q=0;f>q;q++){for(E=F=G=H=w=x=y=z=0,A=R*(I=N[u]),B=R*(J=N[u+1]),C=R*(K=N[u+2]),D=R*(L=N[u+3]),w+=S*I,x+=S*J,y+=S*K,z+=S*L,U=T,r=0;R>r;r++)U.r=I,U.g=J,U.b=K,U.a=L,U=U.next;for(r=1;R>r;r++)s=u+((r>P?P:r)<<2),w+=(U.r=I=N[s])*(M=R-r),x+=(U.g=J=N[s+1])*M,y+=(U.b=K=N[s+2])*M,z+=(U.a=L=N[s+3])*M,E+=I,F+=J,G+=K,H+=L,U=U.next;for(W=T,X=V,p=0;e>p;p++)N[u+3]=L=z*Y>>Z,0!=L?(L=255/L,N[u]=(w*Y>>Z)*L,N[u+1]=(x*Y>>Z)*L,N[u+2]=(y*Y>>Z)*L):N[u]=N[u+1]=N[u+2]=0,w-=A,x-=B,y-=C,z-=D,A-=W.r,B-=W.g,C-=W.b,D-=W.a,s=v+((s=p+g+1)<P?s:P)<<2,E+=W.r=N[s],F+=W.g=N[s+1],G+=W.b=N[s+2],H+=W.a=N[s+3],w+=E,x+=F,y+=G,z+=H,W=W.next,A+=I=X.r,B+=J=X.g,C+=K=X.b,D+=L=X.a,E-=I,F-=J,G-=K,H-=L,X=X.next,u+=4;v+=e}for(p=0;e>p;p++){for(F=G=H=E=x=y=z=w=0,u=p<<2,A=R*(I=N[u]),B=R*(J=N[u+1]),C=R*(K=N[u+2]),D=R*(L=N[u+3]),w+=S*I,x+=S*J,y+=S*K,z+=S*L,U=T,r=0;R>r;r++)U.r=I,U.g=J,U.b=K,U.a=L,U=U.next;for(t=e,r=1;g>=r;r++)u=t+p<<2,w+=(U.r=I=N[u])*(M=R-r),x+=(U.g=J=N[u+1])*M,y+=(U.b=K=N[u+2])*M,z+=(U.a=L=N[u+3])*M,E+=I,F+=J,G+=K,H+=L,U=U.next,Q>r&&(t+=e);for(u=p,W=T,X=V,q=0;f>q;q++)s=u<<2,N[s+3]=L=z*Y>>Z,L>0?(L=255/L,N[s]=(w*Y>>Z)*L,N[s+1]=(x*Y>>Z)*L,N[s+2]=(y*Y>>Z)*L):N[s]=N[s+1]=N[s+2]=0,w-=A,x-=B,y-=C,z-=D,A-=W.r,B-=W.g,C-=W.b,D-=W.a,s=p+((s=q+R)<Q?s:Q)*e<<2,w+=E+=W.r=N[s],x+=F+=W.g=N[s+1],y+=G+=W.b=N[s+2],z+=H+=W.a=N[s+3],W=W.next,A+=I=X.r,B+=J=X.g,C+=K=X.b,D+=L=X.a,E-=I,F-=J,G-=K,H-=L,X=X.next,u+=e}n.putImageData(l,b,c),k()}}function c(a,b,c,e,f,g,j){if(!(isNaN(g)||1>g)){g|=0;var k,l=document.getElementById(a),m=l.getContext("2d");try{k=m.getImageData(b,c,e,f)}catch(n){throw new Error("unable to access image data: "+n)}var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=k.data,J=g+g+1,K=e-1,L=f-1,M=g+1,N=M*(M+1)/2,O=new d,P=O;for(q=1;J>q;q++)if(P=P.next=new d,q==M)var Q=P;P.next=O;var R=null,S=null;u=t=0;var T=h[g],U=i[g];for(p=0;f>p;p++){for(B=C=D=v=w=x=0,y=M*(E=I[t]),z=M*(F=I[t+1]),A=M*(G=I[t+2]),v+=N*E,w+=N*F,x+=N*G,P=O,q=0;M>q;q++)P.r=E,P.g=F,P.b=G,P=P.next;for(q=1;M>q;q++)r=t+((q>K?K:q)<<2),v+=(P.r=E=I[r])*(H=M-q),w+=(P.g=F=I[r+1])*H,x+=(P.b=G=I[r+2])*H,B+=E,C+=F,D+=G,P=P.next;for(R=O,S=Q,o=0;e>o;o++)I[t]=v*T>>U,I[t+1]=w*T>>U,I[t+2]=x*T>>U,v-=y,w-=z,x-=A,y-=R.r,z-=R.g,A-=R.b,r=u+((r=o+g+1)<K?r:K)<<2,B+=R.r=I[r],C+=R.g=I[r+1],D+=R.b=I[r+2],v+=B,w+=C,x+=D,R=R.next,y+=E=S.r,z+=F=S.g,A+=G=S.b,B-=E,C-=F,D-=G,S=S.next,t+=4;u+=e}for(o=0;e>o;o++){for(C=D=B=w=x=v=0,t=o<<2,y=M*(E=I[t]),z=M*(F=I[t+1]),A=M*(G=I[t+2]),v+=N*E,w+=N*F,x+=N*G,P=O,q=0;M>q;q++)P.r=E,P.g=F,P.b=G,P=P.next;for(s=e,q=1;g>=q;q++)t=s+o<<2,v+=(P.r=E=I[t])*(H=M-q),w+=(P.g=F=I[t+1])*H,x+=(P.b=G=I[t+2])*H,B+=E,C+=F,D+=G,P=P.next,L>q&&(s+=e);for(t=o,R=O,S=Q,p=0;f>p;p++)r=t<<2,I[r]=v*T>>U,I[r+1]=w*T>>U,I[r+2]=x*T>>U,v-=y,w-=z,x-=A,y-=R.r,z-=R.g,A-=R.b,r=o+((r=p+M)<L?r:L)*e<<2,v+=B+=R.r=I[r],w+=C+=R.g=I[r+1],x+=D+=R.b=I[r+2],R=R.next,y+=E=S.r,z+=F=S.g,A+=G=S.b,B-=E,C-=F,D-=G,S=S.next,t+=e}m.putImageData(k,b,c),j()}}function d(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function e(){ta=null,ua=null,ta=analytics.getService("myHomework"),j.isChromeApp||ta.getConfig().addCallback(function(a){a.setTrackingPermitted(!0)}),ua=ta.getTracker(j.analyticsID)}function f(a,b){window.XMLHttpRequest.prototype[a]=b(window.XMLHttpRequest.prototype[a])}function g(){if(j.isWindowsApp)return!1;var a=document.createElement("div");return"draggable"in a&&"ondrop"in a}!function(a,b){function c(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(a){return"%"+a.charCodeAt(0).toString(16)})}function d(a){var b,c=a||{};if(c.onError!==!1&&q.setUpOnErrorHandler(),c.wrapEvents!==!1&&q.setUpEventListening(),c.appenders)for(b=0;b<c.appenders.length;b++)q.addAppender(c.appenders[b]);if(c.handlers)for(b=0;b<c.handlers.length;b++)q.addHandler(c.handlers[b]);c.logLevel&&(q.loggingLevel=c.logLevel)}function e(a){s.push(a)}function f(a){t.push(a)}function g(a,b,c,d,e){var f,g,h,i,j={},k=e||s;for(h=0;h<k.length;h++){f=k[h],g=f(a,b,c,d);for(i in g)g.hasOwnProperty(i)&&(j[i]=g[i])}return j}function h(a,b){var c,d,e=b||t;for(d=0;d<e.length;d++)(c=e[d])(a)}function i(a){return function(b,c,d,e){if(!(q.levelOrder.indexOf(a)<q.levelOrder.indexOf(q.loggingLevel))){var f=e||{},i=g(a,c,b,d,f.appenders);h(i,f.handlers)}}}function j(c,d,e,f){function g(a){if(a===b||null===a)return{url:q.constant.UNKNOWN_LOG,lineNumber:q.constant.UNKNOWN_LOG,columnNumber:q.constant.UNKNOWN_LOG};for(var c,d=a.replace(/(\r\n|\n|\r)/gm,"").match(w),e=[],f=null!==d&&d!==b;f;)d=d[1].match(w),c=null!==d?d[1]:null,e=null!==d?d:e,f=null!==d&&d!==b;return{url:e.length>=1?e[1]:q.constant.UNKNOWN_LOG,lineNumber:e.length>=1?e[2]:q.constant.UNKNOWN_LOG,columnNumber:e.length>=1?e[3]:q.constant.UNKNOWN_LOG}}function h(a){return 10>a?"0"+a:a}var i,j,k,l,m=d?d.stack:(new Error).stack||null,n=q.constant.UNKNOWN_LOG,o=e||d.message||q.constant.UNKNOWN_LOG,p=new Date,r=a.location.href,s=q.constant.UNKNOWN_LOG,t=q.constant.UNKNOWN_LOG,u=a.navigator.language||q.constant.UNKNOWN_LOG,v=a.document.characterSet||document.charset||document.defaultCharset||q.constant.UNKNOWN_LOG,w=/(http\:\/\/.*\/.*\.js)\:(\d+)\:(\d+)(.*)$/;if(l=p.toISOString?p.toISOString():function(){return p.getUTCFullYear()+"-"+h(p.getUTCMonth()+1)+"-"+h(p.getUTCDate())+"T"+h(p.getUTCHours())+":"+h(p.getUTCMinutes())+":"+h(p.getUTCSeconds())+"."+(p.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}(),d&&null!==d.stack)k=g(m),n=k.url,s=k.lineNumber,t=k.columnNumber;else{var x=document.getElementsByTagName("script");n=(document.currentScript||x[x.length-1]).src}i={characterSet:v,columnNumber:t,language:u,lineNumber:s,logDate:l,msg:"["+c+"]: "+o,pageURL:r,stack:m||q.constant.UNKNOWN_LOG,type:"jserror",scriptURL:n};for(j in f)f.hasOwnProperty(j)&&null!==f[j]&&f[j]!==b&&(i[j]=f[j]);return i}function k(a){return function(b){$.ajax({type:"POST",url:a,data:JSON.stringify(b),dataType:"text"})}}function l(b){var c,d="";if(console)if(a.attachEvent){for(c in b)b.hasOwnProperty(c)&&(d+=c+"="+b[c]+"\n");console.error(d)}else console.error(b.msg,b)}function m(a,c,d){if(a&&a._wrapper)return a._wrapper;var e=function(){try{return a.apply(c||this,arguments)}catch(e){q.error(e.message,e,b,d)}};return a._wrapper=e,e}function n(a,b,c,d,e){var f;return u&&"function"==typeof u&&(f=u.apply(this,arguments)),q.fatal(a,e,{url:b,lineNumber:c,columnNumber:d}),f}function o(){a.onerror=n}function p(){var c,d,e=[];a.EventTarget?(c=a.EventTarget.prototype.addEventListener,d=a.EventTarget.prototype.removeEventListener,a.EventTarget.prototype.addEventListener=function(a,b,d){return c.call(this,a,q.watch(b),d)},a.EventTarget.prototype.removeEventListener=function(a,b,c){return d.call(this,a,q.watch(b),c)}):a.Element&&a.Element.prototype&&a.Element.prototype.attachEvent&&a.Element.prototype.addEventListener===b&&(Event.prototype.preventDefault||(Event.prototype.preventDefault=function(){this.returnValue=!1}),Event.prototype.stopPropagation||(Event.prototype.stopPropagation=function(){this.cancelBubble=!0}),Element.prototype.addEventListener||(c=function(a,b){var c=this,d=function(a){a.target=a.srcElement,a.currentTarget=c,b.handleEvent?b.handleEvent(a):b.call(c,a)};"DOMContentLoaded"!==a&&(this.attachEvent("on"+a,q.watch(d)),e.push({object:this,type:a,listener:b,wrapper:d}))},d=function(a,b){for(var c,d=0;d<e.length;){if(c=e[d],c.object==this&&c.type===a&&c.listener==b){"DOMContentLoaded"!==a&&this.detachEvent("on"+a,q.watch(c.wrapper)),e.splice(d,1);break}++d}},Element.prototype.addEventListener=c,Element.prototype.removeEventListener=d))}var q={};q.Appender={},q.Handler={},q.constant={},q.utils={},q.version="1.0.0",q.constant.UNKNOWN_LOG="?";var r={FATAL:"FATAL",ERROR:"ERROR",WARN:"WARN",INFO:"INFO",DEBUG:"DEBUG"};q.level=r,q.levelOrder=[r.DEBUG,r.INFO,r.WARN,r.ERROR,r.FATAL],"undefined"==typeof q.levelOrder.indexOf&&(q.levelOrder.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(Math.abs(f)===1/0&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),q.utils.fixedEncodeURIComponent=c;var s=[],t=[];q.debug=i(q.level.DEBUG),q.info=i(q.level.INFO),q.warn=i(q.level.WARN),q.error=i(q.level.ERROR),q.fatal=i(q.level.FATAL),q.addHandler=f,q.addAppender=e,q.init=d,q.loggingLevel=q.level.DEBUG,q.Appender.standardLogAppender=j,q.Handler.beaconLogHandler=k,q.Handler.consoleLogHandler=l,q.watch=function(a,b){return m(a,b)},q.attempt=function(a,b){var c=Array.prototype.slice.call(arguments,2);return m(a,b)(c)},q.localWatch=function(a,b,c){return m(a,c,b)},q.localAttempt=function(a,b,c){var d=Array.prototype.slice.call(arguments,3);return m(a,c,b)(d)};var u=a.onerror;q.setUpOnErrorHandler=o,q.setUpEventListening=p,a.Canadarm=q,a.navigator||(a.navigator={}),q._window=a}(this),function(a,b,c){"use strict";function d(a,c,d){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(e,f,g,h,i){function j(){n&&(d.cancel(n),n=null),l&&(l.$destroy(),l=null),m&&(n=d.leave(m),n.then(function(){n=null}),m=null)}function k(){var g=a.current&&a.current.locals;if(b.isDefined(g&&g.$template)){var g=e.$new(),h=a.current;m=i(g,function(a){d.enter(a,null,m||f).then(function(){!b.isDefined(o)||o&&!e.$eval(o)||c()}),j()}),l=h.scope=g,l.$emit("$viewContentLoaded"),l.$eval(p)}else j()}var l,m,n,o=g.autoscroll,p=g.onload||"";e.$on("$routeChangeSuccess",k),k()}}}function e(a,b,c){return{restrict:"ECA",priority:-400,link:function(d,e){var f=c.current,g=f.locals;e.html(g.$template);var h=a(e.contents());f.controller&&(g.$scope=d,g=b(f.controller,g),f.controllerAs&&(d[f.controllerAs]=g),e.data("$ngControllerController",g),e.children().data("$ngControllerController",g)),h(d)}}}a=b.module("ngRoute",["ng"]).provider("$route",function(){function a(a,c){return b.extend(Object.create(a),c)}function c(a,b){var c=b.caseInsensitiveMatch,d={originalPath:a,regexp:a},e=d.keys=[];return a=a.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(a,b,c,d){return a="?"===d?d:null,d="*"===d?d:null,e.push({name:c,optional:!!a}),b=b||"",""+(a?"":b)+"(?:"+(a?b:"")+(d&&"(.+?)"||"([^/]+)")+(a||"")+")"+(a||"")}).replace(/([\/$\*])/g,"\\$1"),d.regexp=new RegExp("^"+a+"$",c?"i":""),d}var d={};this.when=function(a,e){var f=b.copy(e);if(b.isUndefined(f.reloadOnSearch)&&(f.reloadOnSearch=!0),b.isUndefined(f.caseInsensitiveMatch)&&(f.caseInsensitiveMatch=this.caseInsensitiveMatch),d[a]=b.extend(f,a&&c(a,f)),a){var g="/"==a[a.length-1]?a.substr(0,a.length-1):a+"/";d[g]=b.extend({redirectTo:a},c(g,f))}return this},this.caseInsensitiveMatch=!1,this.otherwise=function(a){return"string"==typeof a&&(a={redirectTo:a}),this.when(null,a),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce",function(c,e,g,h,i,j,k){function l(a){var d=s.current;(q=(p=n())&&d&&p.$$route===d.$$route&&b.equals(p.pathParams,d.pathParams)&&!p.reloadOnSearch&&!r)||!d&&!p||c.$broadcast("$routeChangeStart",p,d).defaultPrevented&&a&&a.preventDefault()}function m(){var a=s.current,d=p;q?(a.params=d.params,b.copy(a.params,g),c.$broadcast("$routeUpdate",a)):(d||a)&&(r=!1,(s.current=d)&&d.redirectTo&&(b.isString(d.redirectTo)?e.path(o(d.redirectTo,d.params)).search(d.params).replace():e.url(d.redirectTo(d.pathParams,e.path(),e.search())).replace()),h.when(d).then(function(){if(d){var a,c,e=b.extend({},d.resolve);return b.forEach(e,function(a,c){e[c]=b.isString(a)?i.get(a):i.invoke(a,null,null,c)}),b.isDefined(a=d.template)?b.isFunction(a)&&(a=a(d.params)):b.isDefined(c=d.templateUrl)&&(b.isFunction(c)&&(c=c(d.params)),c=k.getTrustedResourceUrl(c),b.isDefined(c)&&(d.loadedTemplateUrl=c,a=j(c))),b.isDefined(a)&&(e.$template=a),h.all(e)}}).then(function(e){d==s.current&&(d&&(d.locals=e,b.copy(d.params,g)),c.$broadcast("$routeChangeSuccess",d,a))},function(b){d==s.current&&c.$broadcast("$routeChangeError",d,a,b)}))}function n(){var c,f;return b.forEach(d,function(d,g){var h;if(h=!f){var i=e.path();h=d.keys;var j={};if(d.regexp)if(i=d.regexp.exec(i)){for(var k=1,l=i.length;l>k;++k){var m=h[k-1],n=i[k];m&&n&&(j[m.name]=n)}h=j}else h=null;else h=null;h=c=h}h&&(f=a(d,{params:b.extend({},e.search(),c),pathParams:c}),f.$$route=d)}),f||d[null]&&a(d[null],{params:{},pathParams:{}})}function o(a,c){var d=[];return b.forEach((a||"").split(":"),function(a,b){if(0===b)d.push(a);else{var e=a.match(/(\w+)(?:[?*])?(.*)/),f=e[1];d.push(c[f]),d.push(e[2]||""),delete c[f]}}),d.join("")}var p,q,r=!1,s={routes:d,reload:function(){r=!0,c.$evalAsync(function(){l(),m()})},updateParams:function(a){if(!this.current||!this.current.$$route)throw f("norout");var c={},d=this;b.forEach(Object.keys(a),function(b){d.current.pathParams[b]||(c[b]=a[b])}),a=b.extend({},this.current.params,a),e.path(o(this.current.$$route.originalPath,a)),e.search(b.extend({},e.search(),c))}};return c.$on("$locationChangeStart",l),c.$on("$locationChangeSuccess",m),s}]});var f=b.$$minErr("ngRoute");a.provider("$routeParams",function(){this.$get=function(){return{}}}),a.directive("ngView",d),a.directive("ngView",e),d.$inject=["$route","$anchorScroll","$animate"],e.$inject=["$compile","$controller","$route"]}(window,window.angular),function(a,b,c){"use strict";b.module("ngAnimate",["ng"]).directive("ngAnimateChildren",function(){return function(a,c,d){d=d.ngAnimateChildren,b.isString(d)&&0===d.length?c.data("$$ngAnimateChildren",!0):a.$watch(d,function(a){c.data("$$ngAnimateChildren",!!a)})}}).factory("$$animateReflow",["$$rAF","$document",function(a,b){return function(b){return a(function(){b()})}}]).config(["$provide","$animateProvider",function(d,e){function f(a){for(var b=0;b<a.length;b++){var c=a[b];if(1==c.nodeType)return c}}function g(a,b){return f(a)==f(b)}var h,i=b.noop,j=b.forEach,k=e.$$selectors,l=b.isArray,m=b.isString,n=b.isObject,o={running:!0};d.decorator("$animate",["$delegate","$$q","$injector","$sniffer","$rootElement","$$asyncCallback","$rootScope","$document","$templateRequest","$$jqLite",function(a,c,d,p,q,r,s,t,u,v){function w(a,b){var c=a.data("$$ngAnimateState")||{};return b&&(c.running=!0,c.structural=!0,a.data("$$ngAnimateState",c)),c.disabled||c.running&&c.structural}function x(a){var b,d=c.defer();return d.promise.$$cancelFn=function(){b&&b()},s.$$postDigest(function(){b=a(function(){d.resolve()})}),d.promise}function y(a){return n(a)?(a.tempClasses&&m(a.tempClasses)&&(a.tempClasses=a.tempClasses.split(/\s+/)),a):void 0}function z(a,b,c){c=c||{};var d={};j(c,function(a,b){j(b.split(" "),function(b){d[b]=a})});var e=Object.create(null);j((a.attr("class")||"").split(/\s+/),function(a){e[a]=!0});var f=[],g=[];return j(b&&b.classes||[],function(a,b){var c=e[b],h=d[b]||{};!1===a?(c||"addClass"==h.event)&&g.push(b):!0===a&&(c&&"removeClass"!=h.event||f.push(b))}),0<f.length+g.length&&[f.join(" "),g.join(" ")]}function A(a){if(a){var b=[],c={};a=a.substr(1).split("."),(p.transitions||p.animations)&&b.push(d.get(k[""]));for(var e=0;e<a.length;e++){var f=a[e],g=k[f];g&&!c[f]&&(b.push(d.get(g)),c[f]=!0)}return b}}function B(a,c,d,e){function f(a,b){var c=a[b],d=a["before"+b.charAt(0).toUpperCase()+b.substr(1)];return c||d?("leave"==b&&(d=c,c=null),v.push({event:b,fn:c}),s.push({event:b,fn:d}),!0):void 0}function g(b,c,f){var g=[];j(b,function(a){a.fn&&g.push(a)});var h=0;j(g,function(b,j){var l=function(){a:{if(c){if((c[j]||i)(),++h<g.length)break a;c=null}f()}};switch(b.event){case"setClass":c.push(b.fn(a,k,m,l,e));break;case"animate":c.push(b.fn(a,d,e.from,e.to,l));break;case"addClass":c.push(b.fn(a,k||d,l,e));break;case"removeClass":c.push(b.fn(a,m||d,l,e));break;default:c.push(b.fn(a,l,e))}}),c&&0===c.length&&f()}var h=a[0];if(h){e&&(e.to=e.to||{},e.from=e.from||{});var k,m;l(d)&&(k=d[0],m=d[1],k?m?d=k+" "+m:(d=k,c="addClass"):(d=m,c="removeClass"));var n="setClass"==c,o=n||"addClass"==c||"removeClass"==c||"animate"==c,p=a.attr("class")+" "+d;if(J(p)){var q=i,r=[],s=[],t=i,u=[],v=[],p=(" "+p).replace(/\s+/g,".");return j(A(p),function(a){!f(a,c)&&n&&(f(a,"addClass"),f(a,"removeClass"))}),{node:h,event:c,className:d,isClassBased:o,isSetClassOperation:n,applyStyles:function(){e&&a.css(b.extend(e.from||{},e.to||{}))},before:function(a){q=a,g(s,r,function(){q=i,a()})},after:function(a){t=a,g(v,u,function(){t=i,a()})},cancel:function(){r&&(j(r,function(a){(a||i)(!0)}),q(!0)),u&&(j(u,function(a){(a||i)(!0)}),t(!0))}}}}}function C(a,c,d,e,f,g,k,l){function m(b){var e="$animate:"+b;t&&t[e]&&0<t[e].length&&r(function(){d.triggerHandler(e,{event:a,className:c})})}function n(){m("before")}function o(){m("after")}function p(){p.hasBeenRun||(p.hasBeenRun=!0,g())}function q(){if(!q.hasBeenRun){s&&s.applyStyles(),q.hasBeenRun=!0,k&&k.tempClasses&&j(k.tempClasses,function(a){h.removeClass(d,a)});var b=d.data("$$ngAnimateState");b&&(s&&s.isClassBased?E(d,c):(r(function(){var b=d.data("$$ngAnimateState")||{};y==b.index&&E(d,c,a)}),d.data("$$ngAnimateState",b))),m("close"),l()}}var s=B(d,a,c,k);if(!s)return p(),n(),o(),q(),i;a=s.event,c=s.className;var t=b.element._data(s.node),t=t&&t.events;if(e||(e=f?f.parent():d.parent()),F(d,e))return p(),n(),o(),q(),i;e=d.data("$$ngAnimateState")||{};var u=e.active||{},v=e.totalActive||0,w=e.last;if(f=!1,v>0){if(v=[],s.isClassBased)"setClass"==w.event?(v.push(w),E(d,c)):u[c]&&(x=u[c],x.event==a?f=!0:(v.push(x),E(d,c)));else if("leave"==a&&u["ng-leave"])f=!0;else{for(var x in u)v.push(u[x]);e={},E(d,!0)}0<v.length&&j(v,function(a){a.cancel()})}if(!s.isClassBased||s.isSetClassOperation||"animate"==a||f||(f="addClass"==a==d.hasClass(c)),f)return p(),n(),o(),m("close"),l(),i;u=e.active||{},v=e.totalActive||0,"leave"==a&&d.one("$destroy",function(a){a=b.element(this);var c=a.data("$$ngAnimateState");c&&(c=c.active["ng-leave"])&&(c.cancel(),E(a,"ng-leave"))}),h.addClass(d,"ng-animate"),k&&k.tempClasses&&j(k.tempClasses,function(a){h.addClass(d,a)});var y=H++;return v++,u[c]=s,d.data("$$ngAnimateState",{last:s,active:u,index:y,totalActive:v}),n(),s.before(function(b){var e=d.data("$$ngAnimateState");b=b||!e||!e.active[c]||s.isClassBased&&e.active[c].event!=a,p(),!0===b?q():(o(),s.after(q))}),s.cancel}function D(a){(a=f(a))&&(a=b.isFunction(a.getElementsByClassName)?a.getElementsByClassName("ng-animate"):a.querySelectorAll(".ng-animate"),j(a,function(a){a=b.element(a),(a=a.data("$$ngAnimateState"))&&a.active&&j(a.active,function(a){a.cancel()})}))}function E(a,b){if(g(a,q))o.disabled||(o.running=!1,o.structural=!1);else if(b){var c=a.data("$$ngAnimateState")||{},d=!0===b;!d&&c.active&&c.active[b]&&(c.totalActive--,delete c.active[b]),(d||!c.totalActive)&&(h.removeClass(a,"ng-animate"),a.removeData("$$ngAnimateState"))}}function F(a,c){if(o.disabled)return!0;if(g(a,q))return o.running;var d,e,f;do{if(0===c.length)break;var h=g(c,q),i=h?o:c.data("$$ngAnimateState")||{};if(i.disabled)return!0;h&&(f=!0),!1!==d&&(h=c.data("$$ngAnimateChildren"),b.isDefined(h)&&(d=h)),e=e||i.running||i.last&&!i.last.isClassBased}while(c=c.parent());return!f||!d&&e}h=v,q.data("$$ngAnimateState",o);var G=s.$watch(function(){return u.totalPendingRequests},function(a,b){0===a&&(G(),s.$$postDigest(function(){s.$$postDigest(function(){o.running=!1})}))}),H=0,I=e.classNameFilter(),J=I?function(a){return I.test(a)}:function(){return!0};return{animate:function(a,c,d,e,g){return e=e||"ng-inline-animate",g=y(g)||{},g.from=d?c:null,g.to=d?d:c,x(function(c){return C("animate",e,b.element(f(a)),null,null,i,g,c)})},enter:function(c,d,e,g){return g=y(g),c=b.element(c),d=d&&b.element(d),e=e&&b.element(e),w(c,!0),a.enter(c,d,e),x(function(a){return C("enter","ng-enter",b.element(f(c)),d,e,i,g,a)})},leave:function(c,d){return d=y(d),c=b.element(c),D(c),w(c,!0),x(function(e){return C("leave","ng-leave",b.element(f(c)),null,null,function(){a.leave(c)},d,e)})},move:function(c,d,e,g){return g=y(g),c=b.element(c),d=d&&b.element(d),e=e&&b.element(e),D(c),w(c,!0),a.move(c,d,e),x(function(a){return C("move","ng-move",b.element(f(c)),d,e,i,g,a)})},addClass:function(a,b,c){return this.setClass(a,b,[],c)},removeClass:function(a,b,c){return this.setClass(a,[],b,c)},setClass:function(c,d,e,g){if(g=y(g),c=b.element(c),c=b.element(f(c)),w(c))return a.$$setClassImmediately(c,d,e,g);var h,i=c.data("$$animateClasses"),k=!!i;return i||(i={classes:{}}),h=i.classes,d=l(d)?d:d.split(" "),j(d,function(a){a&&a.length&&(h[a]=!0)}),e=l(e)?e:e.split(" "),j(e,function(a){a&&a.length&&(h[a]=!1)}),k?(g&&i.options&&(i.options=b.extend(i.options||{},g)),i.promise):(c.data("$$animateClasses",i={classes:h,options:g}),i.promise=x(function(b){var d=c.parent(),e=f(c),g=e.parentNode;if(g&&!g.$$NG_REMOVED&&!e.$$NG_REMOVED){e=c.data("$$animateClasses"),c.removeData("$$animateClasses");var g=c.data("$$ngAnimateState")||{},h=z(c,e,g.active);return h?C("setClass",h,c,d,null,function(){h[0]&&a.$$addClassImmediately(c,h[0]),h[1]&&a.$$removeClassImmediately(c,h[1])},e.options,b):b()}b()}))},cancel:function(a){a.$$cancelFn()},enabled:function(a,b){switch(arguments.length){case 2:if(a)E(b);else{var c=b.data("$$ngAnimateState")||{};c.disabled=!0,b.data("$$ngAnimateState",c)}break;case 1:o.disabled=!a;break;default:a=!o.disabled}return!!a}}}]),e.register("",["$window","$sniffer","$timeout","$$animateReflow",function(d,e,g,k){function n(){G||(G=k(function(){J=[],G=null,H={}}))}function o(a,b){G&&G(),J.push(b),G=k(function(){j(J,function(a){a()}),J=[],G=null,H={}})}function p(a,c){var d=f(a);a=b.element(d),M.push(a),d=Date.now()+c,L>=d||(g.cancel(K),L=d,K=g(function(){q(M),M=[]},c,!1))}function q(a){j(a,function(a){(a=a.data("$$ngAnimateCSS3Data"))&&j(a.closeAnimationFns,function(a){a()})})}function r(a,b){var c=b?H[b]:null;if(!c){var e=0,f=0,g=0,h=0;j(a,function(a){if(1==a.nodeType){a=d.getComputedStyle(a)||{},e=Math.max(s(a[B+"Duration"]),e),f=Math.max(s(a[B+"Delay"]),f),h=Math.max(s(a[D+"Delay"]),h);var b=s(a[D+"Duration"]);b>0&&(b*=parseInt(a[D+"IterationCount"],10)||1),g=Math.max(b,g)}}),c={total:0,transitionDelay:f,transitionDuration:e,animationDelay:h,animationDuration:g},b&&(H[b]=c)}return c}function s(a){var b=0;return a=m(a)?a.split(/\s*,\s*/):[],j(a,function(a){b=Math.max(parseFloat(a)||0,b)}),b}function t(a,b,c,d){a=0<=["ng-enter","ng-leave","ng-move"].indexOf(c);var e,g=b.parent(),i=g.data("$$ngAnimateKey");i||(g.data("$$ngAnimateKey",++I),i=I),e=i+"-"+f(b).getAttribute("class");var g=e+" "+c,i=H[g]?++H[g].total:0,j={};if(i>0){var k=c+"-stagger",j=e+" "+k;(e=!H[j])&&h.addClass(b,k),j=r(b,j),e&&h.removeClass(b,k)}h.addClass(b,c);var k=b.data("$$ngAnimateCSS3Data")||{},l=r(b,g);return e=l.transitionDuration,l=l.animationDuration,a&&0===e&&0===l?(h.removeClass(b,c),!1):(c=d||a&&e>0,a=l>0&&0<j.animationDelay&&0===j.animationDuration,b.data("$$ngAnimateCSS3Data",{stagger:j,cacheKey:g,running:k.running||0,itemIndex:i,blockTransition:c,closeAnimationFns:k.closeAnimationFns||[]}),g=f(b),c&&(v(g,!0),d&&b.css(d)),a&&(g.style[D+"PlayState"]="paused"),!0)}function u(a,b,c,d,e){function i(){b.off(G,k),h.removeClass(b,m),h.removeClass(b,n),A&&g.cancel(A),z(b,c);var a,d=f(b);for(a in o)d.style.removeProperty(o[a])}function k(a){a.stopPropagation();var b=a.originalEvent||a;a=b.$manualTimeStamp||b.timeStamp||Date.now(),b=parseFloat(b.elapsedTime.toFixed(3)),Math.max(a-B,0)>=y&&b>=x&&d()}var l=f(b);if(a=b.data("$$ngAnimateCSS3Data"),-1!=l.getAttribute("class").indexOf(c)&&a){var m="",n="";j(c.split(" "),function(a,b){var c=(b>0?" ":"")+a;m+=c+"-active",n+=c+"-pending"});var o=[],q=a.itemIndex,s=a.stagger,t=0;if(q>0){t=0,0<s.transitionDelay&&0===s.transitionDuration&&(t=s.transitionDelay*q);var u=0;0<s.animationDelay&&0===s.animationDuration&&(u=s.animationDelay*q,o.push(F+"animation-play-state")),t=Math.round(100*Math.max(t,u))/100}t||(h.addClass(b,m),a.blockTransition&&v(l,!1));var w=r(b,a.cacheKey+" "+m),x=Math.max(w.transitionDuration,w.animationDuration);if(0!==x){!t&&e&&(w.transitionDuration||(b.css("transition",w.animationDuration+"s linear all"),o.push("transition")),b.css(e));var q=Math.max(w.transitionDelay,w.animationDelay),y=1e3*q;0<o.length&&(s=l.getAttribute("style")||"",";"!==s.charAt(s.length-1)&&(s+=";"),l.setAttribute("style",s+" "));var A,B=Date.now(),G=E+" "+C,q=1e3*(t+1.5*(q+x));return t>0&&(h.addClass(b,n),A=g(function(){A=null,0<w.transitionDuration&&v(l,!1),0<w.animationDuration&&(l.style[D+"PlayState"]=""),h.addClass(b,m),h.removeClass(b,n),e&&(0===w.transitionDuration&&b.css("transition",w.animationDuration+"s linear all"),b.css(e),o.push("transition"))},1e3*t,!1)),b.on(G,k),a.closeAnimationFns.push(function(){i(),d()}),a.running++,p(b,q),i}h.removeClass(b,m),z(b,c),d()}else d()}function v(a,b){a.style[B+"Property"]=b?"none":""}function w(a,b,c,d){return t(a,b,c,d)?function(a){a&&z(b,c)}:void 0}function x(a,b,c,d,e){return b.data("$$ngAnimateCSS3Data")?u(a,b,c,d,e):(z(b,c),void d())}function y(a,b,c,d,e){var f=w(a,b,c,e.from);if(f){var g=f;return o(b,function(){g=x(a,b,c,d,e.to)}),function(a){(g||i)(a)}}n(),d()}function z(a,b){h.removeClass(a,b);var c=a.data("$$ngAnimateCSS3Data");c&&(c.running&&c.running--,c.running&&0!==c.running||a.removeData("$$ngAnimateCSS3Data"))}function A(a,b){var c="";return a=l(a)?a:a.split(/\s+/),j(a,function(a,d){a&&0<a.length&&(c+=(d>0?" ":"")+a+b)}),c}var B,C,D,E,F="";a.ontransitionend===c&&a.onwebkittransitionend!==c?(F="-webkit-",B="WebkitTransition",C="webkitTransitionEnd transitionend"):(B="transition",C="transitionend"),a.onanimationend===c&&a.onwebkitanimationend!==c?(F="-webkit-",D="WebkitAnimation",E="webkitAnimationEnd animationend"):(D="animation",E="animationend");var G,H={},I=0,J=[],K=null,L=0,M=[];return{animate:function(a,b,c,d,e,f){return f=f||{},f.from=c,f.to=d,y("animate",a,b,e,f)},enter:function(a,b,c){return c=c||{},y("enter",a,"ng-enter",b,c)},leave:function(a,b,c){return c=c||{},y("leave",a,"ng-leave",b,c)},move:function(a,b,c){return c=c||{},y("move",a,"ng-move",b,c)},beforeSetClass:function(a,b,c,d,e){return e=e||{},b=A(c,"-remove")+" "+A(b,"-add"),(e=w("setClass",a,b,e.from))?(o(a,d),e):(n(),void d())},beforeAddClass:function(a,b,c,d){return d=d||{},(b=w("addClass",a,A(b,"-add"),d.from))?(o(a,c),b):(n(),void c())},beforeRemoveClass:function(a,b,c,d){return d=d||{},(b=w("removeClass",a,A(b,"-remove"),d.from))?(o(a,c),b):(n(),void c())},setClass:function(a,b,c,d,e){return e=e||{},c=A(c,"-remove"),b=A(b,"-add"),x("setClass",a,c+" "+b,d,e.to)},addClass:function(a,b,c,d){return d=d||{},x("addClass",a,A(b,"-add"),c,d.to)},removeClass:function(a,b,c,d){return d=d||{},x("removeClass",a,A(b,"-remove"),c,d.to)}}}])}])}(window,window.angular),function(a,b,c){"use strict";function d(a){var c=[];return i(c,b.noop).chars(a),c.join("")}function e(a){var b={};a=a.split(",");var c;for(c=0;c<a.length;c++)b[a[c]]=!0;return b}function f(a,c){function d(a,d,f,h){if(d=b.lowercase(d),w[d])for(;s.last()&&x[s.last()];)e("",s.last());v[d]&&s.last()==d&&e("",d),(h=u[d]||!!h)||s.push(d);var i={};f.replace(m,function(a,b,c,d,e){i[b]=g(c||d||e||"")}),c.start&&c.start(d,i,h)}function e(a,d){var e,f=0;if(d=b.lowercase(d))for(f=s.length-1;f>=0&&s[f]!=d;f--);if(f>=0){for(e=s.length-1;e>=f;e--)c.end&&c.end(s[e]);s.length=f}}"string"!=typeof a&&(a=null===a||"undefined"==typeof a?"":""+a);var f,h,i,s=[],t=a;for(s.last=function(){return s[s.length-1]};a;){if(i="",h=!0,s.last()&&y[s.last()]?(a=a.replace(new RegExp("(.*)<\\s*\\/\\s*"+s.last()+"[^>]*>","i"),function(a,b){return b=b.replace(p,"$1").replace(r,"$1"),c.chars&&c.chars(g(b)),""}),e("",s.last())):(0===a.indexOf("<!--")?(f=a.indexOf("--",4),f>=0&&a.lastIndexOf("-->",f)===f&&(c.comment&&c.comment(a.substring(4,f)),a=a.substring(f+3),h=!1)):q.test(a)?(f=a.match(q))&&(a=a.replace(f[0],""),h=!1):o.test(a)?(f=a.match(l))&&(a=a.substring(f[0].length),f[0].replace(l,e),h=!1):n.test(a)&&((f=a.match(k))?(f[4]&&(a=a.substring(f[0].length),f[0].replace(k,d)),h=!1):(i+="<",a=a.substring(1))),h&&(f=a.indexOf("<"),i+=0>f?a:a.substring(0,f),a=0>f?"":a.substring(f),c.chars&&c.chars(g(i)))),a==t)throw j("badparse",a);t=a}e()}function g(a){if(!a)return"";var b=D.exec(a);a=b[1];var c=b[3];return(b=b[2])&&(C.innerHTML=b.replace(/</g,"&lt;"),b="textContent"in C?C.textContent:C.innerText),a+b+c}function h(a){return a.replace(/&/g,"&amp;").replace(s,function(a){var b=a.charCodeAt(0);return a=a.charCodeAt(1),"&#"+(1024*(b-55296)+(a-56320)+65536)+";"}).replace(t,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(a,c){var d=!1,e=b.bind(a,a.push);return{start:function(a,f,g){a=b.lowercase(a),!d&&y[a]&&(d=a),d||!0!==z[a]||(e("<"),e(a),b.forEach(f,function(d,f){var g=b.lowercase(f),i="img"===a&&"src"===g||"background"===g;!0!==B[g]||!0===A[g]&&!c(d,i)||(e(" "),e(f),e('="'),e(h(d)),e('"'))}),e(g?"/>":">"))},end:function(a){a=b.lowercase(a),d||!0!==z[a]||(e("</"),e(a),e(">")),a==d&&(d=!1)},chars:function(a){d||e(h(a))}}}var j=b.$$minErr("$sanitize"),k=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,l=/^<\/\s*([\w:-]+)[^>]*>/,m=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,n=/^</,o=/^<\//,p=/\x3c!--(.*?)--\x3e/g,q=/<!DOCTYPE([^>]*?)>/i,r=/<!\[CDATA\[(.*?)]]\x3e/g,s=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,t=/([^\#-~| |!])/g,u=e("area,br,col,hr,img,wbr");a=e("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),c=e("rp,rt");var v=b.extend({},c,a),w=b.extend({},a,e("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),x=b.extend({},c,e("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var"));a=e("animate,animateColor,animateMotion,animateTransform,circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set,stop,svg,switch,text,title,tspan,use");var y=e("script,style"),z=b.extend({},u,w,x,v,a),A=e("background,cite,href,longdesc,src,usemap,xlink:href");a=e("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),c=e("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan");
var B=b.extend({},A,c,a),C=document.createElement("pre"),D=/^(\s*)([\s\S]*?)(\s*)$/;b.module("ngSanitize",[]).provider("$sanitize",function(){this.$get=["$$sanitizeUri",function(a){return function(b){var c=[];return f(b,i(c,function(b,c){return!/^unsafe/.test(a(b,c))})),c.join("")}}]}),b.module("ngSanitize").filter("linky",["$sanitize",function(a){var c=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/,e=/^mailto:/;return function(f,g){function h(a){a&&n.push(d(a))}function i(a,c){n.push("<a "),b.isDefined(g)&&n.push('target="',g,'" '),n.push('href="',a.replace(/"/g,"&quot;"),'">'),h(c),n.push("</a>")}if(!f)return f;for(var j,k,l,m=f,n=[];j=m.match(c);)k=j[0],j[2]||j[4]||(k=(j[3]?"http://":"mailto:")+k),l=j.index,h(m.substr(0,l)),i(k,j[0].replace(e,"")),m=m.substring(l+j[0].length);return h(m),a(n.join(""))}}])}(window,window.angular),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.relativeDate=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b,c){var d=e(a,c);return function(a){var c=b||new Date;a instanceof Date||(a=new Date(a));var e=null,g=60,h=60*g,i=24*h,j=7*i,k=30*i,l=365*i;e=f(c,a),e>i&&j>e&&(a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0),e=f(c,a));var m=function(b,e){var f;return f="just_now"===b?b:c>=a?b+"_ago":b+"_from_now",d.instant(f,{time:e})};switch(!1){case!(30>e):return m("just_now");case!(g>e):return m("seconds",e);case!(2*g>e):return m("a_minute");case!(h>e):return m("minutes",Math.floor(e/g));case 1!==Math.floor(e/h):return m("an_hour");case!(i>e):return m("hours",Math.floor(e/h));case!(2*i>e):return m("a_day");case!(j>e):return m("days",Math.floor(e/i));case 1!==Math.floor(e/j):return m("a_week");case!(k>e):return m("weeks",Math.floor(e/j));case 1!==Math.floor(e/k):return m("a_month");case!(l>e):return m("months",Math.floor(e/k));case 1!==Math.floor(e/l):return m("a_year");default:return m("over_a_year")}}}Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=d;var e=function(a,b){return a.has("$translate")?a.get("$translate"):{instant:function(a,c){return b[a].replace("{{time}}",c.time)}}},f=function(a,b){return Math.round(Math.abs(a-b)/1e3)}},{}],2:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a("./translations"),f=d(e),g=a("./filter"),h=d(g),i=angular.module("relativeDate",[]);i.value("now",void 0),i.value("relativeDateTranslations",f["default"]),i.filter("relativeDate",["$injector","now","relativeDateTranslations",h["default"]]),c["default"]=i},{"./filter":1,"./translations":3}],3:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]={just_now:"Just now",seconds_ago:"{{time}} seconds ago",a_minute_ago:"A minute ago",minutes_ago:"{{time}} minutes ago",an_hour_ago:"An hour ago",hours_ago:"{{time}} hours ago",a_day_ago:"Yesterday",days_ago:"{{time}} days ago",a_week_ago:"A week ago",weeks_ago:"{{time}} weeks ago",a_month_ago:"A month ago",months_ago:"{{time}} months ago",a_year_ago:"A year ago",years_ago:"{{time}} years ago",over_a_year_ago:"Over a year ago",seconds_from_now:"{{time}} seconds from now",a_minute_from_now:"A minute from now",minutes_from_now:"{{time}} minutes from now",an_hour_from_now:"An hour from now",hours_from_now:"{{time}} hours from now",a_day_from_now:"Tomorrow",days_from_now:"{{time}} days from now",a_week_from_now:"A week from now",weeks_from_now:"{{time}} weeks from now",a_month_from_now:"A month from now",months_from_now:"{{time}} months from now",a_year_from_now:"A year from now",years_from_now:"{{time}} years from now",over_a_year_from_now:"Over a year from now"}},{}]},{},[2])(2)}),angular.module("ui.bootstrap.modal",["ui.bootstrap.transition"]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b==a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b==a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}).directive("modalWindow",["$modalStack","$timeout",function(a,b){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:function(a,b){return b.templateUrl||"templates/libs/modal/window.html"},link:function(a,c,d){c.addClass(d.windowClass||""),a.size=d.size,b(function(){a.animate=!0,c[0].querySelectorAll("[autofocus]").length||c[0].focus()},200)}}}]).directive("modalTransclude",function(){return{link:function(a,b,c,d,e){e(a.$parent,function(a){b.empty(),b.append(a)})}}}).factory("$modalStack",["$transition","$timeout","$document","$compile","$rootScope","$$stackedMap",function(a,b,c,d,e,f){function g(a){var b=c.find("body").eq(0),d=j.get(a).value;j.remove(a),h(d.modalDomEl,d.modalScope,300,function(){d.modalScope.$destroy(),b.toggleClass(i,j.length()>0)})}function h(c,d,e,f){function g(){g.done||(g.done=!0,c.remove(),f&&f())}d.animate=!1;var h=a.transitionEndEventName;if(h){var i=b(g,e);c.bind(h,function(){b.cancel(i),g(),d.$apply()})}else b(g)}var i="modal-open",j=f.createNew(),k={};return c.bind("keydown",function(a){var b;27===a.which&&(b=j.top(),b&&b.value.keyboard&&(a.preventDefault(),e.$apply(function(){k.dismiss(b.key,"escape key press")})))}),k.open=function(a,b){j.add(a,{deferred:b.deferred,modalScope:b.scope,keyboard:b.keyboard});var e=c.find("body").eq(0),f=angular.element("<div modal-window></div>");f.attr({"template-url":b.windowTemplateUrl,"window-class":b.windowClass,size:b.size,index:j.length()-1,animate:"animate"}).html(b.content);var g=d(f)(b.scope);j.top().value.modalDomEl=g,e.append(g),e.addClass(i)},k.close=function(a,b){var c=j.get(a);c&&(c.value.deferred.resolve(b),g(a))},k.forceClose=function(a){},k.dismiss=function(a,b){var c=j.get(a);c&&(c.value.deferred.reject(b),g(a))},k.dismissAll=function(a){for(var b=this.getTop();b;)this.dismiss(b.key,a),b=this.getTop()},k.getTop=function(){return j.top()},k}]).provider("$modal",function(){var a={options:{keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack","$timeout",function(b,c,d,e,f,g,h,i){function k(a){return a.template?d.when(a.template):e.get(angular.isFunction(a.templateUrl)?a.templateUrl():a.templateUrl,{cache:f}).then(function(a){return a.data})}function l(a){var c=[];return angular.forEach(a,function(a){(angular.isFunction(a)||angular.isArray(a))&&c.push(d.when(b.invoke(a)))}),c}var m=!1,n={};return n.open=function(b){if(b.analyticsTitle?ua.sendAppView(b.analyticsTitle):b.title?ua.sendAppView(b.title):b.controller&&ua.sendAppView(b.controller),j.isMacApp){if(m)return;m=!0,b.resolve&&delete b.resolve;var e={};for(var f in c)"$"!=f.charAt(0)&&"function"!=typeof c[f]&&(e[f]=c[f]);return b.windowScope=e,MacApp.Window.openModal(b),void i(function(){m=!1},1500)}var n=d.defer(),o=d.defer(),p={result:n.promise,opened:o.promise,close:function(a){h.close(p,a)},dismiss:function(a){h.dismiss(p,a)}};if(b=angular.extend({},a.options,b),b.resolve=b.resolve||{},b.params=b.params||{},b.resolve.$modalParams=function(){return b.params},!b.template&&!b.templateUrl)throw new Error("One of template or templateUrl options is required.");var q=d.all([k(b)].concat(l(b.resolve)));return q.then(function(a){var d=(b.scope||c).$new();d.$close=p.close,d.$dismiss=p.dismiss;var e,f={},i=1;b.controller&&(f.$scope=d,f.$modalInstance=p,angular.forEach(b.resolve,function(b,c){f[c]=a[i++]}),e=g(b.controller,f),b.controllerAs&&(d[b.controllerAs]=e)),h.open(p,{scope:d,deferred:n,content:a[0],keyboard:b.keyboard,windowClass:b.windowClass,windowTemplateUrl:b.windowTemplateUrl,size:b.size})},function(a){n.reject(a)}),q.then(function(){o.resolve(!0)},function(){o.reject(!1)}),p},n.close=function(){if(j.isMacApp)return void MacApp.Window.close();var a=h.getTop();a&&h.close(a.key,"close")},n.forceClose=function(){var a=h.getTop();a&&h.close(a.key,"close")},n}]};return a}),angular.module("ui.bootstrap.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function(a,b,c){function d(a){for(var b in a)if(void 0!==f.style[b])return a[b]}var e=function(d,f,g){g=g||{};var h=a.defer(),i=e[g.animation?"animationEndEventName":"transitionEndEventName"],j=function(a){c.$apply(function(){d.unbind(i,j),h.resolve(d)})};return i&&d.bind(i,j),b(function(){angular.isString(f)?d.addClass(f):angular.isFunction(f)?f(d):angular.isObject(f)&&d.css(f),i||h.resolve(d)}),h.promise.cancel=function(){i&&d.unbind(i,j),h.reject("Transition cancelled")},h.promise},f=document.createElement("trans"),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},h={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return e.transitionEndEventName=d(g),e.animationEndEventName=d(h),e}]),angular.module("ui.bootstrap.datepicker",["ui.bootstrap.dateparser","ui.bootstrap.position"]).constant("datepickerConfig",{formatDay:"d",formatMonth:"MMMM",formatYear:"yyyy",formatDayHeader:"EEE",formatDayTitle:"MMMM yyyy",formatMonthTitle:"yyyy",datepickerMode:"day",minMode:"day",maxMode:"year",showWeeks:!0,startingDay:0,yearRange:20,minDate:null,maxDate:null,autoSelectMonth:!1}).controller("DatepickerController",["$scope","$attrs","$parse","$interpolate","$timeout","$log","dateFilter","datepickerConfig",function(a,b,c,d,e,f,g,h){var i=this,j={$setViewValue:angular.noop};a.$watch("busyDays",function(a){a&&(i.busyDays=a,i.refreshView())}),a.$watch("noSchoolDays",function(a){a&&(i.noSchoolDays=a,i.refreshView())}),a.$watch("explicitBlockDays",function(a){a&&(i.explicitBlockDays=a,i.explicitBlockDates=Object.keys(a),i.refreshView())}),a.$watch("blockSettings",function(a,b){a&&(i.blockSettings=a,i.refreshView())},!0),a.$watch("initDate",function(a,b){a&&(i.activeDate=a,i.refreshView())},!0),this.modes=["day","month","year"],angular.forEach(["formatDay","formatMonth","formatYear","formatDayHeader","formatDayTitle","formatMonthTitle","minMode","maxMode","showWeeks","startingDay","yearRange","autoSelectMonth"],function(c,e){i[c]=angular.isDefined(b[c])?8>e?d(b[c])(a.$parent):a.$parent.$eval(b[c]):h[c]}),angular.forEach(["minDate","maxDate"],function(d){b[d]?a.$parent.$watch(c(b[d]),function(a){i[d]=a?new Date(a):null,i.refreshView()}):i[d]=h[d]?new Date(h[d]):null}),a.datepickerMode=a.datepickerMode||h.datepickerMode,a.uniqueId="datepicker-"+a.$id+"-"+Math.floor(1e4*Math.random()),this.activeDate=angular.isDefined(b.initDate)&&a.$parent.$eval(b.initDate)?a.$parent.$eval(b.initDate):new Date,a.isActive=function(b){return 0===i.compare(b.date,i.activeDate)?(a.activeDateId=b.uid,!0):!1},this.init=function(a){j=a,j.$render=function(){i.render()}},this.render=function(){if(j.$modelValue){var a=new Date(j.$modelValue),b=!isNaN(a);b?this.activeDate=a:f.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),j.$setValidity("date",b)}this.refreshView()},this.refreshView=function(){if(this.element){this._refreshView();var a=j.$modelValue?new Date(j.$modelValue):null;j.$setValidity("date-disabled",!a||this.element&&!this.isDisabled(a))}},this.createDateObject=function(a,b){var c=j.$modelValue?new Date(j.$modelValue):null;return{date:a,label:g(a,b),selected:c&&0===this.compare(a,c),disabled:this.isDisabled(a),current:0===this.compare(a,new Date)}},this.selectedDate=function(){return j.$modelValue?new Date(j.$modelValue):null},this.isDisabled=function(c){return this.minDate&&this.compare(c,this.minDate)<0||this.maxDate&&this.compare(c,this.maxDate)>0||b.dateDisabled&&a.dateDisabled({date:c,mode:a.datepickerMode})},this.split=function(a,b){for(var c=[];a.length>0;)c.push(a.splice(0,b));return c},a.select=function(b){if(a.datepickerMode===i.minMode){var c=j.$modelValue?new Date(j.$modelValue):new Date(0,0,0,0,0,0,0);c.setFullYear(b.getFullYear(),b.getMonth(),b.getDate()),j.$setViewValue(c),j.$render()}else i.activeDate=b,a.datepickerMode=i.modes[i.modes.indexOf(a.datepickerMode)-1]},a.move=function(a){var b=i.activeDate.getFullYear()+a*(i.step.years||0),c=i.activeDate.getMonth()+a*(i.step.months||0);i.activeDate.setFullYear(b,c,1),i.refreshView(),i.autoSelectMonth&&(j.$setViewValue(i.activeDate),j.$render())},a.toggleMode=function(b){b=b||1,a.datepickerMode===i.maxMode&&1===b||a.datepickerMode===i.minMode&&-1===b||(a.datepickerMode=i.modes[i.modes.indexOf(a.datepickerMode)+b])},a.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"};var k=function(){e(function(){i.element[0].focus()},0,!1)};a.$on("datepicker.focus",k),a.keydown=function(b){var c=a.keys[b.which];if(c&&!b.shiftKey&&!b.altKey)if(b.preventDefault(),b.stopPropagation(),"enter"===c||"space"===c){if(i.isDisabled(i.activeDate))return;a.select(i.activeDate),k()}else!b.ctrlKey||"up"!==c&&"down"!==c?(i.handleKeyDown(c,b),i.refreshView()):(a.toggleMode("up"===c?1:-1),k())}}]).directive("datepicker",function(){return{restrict:"EA",replace:!0,templateUrl:"templates/libs/datepicker/datepicker.html",scope:{datepickerMode:"=?",dateDisabled:"&",busyDays:"=busyDays",noSchoolDays:"=noSchoolDays",blockSettings:"=blockSettings",explicitBlockDays:"=explicitBlockDays",initDate:"=initDate"},require:["datepicker","?^ngModel"],controller:"DatepickerController",link:function(a,b,c,d){var e=d[0],f=d[1];f&&e.init(f)}}}).directive("daypicker",["dateFilter",function(a){return{restrict:"EA",replace:!0,templateUrl:"templates/libs/datepicker/day.html",require:"^datepicker",link:function(b,c,d,e){function f(a,b){return 1!==b||a%4!==0||a%100===0&&a%400!==0?i[b]:29}function g(a,b){var c=new Array(b),d=new Date(a),e=0;for(d.setHours(12);b>e;)c[e++]=new Date(d),d.setDate(d.getDate()+1);return c}function h(a){var b=new Date(a);b.setDate(b.getDate()+4-(b.getDay()||7));var c=b.getTime();return b.setMonth(0),b.setDate(1),Math.floor(Math.round((c-b)/864e5)/7)+1}b.showWeeks=e.showWeeks,e.step={months:1},e.element=c;var i=[31,28,31,30,31,30,31,31,30,31,30,31];e._refreshView=function(){var c=e.activeDate.getFullYear(),d=e.activeDate.getMonth(),f=new Date(c,d,1),i=e.startingDay-f.getDay(),j=i>0?7-i:-i,k=new Date(f);j>0&&k.setDate(-j+1);var l=e.selectedDate(),m=l?a(l,"yyyyMMdd"):null,n=[],o={},p=0;e.blockSettings&&E(e.blockSettings,function(a){a.color&&a.color.h?n.push(a.color.h):n.push(""),a.si&&(o[a.si]=a)});for(var q=g(k,42),r=0;42>r;r++){if(q[r]=angular.extend(e.createDateObject(q[r],e.formatDay),{secondary:q[r].getMonth()!==d,weekend:0==q[r].getDay()||6==q[r].getDay(),uid:b.uniqueId+"-"+r}),e.busyDays){var s=e.busyDays[a(q[r].date,"yyyyMMdd")];s&&(q[r].busyCount=Array(s+1).join("·"))}if(e.explicitBlockDays){var t=e.explicitBlockDays[a(q[r].date,"yyyyMMdd")];if(t){var u=o[t.si];u&&(q[r].explicitBlockDay=t,q[r].color=u.color.h)}}if(e.noSchoolDays){var v=e.noSchoolDays[a(q[r].date,"yyyyMMdd")];v&&(q[r].isNoSchoolDay=!0)}if(q[r].color);else n.length>0&&m&&!q[r].isNoSchoolDay&&a(q[r].date,"yyyyMMdd")>=m&&0!=q[r].date.getDay()&&6!=q[r].date.getDay()?(q[r].color=n[p],p++,p>=n.length&&(p=0)):q[r].color=null}b.labels=new Array(7);for(var w=0;7>w;w++)b.labels[w]={abbr:a(q[w].date,e.formatDayHeader),full:a(q[w].date,"EEEE")};if(b.title=a(e.activeDate,e.formatDayTitle),b.rows=e.split(q,7),b.showWeeks){b.weekNumbers=[];for(var x=h(b.rows[0][0].date),y=b.rows.length;b.weekNumbers.push(x++)<y;);}},e.compare=function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate())-new Date(b.getFullYear(),b.getMonth(),b.getDate())},e.handleKeyDown=function(a,b){var c=e.activeDate.getDate();if("left"===a)c-=1;else if("up"===a)c-=7;else if("right"===a)c+=1;else if("down"===a)c+=7;else if("pageup"===a||"pagedown"===a){var d=e.activeDate.getMonth()+("pageup"===a?-1:1);e.activeDate.setMonth(d,1),c=Math.min(f(e.activeDate.getFullYear(),e.activeDate.getMonth()),c)}else"home"===a?c=1:"end"===a&&(c=f(e.activeDate.getFullYear(),e.activeDate.getMonth()));e.activeDate.setDate(c)},e.refreshView()}}}]).directive("monthpicker",["dateFilter",function(a){return{restrict:"EA",replace:!0,templateUrl:"templates/libs/datepicker/month.html",require:"^datepicker",link:function(b,c,d,e){e.step={years:1},e.element=c,e._refreshView=function(){for(var c=new Array(12),d=e.activeDate.getFullYear(),f=0;12>f;f++)c[f]=angular.extend(e.createDateObject(new Date(d,f,1),e.formatMonth),{uid:b.uniqueId+"-"+f});b.title=a(e.activeDate,e.formatMonthTitle),b.rows=e.split(c,3)},e.compare=function(a,b){return new Date(a.getFullYear(),a.getMonth())-new Date(b.getFullYear(),b.getMonth())},e.handleKeyDown=function(a,b){var c=e.activeDate.getMonth();if("left"===a)c-=1;else if("up"===a)c-=3;else if("right"===a)c+=1;else if("down"===a)c+=3;else if("pageup"===a||"pagedown"===a){var d=e.activeDate.getFullYear()+("pageup"===a?-1:1);e.activeDate.setFullYear(d)}else"home"===a?c=0:"end"===a&&(c=11);e.activeDate.setMonth(c)},e.refreshView()}}}]).directive("yearpicker",["dateFilter",function(a){return{restrict:"EA",replace:!0,templateUrl:"templates/libs/datepicker/year.html",require:"^datepicker",link:function(a,b,c,d){function e(a){return parseInt((a-1)/f,10)*f+1}var f=d.yearRange;d.step={years:f},d.element=b,d._refreshView=function(){for(var b=new Array(f),c=0,g=e(d.activeDate.getFullYear());f>c;c++)b[c]=angular.extend(d.createDateObject(new Date(g+c,0,1),d.formatYear),{uid:a.uniqueId+"-"+c});a.title=[b[0].label,b[f-1].label].join(" - "),a.rows=d.split(b,5)},d.compare=function(a,b){return a.getFullYear()-b.getFullYear()},d.handleKeyDown=function(a,b){var c=d.activeDate.getFullYear();"left"===a?c-=1:"up"===a?c-=5:"right"===a?c+=1:"down"===a?c+=5:"pageup"===a||"pagedown"===a?c+=("pageup"===a?-1:1)*d.step.years:"home"===a?c=e(d.activeDate.getFullYear()):"end"===a&&(c=e(d.activeDate.getFullYear())+f-1),d.activeDate.setFullYear(c)},d.refreshView()}}}]).constant("datepickerPopupConfig",{datepickerPopup:"yyyy-MM-dd",currentText:"Today",clearText:"Clear",closeText:"Done",closeOnDateSelection:!0,appendToBody:!1,showButtonBar:!0}).directive("datepickerPopup",["$compile","$parse","$document","$position","dateFilter","dateParser","datepickerPopupConfig",function(a,b,c,d,e,f,g){return{restrict:"EA",require:"ngModel",scope:{isOpen:"=?",currentText:"@",clearText:"@",closeText:"@",dateDisabled:"&",noSchoolDays:"=noSchoolDays",initDate:"=initDate"},link:function(h,i,j,k){function l(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}function m(a){if(a){if(angular.isDate(a)&&!isNaN(a))return k.$setValidity("date",!0),a;if(angular.isString(a)){var b=f.parse(a,n)||new Date(a);return isNaN(b)?void k.$setValidity("date",!1):(k.$setValidity("date",!0),b)}return void k.$setValidity("date",!1)}return k.$setValidity("date",!0),null}k.$formatters.shift();var n,o=angular.isDefined(j.closeOnDateSelection)?h.$parent.$eval(j.closeOnDateSelection):g.closeOnDateSelection,p=angular.isDefined(j.datepickerAppendToBody)?h.$parent.$eval(j.datepickerAppendToBody):g.appendToBody;h.showButtonBar=angular.isDefined(j.showButtonBar)?h.$parent.$eval(j.showButtonBar):g.showButtonBar,h.getText=function(a){return h[a+"Text"]||g[a+"Text"]},j.$observe("datepickerPopup",function(a){n=a||g.datepickerPopup,k.$render()});var q=angular.element("<div datepicker-popup-wrap><div datepicker></div></div>");q.attr({"ng-model":"date","ng-change":"dateSelection()"});var r=angular.element(q.children()[0]);j.datepickerOptions&&angular.forEach(h.$parent.$eval(j.datepickerOptions),function(a,b){r.attr(l(b),a)}),h.watchData={},angular.forEach(["minDate","maxDate","datepickerMode","noSchoolDays","initDate"],function(a){if(j[a]){var c=b(j[a]);if(h.$parent.$watch(c,function(b){h.watchData[a]=b}),r.attr(l(a),"watchData."+a),"datepickerMode"===a){var d=c.assign;h.$watch("watchData."+a,function(a,b){a!==b&&d(h.$parent,a)})}}}),j.dateDisabled&&r.attr("date-disabled","dateDisabled({ date: date, mode: mode })"),k.$parsers.unshift(m),h.dateSelection=function(a){angular.isDefined(a)&&(h.date=a),k.$setViewValue(h.date),k.$render(),o&&(h.isOpen=!1)},i.bind("input change keyup",function(){h.$apply(function(){h.date=k.$modelValue})}),k.$render=function(){var a=k.$viewValue?e(k.$viewValue,n):"";i.val(a),h.date=m(k.$modelValue)};var s=function(a){h.isOpen&&a.target!==i[0]&&h.$apply(function(){h.isOpen=!1})},t=function(a,b){h.keydown(a)};i.bind("keydown",t),h.keydown=function(a){27===a.which?(a.preventDefault(),a.stopPropagation(),h.close()):40!==a.which||h.isOpen||(h.isOpen=!0)},h.$watch("isOpen",function(a){a?(h.$broadcast("datepicker.focus"),h.position=p?d.offset(i):d.position(i),h.position.top=h.position.top+i.prop("offsetHeight"),c.bind("click",s)):c.unbind("click",s)}),h.select=function(a){if("today"===a){var b=new Date;angular.isDate(k.$modelValue)?(a=new Date(k.$modelValue),a.setFullYear(b.getFullYear(),b.getMonth(),b.getDate())):a=new Date(b.setHours(0,0,0,0))}h.dateSelection(a)},h.close=function(){h.isOpen=!1,i[0].focus()};var u=a(q)(h);q.remove(),p?c.find("body").append(u):i.after(u),h.$on("$destroy",function(){u.remove(),i.unbind("keydown",t),c.unbind("click",s)})}}}]).directive("datepickerPopupWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"templates/libs/datepicker/popup.html",link:function(a,b,c){b.bind("click",function(a){a.preventDefault(),a.stopPropagation()})}}}),angular.module("ui.bootstrap.dateparser",[]).service("dateParser",["$locale","orderByFilter",function(a,b){function c(a){var c=[],d=a.split("");return angular.forEach(e,function(b,e){var f=a.indexOf(e);if(f>-1){a=a.split(""),d[f]="("+b.regex+")",a[f]="$";for(var g=f+1,h=f+e.length;h>g;g++)d[g]="",a[g]="$";a=a.join(""),c.push({index:f,apply:b.apply})}}),{regex:new RegExp("^"+d.join("")+"$"),map:b(c,"index")}}function d(a,b,c){return 1===b&&c>28?29===c&&(a%4===0&&a%100!==0||a%400===0):3===b||5===b||8===b||10===b?31>c:!0}this.parsers={};var e={yyyy:{regex:"\\d{4}",apply:function(a){this.year=+a}},yy:{regex:"\\d{2}",apply:function(a){this.year=+a+2e3}},y:{regex:"\\d{1,4}",apply:function(a){this.year=+a}},MMMM:{regex:a.DATETIME_FORMATS.MONTH.join("|"),apply:function(b){this.month=a.DATETIME_FORMATS.MONTH.indexOf(b)}},MMM:{regex:a.DATETIME_FORMATS.SHORTMONTH.join("|"),apply:function(b){this.month=a.DATETIME_FORMATS.SHORTMONTH.indexOf(b)}},MM:{regex:"0[1-9]|1[0-2]",apply:function(a){this.month=a-1}},M:{regex:"[1-9]|1[0-2]",apply:function(a){this.month=a-1}},dd:{regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(a){this.date=+a}},d:{regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(a){this.date=+a}},EEEE:{regex:a.DATETIME_FORMATS.DAY.join("|")},EEE:{regex:a.DATETIME_FORMATS.SHORTDAY.join("|")}};this.parse=function(b,e){if(!angular.isString(b)||!e)return b;e=a.DATETIME_FORMATS[e]||e,this.parsers[e]||(this.parsers[e]=c(e));var f=this.parsers[e],g=f.regex,h=f.map,i=b.match(g);if(i&&i.length){for(var j,k={year:1900,month:0,date:1,hours:0},l=1,m=i.length;m>l;l++){var n=h[l-1];n.apply&&n.apply.call(k,i[l])}return d(k.year,k.month,k.date)&&(j=new Date(k.year,k.month,k.date,k.hours)),j}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function(a,b){function c(a,c){return a.currentStyle?a.currentStyle[c]:b.getComputedStyle?b.getComputedStyle(a)[c]:a.style[c]}function d(a){return"static"===(c(a,"position")||"static")}var e=function(b){for(var c=a[0],e=b.offsetParent||c;e&&e!==c&&d(e);)e=e.offsetParent;return e||c};return{position:function(b){var c=this.offset(b),d={top:0,left:0},f=e(b[0]);f!=a[0]&&(d=this.offset(angular.element(f)),d.top+=f.clientTop-f.scrollTop,d.left+=f.clientLeft-f.scrollLeft);var g=b[0].getBoundingClientRect();return{width:g.width||b.prop("offsetWidth"),height:g.height||b.prop("offsetHeight"),top:c.top-d.top,left:c.left-d.left}},offset:function(c){var d=c[0].getBoundingClientRect();return{width:d.width||c.prop("offsetWidth"),height:d.height||c.prop("offsetHeight"),top:d.top+(b.pageYOffset||a[0].documentElement.scrollTop),left:d.left+(b.pageXOffset||a[0].documentElement.scrollLeft)}},positionElements:function(a,b,c,d){var e,f,g,h,i=c.split("-"),j=i[0],k=i[1]||"center";e=d?this.offset(a):this.position(a),f=b.prop("offsetWidth"),g=b.prop("offsetHeight");var l={center:function(){return e.left+e.width/2-f/2},left:function(){return e.left},right:function(){return e.left+e.width}},m={center:function(){return e.top+e.height/2-g/2},top:function(){return e.top},bottom:function(){return e.top+e.height}};switch(j){case"right":h={top:m[k](),left:l[j]()};break;case"left":h={top:m[k](),left:e.left-f};break;case"bottom":h={top:m[j](),left:l[k]()};break;default:h={top:e.top-g,left:l[k]()}}return h}}}]),angular.module("ui.bootstrap.carousel",[]).controller("CarouselController",["$scope","$interval","$animate",function(a,b,c){function d(a){if(angular.isUndefined(k[a].index))return k[a];var b;k.length;for(b=0;b<k.length;++b)if(k[b].index==a)return k[b]}function e(){f();var c=+a.interval;!isNaN(c)&&c>0&&(h=b(g,c))}function f(){h&&(b.cancel(h),h=null)}function g(){var b=+a.interval;i&&!isNaN(b)&&b>0?a.next():a.pause()}var h,i,j=this,k=j.slides=a.slides=[],l=-1;j.currentSlide=null;var m=!1;j.select=a.select=function(b,d){function f(){m||(angular.extend(b,{direction:d,active:!0}),angular.extend(j.currentSlide||{},{direction:d,active:!1}),c.enabled()&&!a.noTransition&&b.$element&&(a.$currentTransition=!0,b.$element.one("$animate:close",function(){a.$currentTransition=null})),j.currentSlide=b,l=g,e())}var g=j.indexOfSlide(b);void 0===d&&(d=g>j.getCurrentIndex()?"next":"prev"),b&&b!==j.currentSlide&&f()},a.$on("$destroy",function(){m=!0}),j.getCurrentIndex=function(){return j.currentSlide&&angular.isDefined(j.currentSlide.index)?+j.currentSlide.index:l},j.indexOfSlide=function(a){return angular.isDefined(a.index)?+a.index:k.indexOf(a)},a.next=function(){var b=(j.getCurrentIndex()+1)%k.length;return a.$currentTransition?void 0:j.select(d(b),"next")},a.prev=function(){var b=j.getCurrentIndex()-1<0?k.length-1:j.getCurrentIndex()-1;return a.$currentTransition?void 0:j.select(d(b),"prev")},a.isActive=function(a){return j.currentSlide===a},a.$watch("interval",e),a.$on("$destroy",f),a.play=function(){i||(i=!0,e())},a.pause=function(){a.noPause||(i=!1,f())},j.addSlide=function(b,c){b.$element=c,k.push(b),1===k.length||b.active?(j.select(k[k.length-1]),1==k.length&&a.play()):b.active=!1},j.removeSlide=function(a){angular.isDefined(a.index)&&k.sort(function(a,b){return+a.index>+b.index});var b=k.indexOf(a);k.splice(b,1),k.length>0&&a.active?b>=k.length?j.select(k[b-1]):j.select(k[b]):l>b&&l--}}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",require:"carousel",templateUrl:"templates/libs/carousel/carousel.html",scope:{interval:"=",noTransition:"=",noPause:"="}}}]).directive("slide",function(){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:"templates/libs/carousel/slide.html",scope:{active:"=?",index:"=?"},link:function(a,b,c,d){d.addSlide(a,b),a.$on("$destroy",function(){d.removeSlide(a)}),a.$watch("active",function(b){b&&d.select(a)})}}}).animation(".item",["$animate",function(a){return{beforeAddClass:function(b,c,d){if("active"==c&&b.parent()&&!b.parent().scope().noTransition){var e=!1,f=b.isolateScope().direction,g="next"==f?"left":"right";return b.addClass(f),a.addClass(b,g).then(function(){e||b.removeClass(g+" "+f),d()}),function(){e=!0}}d()},beforeRemoveClass:function(b,c,d){if("active"==c&&b.parent()&&!b.parent().scope().noTransition){var e=!1,f=b.isolateScope().direction,g="next"==f?"left":"right";return a.addClass(b,g).then(function(){e||b.removeClass(g),d()}),function(){e=!0}}d()}}}]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function a(a){var b=/[A-Z]/g,c="-";return a.replace(b,function(a,b){return(b?c:"")+a.toLowerCase()})}var b={placement:"top",animation:!0,popupDelay:1200},c={mouseenter:"mouseleave",click:"click",focus:"blur"},d={};this.options=function(a){angular.extend(d,a)},this.setTriggers=function(a){angular.extend(c,a)},this.$get=["$window","$compile","$timeout","$document","$position","$interpolate",function(e,f,g,h,i,j){return function(e,k,l){function m(a){var b=a||n.trigger||l,d=c[b]||b;return{show:b,hide:d}}var n=angular.extend({},b,d),o=a(e),p=j.startSymbol(),q=j.endSymbol(),r="<div "+o+'-popup title="'+p+"title"+q+'" content="'+p+"content"+q+'" placement="'+p+"placement"+q+'" animation="animation" is-open="isOpen"></div>';return{restrict:"EA",compile:function(a,b){var c=f(r);return function(a,b,d){function f(){D.isOpen?l():j()}function j(){(!C||a.$eval(d[k+"Enable"]))&&(s(),D.popupDelay?z||(z=g(o,D.popupDelay,!1),z.then(function(a){a()})):o()())}function l(){a.$apply(function(){p()})}function o(){return z=null,y&&(g.cancel(y),y=null),D.content?(q(),w.css({top:0,left:0,display:"block"}),D.$digest(),E(),D.isOpen=!0,D.$digest(),E):angular.noop}function p(){D.isOpen=!1,g.cancel(z),z=null,D.animation?y||(y=g(r,500)):r()}function q(){w&&r(),x=D.$new(),w=c(x,function(a){A?h.find("body").append(a):b.after(a)})}function r(){y=null,w&&(w.remove(),w=null),x&&(x.$destroy(),x=null)}function s(){t(),u()}function t(){var a=d[k+"Placement"];D.placement=angular.isDefined(a)?a:n.placement}function u(){var a=d[k+"PopupDelay"],b=parseInt(a,10);D.popupDelay=isNaN(b)?n.popupDelay:b}function v(){var a=d[k+"Trigger"];F(),B=m(a),B.show===B.hide?b.bind(B.show,f):(b.bind(B.show,j),b.bind(B.hide,l))}var w,x,y,z,A=angular.isDefined(n.appendToBody)?n.appendToBody:!0,B=m(void 0),C=angular.isDefined(d[k+"Enable"]),D=a.$new(!0),E=function(){var a=i.positionElements(b,w,D.placement,A);a.top+="px",a.left+="px",w.css(a)};D.isOpen=!1,d.$observe(e,function(a){D.content=a,!a&&D.isOpen&&p()}),d.$observe(k+"Title",function(a){D.title=a});var F=function(){b.unbind(B.show,j),b.unbind(B.hide,l)};v();var G=a.$eval(d[k+"Animation"]);D.animation=angular.isDefined(G)?!!G:n.animation;var H=a.$eval(d[k+"AppendToBody"]);A=angular.isDefined(H)?H:A,A&&a.$on("$locationChangeSuccess",function(){D.isOpen&&p()}),a.$on("$destroy",function(){g.cancel(y),g.cancel(z),F(),r(),D=null})}}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"templates/libs/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function(a){return a("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"templates/libs/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function(a){return a("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(a,b,c){b.addClass("ng-binding").data("$binding",c.bindHtmlUnsafe),a.$watch(c.bindHtmlUnsafe,function(a){b.html(a||"")})}}),function(a){if("function"==typeof bootstrap)bootstrap("nedb",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){
if(!ses.ok())return;ses.makeNedb=a}else"undefined"!=typeof window?window.Nedb=a():global.Nedb=a()}(function(){var a;return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b,c){function d(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(b===a[c])return c;return-1}var e=a("__browserify_process");e.EventEmitter||(e.EventEmitter=function(){});var f=c.EventEmitter=e.EventEmitter,g="function"==typeof Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},h=10;f.prototype.setMaxListeners=function(a){this._events||(this._events={}),this._events.maxListeners=a},f.prototype.emit=function(a){if("error"===a&&(!this._events||!this._events.error||g(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var b=this._events[a];if(!b)return!1;if("function"==typeof b){switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var c=Array.prototype.slice.call(arguments,1);b.apply(this,c)}return!0}if(g(b)){for(var c=Array.prototype.slice.call(arguments,1),d=b.slice(),e=0,f=d.length;f>e;e++)d[e].apply(this,c);return!0}return!1},f.prototype.addListener=function(a,b){if("function"!=typeof b)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",a,b),this._events[a])if(g(this._events[a])){if(!this._events[a].warned){var c;c=void 0!==this._events.maxListeners?this._events.maxListeners:h,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}this._events[a].push(b)}else this._events[a]=[this._events[a],b];else this._events[a]=b;return this},f.prototype.on=f.prototype.addListener,f.prototype.once=function(a,b){var c=this;return c.on(a,function d(){c.removeListener(a,d),b.apply(this,arguments)}),this},f.prototype.removeListener=function(a,b){if("function"!=typeof b)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[a])return this;var c=this._events[a];if(g(c)){var e=d(c,b);if(0>e)return this;c.splice(e,1),0==c.length&&delete this._events[a]}else this._events[a]===b&&delete this._events[a];return this},f.prototype.removeAllListeners=function(a){return 0===arguments.length?(this._events={},this):(a&&this._events&&this._events[a]&&(this._events[a]=null),this)},f.prototype.listeners=function(a){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),g(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},f.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?"function"==typeof a._events[b]?1:a._events[b].length:0}},{__browserify_process:4}],2:[function(a,b,c){function d(a,b){for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}function e(a,b){for(var c=0,d=a.length;d>=0;d--){var e=a[d];"."==e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}var f=a("__browserify_process"),g=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;c.resolve=function(){for(var a="",b=!1,c=arguments.length;c>=-1&&!b;c--){var g=c>=0?arguments[c]:f.cwd();"string"==typeof g&&g&&(a=g+"/"+a,b="/"===g.charAt(0))}return a=e(d(a.split("/"),function(a){return!!a}),!b).join("/"),(b?"/":"")+a||"."},c.normalize=function(a){var b="/"===a.charAt(0),c="/"===a.slice(-1);return a=e(d(a.split("/"),function(a){return!!a}),!b).join("/"),a||b||(a="."),a&&c&&(a+="/"),(b?"/":"")+a},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a,b){return a&&"string"==typeof a}).join("/"))},c.dirname=function(a){var b=g.exec(a)[1]||"",c=!1;return b?1===b.length||c&&b.length<=3&&":"===b.charAt(1)?b:b.substring(0,b.length-1):"."},c.basename=function(a,b){var c=g.exec(a)[2]||"";return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return g.exec(a)[3]||""},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/"},{__browserify_process:4}],3:[function(a,b,c){function d(a){return Array.isArray(a)||"object"==typeof a&&"[object Array]"===Object.prototype.toString.call(a)}function e(a){"object"==typeof a&&"[object RegExp]"===Object.prototype.toString.call(a)}function f(a){return"object"==typeof a&&"[object Date]"===Object.prototype.toString.call(a)}a("events");c.isArray=d,c.isDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)},c.isRegExp=function(a){return"[object RegExp]"===Object.prototype.toString.call(a)},c.print=function(){},c.puts=function(){},c.debug=function(){},c.inspect=function(a,b,i,j){function k(a,i){if(a&&"function"==typeof a.inspect&&a!==c&&(!a.constructor||a.constructor.prototype!==a))return a.inspect(i);switch(typeof a){case"undefined":return m("undefined","undefined");case"string":var j="'"+JSON.stringify(a).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return m(j,"string");case"number":return m(""+a,"number");case"boolean":return m(""+a,"boolean")}if(null===a)return m("null","null");var n=g(a),o=b?h(a):n;if("function"==typeof a&&0===o.length){if(e(a))return m(""+a,"regexp");var p=a.name?": "+a.name:"";return m("[Function"+p+"]","special")}if(f(a)&&0===o.length)return m(a.toUTCString(),"date");var q,r,s;if(d(a)?(r="Array",s=["[","]"]):(r="Object",s=["{","}"]),"function"==typeof a){var t=a.name?": "+a.name:"";q=e(a)?" "+a:" [Function"+t+"]"}else q="";if(f(a)&&(q=" "+a.toUTCString()),0===o.length)return s[0]+q+s[1];if(0>i)return e(a)?m(""+a,"regexp"):m("[Object]","special");l.push(a);var u=o.map(function(b){var c,e;if(a.__lookupGetter__&&(a.__lookupGetter__(b)?e=a.__lookupSetter__(b)?m("[Getter/Setter]","special"):m("[Getter]","special"):a.__lookupSetter__(b)&&(e=m("[Setter]","special"))),n.indexOf(b)<0&&(c="["+b+"]"),e||(l.indexOf(a[b])<0?(e=null===i?k(a[b]):k(a[b],i-1),e.indexOf("\n")>-1&&(e=d(a)?e.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+e.split("\n").map(function(a){return"   "+a}).join("\n"))):e=m("[Circular]","special")),"undefined"==typeof c){if("Array"===r&&b.match(/^\d+$/))return e;c=JSON.stringify(""+b),c.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(c=c.substr(1,c.length-2),c=m(c,"name")):(c=c.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),c=m(c,"string"))}return c+": "+e});l.pop();var v=0,w=u.reduce(function(a,b){return v++,b.indexOf("\n")>=0&&v++,a+b.length+1},0);return u=w>50?s[0]+(""===q?"":q+"\n ")+" "+u.join(",\n  ")+" "+s[1]:s[0]+q+" "+u.join(", ")+" "+s[1]}var l=[],m=function(a,b){var c={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},d={special:"cyan",number:"blue","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"}[b];return d?"["+c[d][0]+"m"+a+"["+c[d][1]+"m":a};return j||(m=function(a,b){return a}),k(a,"undefined"==typeof i?2:i)};c.log=function(a){},c.pump=null;var g=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b},h=Object.getOwnPropertyNames||function(a){var b=[];for(var c in a)Object.hasOwnProperty.call(a,c)&&b.push(c);return b},i=Object.create||function(a,b){var c;if(null===a)c={__proto__:null};else{if("object"!=typeof a)throw new TypeError("typeof prototype["+typeof a+"] != 'object'");var d=function(){};d.prototype=a,c=new d,c.__proto__=a}return"undefined"!=typeof b&&Object.defineProperties&&Object.defineProperties(c,b),c};c.inherits=function(a,b){a.super_=b,a.prototype=i(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})};var j=/%[sdj%]/g;c.format=function(a){if("string"!=typeof a){for(var b=[],d=0;d<arguments.length;d++)b.push(c.inspect(arguments[d]));return b.join(" ")}for(var d=1,e=arguments,f=e.length,g=String(a).replace(j,function(a){if("%%"===a)return"%";if(d>=f)return a;switch(a){case"%s":return String(e[d++]);case"%d":return Number(e[d++]);case"%j":return JSON.stringify(e[d++]);default:return a}}),h=e[d];f>d;h=e[++d])g+=null===h||"object"!=typeof h?" "+h:" "+c.inspect(h);return g}},{events:1}],4:[function(a,b,c){var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.binding=function(a){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],5:[function(a,b,c){function d(a,b,c){this.db=a,this.query=b||{},c&&(this.execFn=c)}var e=a("./model"),f=a("underscore");d.prototype.limit=function(a){return this._limit=a,this},d.prototype.skip=function(a){return this._skip=a,this},d.prototype.sort=function(a){return this._sort=a,this},d.prototype.projection=function(a){return this._projection=a,this},d.prototype.project=function(a){var b,c,d,e=[],g=this;return void 0===this._projection||0===Object.keys(this._projection).length?a:(b=0===this._projection._id?!1:!0,this._projection=f.omit(this._projection,"_id"),d=Object.keys(this._projection),d.forEach(function(a){if(void 0!==c&&g._projection[a]!==c)throw"Can't both keep and omit fields except for _id";c=g._projection[a]}),a.forEach(function(a){var g=1===c?f.pick(a,d):f.omit(a,d);b?g._id=a._id:delete g._id,e.push(g)}),e)},d.prototype._exec=function(a){var b,c,d,f=this.db.getCandidates(this.query),g=[],h=0,i=0,j=this,k=null;try{for(b=0;b<f.length;b+=1)if(e.match(f[b],this.query))if(this._sort)g.push(f[b]);else if(this._skip&&this._skip>i)i+=1;else if(g.push(f[b]),h+=1,this._limit&&this._limit<=h)break}catch(l){return a(l)}if(this._sort){c=Object.keys(this._sort);var m=[];for(b=0;b<c.length;b++)d=c[b],m.push({key:d,direction:j._sort[d]});g.sort(function(a,b){var c,d,f;for(f=0;f<m.length;f++)if(c=m[f],d=c.direction*e.compareThings(e.getDotValue(a,c.key),e.getDotValue(b,c.key)),0!==d)return d;return 0});var n=this._limit||g.length,o=this._skip||0;g=g.slice(o,o+n)}try{g=this.project(g)}catch(p){k=p,g=void 0}return this.execFn?this.execFn(k,g,a):a(k,g)},d.prototype.exec=function(){this.db.executor.push({"this":this,fn:this._exec,arguments:arguments})},b.exports=d},{"./model":10,underscore:18}],6:[function(a,b,c){function d(a){for(var b,b,c=new Array(a),d=0;a>d;d++)0==(3&d)&&(b=4294967296*Math.random()),c[d]=b>>>((3&d)<<3)&255;return c}function e(a){function b(a){return f[a>>18&63]+f[a>>12&63]+f[a>>6&63]+f[63&a]}var c,d,e,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=a.length%3,h="";for(e=0,d=a.length-g;d>e;e+=3)c=(a[e]<<16)+(a[e+1]<<8)+a[e+2],h+=b(c);switch(g){case 1:c=a[a.length-1],h+=f[c>>2],h+=f[c<<4&63],h+="==";break;case 2:c=(a[a.length-2]<<8)+a[a.length-1],h+=f[c>>10],h+=f[c>>4&63],h+=f[c<<2&63],h+="="}return h}function f(a){return e(d(Math.ceil(Math.max(8,2*a)))).replace(/[+\/]/g,"").slice(0,a)}b.exports.uid=f},{}],7:[function(a,b,c){function d(a){var b;"string"==typeof a?(b=a,this.inMemoryOnly=!1):(a=a||{},b=a.filename,this.inMemoryOnly=a.inMemoryOnly||!1,this.autoload=a.autoload||!1),b&&"string"==typeof b&&0!==b.length?this.filename=b:(this.filename=null,this.inMemoryOnly=!0),this.persistence=new l({db:this,nodeWebkitAppName:a.nodeWebkitAppName,afterSerialization:a.afterSerialization,beforeDeserialization:a.beforeDeserialization,corruptAlertThreshold:a.corruptAlertThreshold}),this.executor=new h,this.inMemoryOnly&&(this.executor.ready=!0),this.indexes={},this.indexes._id=new i({fieldName:"_id",unique:!0}),this.autoload&&this.loadDatabase(a.onload||function(a){if(a)throw a})}var e=a("./customUtils"),f=a("./model"),g=a("async"),h=a("./executor"),i=a("./indexes"),j=a("util"),k=a("underscore"),l=a("./persistence"),m=a("./cursor");d.prototype.loadDatabase=function(){this.executor.push({"this":this.persistence,fn:this.persistence.loadDatabase,arguments:arguments},!0)},d.prototype.getAllData=function(){return this.indexes._id.getAll()},d.prototype.resetIndexes=function(a){var b=this;Object.keys(this.indexes).forEach(function(c){b.indexes[c].reset(a)})},d.prototype.ensureIndex=function(a,b){var c=b||function(){};if(a=a||{},!a.fieldName)return c({missingFieldName:!0});if(this.indexes[a.fieldName])return c(null);this.indexes[a.fieldName]=new i(a);try{this.indexes[a.fieldName].insert(this.getAllData())}catch(d){return delete this.indexes[a.fieldName],c(d)}this.persistence.persistNewState([{$$indexCreated:a}],function(a){return c(a?a:null)})},d.prototype.removeIndex=function(a,b){var c=b||function(){};delete this.indexes[a],this.persistence.persistNewState([{$$indexRemoved:a}],function(a){return c(a?a:null)})},d.prototype.addToIndexes=function(a){var b,c,d,e=Object.keys(this.indexes);for(b=0;b<e.length;b+=1)try{this.indexes[e[b]].insert(a)}catch(f){c=b,d=f;break}if(d){for(b=0;c>b;b+=1)this.indexes[e[b]].remove(a);throw d}},d.prototype.removeFromIndexes=function(a){var b=this;Object.keys(this.indexes).forEach(function(c){b.indexes[c].remove(a)})},d.prototype.updateIndexes=function(a,b){var c,d,e,f=Object.keys(this.indexes);for(c=0;c<f.length;c+=1)try{this.indexes[f[c]].update(a,b)}catch(g){d=c,e=g;break}if(e){for(c=0;d>c;c+=1)this.indexes[f[c]].revertUpdate(a,b);throw e}},d.prototype.getCandidates=function(a){var b,c=Object.keys(this.indexes);return b=[],Object.keys(a).forEach(function(c){("string"==typeof a[c]||"number"==typeof a[c]||"boolean"==typeof a[c]||j.isDate(a[c])||null===a[c])&&b.push(c)}),b=k.intersection(b,c),b.length>0?this.indexes[b[0]].getMatching(a[b[0]]):(b=[],Object.keys(a).forEach(function(c){a[c]&&a[c].hasOwnProperty("$in")&&b.push(c)}),b=k.intersection(b,c),b.length>0?this.indexes[b[0]].getMatching(a[b[0]].$in):(b=[],Object.keys(a).forEach(function(c){a[c]&&(a[c].hasOwnProperty("$lt")||a[c].hasOwnProperty("$lte")||a[c].hasOwnProperty("$gt")||a[c].hasOwnProperty("$gte"))&&b.push(c)}),b=k.intersection(b,c),b.length>0?this.indexes[b[0]].getBetweenBounds(a[b[0]]):this.getAllData()))},d.prototype._insert=function(a,b){var c=b||function(){};try{this._insertInCache(a)}catch(d){return c(d)}this.persistence.persistNewState(j.isArray(a)?a:[a],function(b){return b?c(b):c(null,a)})},d.prototype.createNewId=function(){var a=e.uid(16);return this.indexes._id.getMatching(a).length>0&&(a=this.createNewId()),a},d.prototype.prepareDocumentForInsertion=function(a){var b,c=this;return j.isArray(a)?(b=[],a.forEach(function(a){b.push(c.prepareDocumentForInsertion(a))})):(void 0===a._id&&(a._id=this.createNewId()),b=f.deepCopy(a),f.checkObject(b)),b},d.prototype._insertInCache=function(a){j.isArray(a)?this._insertMultipleDocsInCache(a):this.addToIndexes(this.prepareDocumentForInsertion(a))},d.prototype._insertMultipleDocsInCache=function(a){var b,c,d,e=this.prepareDocumentForInsertion(a);for(b=0;b<e.length;b+=1)try{this.addToIndexes(e[b])}catch(f){d=f,c=b;break}if(d){for(b=0;c>b;b+=1)this.removeFromIndexes(e[b]);throw d}},d.prototype.insert=function(){this.executor.push({"this":this,fn:this._insert,arguments:arguments})},d.prototype.count=function(a,b){var c=new m(this,a,function(a,b,c){return a?c(a):c(null,b.length)});return"function"!=typeof b?c:void c.exec(b)},d.prototype.find=function(a,b,c){switch(arguments.length){case 1:b={};break;case 2:"function"==typeof b&&(c=b,b={})}var d=new m(this,a,function(a,b,c){var d,e=[];if(a)return c(a);for(d=0;d<b.length;d+=1)e.push(f.deepCopy(b[d]));return c(null,e)});return d.projection(b),"function"!=typeof c?d:void d.exec(c)},d.prototype.findOne=function(a,b,c){switch(arguments.length){case 1:b={};break;case 2:"function"==typeof b&&(c=b,b={})}var d=new m(this,a,function(a,b,c){return a?c(a):1===b.length?c(null,f.deepCopy(b[0])):c(null,null)});return d.projection(b).limit(1),"function"!=typeof c?d:void d.exec(c)},d.prototype._update=function(a,b,c,d){var e,h,i,j,l=this,n=0;"function"==typeof c&&(d=c,c={}),"undefined"==typeof c&&(c={}),e=d||function(){},h=void 0!==c.multi?c.multi:!1,i=void 0!==c.upsert?c.upsert:!1,g.waterfall([function(c){if(!i)return c();var d=new m(l,a);d.limit(1)._exec(function(d,g){if(d)return e(d);if(1===g.length)return c();var h;try{f.checkObject(b),h=b}catch(i){try{h=f.modify(f.deepCopy(a,!0),b)}catch(d){return e(d)}}return l._insert(h,function(a,b){return a?e(a):e(null,1,b)})})},function(){var c,d=l.getCandidates(a),g=[];try{for(j=0;j<d.length;j+=1)f.match(d[j],a)&&(h||0===n)&&(n+=1,c=f.modify(d[j],b),g.push({oldDoc:d[j],newDoc:c}))}catch(i){return e(i)}try{l.updateIndexes(g)}catch(i){return e(i)}l.persistence.persistNewState(k.pluck(g,"newDoc"),function(a){return a?e(a):e(null,n)})}])},d.prototype.update=function(){this.executor.push({"this":this,fn:this._update,arguments:arguments})},d.prototype._remove=function(a,b,c){var d,e,g=this,h=0,i=[],j=this.getCandidates(a);"function"==typeof b&&(c=b,b={}),d=c||function(){},e=void 0!==b.multi?b.multi:!1;try{j.forEach(function(b){f.match(b,a)&&(e||0===h)&&(h+=1,i.push({$$deleted:!0,_id:b._id}),g.removeFromIndexes(b))})}catch(k){return d(k)}g.persistence.persistNewState(i,function(a){return a?d(a):d(null,h)})},d.prototype.remove=function(){this.executor.push({"this":this,fn:this._remove,arguments:arguments})},b.exports=d},{"./cursor":5,"./customUtils":6,"./executor":8,"./indexes":9,"./model":10,"./persistence":11,async:13,underscore:18,util:3}],8:[function(a,b,c){function d(){this.buffer=[],this.ready=!1,this.queue=f.queue(function(a,b){var c,d,f=a.arguments[a.arguments.length-1],g=[];for(d=0;d<a.arguments.length;d+=1)g.push(a.arguments[d]);"function"==typeof f?(c=function(){"function"==typeof setImmediate?setImmediate(b):e.nextTick(b),f.apply(null,arguments)},g[g.length-1]=c):(c=function(){b()},g.push(c)),a.fn.apply(a["this"],g)},1)}var e=a("__browserify_process"),f=a("async");d.prototype.push=function(a,b){this.ready||b?this.queue.push(a):this.buffer.push(a)},d.prototype.processBuffer=function(){var a;for(this.ready=!0,a=0;a<this.buffer.length;a+=1)this.queue.push(this.buffer[a]);this.buffer=[]},b.exports=d},{__browserify_process:4,async:13}],9:[function(a,b,c){function d(a,b){return a===b}function e(a){return null===a?"$null":"string"==typeof a?"$string"+a:"boolean"==typeof a?"$boolean"+a:"number"==typeof a?"$number"+a:k.isArray(a)?"$date"+a.getTime():a}function f(a){this.fieldName=a.fieldName,this.unique=a.unique||!1,this.sparse=a.sparse||!1,this.treeOptions={unique:this.unique,compareKeys:i.compareThings,checkValueEquality:d},this.reset()}function g(a,b){var c;for(c=0;c<b.length;c+=1)a.push(b[c])}var h=a("binary-search-tree").AVLTree,i=a("./model"),j=a("underscore"),k=a("util");f.prototype.reset=function(a){this.tree=new h(this.treeOptions),a&&this.insert(a)},f.prototype.insert=function(a){var b,c,d,f,g;if(k.isArray(a))return void this.insertMultipleDocs(a);if(b=i.getDotValue(a,this.fieldName),void 0!==b||!this.sparse)if(k.isArray(b)){for(c=j.uniq(b,e),d=0;d<c.length;d+=1)try{this.tree.insert(c[d],a)}catch(h){g=h,f=d;break}if(g){for(d=0;f>d;d+=1)this.tree["delete"](c[d],a);throw g}}else this.tree.insert(b,a)},f.prototype.insertMultipleDocs=function(a){var b,c,d;for(b=0;b<a.length;b+=1)try{this.insert(a[b])}catch(e){c=e,d=b;break}if(c){for(b=0;d>b;b+=1)this.remove(a[b]);throw c}},f.prototype.remove=function(a){var b,c=this;return k.isArray(a)?void a.forEach(function(a){c.remove(a)}):(b=i.getDotValue(a,this.fieldName),void(void 0===b&&this.sparse||(k.isArray(b)?j.uniq(b,e).forEach(function(b){c.tree["delete"](b,a)}):this.tree["delete"](b,a))))},f.prototype.update=function(a,b){if(k.isArray(a))return void this.updateMultipleDocs(a);this.remove(a);try{this.insert(b)}catch(c){throw this.insert(a),c}},f.prototype.updateMultipleDocs=function(a){var b,c,d;for(b=0;b<a.length;b+=1)this.remove(a[b].oldDoc);for(b=0;b<a.length;b+=1)try{this.insert(a[b].newDoc)}catch(e){d=e,c=b;break}if(d){for(b=0;c>b;b+=1)this.remove(a[b].newDoc);for(b=0;b<a.length;b+=1)this.insert(a[b].oldDoc);throw d}},f.prototype.revertUpdate=function(a,b){var c=[];k.isArray(a)?(a.forEach(function(a){c.push({oldDoc:a.newDoc,newDoc:a.oldDoc})}),this.update(c)):this.update(b,a)},f.prototype.getMatching=function(a){var b,c=this;return k.isArray(a)?(b=[],a.forEach(function(a){g(b,c.getMatching(a))}),b):this.tree.search(a)},f.prototype.getBetweenBounds=function(a){return this.tree.betweenBounds(a)},f.prototype.getAll=function(){var a=[];return this.tree.executeOnEveryNode(function(b){var c;for(c=0;c<b.data.length;c+=1)a.push(b.data[c])}),a},b.exports=f},{"./model":10,"binary-search-tree":14,underscore:18,util:3}],10:[function(a,b,c){function d(a,b){if(!("$"!==a[0]||"$$date"===a&&"number"==typeof b||"$$deleted"===a&&b===!0||"$$indexCreated"===a||"$$indexRemoved"===a))throw"Field names cannot begin with the $ character";if("number"!=typeof a&&-1!==a.indexOf("."))throw"Field names cannot contain a ."}function e(a){t.isArray(a)&&a.forEach(function(a){e(a)}),"object"==typeof a&&null!==a&&Object.keys(a).forEach(function(b){d(b,a[b]),e(a[b])})}function f(a){var b;return b=JSON.stringify(a,function(a,b){return d(a,b),void 0===b?void 0:null===b?null:"function"==typeof this[a].getTime?{$$date:this[a].getTime()}:b})}function g(a){return"undefined"!=typeof a&&a&&a.length?JSON.parse(a,function(a,b){return"$$date"===a?new Date(b):"string"==typeof b||"number"==typeof b||"boolean"==typeof b||null===b?b:b&&b.$$date?b.$$date:b}):""}function h(a,b){var c;return"boolean"==typeof a||"number"==typeof a||"string"==typeof a||null===a||t.isDate(a)?a:t.isArray(a)?(c=[],a.forEach(function(a){c.push(h(a,b))}),c):"object"==typeof a?(c={},Object.keys(a).forEach(function(d){(!b||"$"!==d[0]&&-1===d.indexOf("."))&&(c[d]=h(a[d],b))}),c):void 0}function i(a){return"boolean"==typeof a||"number"==typeof a||"string"==typeof a||null===a||t.isDate(a)||t.isArray(a)}function j(a,b){return b>a?-1:a>b?1:0}function k(a,b){var c,d;for(c=0;c<Math.min(a.length,b.length);c+=1)if(d=l(a[c],b[c]),0!==d)return d;return j(a.length,b.length)}function l(a,b){var c,d,e,f;if(void 0===a)return void 0===b?0:-1;if(void 0===b)return void 0===a?0:1;if(null===a)return null===b?0:-1;if(null===b)return null===a?0:1;if("number"==typeof a)return"number"==typeof b?j(a,b):-1;if("number"==typeof b)return"number"==typeof a?j(a,b):1;if("string"==typeof a)return"string"==typeof b?j(a,b):-1;if("string"==typeof b)return"string"==typeof a?j(a,b):1;if("boolean"==typeof a)return"boolean"==typeof b?j(a,b):-1;if("boolean"==typeof b)return"boolean"==typeof a?j(a,b):1;if(t.isDate(a))return t.isDate(b)?j(a.getTime(),b.getTime()):-1;if(t.isDate(b))return t.isDate(a)?j(a.getTime(),b.getTime()):1;if(t.isArray(a))return t.isArray(b)?k(a,b):-1;if(t.isArray(b))return t.isArray(a)?k(a,b):1;for(c=Object.keys(a).sort(),d=Object.keys(b).sort(),f=0;f<Math.min(c.length,d.length);f+=1)if(e=l(a[c[f]],b[d[f]]),0!==e)return e;return j(c.length,d.length)}function m(a){return function(b,c,d){var e="string"==typeof c?c.split("."):c;1===e.length?w[a](b,c,d):(b[e[0]]=b[e[0]]||{},v[a](b[e[0]],e.slice(1),d))}}function n(a,b){var c,d,f=Object.keys(b),g=u.map(f,function(a){return a[0]}),i=u.filter(g,function(a){return"$"===a});if(-1!==f.indexOf("_id")&&b._id!==a._id)throw"You cannot change a document's _id";if(0!==i.length&&i.length!==g.length)throw"You cannot mix modifiers and normal fields";if(0===i.length?(c=h(b),c._id=a._id):(d=u.uniq(f),c=h(a),d.forEach(function(a){var d;if(!v[a])throw"Unknown modifier "+a;try{d=Object.keys(b[a])}catch(e){throw"Modifier "+a+"'s argument must be an object"}d.forEach(function(d){v[a](c,d,b[a][d])})})),e(c),a._id!==c._id)throw"You can't change a document's _id";return c}function o(a,b){var c,d,e="string"==typeof b?b.split("."):b;if(!a)return void 0;if(0===e.length)return a;if(1===e.length)return a[e[0]];if(t.isArray(a[e[0]])){if(c=parseInt(e[1],10),"number"==typeof c&&!isNaN(c))return o(a[e[0]][c],e.slice(2));for(d=new Array,c=0;c<a[e[0]].length;c+=1)d.push(o(a[e[0]][c],e.slice(1)));return d}return o(a[e[0]],e.slice(1))}function p(a,b){var c,d,e;if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||null===b||"string"==typeof b||"boolean"==typeof b||"number"==typeof b)return a===b;if(t.isDate(a)||t.isDate(b))return t.isDate(a)&&t.isDate(b)&&a.getTime()===b.getTime();if(t.isArray(a)||t.isArray(b)||void 0===a||void 0===b)return!1;try{c=Object.keys(a),d=Object.keys(b)}catch(f){return!1}if(c.length!==d.length)return!1;for(e=0;e<c.length;e+=1){if(-1===d.indexOf(c[e]))return!1;if(!p(a[c[e]],b[c[e]]))return!1}return!0}function q(a,b){return"string"==typeof a||"number"==typeof a||t.isDate(a)||"string"==typeof b||"number"==typeof b||t.isDate(b)?typeof a!=typeof b?!1:!0:!1}function r(a,b){var c,d,e,f;if(i(a)||i(b))return s({needAKey:a},"needAKey",b);for(c=Object.keys(b),f=0;f<c.length;f+=1)if(d=c[f],e=b[d],"$"===d[0]){if(!y[d])throw"Unknown logical operator "+d;if(!y[d](a,e))return!1}else if(!s(a,d,e))return!1;return!0}function s(a,b,c,d){var e,f,g,h,i=o(a,b);if(t.isArray(i)&&!d){if(null!==c&&"object"==typeof c&&!t.isRegExp(c))for(f=Object.keys(c),e=0;e<f.length;e+=1)if(z[f[e]])return s(a,b,c,!0);for(e=0;e<i.length;e+=1)if(s({k:i[e]},"k",c))return!0;return!1}if(null!==c&&"object"==typeof c&&!t.isRegExp(c)){if(f=Object.keys(c),g=u.map(f,function(a){return a[0]}),h=u.filter(g,function(a){return"$"===a}),0!==h.length&&h.length!==g.length)throw"You cannot mix operators and normal fields";if(h.length>0){for(e=0;e<f.length;e+=1){if(!x[f[e]])throw"Unknown comparison function "+f[e];if(!x[f[e]](i,c[f[e]]))return!1}return!0}}return t.isRegExp(c)?x.$regex(i,c):p(i,c)?!0:!1}var t=a("util"),u=a("underscore"),v={},w={},x={},y={},z={};w.$set=function(a,b,c){a[b]=c},w.$unset=function(a,b,c){delete a[b]},w.$push=function(a,b,c){if(a.hasOwnProperty(b)||(a[b]=[]),!t.isArray(a[b]))throw"Can't $push an element on non-array values";if(null!==c&&"object"==typeof c&&c.$each){if(Object.keys(c).length>1)throw"Can't use another field in conjunction with $each";if(!t.isArray(c.$each))throw"$each requires an array value";c.$each.forEach(function(c){a[b].push(c)})}else a[b].push(c)},w.$addToSet=function(a,b,c){var d=!0;if(a.hasOwnProperty(b)||(a[b]=[]),!t.isArray(a[b]))throw"Can't $addToSet an element on non-array values";if(null!==c&&"object"==typeof c&&c.$each){if(Object.keys(c).length>1)throw"Can't use another field in conjunction with $each";if(!t.isArray(c.$each))throw"$each requires an array value";c.$each.forEach(function(c){w.$addToSet(a,b,c)})}else a[b].forEach(function(a){0===l(a,c)&&(d=!1)}),d&&a[b].push(c)},w.$pop=function(a,b,c){if(!t.isArray(a[b]))throw"Can't $pop an element from non-array values";if("number"!=typeof c)throw c+" isn't an integer, can't use it with $pop";0!==c&&(c>0?a[b]=a[b].slice(0,a[b].length-1):a[b]=a[b].slice(1))},w.$pull=function(a,b,c){var d,e;if(!t.isArray(a[b]))throw"Can't $pull an element from non-array values";for(d=a[b],e=d.length-1;e>=0;e-=1)r(d[e],c)&&d.splice(e,1)},w.$inc=function(a,b,c){if("number"!=typeof c)throw c+" must be a number";if("number"!=typeof a[b]){if(u.has(a,b))throw"Don't use the $inc modifier on non-number fields";a[b]=c}else a[b]+=c},Object.keys(w).forEach(function(a){v[a]=m(a)}),x.$lt=function(a,b){return q(a,b)&&b>a},x.$lte=function(a,b){return q(a,b)&&b>=a},x.$gt=function(a,b){return q(a,b)&&a>b},x.$gte=function(a,b){return q(a,b)&&a>=b},x.$ne=function(a,b){return void 0===a?!0:!p(a,b)},x.$in=function(a,b){var c;if(!t.isArray(b))throw"$in operator called with a non-array";for(c=0;c<b.length;c+=1)if(p(a,b[c]))return!0;return!1},x.$nin=function(a,b){if(!t.isArray(b))throw"$nin operator called with a non-array";return!x.$in(a,b)},x.$regex=function(a,b){if(!t.isRegExp(b))throw"$regex operator called with non regular expression";return"string"!=typeof a?!1:b.test(a)},x.$exists=function(a,b){return b=b||""===b?!0:!1,void 0===a?!b:b},x.$size=function(a,b){if(!t.isArray(a))return!1;if(b%1!==0)throw"$size operator called without an integer";return a.length==b},z.$size=!0,y.$or=function(a,b){var c;if(!t.isArray(b))throw"$or operator used without an array";for(c=0;c<b.length;c+=1)if(r(a,b[c]))return!0;return!1},y.$and=function(a,b){var c;if(!t.isArray(b))throw"$and operator used without an array";for(c=0;c<b.length;c+=1)if(!r(a,b[c]))return!1;return!0},y.$not=function(a,b){return!r(a,b)},y.$where=function(a,b){var c;if(!u.isFunction(b))throw"$where operator used without a function";if(c=b.call(a),!u.isBoolean(c))throw"$where function must return boolean";return c},b.exports.serialize=f,b.exports.deserialize=g,b.exports.deepCopy=h,b.exports.checkObject=e,b.exports.isPrimitiveType=i,b.exports.modify=n,b.exports.getDotValue=o,b.exports.match=r,b.exports.areThingsEqual=p,b.exports.compareThings=l},{underscore:18,util:3}],11:[function(a,b,c){function d(a){var b,c,e;if(this.db=a.db,this.inMemoryOnly=this.db.inMemoryOnly,this.filename=this.db.filename,this.corruptAlertThreshold=void 0!==a.corruptAlertThreshold?a.corruptAlertThreshold:.1,!this.inMemoryOnly&&this.filename){if("~"===this.filename.charAt(this.filename.length-1))throw"The datafile name can't end with a ~, which is reserved for automatic backup files";this.tempFilename=this.filename+"~",this.oldFilename=this.filename+"~~"}if(a.afterSerialization&&!a.beforeDeserialization)throw"Serialization hook defined but deserialization hook undefined, cautiously refusing to start NeDB to prevent dataloss";if(!a.afterSerialization&&a.beforeDeserialization)throw"Serialization hook undefined but deserialization hook defined, cautiously refusing to start NeDB to prevent dataloss";for(this.afterSerialization=a.afterSerialization||function(a){return a},this.beforeDeserialization=a.beforeDeserialization||function(a){return a},b=1;30>b;b+=1)for(c=0;10>c;c+=1)if(e=j.uid(b),this.beforeDeserialization(this.afterSerialization(e))!==e)throw"beforeDeserialization is not the reverse of afterSerialization, cautiously refusing to start NeDB to prevent dataloss";this.filename&&a.nodeWebkitAppName&&(console.log("=================================================================="),console.log("WARNING: The nodeWebkitAppName option is deprecated"),console.log("To get the path to the directory where Node Webkit stores the data"),console.log("for your app, use the internal nw.gui module like this"),console.log("require('nw.gui').App.dataPath"),console.log("See https://github.com/rogerwang/node-webkit/issues/500"),console.log("=================================================================="),this.filename=d.getNWAppFilename(a.nodeWebkitAppName,this.filename),this.tempFilename=d.getNWAppFilename(a.nodeWebkitAppName,this.tempFilename),this.oldFilename=d.getNWAppFilename(a.nodeWebkitAppName,this.oldFilename))}var e=a("__browserify_process"),f=a("./storage"),g=a("path"),h=a("./model"),i=a("async"),j=a("./customUtils"),k=a("./indexes");d.ensureDirectoryExists=function(a,b){
var c=b||function(){};f.mkdirp(a,function(a){return c(a)})},d.ensureFileDoesntExist=function(a,b){f.exists(a,function(c){return c?void f.unlink(a,function(a){return b(a)}):b(null)})},d.getNWAppFilename=function(a,b){var c;switch(e.platform){case"win32":case"win64":if(c=e.env.LOCALAPPDATA||e.env.APPDATA,!c)throw"Couldn't find the base application data folder";c=g.join(c,a);break;case"darwin":if(c=e.env.HOME,!c)throw"Couldn't find the base application data directory";c=g.join(c,"Library","Application Support",a);break;case"linux":if(c=e.env.HOME,!c)throw"Couldn't find the base application data directory";c=g.join(c,".config",a);break;default:throw"Can't use the Node Webkit relative path for platform "+e.platform}return g.join(c,"nedb-data",b)},d.prototype.persistCachedDatabase=function(a){var b=a||function(){},c="",e=this;return this.inMemoryOnly?b(null):(this.db.getAllData().forEach(function(a){c+=e.afterSerialization(h.serialize(a))+"\n"}),Object.keys(this.db.indexes).forEach(function(a){"_id"!=a&&(c+=e.afterSerialization(h.serialize({$$indexCreated:{fieldName:a,unique:e.db.indexes[a].unique,sparse:e.db.indexes[a].sparse}}))+"\n")}),void i.waterfall([i.apply(d.ensureFileDoesntExist,e.tempFilename),i.apply(d.ensureFileDoesntExist,e.oldFilename),function(a){f.exists(e.filename,function(b){return b?void f.rename(e.filename,e.oldFilename,function(b){return a(b)}):a()})},function(a){f.writeFile(e.tempFilename,c,function(b){return a(b)})},function(a){f.rename(e.tempFilename,e.filename,function(b){return a(b)})},i.apply(d.ensureFileDoesntExist,e.oldFilename)],function(a){return b(a?a:null)}))},d.prototype.compactDatafile=function(){this.db.executor.push({"this":this,fn:this.persistCachedDatabase,arguments:[]})},d.prototype.setAutocompactionInterval=function(a){var b=this,c=5e3,d=Math.max(a||0,c);this.stopAutocompaction(),this.autocompactionIntervalId=setInterval(function(){b.compactDatafile()},d)},d.prototype.stopAutocompaction=function(){this.autocompactionIntervalId&&clearInterval(this.autocompactionIntervalId)},d.prototype.persistNewState=function(a,b){var c=this,d="",e=b||function(){};return c.inMemoryOnly?e(null):(a.forEach(function(a){d+=c.afterSerialization(h.serialize(a))+"\n"}),0===d.length?e(null):void f.appendFile(c.filename,d,"utf8",function(a){return e(a)}))},d.prototype.treatRawData=function(a){var b,c=a.split("\n"),d={},e=[],f={},g=-1;for(b=0;b<c.length;b+=1){var i;try{i=h.deserialize(this.beforeDeserialization(c[b])),i._id?i.$$deleted===!0?delete d[i._id]:d[i._id]=i:i.$$indexCreated&&void 0!=i.$$indexCreated.fieldName?f[i.$$indexCreated.fieldName]=i.$$indexCreated:"string"==typeof i.$$indexRemoved&&delete f[i.$$indexRemoved]}catch(j){g+=1}}if(c.length>0&&g/c.length>this.corruptAlertThreshold)throw"More than 10% of the data file is corrupt, the wrong beforeDeserialization hook may be used. Cautiously refusing to start NeDB to prevent dataloss";return Object.keys(d).forEach(function(a){e.push(d[a])}),{data:e,indexes:f}},d.prototype.ensureDatafileIntegrity=function(a){var b=this;f.exists(b.filename,function(c){return c?a(null):void f.exists(b.oldFilename,function(c){return c?void f.rename(b.oldFilename,b.filename,function(b){return a(b)}):f.writeFile(b.filename,"","utf8",function(b){a(b)})})})},d.prototype.loadDatabase=function(a){var b=a||function(){},c=this;return c.db.resetIndexes(),c.inMemoryOnly?b(null):void i.waterfall([function(a){d.ensureDirectoryExists(g.dirname(c.filename),function(b){c.ensureDatafileIntegrity(function(b){f.readFile(c.filename,"utf8",function(b,d){if(b)return a(b);try{var e=c.treatRawData(d)}catch(f){return a(f)}Object.keys(e.indexes).forEach(function(a){c.db.indexes[a]=new k(e.indexes[a])});try{c.db.resetIndexes(e.data)}catch(f){return c.db.resetIndexes(),a(f)}c.db.persistence.persistCachedDatabase(a)})})})}],function(a){return a?b(a):(c.db.executor.processBuffer(),b(null))})},b.exports=d},{"./customUtils":6,"./indexes":9,"./model":10,"./storage":12,__browserify_process:4,async:13,path:2}],12:[function(a,b,c){function d(a,b){chrome.storage.local.get(a,function(c){b(c[a]?!0:!1)})}function e(a,b,c){chrome.storage.local.get(a,function(d){if(d[a]){var e={};e[b]=d[a],chrome.storage.local.set(e,function(){chrome.storage.local.remove(a,function(){return c()})})}else chrome.storage.local.remove(b,function(){return c()})})}function f(a,b,c,d){"function"==typeof c&&(d=c);var e={};e[a]=b,chrome.storage.local.set(e,function(){return d()})}function g(a,b,c,d){"function"==typeof c&&(d=c),chrome.storage.local.get(a,function(c){var e=c[a]||"";e+=b;var f={};f[a]=e,chrome.storage.local.set(f,function(){return d()})})}function h(a,b,c){"function"==typeof b&&(c=b),chrome.storage.local.get(a,function(b){c(null,b[a]||"")})}function i(a,b){chrome.storage.local.remove(a,function(){return b()})}function j(a,b){return b()}b.exports.exists=d,b.exports.rename=e,b.exports.writeFile=f,b.exports.appendFile=g,b.exports.readFile=h,b.exports.unlink=i,b.exports.mkdirp=j},{}],13:[function(b,c,d){var e=b("__browserify_process");!function(){function b(a){var b=!1;return function(){if(b)throw new Error("Callback was already called.");b=!0,a.apply(d,arguments)}}var d,f,g={};d=this,null!=d&&(f=d.async),g.noConflict=function(){return d.async=f,g};var h=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},i=function(a,b){if(a.map)return a.map(b);var c=[];return h(a,function(a,d,e){c.push(b(a,d,e))}),c},j=function(a,b,c){return a.reduce?a.reduce(b,c):(h(a,function(a,d,e){c=b(c,a,d,e)}),c)},k=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};"undefined"!=typeof e&&e.nextTick?(g.nextTick=e.nextTick,"undefined"!=typeof setImmediate?g.setImmediate=function(a){setImmediate(a)}:g.setImmediate=g.nextTick):"function"==typeof setImmediate?(g.nextTick=function(a){setImmediate(a)},g.setImmediate=g.nextTick):(g.nextTick=function(a){setTimeout(a,0)},g.setImmediate=g.nextTick),g.each=function(a,c,d){if(d=d||function(){},!a.length)return d();var e=0;h(a,function(f){c(f,b(function(b){b?(d(b),d=function(){}):(e+=1,e>=a.length&&d(null))}))})},g.forEach=g.each,g.eachSeries=function(a,b,c){if(c=c||function(){},!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c(null):e())})};e()},g.forEachSeries=g.eachSeries,g.eachLimit=function(a,b,c,d){var e=l(b);e.apply(null,[a,c,d])},g.forEachLimit=g.eachLimit;var l=function(a){return function(b,c,d){if(d=d||function(){},!b.length||0>=a)return d();var e=0,f=0,g=0;!function h(){if(e>=b.length)return d();for(;a>g&&f<b.length;)f+=1,g+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,g-=1,e>=b.length?d():h())})}()}},m=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[g.each].concat(b))}},n=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[l(a)].concat(c))}},o=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[g.eachSeries].concat(b))}},p=function(a,b,c,d){var e=[];b=i(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)})},function(a){d(a,e)})};g.map=m(p),g.mapSeries=o(p),g.mapLimit=function(a,b,c,d){return q(b)(a,c,d)};var q=function(a){return n(a,p)};g.reduce=function(a,b,c,d){g.eachSeries(a,function(a,d){c(b,a,function(a,c){b=c,d(a)})},function(a){d(a,b)})},g.inject=g.reduce,g.foldl=g.reduce,g.reduceRight=function(a,b,c,d){var e=i(a,function(a){return a}).reverse();g.reduce(e,b,c,d)},g.foldr=g.reduceRight;var r=function(a,b,c,d){var e=[];b=i(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c&&e.push(a),b()})},function(a){d(i(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};g.filter=m(r),g.filterSeries=o(r),g.select=g.filter,g.selectSeries=g.filterSeries;var s=function(a,b,c,d){var e=[];b=i(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c||e.push(a),b()})},function(a){d(i(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};g.reject=m(s),g.rejectSeries=o(s);var t=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(a){d()})};g.detect=m(t),g.detectSeries=o(t),g.some=function(a,b,c){g.each(a,function(a,d){b(a,function(a){a&&(c(!0),c=function(){}),d()})},function(a){c(!1)})},g.any=g.some,g.every=function(a,b,c){g.each(a,function(a,d){b(a,function(a){a||(c(!1),c=function(){}),d()})},function(a){c(!0)})},g.all=g.every,g.sortBy=function(a,b,c){g.map(a,function(a,c){b(a,function(b,d){b?c(b):c(null,{value:a,criteria:d})})},function(a,b){if(a)return c(a);var d=function(a,b){var c=a.criteria,d=b.criteria;return d>c?-1:c>d?1:0};c(null,i(b.sort(d),function(a){return a.value}))})},g.auto=function(a,b){b=b||function(){};var c=k(a);if(!c.length)return b(null);var d={},e=[],f=function(a){e.unshift(a)},i=function(a){for(var b=0;b<e.length;b+=1)if(e[b]===a)return void e.splice(b,1)},l=function(){h(e.slice(0),function(a){a()})};f(function(){k(d).length===c.length&&(b(null,d),b=function(){})}),h(c,function(c){var e=a[c]instanceof Function?[a[c]]:a[c],m=function(a){var e=Array.prototype.slice.call(arguments,1);if(e.length<=1&&(e=e[0]),a){var f={};h(k(d),function(a){f[a]=d[a]}),f[c]=e,b(a,f),b=function(){}}else d[c]=e,g.setImmediate(l)},n=e.slice(0,Math.abs(e.length-1))||[],o=function(){return j(n,function(a,b){return a&&d.hasOwnProperty(b)},!0)&&!d.hasOwnProperty(c)};if(o())e[e.length-1](m,d);else{var p=function(){o()&&(i(p),e[e.length-1](m,d))};f(p)}})},g.waterfall=function(a,b){if(b=b||function(){},a.constructor!==Array){var c=new Error("First argument to waterfall must be an array of functions");return b(c)}if(!a.length)return b();var d=function(a){return function(c){if(c)b.apply(null,arguments),b=function(){};else{var e=Array.prototype.slice.call(arguments,1),f=a.next();f?e.push(d(f)):e.push(b),g.setImmediate(function(){a.apply(null,e)})}}};d(g.iterator(a))()};var u=function(a,b,c){if(c=c||function(){},b.constructor===Array)a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.each(k(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}};g.parallel=function(a,b){u({map:g.map,each:g.each},a,b)},g.parallelLimit=function(a,b,c){u({map:q(b),each:l(b)},a,c)},g.series=function(a,b){if(b=b||function(){},a.constructor===Array)g.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},b);else{var c={};g.eachSeries(k(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),c[b]=e,d(a)})},function(a){b(a,c)})}},g.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},g.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var v=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};g.concat=m(v),g.concatSeries=o(v),g.whilst=function(a,b,c){a()?b(function(d){return d?c(d):void g.whilst(a,b,c)}):c()},g.doWhilst=function(a,b,c){a(function(d){return d?c(d):void(b()?g.doWhilst(a,b,c):c())})},g.until=function(a,b,c){a()?c():b(function(d){return d?c(d):void g.until(a,b,c)})},g.doUntil=function(a,b,c){a(function(d){return d?c(d):void(b()?c():g.doUntil(a,b,c))})},g.queue=function(a,c){function d(a,b,d,e){b.constructor!==Array&&(b=[b]),h(b,function(b){var f={data:b,callback:"function"==typeof e?e:null};d?a.tasks.unshift(f):a.tasks.push(f),a.saturated&&a.tasks.length===c&&a.saturated(),g.setImmediate(a.process)})}void 0===c&&(c=1);var e=0,f={tasks:[],concurrency:c,saturated:null,empty:null,drain:null,push:function(a,b){d(f,a,!1,b)},unshift:function(a,b){d(f,a,!0,b)},process:function(){if(e<f.concurrency&&f.tasks.length){var c=f.tasks.shift();f.empty&&0===f.tasks.length&&f.empty(),e+=1;var d=function(){e-=1,c.callback&&c.callback.apply(c,arguments),f.drain&&f.tasks.length+e===0&&f.drain(),f.process()},g=b(d);a(c.data,g)}},length:function(){return f.tasks.length},running:function(){return e}};return f},g.cargo=function(a,b){var c=!1,d=[],e={tasks:d,payload:b,saturated:null,empty:null,drain:null,push:function(a,c){a.constructor!==Array&&(a=[a]),h(a,function(a){d.push({data:a,callback:"function"==typeof c?c:null}),e.saturated&&d.length===b&&e.saturated()}),g.setImmediate(e.process)},process:function f(){if(!c){if(0===d.length)return void(e.drain&&e.drain());var g="number"==typeof b?d.splice(0,b):d.splice(0),j=i(g,function(a){return a.data});e.empty&&e.empty(),c=!0,a(j,function(){c=!1;var a=arguments;h(g,function(b){b.callback&&b.callback.apply(null,a)}),f()})}},length:function(){return d.length},running:function(){return c}};return e};var w=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(b?console.error&&console.error(b):console[a]&&h(c,function(b){console[a](b)}))}]))}};g.log=w("log"),g.dir=w("dir"),g.memoize=function(a,b){var c={},d={};b=b||function(a){return a};var e=function(){var e=Array.prototype.slice.call(arguments),f=e.pop(),g=b.apply(null,e);g in c?f.apply(null,c[g]):g in d?d[g].push(f):(d[g]=[f],a.apply(null,e.concat([function(){c[g]=arguments;var a=d[g];delete d[g];for(var b=0,e=a.length;e>b;b++)a[b].apply(null,arguments)}])))};return e.memo=c,e.unmemoized=a,e},g.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}},g.times=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return g.map(d,b,c)},g.timesSeries=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return g.mapSeries(d,b,c)},g.compose=function(){var a=Array.prototype.reverse.call(arguments);return function(){var b=this,c=Array.prototype.slice.call(arguments),d=c.pop();g.reduce(a,c,function(a,c,d){c.apply(b,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,c){d.apply(b,[a].concat(c))})}};var x=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,function(a,b){a.apply(c,d.concat([b]))},e)};if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);return c.apply(this,d)}return c};g.applyEach=m(x),g.applyEachSeries=o(x),g.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d}a(c)}c()},"undefined"!=typeof a&&a.amd?a([],function(){return g}):"undefined"!=typeof c&&c.exports?c.exports=g:d.async=g}()},{__browserify_process:4}],14:[function(a,b,c){b.exports.BinarySearchTree=a("./lib/bst"),b.exports.AVLTree=a("./lib/avltree")},{"./lib/avltree":15,"./lib/bst":16}],15:[function(a,b,c){function d(a){this.tree=new e(a)}function e(a){a=a||{},this.left=null,this.right=null,this.parent=void 0!==a.parent?a.parent:null,a.hasOwnProperty("key")&&(this.key=a.key),this.data=a.hasOwnProperty("value")?[a.value]:[],this.unique=a.unique||!1,this.compareKeys=a.compareKeys||g.defaultCompareKeysFunction,this.checkValueEquality=a.checkValueEquality||g.defaultCheckValueEquality}var f=a("./bst"),g=a("./customUtils"),h=a("util");a("underscore");h.inherits(e,f),d._AVLTree=e,e.prototype.checkHeightCorrect=function(){var a,b;if(this.hasOwnProperty("key")){if(this.left&&void 0===this.left.height)throw"Undefined height for node "+this.left.key;if(this.right&&void 0===this.right.height)throw"Undefined height for node "+this.right.key;if(void 0===this.height)throw"Undefined height for node "+this.key;if(a=this.left?this.left.height:0,b=this.right?this.right.height:0,this.height!==1+Math.max(a,b))throw"Height constraint failed for node "+this.key;this.left&&this.left.checkHeightCorrect(),this.right&&this.right.checkHeightCorrect()}},e.prototype.balanceFactor=function(){var a=this.left?this.left.height:0,b=this.right?this.right.height:0;return a-b},e.prototype.checkBalanceFactors=function(){if(Math.abs(this.balanceFactor())>1)throw"Tree is unbalanced at node "+this.key;this.left&&this.left.checkBalanceFactors(),this.right&&this.right.checkBalanceFactors()},e.prototype.checkIsAVLT=function(){e.super_.prototype.checkIsBST.call(this),this.checkHeightCorrect(),this.checkBalanceFactors()},d.prototype.checkIsAVLT=function(){this.tree.checkIsAVLT()},e.prototype.rightRotation=function(){var a,b,c,d,e=this,f=this.left;return f?(a=f.right,e.parent?(f.parent=e.parent,e.parent.left===e?e.parent.left=f:e.parent.right=f):f.parent=null,f.right=e,e.parent=f,e.left=a,a&&(a.parent=e),b=f.left?f.left.height:0,c=a?a.height:0,d=e.right?e.right.height:0,e.height=Math.max(c,d)+1,f.height=Math.max(b,e.height)+1,f):this},e.prototype.leftRotation=function(){var a,b,c,d,e=this,f=this.right;return f?(a=f.left,e.parent?(f.parent=e.parent,e.parent.left===e?e.parent.left=f:e.parent.right=f):f.parent=null,f.left=e,e.parent=f,e.right=a,a&&(a.parent=e),b=e.left?e.left.height:0,c=a?a.height:0,d=f.right?f.right.height:0,e.height=Math.max(b,c)+1,f.height=Math.max(d,e.height)+1,f):this},e.prototype.rightTooSmall=function(){return this.balanceFactor()<=1?this:(this.left.balanceFactor()<0&&this.left.leftRotation(),this.rightRotation())},e.prototype.leftTooSmall=function(){return this.balanceFactor()>=-1?this:(this.right.balanceFactor()>0&&this.right.rightRotation(),this.leftRotation())},e.prototype.rebalanceAlongPath=function(a){var b,c,d=this;if(!this.hasOwnProperty("key"))return delete this.height,this;for(c=a.length-1;c>=0;c-=1)a[c].height=1+Math.max(a[c].left?a[c].left.height:0,a[c].right?a[c].right.height:0),a[c].balanceFactor()>1&&(b=a[c].rightTooSmall(),0===c&&(d=b)),a[c].balanceFactor()<-1&&(b=a[c].leftTooSmall(),0===c&&(d=b));return d},e.prototype.insert=function(a,b){var c=[],d=this;if(!this.hasOwnProperty("key"))return this.key=a,this.data.push(b),this.height=1,this;for(;;){if(0===d.compareKeys(d.key,a)){if(d.unique)throw{message:"Can't insert key "+a+", it violates the unique constraint",key:a,errorType:"uniqueViolated"};return d.data.push(b),this}if(c.push(d),d.compareKeys(a,d.key)<0){if(!d.left){c.push(d.createLeftChild({key:a,value:b}));break}d=d.left}else{if(!d.right){c.push(d.createRightChild({key:a,value:b}));break}d=d.right}}return this.rebalanceAlongPath(c)},d.prototype.insert=function(a,b){var c=this.tree.insert(a,b);c&&(this.tree=c)},e.prototype["delete"]=function(a,b){var c,d=[],e=this,f=[];if(!this.hasOwnProperty("key"))return this;for(;;){if(0===e.compareKeys(a,e.key))break;if(f.push(e),e.compareKeys(a,e.key)<0){if(!e.left)return this;e=e.left}else{if(!e.right)return this;e=e.right}}if(e.data.length>1&&b)return e.data.forEach(function(a){e.checkValueEquality(a,b)||d.push(a)}),e.data=d,this;if(!e.left&&!e.right)return e===this?(delete e.key,e.data=[],delete e.height,this):(e.parent.left===e?e.parent.left=null:e.parent.right=null,this.rebalanceAlongPath(f));if(!e.left||!e.right)return c=e.left?e.left:e.right,e===this?(c.parent=null,c):(e.parent.left===e?(e.parent.left=c,c.parent=e.parent):(e.parent.right=c,c.parent=e.parent),this.rebalanceAlongPath(f));if(f.push(e),c=e.left,!c.right)return e.key=c.key,e.data=c.data,e.left=c.left,c.left&&(c.left.parent=e),this.rebalanceAlongPath(f);for(;;){if(!c.right)break;f.push(c),c=c.right}return e.key=c.key,e.data=c.data,c.parent.right=c.left,c.left&&(c.left.parent=c.parent),this.rebalanceAlongPath(f)},d.prototype["delete"]=function(a,b){var c=this.tree["delete"](a,b);c&&(this.tree=c)},["getNumberOfKeys","search","betweenBounds","prettyPrint","executeOnEveryNode"].forEach(function(a){d.prototype[a]=function(){return this.tree[a].apply(this.tree,arguments)}}),b.exports=d},{"./bst":16,"./customUtils":17,underscore:18,util:3}],16:[function(a,b,c){function d(a){a=a||{},this.left=null,this.right=null,this.parent=void 0!==a.parent?a.parent:null,a.hasOwnProperty("key")&&(this.key=a.key),this.data=a.hasOwnProperty("value")?[a.value]:[],this.unique=a.unique||!1,this.compareKeys=a.compareKeys||f.defaultCompareKeysFunction,this.checkValueEquality=a.checkValueEquality||f.defaultCheckValueEquality}function e(a,b){var c;for(c=0;c<b.length;c+=1)a.push(b[c])}var f=a("./customUtils");d.prototype.getMaxKeyDescendant=function(){return this.right?this.right.getMaxKeyDescendant():this},d.prototype.getMaxKey=function(){return this.getMaxKeyDescendant().key},d.prototype.getMinKeyDescendant=function(){return this.left?this.left.getMinKeyDescendant():this},d.prototype.getMinKey=function(){return this.getMinKeyDescendant().key},d.prototype.checkAllNodesFullfillCondition=function(a){this.hasOwnProperty("key")&&(a(this.key,this.data),this.left&&this.left.checkAllNodesFullfillCondition(a),this.right&&this.right.checkAllNodesFullfillCondition(a))},d.prototype.checkNodeOrdering=function(){var a=this;this.hasOwnProperty("key")&&(this.left&&(this.left.checkAllNodesFullfillCondition(function(b){if(a.compareKeys(b,a.key)>=0)throw"Tree with root "+a.key+" is not a binary search tree"}),this.left.checkNodeOrdering()),this.right&&(this.right.checkAllNodesFullfillCondition(function(b){if(a.compareKeys(b,a.key)<=0)throw"Tree with root "+a.key+" is not a binary search tree"}),this.right.checkNodeOrdering()))},d.prototype.checkInternalPointers=function(){if(this.left){if(this.left.parent!==this)throw"Parent pointer broken for key "+this.key;this.left.checkInternalPointers()}if(this.right){if(this.right.parent!==this)throw"Parent pointer broken for key "+this.key;this.right.checkInternalPointers()}},d.prototype.checkIsBST=function(){if(this.checkNodeOrdering(),this.checkInternalPointers(),this.parent)throw"The root shouldn't have a parent"},d.prototype.getNumberOfKeys=function(){var a;return this.hasOwnProperty("key")?(a=1,this.left&&(a+=this.left.getNumberOfKeys()),this.right&&(a+=this.right.getNumberOfKeys()),a):0},d.prototype.createSimilar=function(a){return a=a||{},a.unique=this.unique,a.compareKeys=this.compareKeys,a.checkValueEquality=this.checkValueEquality,new this.constructor(a)},d.prototype.createLeftChild=function(a){var b=this.createSimilar(a);return b.parent=this,this.left=b,b},d.prototype.createRightChild=function(a){var b=this.createSimilar(a);return b.parent=this,this.right=b,b},d.prototype.insert=function(a,b){if(!this.hasOwnProperty("key"))return this.key=a,void this.data.push(b);if(0===this.compareKeys(this.key,a)){if(this.unique)throw{message:"Can't insert key "+a+", it violates the unique constraint",key:a,errorType:"uniqueViolated"};return void this.data.push(b)}this.compareKeys(a,this.key)<0?this.left?this.left.insert(a,b):this.createLeftChild({key:a,value:b}):this.right?this.right.insert(a,b):this.createRightChild({key:a,value:b})},d.prototype.search=function(a){return this.hasOwnProperty("key")?0===this.compareKeys(this.key,a)?this.data:this.compareKeys(a,this.key)<0?this.left?this.left.search(a):[]:this.right?this.right.search(a):[]:[]},d.prototype.getLowerBoundMatcher=function(a){var b=this;return a.hasOwnProperty("$gt")||a.hasOwnProperty("$gte")?a.hasOwnProperty("$gt")&&a.hasOwnProperty("$gte")?0===b.compareKeys(a.$gte,a.$gt)?function(c){return b.compareKeys(c,a.$gt)>0}:b.compareKeys(a.$gte,a.$gt)>0?function(c){return b.compareKeys(c,a.$gte)>=0}:function(c){return b.compareKeys(c,a.$gt)>0}:a.hasOwnProperty("$gt")?function(c){return b.compareKeys(c,a.$gt)>0}:function(c){return b.compareKeys(c,a.$gte)>=0}:function(){return!0}},d.prototype.getUpperBoundMatcher=function(a){var b=this;return a.hasOwnProperty("$lt")||a.hasOwnProperty("$lte")?a.hasOwnProperty("$lt")&&a.hasOwnProperty("$lte")?0===b.compareKeys(a.$lte,a.$lt)?function(c){return b.compareKeys(c,a.$lt)<0}:b.compareKeys(a.$lte,a.$lt)<0?function(c){return b.compareKeys(c,a.$lte)<=0}:function(c){return b.compareKeys(c,a.$lt)<0}:a.hasOwnProperty("$lt")?function(c){return b.compareKeys(c,a.$lt)<0}:function(c){return b.compareKeys(c,a.$lte)<=0}:function(){return!0}},d.prototype.betweenBounds=function(a,b,c){var d=[];return this.hasOwnProperty("key")?(b=b||this.getLowerBoundMatcher(a),c=c||this.getUpperBoundMatcher(a),b(this.key)&&this.left&&e(d,this.left.betweenBounds(a,b,c)),b(this.key)&&c(this.key)&&e(d,this.data),c(this.key)&&this.right&&e(d,this.right.betweenBounds(a,b,c)),d):[]},d.prototype.deleteIfLeaf=function(){return this.left||this.right?!1:this.parent?(this.parent.left===this?this.parent.left=null:this.parent.right=null,!0):(delete this.key,this.data=[],!0)},d.prototype.deleteIfOnlyOneChild=function(){var a;return this.left&&!this.right&&(a=this.left),!this.left&&this.right&&(a=this.right),a?this.parent?(this.parent.left===this?(this.parent.left=a,a.parent=this.parent):(this.parent.right=a,a.parent=this.parent),!0):(this.key=a.key,this.data=a.data,this.left=null,a.left&&(this.left=a.left,a.left.parent=this),this.right=null,a.right&&(this.right=a.right,a.right.parent=this),!0):!1},d.prototype["delete"]=function(a,b){var c,d=[],e=this;if(this.hasOwnProperty("key")){if(this.compareKeys(a,this.key)<0)return void(this.left&&this.left["delete"](a,b));if(this.compareKeys(a,this.key)>0)return void(this.right&&this.right["delete"](a,b));if(0!==!this.compareKeys(a,this.key))return this.data.length>1&&void 0!==b?(this.data.forEach(function(a){e.checkValueEquality(a,b)||d.push(a)}),void(e.data=d)):void(this.deleteIfLeaf()||this.deleteIfOnlyOneChild()||(Math.random()>=.5?(c=this.left.getMaxKeyDescendant(),this.key=c.key,this.data=c.data,this===c.parent?(this.left=c.left,c.left&&(c.left.parent=c.parent)):(c.parent.right=c.left,c.left&&(c.left.parent=c.parent))):(c=this.right.getMinKeyDescendant(),this.key=c.key,this.data=c.data,this===c.parent?(this.right=c.right,c.right&&(c.right.parent=c.parent)):(c.parent.left=c.right,c.right&&(c.right.parent=c.parent)))))}},d.prototype.executeOnEveryNode=function(a){this.left&&this.left.executeOnEveryNode(a),a(this),this.right&&this.right.executeOnEveryNode(a)},d.prototype.prettyPrint=function(a,b){b=b||"",console.log(b+"* "+this.key),a&&console.log(b+"* "+this.data),(this.left||this.right)&&(this.left?this.left.prettyPrint(a,b+"  "):console.log(b+"  *"),this.right?this.right.prettyPrint(a,b+"  "):console.log(b+"  *"))},b.exports=d},{"./customUtils":17}],17:[function(a,b,c){function d(a){var b,c;return 0===a?[]:1===a?[0]:(b=d(a-1),c=Math.floor(Math.random()*a),b.splice(c,0,a-1),b)}function e(a,b){if(b>a)return-1;if(a>b)return 1;if(a===b)return 0;throw{message:"Couldn't compare elements",a:a,b:b}}function f(a,b){return a===b}b.exports.getRandomArray=d,b.exports.defaultCompareKeysFunction=e,b.exports.defaultCheckValueEquality=f},{}],18:[function(a,b,c){(function(){var a=this,d=a._,e={},f=Array.prototype,g=Object.prototype,h=Function.prototype,i=f.push,j=f.slice,k=f.concat,l=g.toString,m=g.hasOwnProperty,n=f.forEach,o=f.map,p=f.reduce,q=f.reduceRight,r=f.filter,s=f.every,t=f.some,u=f.indexOf,v=f.lastIndexOf,w=Array.isArray,x=Object.keys,y=h.bind,z=function(a){return a instanceof z?a:this instanceof z?void(this._wrapped=a):new z(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=z),c._=z):a._=z,z.VERSION="1.4.4";var A=z.each=z.forEach=function(a,b,c){if(null!=a)if(n&&a.forEach===n)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,f=a.length;f>d;d++)if(b.call(c,a[d],d,a)===e)return}else for(var g in a)if(z.has(a,g)&&b.call(c,a[g],g,a)===e)return};z.map=z.collect=function(a,b,c){var d=[];return null==a?d:o&&a.map===o?a.map(b,c):(A(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var B="Reduce of empty array with no initial value";z.reduce=z.foldl=z.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),p&&a.reduce===p)return d&&(b=z.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(A(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(B);return c},z.reduceRight=z.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),q&&a.reduceRight===q)return d&&(b=z.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=z.keys(a);f=g.length}if(A(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(B);return c},z.find=z.detect=function(a,b,c){var d;return C(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},z.filter=z.select=function(a,b,c){var d=[];return null==a?d:r&&a.filter===r?a.filter(b,c):(A(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},z.reject=function(a,b,c){return z.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},z.every=z.all=function(a,b,c){b||(b=z.identity);var d=!0;return null==a?d:s&&a.every===s?a.every(b,c):(A(a,function(a,f,g){return(d=d&&b.call(c,a,f,g))?void 0:e}),!!d)};var C=z.some=z.any=function(a,b,c){b||(b=z.identity);var d=!1;return null==a?d:t&&a.some===t?a.some(b,c):(A(a,function(a,f,g){return d||(d=b.call(c,a,f,g))?e:void 0}),!!d)};z.contains=z.include=function(a,b){return null==a?!1:u&&a.indexOf===u?-1!=a.indexOf(b):C(a,function(a){return a===b})},z.invoke=function(a,b){var c=j.call(arguments,2),d=z.isFunction(b);return z.map(a,function(a){return(d?b:a[b]).apply(a,c)})},z.pluck=function(a,b){return z.map(a,function(a){return a[b]})},z.where=function(a,b,c){return z.isEmpty(b)?c?null:[]:z[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},z.findWhere=function(a,b){return z.where(a,b,!0)},z.max=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&z.isEmpty(a))return-(1/0);var d={computed:-(1/0),value:-(1/0)};return A(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},z.min=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&z.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return A(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},z.shuffle=function(a){var b,c=0,d=[];return A(a,function(a){b=z.random(c++),d[c-1]=d[b],d[b]=a}),d};var D=function(a){return z.isFunction(a)?a:function(b){return b[a]}};z.sortBy=function(a,b,c){var d=D(b);return z.pluck(z.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var E=function(a,b,c,d){var e={},f=D(b||z.identity);return A(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};z.groupBy=function(a,b,c){return E(a,b,c,function(a,b,c){(z.has(a,b)?a[b]:a[b]=[]).push(c)})},z.countBy=function(a,b,c){return E(a,b,c,function(a,b){z.has(a,b)||(a[b]=0),a[b]++})},z.sortedIndex=function(a,b,c,d){c=null==c?z.identity:D(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},z.toArray=function(a){return a?z.isArray(a)?j.call(a):a.length===+a.length?z.map(a,z.identity):z.values(a):[]},z.size=function(a){return null==a?0:a.length===+a.length?a.length:z.keys(a).length},z.first=z.head=z.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:j.call(a,0,b)},z.initial=function(a,b,c){return j.call(a,0,a.length-(null==b||c?1:b))},z.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:j.call(a,Math.max(a.length-b,0))},z.rest=z.tail=z.drop=function(a,b,c){return j.call(a,null==b||c?1:b)},z.compact=function(a){return z.filter(a,z.identity)};var F=function(a,b,c){return A(a,function(a){z.isArray(a)?b?i.apply(c,a):F(a,b,c):c.push(a)}),c};z.flatten=function(a,b){return F(a,b,[])},z.without=function(a){return z.difference(a,j.call(arguments,1))},z.uniq=z.unique=function(a,b,c,d){z.isFunction(b)&&(d=c,c=b,b=!1);var e=c?z.map(a,c,d):a,f=[],g=[];return A(e,function(c,d){(b?d&&g[g.length-1]===c:z.contains(g,c))||(g.push(c),f.push(a[d]))}),f},z.union=function(){return z.uniq(k.apply(f,arguments))},z.intersection=function(a){
var b=j.call(arguments,1);return z.filter(z.uniq(a),function(a){return z.every(b,function(b){return z.indexOf(b,a)>=0})})},z.difference=function(a){var b=k.apply(f,j.call(arguments,1));return z.filter(a,function(a){return!z.contains(b,a)})},z.zip=function(){for(var a=j.call(arguments),b=z.max(z.pluck(a,"length")),c=new Array(b),d=0;b>d;d++)c[d]=z.pluck(a,""+d);return c},z.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},z.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=z.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(u&&a.indexOf===u)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},z.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(v&&a.lastIndexOf===v)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},z.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f},z.bind=function(a,b){if(a.bind===y&&y)return y.apply(a,j.call(arguments,1));var c=j.call(arguments,2);return function(){return a.apply(b,c.concat(j.call(arguments)))}},z.partial=function(a){var b=j.call(arguments,1);return function(){return a.apply(this,b.concat(j.call(arguments)))}},z.bindAll=function(a){var b=j.call(arguments,1);return 0===b.length&&(b=z.functions(a)),A(b,function(b){a[b]=z.bind(a[b],a)}),a},z.memoize=function(a,b){var c={};return b||(b=z.identity),function(){var d=b.apply(this,arguments);return z.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},z.delay=function(a,b){var c=j.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},z.defer=function(a){return z.delay.apply(z,[a,1].concat(j.call(arguments,1)))},z.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},z.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},z.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},z.wrap=function(a,b){return function(){var c=[a];return i.apply(c,arguments),b.apply(this,c)}},z.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},z.after=function(a,b){return 0>=a?b():function(){return--a<1?b.apply(this,arguments):void 0}},z.keys=x||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)z.has(a,c)&&(b[b.length]=c);return b},z.values=function(a){var b=[];for(var c in a)z.has(a,c)&&b.push(a[c]);return b},z.pairs=function(a){var b=[];for(var c in a)z.has(a,c)&&b.push([c,a[c]]);return b},z.invert=function(a){var b={};for(var c in a)z.has(a,c)&&(b[a[c]]=c);return b},z.functions=z.methods=function(a){var b=[];for(var c in a)z.isFunction(a[c])&&b.push(c);return b.sort()},z.extend=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},z.pick=function(a){var b={},c=k.apply(f,j.call(arguments,1));return A(c,function(c){c in a&&(b[c]=a[c])}),b},z.omit=function(a){var b={},c=k.apply(f,j.call(arguments,1));for(var d in a)z.contains(c,d)||(b[d]=a[d]);return b},z.defaults=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a},z.clone=function(a){return z.isObject(a)?z.isArray(a)?a.slice():z.extend({},a):a},z.tap=function(a,b){return b(a),a};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof z&&(a=a._wrapped),b instanceof z&&(b=b._wrapped);var e=l.call(a);if(e!=l.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=G(a[g],b[g],c,d)););}else{var i=a.constructor,j=b.constructor;if(i!==j&&!(z.isFunction(i)&&i instanceof i&&z.isFunction(j)&&j instanceof j))return!1;for(var k in a)if(z.has(a,k)&&(g++,!(h=z.has(b,k)&&G(a[k],b[k],c,d))))break;if(h){for(k in b)if(z.has(b,k)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};z.isEqual=function(a,b){return G(a,b,[],[])},z.isEmpty=function(a){if(null==a)return!0;if(z.isArray(a)||z.isString(a))return 0===a.length;for(var b in a)if(z.has(a,b))return!1;return!0},z.isElement=function(a){return!(!a||1!==a.nodeType)},z.isArray=w||function(a){return"[object Array]"==l.call(a)},z.isObject=function(a){return a===Object(a)},A(["Arguments","Function","String","Number","Date","RegExp"],function(a){z["is"+a]=function(b){return l.call(b)=="[object "+a+"]"}}),z.isArguments(arguments)||(z.isArguments=function(a){return!(!a||!z.has(a,"callee"))}),"function"!=typeof/./&&(z.isFunction=function(a){return"function"==typeof a}),z.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},z.isNaN=function(a){return z.isNumber(a)&&a!=+a},z.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==l.call(a)},z.isNull=function(a){return null===a},z.isUndefined=function(a){return void 0===a},z.has=function(a,b){return m.call(a,b)},z.noConflict=function(){return a._=d,this},z.identity=function(a){return a},z.times=function(a,b,c){for(var d=Array(a),e=0;a>e;e++)d[e]=b.call(c,e);return d},z.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var H={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};H.unescape=z.invert(H.escape);var I={escape:new RegExp("["+z.keys(H.escape).join("")+"]","g"),unescape:new RegExp("("+z.keys(H.unescape).join("|")+")","g")};z.each(["escape","unescape"],function(a){z[a]=function(b){return null==b?"":(""+b).replace(I[a],function(b){return H[a][b]})}}),z.result=function(a,b){if(null==a)return null;var c=a[b];return z.isFunction(c)?c.call(a):c},z.mixin=function(a){A(z.functions(a),function(b){var c=z[b]=a[b];z.prototype[b]=function(){var a=[this._wrapped];return i.apply(a,arguments),N.call(this,c.apply(z,a))}})};var J=0;z.uniqueId=function(a){var b=++J+"";return a?a+b:b},z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;z.template=function(a,b,c){var d;c=z.defaults({},c,z.templateSettings);var e=new RegExp([(c.escape||K).source,(c.interpolate||K).source,(c.evaluate||K).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(M,function(a){return"\\"+L[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,z);var i=function(a){return d.call(this,a,z)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},z.chain=function(a){return z(a).chain()};var N=function(a){return this._chain?z(a).chain():a};z.mixin(z),A(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=f[a];z.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],N.call(this,c)}}),A(["concat","join","slice"],function(a){var b=f[a];z.prototype[a]=function(){return N.call(this,b.apply(this._wrapped,arguments))}}),z.extend(z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}]},{},[7])(7)}),function(a,b){"use strict";function c(){function b(b){var d=b||a.event,e=d.keyCode||d.which;if(-1!==[9,13,32,27].indexOf(e)){for(var g=d.target||d.srcElement,h=-1,i=0;i<w.length;i++)if(g===w[i]){h=i;break}9===e?(g=-1===h?s:h===w.length-1?w[0]:w[h+1],z(d),f(g)):13===e||32===e?-1===h&&y(s,d):27===e&&c.allowEscapeKey===!0&&y(v,d)}}if(void 0===arguments[0])return a.console.error("nAlert expects at least 1 attribute!"),!1;var c=e({},m);switch(typeof arguments[0]){case"string":c.text=arguments[0];break;case"object":c.title=arguments[0].title||m.title,c.text=arguments[0].text||m.text,c.html=arguments[0].html||m.html,c.allowEscapeKey=void 0!==arguments[0].allowEscapeKey?arguments[0].allowEscapeKey:m.allowEscapeKey,c.showConfirmButton=void 0!==arguments[0].showConfirmButton?arguments[0].showConfirmButton:m.showConfirmButton,c.showCancelButton=void 0!==arguments[0].showCancelButton?arguments[0].showCancelButton:m.showCancelButton,c.showAltButton=void 0!==arguments[0].showAltButton?arguments[0].showAltButton:m.showAltButton,c.showSecondAltButton=void 0!==arguments[0].showSecondAltButton?arguments[0].showSecondAltButton:m.showSecondAltButton,c.closeOnConfirm=void 0!==arguments[0].closeOnConfirm?arguments[0].closeOnConfirm:m.closeOnConfirm,c.closeOnCancel=void 0!==arguments[0].closeOnCancel?arguments[0].closeOnCancel:m.closeOnCancel,c.timer=parseInt(arguments[0].timer)||m.timer,c.width=parseInt(arguments[0].width)||m.width,c.confirmButtonText=arguments[0].confirmButtonText||m.confirmButtonText,c.cancelButtonText=arguments[0].cancelButtonText||m.cancelButtonText,c.altButtonText=arguments[0].altButtonText||m.altButtonText,c.secondAltButtonText=arguments[0].secondAltButtonText||m.secondAltButtonText,c.callback=arguments[1]||null,a.nAlert.callback=a.nAlert.callback=function(a){"function"==typeof c.callback&&c.callback(a)};break;default:return a.console.error('Unexpected type of argument! Expected "string" or "object", got '+typeof arguments[0]),!1}d(c),i(),g();var j=n();c.timer&&(j.timeout=setTimeout(function(){h(),"function"==typeof c.callback&&c.callback()},c.timer));var o,q=function(b){var d=b||a.event,e=d.target||d.srcElement,f=p(e,"confirm"),g=(p(e,"cancel"),p(e,"alt")),i=p(e,"secondAlt"),k=p(j,"visible");switch(d.type){case"click":if(f&&c.callback&&k)c.callback(!0),c.closeOnConfirm&&h();else if(g&&c.callback&&k)c.callback(!1,!0),c.closeOnConfirm&&h();else if(i&&c.callback&&k)c.callback(!1,!1,!0),c.closeOnConfirm&&h();else if(c.callback&&k){var l=String(c.callback).replace(/\s/g,""),m="function("===l.substring(0,9)&&")"!==l.substring(9,10);m&&c.callback(!1),c.closeOnCancel&&h()}else h()}},r=j.querySelectorAll("button");for(o=0;o<r.length;o++)r[o].onclick=q,r[o].onmouseover=q,r[o].onmouseout=q,r[o].onmousedown=q;var s=j.querySelector("button.confirm"),t=j.querySelector("button.alt"),u=j.querySelector("button.secondAlt"),v=j.querySelector("button.cancel"),w=j.querySelectorAll("button, input:not([type=hidden]), textarea");for(o=0;o<w.length;o++)w[o].addEventListener("focus",q,!0),w[o].addEventListener("blur",q,!0);k=a.onkeydown,a.onkeydown=b,a.nAlert.toggleLoading=function(){s.disabled=!s.disabled,t.disabled=!t.disabled,u.disabled=!u.disabled,v.disabled=!v.disabled},a.nAlert.enableButtons=function(){s.disabled=!1,t.disabled=!1,u.disabled=!1,v.disabled=!1},a.nAlert.disableButtons=function(){s.disabled=!0,t.disabled=!0,u.disabled=!0,v.disabled=!0},nAlert.enableButtons(),a.onfocus=function(){a.setTimeout(function(){void 0!==l&&(l.focus(),l=void 0)},0)}}function d(a){var c=n();c.style.width=a.width+"px",c.style.marginLeft=-a.width/2+"px";var d=b.getElementsByTagName("head")[0],e=b.createElement("style");e.type="text/css",e.id="nalert-mediaquery",e.innerHTML="@media screen and (max-width: "+a.width+"px) {.nalert {max-width: 100%;left: 0 !important;margin-left: 0 !important;}}",d.appendChild(e);var f=c.querySelector("h2"),g=c.querySelector("p"),h=c.querySelector("button.cancel"),i=c.querySelector("button.confirm"),j=c.querySelector("button.alt"),k=c.querySelector("button.secondAlt");f.innerHTML=s(a.title).split("\n").join("<br>"),g.innerHTML=s(a.text.split("\n").join("<br>"))||a.html,g.innerHTML&&u(g),c.setAttribute("data-has-cancel-button",a.showCancelButton),a.showCancelButton?q(h,"visible"):r(h,"visible"),a.showConfirmButton?q(i,"visible"):r(i,"visible"),a.showAltButton?q(j,"visible"):r(j,"visible"),a.showSecondAltButton?q(k,"visible"):r(k,"visible"),i.innerHTML=s(a.confirmButtonText),j.innerHTML=s(a.altButtonText),k.innerHTML=s(a.secondAltButtonText),h.innerHTML=s(a.cancelButtonText)}function e(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function f(a){a.focus()}function g(){var a=n();w(o(),10),u(a),q(a,"pop-in"),r(a,"pop-out"),j=b.activeElement,setTimeout(function(){q(a,"visible")},500)}function h(){var c=n();if(c){x(o(),5),x(c,5),r(c,"pop-in"),q(c,"pop-out"),r(c,"visible"),a.onkeydown=k,j&&j.focus(),l=void 0,clearTimeout(c.timeout);var d=b.getElementsByTagName("head")[0],e=b.getElementById("nalert-mediaquery");e&&d.removeChild(e)}}function i(){var a=n();a.style.marginTop=v(n())}var j,k,l,m={title:"",text:"",html:"",allowEscapeKey:!0,showConfirmButton:!0,showCancelButton:!1,showAltButton:!1,showSecondAltButton:!1,closeOnConfirm:!0,closeOnCancel:!0,confirmButtonText:"OK",altButtonText:"",secondAltButtonText:"",cancelButtonText:"Cancel",timer:null,width:500},n=function(){return b.querySelector(".nalert")},o=function(){return b.querySelector(".nalert-overlay")},p=function(a,b){return new RegExp(" "+b+" ").test(" "+a.className+" ")},q=function(a,b){p(a,b)||(a.className+=" "+b)},r=function(a,b){var c=" "+a.className.replace(/[\t\r\n]/g," ")+" ";if(p(a,b)){for(;c.indexOf(" "+b+" ")>=0;)c=c.replace(" "+b+" "," ");a.className=c.replace(/^\s+|\s+$/g,"")}},s=function(a){var c=b.createElement("div");return c.appendChild(b.createTextNode(a)),c.innerHTML},t=function(a){a.style.opacity="",a.style.display="block"},u=function(a){if(a&&!a.length)return t(a);for(var b=0;b<a.length;++b)t(a[b])},v=function(a){a.style.left="-9999px",a.style.display="block";var b,c=a.clientHeight;return b="undefined"!=typeof getComputedStyle?parseInt(getComputedStyle(a).getPropertyValue("padding"),10):parseInt(a.currentStyle.padding),a.style.left="",a.style.display="none","-"+parseInt(c/2+b)+"px"},w=function(a,b){if(+a.style.opacity<1){b=b||16,a.style.opacity=0,a.style.display="block";var c=+new Date,d=function(){a.style.opacity=+a.style.opacity+(new Date-c)/100,c=+new Date,+a.style.opacity<1&&setTimeout(d,b)};d()}a.style.display="block"},x=function(a,b){b=b||16,a.style.opacity=1;var c=+new Date,d=function(){a.style.opacity=+a.style.opacity-(new Date-c)/100,c=+new Date,+a.style.opacity>0?setTimeout(d,b):a.style.display="none"};d()},y=function(c){if("function"==typeof MouseEvent){var d=new MouseEvent("click",{view:a,bubbles:!1,cancelable:!0});c.dispatchEvent(d)}else if(b.createEvent){var e=b.createEvent("MouseEvents");e.initEvent("click",!1,!1),c.dispatchEvent(e)}else b.createEventObject?c.fireEvent("onclick"):"function"==typeof c.onclick&&c.onclick()},z=function(b){"function"==typeof b.stopPropagation?(b.stopPropagation(),b.preventDefault()):a.event&&a.event.hasOwnProperty("cancelBubble")&&(a.event.cancelBubble=!0)};a.nAlert=function(){var a=arguments;if(null!==n())c.apply(this,a);else var b=setInterval(function(){null!==n()&&(clearInterval(b),c.apply(this,a))},100)},a.nAlert.close=function(){h()},a.nAlert.init=function(){var a='<div class="nalert-overlay" tabIndex="-1"></div><div class="nalert" tabIndex="-1"><h2>Title</h2><p>Text</p><div class="nalert-buttons"><button class="confirm">OK</button><button class="alt-button alt"></button><button class="alt-button secondAlt"></button><button class="alt-button cancel">Cancel</button></div></div>',c=b.createElement("div");c.innerHTML=a,b.body.appendChild(c)},a.nAlert.setDefaults=function(a){if(!a)throw new Error("userParams is required");if("object"!=typeof a)throw new Error("userParams has to be a object");e(m,a)},function(){"complete"===b.readyState||"interactive"===b.readyState&&b.body?nAlert.init():b.addEventListener?b.addEventListener("DOMContentLoaded",function a(){b.removeEventListener("DOMContentLoaded",a,!1),nAlert.init()},!1):b.attachEvent&&b.attachEvent("onreadystatechange",function c(){"complete"===b.readyState&&(b.detachEvent("onreadystatechange",c),nAlert.init())})}()}(window,document),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.IPv6=b(a)}(this,function(a){var b=a&&a.IPv6;return{best:function(a){a=a.toLowerCase().split(":");var b=a.length,c=8;""===a[0]&&""===a[1]&&""===a[2]?(a.shift(),a.shift()):""===a[0]&&""===a[1]?a.shift():""===a[b-1]&&""===a[b-2]&&a.pop(),b=a.length,-1!==a[b-1].indexOf(".")&&(c=7);var d;for(d=0;b>d&&""!==a[d];d++);if(c>d)for(a.splice(d,1,"0000");a.length<c;)a.splice(d,0,"0000");for(d=0;c>d;d++){for(var b=a[d].split(""),e=0;3>e&&("0"===b[0]&&1<b.length);e++)b.splice(0,1);a[d]=b.join("")}var b=-1,f=e=0,g=-1,h=!1;for(d=0;c>d;d++)h?"0"===a[d]?f+=1:(h=!1,f>e&&(b=g,e=f)):"0"===a[d]&&(h=!0,g=d,f=1);for(f>e&&(b=g,e=f),e>1&&a.splice(b,e,""),b=a.length,c="",""===a[0]&&(c=":"),d=0;b>d&&(c+=a[d],d!==b-1);d++)c+=":";return""===a[b-1]&&(c+=":"),c},noConflict:function(){return a.IPv6===this&&(a.IPv6=b),this}}}),function(a){function b(a){throw RangeError(s[a])}function c(a,b){for(var c=a.length;c--;)a[c]=b(a[c]);return a}function d(a,b){return c(a.split(r),b).join(".")}function e(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function f(a){return c(a,function(a){var b="";return a>65535&&(a-=65536,b+=u(a>>>10&1023|55296),a=56320|1023&a),b+=u(a)}).join("")}function g(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function h(a,b,c){var d=0;for(a=c?t(a/700):a>>1,a+=t(a/b);a>455;d+=36)a=t(a/35);return t(d+36*a/(a+38))}function i(a){var c,d,e,g,i,j,k=[],l=a.length,m=0,n=128,o=72;for(d=a.lastIndexOf("-"),0>d&&(d=0),e=0;d>e;++e)128<=a.charCodeAt(e)&&b("not-basic"),k.push(a.charCodeAt(e));for(d=d>0?d+1:0;l>d;){for(e=m,c=1,g=36;d>=l&&b("invalid-input"),i=a.charCodeAt(d++),i=10>i-48?i-22:26>i-65?i-65:26>i-97?i-97:36,(i>=36||i>t((2147483647-m)/c))&&b("overflow"),m+=i*c,j=o>=g?1:g>=o+26?26:g-o,!(j>i);g+=36)i=36-j,c>t(2147483647/i)&&b("overflow"),c*=i;c=k.length+1,o=h(m-e,c,0==e),t(m/c)>2147483647-n&&b("overflow"),n+=t(m/c),m%=c,k.splice(m++,0,n)}return f(k)}function j(a){var c,d,f,i,j,k,l,m,n,o,p,q,r=[];for(a=e(a),o=a.length,c=128,d=0,j=72,k=0;o>k;++k)n=a[k],128>n&&r.push(u(n));for((f=i=r.length)&&r.push("-");o>f;){for(l=2147483647,k=0;o>k;++k)n=a[k],n>=c&&l>n&&(l=n);for(p=f+1,l-c>t((2147483647-d)/p)&&b("overflow"),d+=(l-c)*p,c=l,k=0;o>k;++k)if(n=a[k],c>n&&2147483647<++d&&b("overflow"),n==c){for(m=d,l=36;n=j>=l?1:l>=j+26?26:l-j,!(n>m);l+=36)q=m-n,m=36-n,r.push(u(g(n+q%m,0))),m=t(q/m);r.push(u(g(m,0))),j=h(d,p,f==i),d=0,++f}++d,++c}return r.join("")}var k="object"==typeof exports&&exports,l="object"==typeof module&&module&&module.exports==k&&module,m="object"==typeof global&&global;(m.global===m||m.window===m)&&(a=m);var n,o,p=/^xn--/,q=/[^ -~]/,r=/\x2E|\u3002|\uFF0E|\uFF61/g,s={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},t=Math.floor,u=String.fromCharCode;if(n={version:"1.2.3",ucs2:{decode:e,encode:f},decode:i,encode:j,toASCII:function(a){return d(a,function(a){return q.test(a)?"xn--"+j(a):a})},toUnicode:function(a){return d(a,function(a){return p.test(a)?i(a.slice(4).toLowerCase()):a})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return n});else if(k&&!k.nodeType)if(l)l.exports=n;else for(o in n)n.hasOwnProperty(o)&&(k[o]=n[o]);else a.punycode=n}(this),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.SecondLevelDomains=b(a)}(this,function(a){var b=a&&a.SecondLevelDomains,c={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ","do":" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ","in":" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch "},has:function(a){var b=a.lastIndexOf(".");if(0>=b||b>=a.length-1)return!1;var d=a.lastIndexOf(".",b-1);if(0>=d||d>=b-1)return!1;var e=c.list[a.slice(b+1)];return e?0<=e.indexOf(" "+a.slice(d+1,b)+" "):!1},is:function(a){var b=a.lastIndexOf(".");if(0>=b||b>=a.length-1||0<=a.lastIndexOf(".",b-1))return!1;var d=c.list[a.slice(b+1)];return d?0<=d.indexOf(" "+a.slice(0,b)+" "):!1},get:function(a){var b=a.lastIndexOf(".");if(0>=b||b>=a.length-1)return null;var d=a.lastIndexOf(".",b-1);if(0>=d||d>=b-1)return null;var e=c.list[a.slice(b+1)];return!e||0>e.indexOf(" "+a.slice(d+1,b)+" ")?null:a.slice(d+1)},noConflict:function(){return a.SecondLevelDomains===this&&(a.SecondLevelDomains=b),this}};return c}),function(a,b){"object"==typeof exports?module.exports=b(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],b):a.URI=b(a.punycode,a.IPv6,a.SecondLevelDomains,a)}(this,function(a,b,c,d){function e(a,b){return this instanceof e?(void 0===a&&(a="undefined"!=typeof location?location.href+"":""),this.href(a),void 0!==b?this.absoluteTo(b):this):new e(a,b)}function f(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function g(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function h(a){return"Array"===g(a)}function i(a,b){var c,d;if(h(b)){for(c=0,d=b.length;d>c;c++)if(!i(a,b[c]))return!1;return!0}var e=g(b);for(c=0,d=a.length;d>c;c++)if("RegExp"===e){if("string"==typeof a[c]&&a[c].match(b))return!0}else if(a[c]===b)return!0;return!1}function j(a,b){if(!h(a)||!h(b)||a.length!==b.length)return!1;a.sort(),b.sort();for(var c=0,d=a.length;d>c;c++)if(a[c]!==b[c])return!1;return!0}function k(a){return escape(a)}function l(a){return encodeURIComponent(a).replace(/[!'()*]/g,k).replace(/\*/g,"%2A")}function m(a){return function(b,c){return void 0===b?this._parts[a]||"":(this._parts[a]=b||null,this.build(!c),this)}}function n(a,b){return function(c,d){return void 0===c?this._parts[a]||"":(null!==c&&(c+="",c.charAt(0)===b&&(c=c.substring(1))),this._parts[a]=c,this.build(!d),this)}}var o=d&&d.URI;e.version="1.14.1";var p=e.prototype,q=Object.prototype.hasOwnProperty;e._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:e.duplicateQueryParameters,escapeQuerySpace:e.escapeQuerySpace}},e.duplicateQueryParameters=!1,e.escapeQuerySpace=!0,e.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,e.idn_expression=/[^a-z0-9\.-]/i,e.punycode_expression=/(xn--)/i,e.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,e.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,e.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/gi,e.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/},e.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},e.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,e.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",
source:"src",track:"src",input:"src",audio:"src",video:"src"},e.getDomAttribute=function(a){if(a&&a.nodeName){var b=a.nodeName.toLowerCase();return"input"===b&&"image"!==a.type?void 0:e.domAttributes[b]}},e.encode=l,e.decode=decodeURIComponent,e.iso8859=function(){e.encode=escape,e.decode=unescape},e.unicode=function(){e.encode=l,e.decode=decodeURIComponent},e.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}},e.encodeQuery=function(a,b){var c=e.encode(a+"");return void 0===b&&(b=e.escapeQuerySpace),b?c.replace(/%20/g,"+"):c},e.decodeQuery=function(a,b){a+="",void 0===b&&(b=e.escapeQuerySpace);try{return e.decode(b?a.replace(/\+/g,"%20"):a)}catch(c){return a}},e.recodePath=function(a){a=(a+"").split("/");for(var b=0,c=a.length;c>b;b++)a[b]=e.encodePathSegment(e.decode(a[b]));return a.join("/")},e.decodePath=function(a){a=(a+"").split("/");for(var b=0,c=a.length;c>b;b++)a[b]=e.decodePathSegment(a[b]);return a.join("/")};var r,s={encode:"encode",decode:"decode"},t=function(a,b){return function(c){try{return e[b](c+"").replace(e.characters[a][b].expression,function(c){return e.characters[a][b].map[c]})}catch(d){return c}}};for(r in s)e[r+"PathSegment"]=t("pathname",s[r]);e.encodeReserved=t("reserved","encode"),e.parse=function(a,b){var c;return b||(b={}),c=a.indexOf("#"),c>-1&&(b.fragment=a.substring(c+1)||null,a=a.substring(0,c)),c=a.indexOf("?"),c>-1&&(b.query=a.substring(c+1)||null,a=a.substring(0,c)),"//"===a.substring(0,2)?(b.protocol=null,a=a.substring(2),a=e.parseAuthority(a,b)):(c=a.indexOf(":"),c>-1&&(b.protocol=a.substring(0,c)||null,b.protocol&&!b.protocol.match(e.protocol_expression)?b.protocol=void 0:"//"===a.substring(c+1,c+3)?(a=a.substring(c+3),a=e.parseAuthority(a,b)):(a=a.substring(c+1),b.urn=!0))),b.path=a,b},e.parseHost=function(a,b){var c,d=a.indexOf("/");return-1===d&&(d=a.length),"["===a.charAt(0)?(c=a.indexOf("]"),b.hostname=a.substring(1,c)||null,b.port=a.substring(c+2,d)||null,"/"===b.port&&(b.port=null)):a.indexOf(":")!==a.lastIndexOf(":")?(b.hostname=a.substring(0,d)||null,b.port=null):(c=a.substring(0,d).split(":"),b.hostname=c[0]||null,b.port=c[1]||null),b.hostname&&"/"!==a.substring(d).charAt(0)&&(d++,a="/"+a),a.substring(d)||"/"},e.parseAuthority=function(a,b){return a=e.parseUserinfo(a,b),e.parseHost(a,b)},e.parseUserinfo=function(a,b){var c=a.indexOf("/"),d=a.lastIndexOf("@",c>-1?c:a.length-1);return d>-1&&(-1===c||c>d)?(c=a.substring(0,d).split(":"),b.username=c[0]?e.decode(c[0]):null,c.shift(),b.password=c[0]?e.decode(c.join(":")):null,a=a.substring(d+1)):(b.username=null,b.password=null),a},e.parseQuery=function(a,b){if(!a)return{};if(a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!a)return{};for(var c,d,f={},g=a.split("&"),h=g.length,i=0;h>i;i++)c=g[i].split("="),d=e.decodeQuery(c.shift(),b),c=c.length?e.decodeQuery(c.join("="),b):null,q.call(f,d)?("string"==typeof f[d]&&(f[d]=[f[d]]),f[d].push(c)):f[d]=c;return f},e.build=function(a){var b="";return a.protocol&&(b+=a.protocol+":"),a.urn||!b&&!a.hostname||(b+="//"),b+=e.buildAuthority(a)||"","string"==typeof a.path&&("/"!==a.path.charAt(0)&&"string"==typeof a.hostname&&(b+="/"),b+=a.path),"string"==typeof a.query&&a.query&&(b+="?"+a.query),"string"==typeof a.fragment&&a.fragment&&(b+="#"+a.fragment),b},e.buildHost=function(a){var b="";return a.hostname?(b=e.ip6_expression.test(a.hostname)?b+("["+a.hostname+"]"):b+a.hostname,a.port&&(b+=":"+a.port),b):""},e.buildAuthority=function(a){return e.buildUserinfo(a)+e.buildHost(a)},e.buildUserinfo=function(a){var b="";return a.username&&(b+=e.encode(a.username),a.password&&(b+=":"+e.encode(a.password)),b+="@"),b},e.buildQuery=function(a,b,c){var d,f,g,i,j="";for(f in a)if(q.call(a,f)&&f)if(h(a[f]))for(d={},g=0,i=a[f].length;i>g;g++)void 0!==a[f][g]&&void 0===d[a[f][g]+""]&&(j+="&"+e.buildQueryParameter(f,a[f][g],c),!0!==b&&(d[a[f][g]+""]=!0));else void 0!==a[f]&&(j+="&"+e.buildQueryParameter(f,a[f],c));return j.substring(1)},e.buildQueryParameter=function(a,b,c){return e.encodeQuery(a,c)+(null!==b?"="+e.encodeQuery(b,c):"")},e.addQuery=function(a,b,c){if("object"==typeof b)for(var d in b)q.call(b,d)&&e.addQuery(a,d,b[d]);else{if("string"!=typeof b)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");void 0===a[b]?a[b]=c:("string"==typeof a[b]&&(a[b]=[a[b]]),h(c)||(c=[c]),a[b]=(a[b]||[]).concat(c))}},e.removeQuery=function(a,b,c){var d;if(h(b))for(c=0,d=b.length;d>c;c++)a[b[c]]=void 0;else if("object"==typeof b)for(d in b)q.call(b,d)&&e.removeQuery(a,d,b[d]);else{if("string"!=typeof b)throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");if(void 0!==c){if(a[b]===c)a[b]=void 0;else if(h(a[b])){d=a[b];var f,g,i={};if(h(c))for(f=0,g=c.length;g>f;f++)i[c[f]]=!0;else i[c]=!0;for(f=0,g=d.length;g>f;f++)void 0!==i[d[f]]&&(d.splice(f,1),g--,f--);a[b]=d}}else a[b]=void 0}},e.hasQuery=function(a,b,c,d){if("object"==typeof b){for(var f in b)if(q.call(b,f)&&!e.hasQuery(a,f,b[f]))return!1;return!0}if("string"!=typeof b)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(g(c)){case"Undefined":return b in a;case"Boolean":return a=Boolean(h(a[b])?a[b].length:a[b]),c===a;case"Function":return!!c(a[b],b,a);case"Array":return h(a[b])?(d?i:j)(a[b],c):!1;case"RegExp":return h(a[b])?d?i(a[b],c):!1:Boolean(a[b]&&a[b].match(c));case"Number":c=String(c);case"String":return h(a[b])?d?i(a[b],c):!1:a[b]===c;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},e.commonPath=function(a,b){var c,d=Math.min(a.length,b.length);for(c=0;d>c;c++)if(a.charAt(c)!==b.charAt(c)){c--;break}return 1>c?a.charAt(0)===b.charAt(0)&&"/"===a.charAt(0)?"/":"":(("/"!==a.charAt(c)||"/"!==b.charAt(c))&&(c=a.substring(0,c).lastIndexOf("/")),a.substring(0,c+1))},e.withinString=function(a,b,c){c||(c={});var d=c.start||e.findUri.start,f=c.end||e.findUri.end,g=c.trim||e.findUri.trim,h=/[a-z0-9-]=["']?$/i;for(d.lastIndex=0;;){var i=d.exec(a);if(!i)break;if(i=i.index,c.ignoreHtml){var j=a.slice(Math.max(i-3,0),i);if(j&&h.test(j))continue}var j=i+a.slice(i).search(f),k=a.slice(i,j).replace(g,"");c.ignore&&c.ignore.test(k)||(j=i+k.length,k=b(k,i,j,a),a=a.slice(0,i)+k+a.slice(j),d.lastIndex=i+k.length)}return d.lastIndex=0,a},e.ensureValidHostname=function(b){if(b.match(e.invalid_hostname_characters)){if(!a)throw new TypeError('Hostname "'+b+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(a.toASCII(b).match(e.invalid_hostname_characters))throw new TypeError('Hostname "'+b+'" contains characters other than [A-Z0-9.-]')}},e.noConflict=function(a){return a?(a={URI:this.noConflict()},d.URITemplate&&"function"==typeof d.URITemplate.noConflict&&(a.URITemplate=d.URITemplate.noConflict()),d.IPv6&&"function"==typeof d.IPv6.noConflict&&(a.IPv6=d.IPv6.noConflict()),d.SecondLevelDomains&&"function"==typeof d.SecondLevelDomains.noConflict&&(a.SecondLevelDomains=d.SecondLevelDomains.noConflict()),a):(d.URI===this&&(d.URI=o),this)},p.build=function(a){return!0===a?this._deferred_build=!0:(void 0===a||this._deferred_build)&&(this._string=e.build(this._parts),this._deferred_build=!1),this},p.clone=function(){return new e(this)},p.valueOf=p.toString=function(){return this.build(!1)._string},p.protocol=m("protocol"),p.username=m("username"),p.password=m("password"),p.hostname=m("hostname"),p.port=m("port"),p.query=n("query","?"),p.fragment=n("fragment","#"),p.search=function(a,b){var c=this.query(a,b);return"string"==typeof c&&c.length?"?"+c:c},p.hash=function(a,b){var c=this.fragment(a,b);return"string"==typeof c&&c.length?"#"+c:c},p.pathname=function(a,b){if(void 0===a||!0===a){var c=this._parts.path||(this._parts.hostname?"/":"");return a?e.decodePath(c):c}return this._parts.path=a?e.recodePath(a):"/",this.build(!b),this},p.path=p.pathname,p.href=function(a,b){var c;if(void 0===a)return this.toString();this._string="",this._parts=e._parts();var d=a instanceof e,f="object"==typeof a&&(a.hostname||a.path||a.pathname);if(a.nodeName&&(f=e.getDomAttribute(a),a=a[f]||"",f=!1),!d&&f&&void 0!==a.pathname&&(a=a.toString()),"string"==typeof a||a instanceof String)this._parts=e.parse(String(a),this._parts);else{if(!d&&!f)throw new TypeError("invalid input");for(c in d=d?a._parts:a)q.call(this._parts,c)&&(this._parts[c]=d[c])}return this.build(!b),this},p.is=function(a){var b=!1,d=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=!this._parts.urn;switch(this._parts.hostname&&(k=!1,d=e.ip4_expression.test(this._parts.hostname),f=e.ip6_expression.test(this._parts.hostname),b=d||f,h=(g=!b)&&c&&c.has(this._parts.hostname),i=g&&e.idn_expression.test(this._parts.hostname),j=g&&e.punycode_expression.test(this._parts.hostname)),a.toLowerCase()){case"relative":return k;case"absolute":return!k;case"domain":case"name":return g;case"sld":return h;case"ip":return b;case"ip4":case"ipv4":case"inet4":return d;case"ip6":case"ipv6":case"inet6":return f;case"idn":return i;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return j}return null};var u=p.protocol,v=p.port,w=p.hostname;p.protocol=function(a,b){if(void 0!==a&&a&&(a=a.replace(/:(\/\/)?$/,""),!a.match(e.protocol_expression)))throw new TypeError('Protocol "'+a+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return u.call(this,a,b)},p.scheme=p.protocol,p.port=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a&&(0===a&&(a=null),a&&(a+="",":"===a.charAt(0)&&(a=a.substring(1)),a.match(/[^0-9]/))))throw new TypeError('Port "'+a+'" contains characters other than [0-9]');return v.call(this,a,b)},p.hostname=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a){var c={};e.parseHost(a,c),a=c.hostname}return w.call(this,a,b)},p.host=function(a,b){return this._parts.urn?void 0===a?"":this:void 0===a?this._parts.hostname?e.buildHost(this._parts):"":(e.parseHost(a,this._parts),this.build(!b),this)},p.authority=function(a,b){return this._parts.urn?void 0===a?"":this:void 0===a?this._parts.hostname?e.buildAuthority(this._parts):"":(e.parseAuthority(a,this._parts),this.build(!b),this)},p.userinfo=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.username)return"";var c=e.buildUserinfo(this._parts);return c.substring(0,c.length-1)}return"@"!==a[a.length-1]&&(a+="@"),e.parseUserinfo(a,this._parts),this.build(!b),this},p.resource=function(a,b){var c;return void 0===a?this.path()+this.search()+this.hash():(c=e.parse(a),this._parts.path=c.path,this._parts.query=c.query,this._parts.fragment=c.fragment,this.build(!b),this)},p.subdomain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,c)||""}return c=this._parts.hostname.length-this.domain().length,c=this._parts.hostname.substring(0,c),c=new RegExp("^"+f(c)),a&&"."!==a.charAt(a.length-1)&&(a+="."),a&&e.ensureValidHostname(a),this._parts.hostname=this._parts.hostname.replace(c,a),this.build(!b),this},p.domain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.match(/\./g);return c&&2>c.length?this._parts.hostname:(c=this._parts.hostname.length-this.tld(b).length-1,c=this._parts.hostname.lastIndexOf(".",c-1)+1,this._parts.hostname.substring(c)||"")}if(!a)throw new TypeError("cannot set domain empty");return e.ensureValidHostname(a),!this._parts.hostname||this.is("IP")?this._parts.hostname=a:(c=new RegExp(f(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(c,a)),this.build(!b),this},p.tld=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var d=this._parts.hostname.lastIndexOf("."),d=this._parts.hostname.substring(d+1);return!0!==b&&c&&c.list[d.toLowerCase()]?c.get(this._parts.hostname)||d:d}if(!a)throw new TypeError("cannot set TLD empty");if(a.match(/[^a-zA-Z0-9-]/)){if(!c||!c.is(a))throw new TypeError('TLD "'+a+'" contains characters other than [A-Z0-9]');d=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(d,a)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");d=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(d,a)}return this.build(!b),this},p.directory=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var c=this._parts.path.length-this.filename().length-1,c=this._parts.path.substring(0,c)||(this._parts.hostname?"/":"");return a?e.decodePath(c):c}return c=this._parts.path.length-this.filename().length,c=this._parts.path.substring(0,c),c=new RegExp("^"+f(c)),this.is("relative")||(a||(a="/"),"/"!==a.charAt(0)&&(a="/"+a)),a&&"/"!==a.charAt(a.length-1)&&(a+="/"),a=e.recodePath(a),this._parts.path=this._parts.path.replace(c,a),this.build(!b),this},p.filename=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path)return"";var c=this._parts.path.lastIndexOf("/"),c=this._parts.path.substring(c+1);return a?e.decodePathSegment(c):c}c=!1,"/"===a.charAt(0)&&(a=a.substring(1)),a.match(/\.?\//)&&(c=!0);var d=new RegExp(f(this.filename())+"$");return a=e.recodePath(a),this._parts.path=this._parts.path.replace(d,a),c?this.normalizePath(b):this.build(!b),this},p.suffix=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path)return"";var c=this.filename(),d=c.lastIndexOf(".");return-1===d?"":(c=c.substring(d+1),c=/^[a-z0-9%]+$/i.test(c)?c:"",a?e.decodePathSegment(c):c)}if("."===a.charAt(0)&&(a=a.substring(1)),c=this.suffix())d=a?new RegExp(f(c)+"$"):new RegExp(f("."+c)+"$");else{if(!a)return this;this._parts.path+="."+e.recodePath(a)}return d&&(a=e.recodePath(a),this._parts.path=this._parts.path.replace(d,a)),this.build(!b),this},p.segment=function(a,b,c){var d=this._parts.urn?":":"/",e=this.path(),f="/"===e.substring(0,1),e=e.split(d);if(void 0!==a&&"number"!=typeof a&&(c=b,b=a,a=void 0),void 0!==a&&"number"!=typeof a)throw Error('Bad segment "'+a+'", must be 0-based integer');if(f&&e.shift(),0>a&&(a=Math.max(e.length+a,0)),void 0===b)return void 0===a?e:e[a];if(null===a||void 0===e[a])if(h(b)){e=[],a=0;for(var g=b.length;g>a;a++)(b[a].length||e.length&&e[e.length-1].length)&&(e.length&&!e[e.length-1].length&&e.pop(),e.push(b[a]))}else(b||"string"==typeof b)&&(""===e[e.length-1]?e[e.length-1]=b:e.push(b));else b?e[a]=b:e.splice(a,1);return f&&e.unshift(""),this.path(e.join(d),c)},p.segmentCoded=function(a,b,c){var d,f;if("number"!=typeof a&&(c=b,b=a,a=void 0),void 0===b){if(a=this.segment(a,b,c),h(a))for(d=0,f=a.length;f>d;d++)a[d]=e.decode(a[d]);else a=void 0!==a?e.decode(a):void 0;return a}if(h(b))for(d=0,f=b.length;f>d;d++)b[d]=e.decode(b[d]);else b="string"==typeof b||b instanceof String?e.encode(b):b;return this.segment(a,b,c)};var x=p.query;return p.query=function(a,b){if(!0===a)return e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof a){var c=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace),d=a.call(this,c);return this._parts.query=e.buildQuery(d||c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this}return void 0!==a&&"string"!=typeof a?(this._parts.query=e.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):x.call(this,a,b)},p.setQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof a||a instanceof String)d[a]=void 0!==b?b:null;else{if("object"!=typeof a)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var f in a)q.call(a,f)&&(d[f]=a[f])}return this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},p.addQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.addQuery(d,a,void 0===b?null:b),this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},p.removeQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.removeQuery(d,a,b),this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},p.hasQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.hasQuery(d,a,b,c)},p.setSearch=p.setQuery,p.addSearch=p.addQuery,p.removeSearch=p.removeQuery,p.hasSearch=p.hasQuery,p.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},p.normalizeProtocol=function(a){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a)),this},p.normalizeHostname=function(c){return this._parts.hostname&&(this.is("IDN")&&a?this._parts.hostname=a.toASCII(this._parts.hostname):this.is("IPv6")&&b&&(this._parts.hostname=b.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!c)),this},p.normalizePort=function(a){return"string"==typeof this._parts.protocol&&this._parts.port===e.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a)),this},p.normalizePath=function(a){if(this._parts.urn||!this._parts.path||"/"===this._parts.path)return this;var b,c,d,f=this._parts.path,g="";for("/"!==f.charAt(0)&&(b=!0,f="/"+f),f=f.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),b&&(g=f.substring(1).match(/^(\.\.\/)+/)||"")&&(g=g[0]);c=f.indexOf("/.."),-1!==c;)0!==c?(d=f.substring(0,c).lastIndexOf("/"),-1===d&&(d=c),f=f.substring(0,d)+f.substring(c+3)):f=f.substring(3);return b&&this.is("relative")&&(f=g+f.substring(1)),f=e.recodePath(f),this._parts.path=f,this.build(!a),this},p.normalizePathname=p.normalizePath,p.normalizeQuery=function(a){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(e.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a)),this},p.normalizeFragment=function(a){return this._parts.fragment||(this._parts.fragment=null,this.build(!a)),this},p.normalizeSearch=p.normalizeQuery,p.normalizeHash=p.normalizeFragment,p.iso8859=function(){var a=e.encode,b=e.decode;return e.encode=escape,e.decode=decodeURIComponent,this.normalize(),e.encode=a,e.decode=b,this},p.unicode=function(){var a=e.encode,b=e.decode;return e.encode=l,e.decode=unescape,this.normalize(),e.encode=a,e.decode=b,this},p.readable=function(){var b=this.clone();b.username("").password("").normalize();var c="";if(b._parts.protocol&&(c+=b._parts.protocol+"://"),b._parts.hostname&&(b.is("punycode")&&a?(c+=a.toUnicode(b._parts.hostname),b._parts.port&&(c+=":"+b._parts.port)):c+=b.host()),b._parts.hostname&&b._parts.path&&"/"!==b._parts.path.charAt(0)&&(c+="/"),c+=b.path(!0),b._parts.query){for(var d="",f=0,g=b._parts.query.split("&"),h=g.length;h>f;f++){var i=(g[f]||"").split("="),d=d+("&"+e.decodeQuery(i[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"));void 0!==i[1]&&(d+="="+e.decodeQuery(i[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}c+="?"+d.substring(1)}return c+=e.decodeQuery(b.hash(),!0)},p.absoluteTo=function(a){var b,c,d=this.clone(),f=["protocol","username","password","hostname","port"];if(this._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");if(a instanceof e||(a=new e(a)),d._parts.protocol||(d._parts.protocol=a._parts.protocol),this._parts.hostname)return d;for(b=0;c=f[b];b++)d._parts[c]=a._parts[c];return d._parts.path?".."===d._parts.path.substring(-2)&&(d._parts.path+="/"):(d._parts.path=a._parts.path,d._parts.query||(d._parts.query=a._parts.query)),"/"!==d.path().charAt(0)&&(a=a.directory(),d._parts.path=(a?a+"/":"")+d._parts.path,d.normalizePath()),d.build(),d},p.relativeTo=function(a){var b,c,d,f,g=this.clone().normalize();if(g._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");if(a=new e(a).normalize(),b=g._parts,c=a._parts,d=g.path(),f=a.path(),"/"!==d.charAt(0))throw Error("URI is already relative");if("/"!==f.charAt(0))throw Error("Cannot calculate a URI relative to another relative URI");return b.protocol===c.protocol&&(b.protocol=null),b.username!==c.username||b.password!==c.password||null!==b.protocol||null!==b.username||null!==b.password||b.hostname!==c.hostname||b.port!==c.port?g.build():(b.hostname=null,b.port=null,d===f?(b.path="",g.build()):(a=e.commonPath(g.path(),a.path()))?(c=c.path.substring(a.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../"),b.path=c+b.path.substring(a.length),g.build()):g.build())},p.equals=function(a){var b=this.clone();a=new e(a);var c,d={},f={},g={};if(b.normalize(),a.normalize(),b.toString()===a.toString())return!0;if(d=b.query(),f=a.query(),b.query(""),a.query(""),b.toString()!==a.toString()||d.length!==f.length)return!1;d=e.parseQuery(d,this._parts.escapeQuerySpace),f=e.parseQuery(f,this._parts.escapeQuerySpace);for(c in d)if(q.call(d,c)){if(h(d[c])){if(!j(d[c],f[c]))return!1}else if(d[c]!==f[c])return!1;g[c]=!0}for(c in f)if(q.call(f,c)&&!g[c])return!1;return!0},p.duplicateQueryParameters=function(a){return this._parts.duplicateQueryParameters=!!a,this},p.escapeQuerySpace=function(a){return this._parts.escapeQuerySpace=!!a,this},e}),function(a,b){"object"==typeof exports?module.exports=b(require("./URI")):"function"==typeof define&&define.amd?define(["./URI"],b):a.URITemplate=b(a.URI,a)}(this,function(a,b){function c(a){return c._cache[a]?c._cache[a]:this instanceof c?(this.expression=a,c._cache[a]=this,this):new c(a)}function d(a){this.data=a,this.cache={}}var e=b&&b.URITemplate,f=Object.prototype.hasOwnProperty,g=c.prototype,h={"":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encode"},"+":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},"#":{prefix:"#",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},".":{prefix:".",separator:".",named:!1,empty_name_separator:!1,encode:"encode"},"/":{prefix:"/",separator:"/",named:!1,empty_name_separator:!1,encode:"encode"},";":{prefix:";",separator:";",named:!0,empty_name_separator:!1,encode:"encode"},"?":{prefix:"?",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"},"&":{prefix:"&",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"}};return c._cache={},c.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g,c.VARIABLE_PATTERN=/^([^*:]+)((\*)|:(\d+))?$/,c.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_]/,c.expand=function(a,b){var d,e,f,g=h[a.operator],i=g.named?"Named":"Unnamed",j=a.variables,k=[];for(f=0;e=j[f];f++)d=b.get(e.name),d.val.length?k.push(c["expand"+i](d,g,e.explode,e.explode&&g.separator||",",e.maxlength,e.name)):d.type&&k.push("");return k.length?g.prefix+k.join(g.separator):""},c.expandNamed=function(b,c,d,e,f,g){var h="",i=c.encode;c=c.empty_name_separator;var j,k,l,m=!b[i].length,n=2===b.type?"":a[i](g);for(k=0,l=b.val.length;l>k;k++)f?(j=a[i](b.val[k][1].substring(0,f)),2===b.type&&(n=a[i](b.val[k][0].substring(0,f)))):m?(j=a[i](b.val[k][1]),2===b.type?(n=a[i](b.val[k][0]),b[i].push([n,j])):b[i].push([void 0,j])):(j=b[i][k][1],2===b.type&&(n=b[i][k][0])),h&&(h+=e),d?h+=n+(c||j?"=":"")+j:(k||(h+=a[i](g)+(c||j?"=":"")),2===b.type&&(h+=n+","),h+=j);return h},c.expandUnnamed=function(b,c,d,e,f){var g="",h=c.encode;c=c.empty_name_separator;var i,j,k,l,m=!b[h].length;for(k=0,l=b.val.length;l>k;k++)f?j=a[h](b.val[k][1].substring(0,f)):m?(j=a[h](b.val[k][1]),b[h].push([2===b.type?a[h](b.val[k][0]):void 0,j])):j=b[h][k][1],g&&(g+=e),2===b.type&&(i=f?a[h](b.val[k][0].substring(0,f)):b[h][k][0],g+=i,g=d?g+(c||j?"=":""):g+","),g+=j;return g},c.noConflict=function(){return b.URITemplate===c&&(b.URITemplate=e),c},g.expand=function(a){var b="";this.parts&&this.parts.length||this.parse(),a instanceof d||(a=new d(a));for(var e=0,f=this.parts.length;f>e;e++)b+="string"==typeof this.parts[e]?this.parts[e]:c.expand(this.parts[e],a);return b},g.parse=function(){var a,b,d,e=this.expression,f=c.EXPRESSION_PATTERN,g=c.VARIABLE_PATTERN,i=c.VARIABLE_NAME_PATTERN,j=[],k=0;for(f.lastIndex=0;;){if(b=f.exec(e),null===b){j.push(e.substring(k));break}if(j.push(e.substring(k,b.index)),k=b.index+b[0].length,!h[b[1]])throw Error('Unknown Operator "'+b[1]+'" in "'+b[0]+'"');if(!b[3])throw Error('Unclosed Expression "'+b[0]+'"');a=b[2].split(",");for(var l=0,m=a.length;m>l;l++){if(d=a[l].match(g),null===d)throw Error('Invalid Variable "'+a[l]+'" in "'+b[0]+'"');if(d[1].match(i))throw Error('Invalid Variable Name "'+d[1]+'" in "'+b[0]+'"');a[l]={name:d[1],explode:!!d[3],maxlength:d[4]&&parseInt(d[4],10)}}if(!a.length)throw Error('Expression Missing Variable(s) "'+b[0]+'"');j.push({expression:b[0],operator:b[1],variables:a})}return j.length||j.push(e),this.parts=j,this},d.prototype.get=function(a){var b,c=this.data,d={type:0,val:[],encode:[],encodeReserved:[]};if(void 0!==this.cache[a])return this.cache[a];if(this.cache[a]=d,c="[object Function]"===String(Object.prototype.toString.call(c))?c(a):"[object Function]"===String(Object.prototype.toString.call(c[a]))?c[a](a):c[a],void 0!==c&&null!==c)if("[object Array]"===String(Object.prototype.toString.call(c))){for(b=0,a=c.length;a>b;b++)void 0!==c[b]&&null!==c[b]&&d.val.push([void 0,String(c[b])]);d.val.length&&(d.type=3)}else if("[object Object]"===String(Object.prototype.toString.call(c))){for(b in c)f.call(c,b)&&void 0!==c[b]&&null!==c[b]&&d.val.push([b,String(c[b])]);d.val.length&&(d.type=2)}else d.type=1,d.val.push([void 0,String(c)]);return d},a.expand=function(b,d){var e=new c(b).expand(d);return new a(e)},c}),function(){"use strict";var a,b=b||{},c=this,d=function(a){return void 0!==a},e=function(){},f=function(a){var b=typeof a;if("object"==b){if(!a)return"null";if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else if("function"==b&&"undefined"==typeof a.call)return"object";return b},g=function(a){return"array"==f(a)},h=function(a){var b=f(a);return"array"==b||"object"==b&&"number"==typeof a.length},i=function(a){return"string"==typeof a},k=function(a){return"number"==typeof a},l=function(a){return"function"==f(a)},m=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b},n=function(a,b,c){return a.call.apply(a.bind,arguments)},o=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}},p=function(a,b,c){return p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?n:o,p.apply(null,arguments)},q=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();return b.push.apply(b,arguments),a.apply(this,b)}},r=Date.now||function(){return+new Date},s=function(a,b){var e=a.split("."),f=c;e[0]in f||!f.execScript||f.execScript("var "+e[0]);for(var g;e.length&&(g=e.shift());)!e.length&&d(b)?f[g]=b:f=f[g]?f[g]:f[g]={}},t=function(a,b){function c(){}c.prototype=b.prototype,a.P=b.prototype,a.prototype=new c,a.ie=function(a,c,d){for(var e=Array(arguments.length-2),f=2;f<arguments.length;f++)e[f-2]=arguments[f];return b.prototype[c].apply(a,e)}};Function.prototype.bind=Function.prototype.bind||function(a,b){if(1<arguments.length){var c=Array.prototype.slice.call(arguments,1);return c.unshift(this,a),p.apply(null,c)}return p(this,a)};var u=function(a){if(Error.captureStackTrace)Error.captureStackTrace(this,u);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))};t(u,Error),u.prototype.name="CustomError";var v=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},w=function(a,b){return b>a?-1:a>b?1:0},x=Array.prototype,y=x.indexOf?function(a,b,c){return x.indexOf.call(a,b,c)}:function(a,b,c){if(c=null==c?0:0>c?Math.max(0,a.length+c):c,i(a))return i(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},z=x.forEach?function(a,b,c){x.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=i(a)?a.split(""):a,f=0;d>f;f++)f in e&&b.call(c,e[f],f,a)},A=x.some?function(a,b,c){return x.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=i(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1},B=x.every?function(a,b,c){return x.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=i(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0},C=function(a){var b;a:{b=Ad;for(var c=a.length,d=i(a)?a.split(""):a,e=0;c>e;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:i(a)?a.charAt(b):a[b]},D=function(a,b){var c,d=y(a,b);return(c=d>=0)&&x.splice.call(a,d,1),c},E=function(a){return x.concat.apply(x,arguments)},F=function(a,b,c){return 2>=arguments.length?x.slice.call(a,b):x.slice.call(a,b,c)},G="StopIteration"in c?c.StopIteration:Error("StopIteration"),H=function(){};H.prototype.next=function(){throw G},H.prototype.Sb=function(){return this};var I=function(a,b,c){for(var d in a)b.call(c,a[d],d,a)},J=function(a){var b,c=[],d=0;for(b in a)c[d++]=a[b];return c},K=function(a){var b,c=[],d=0;for(b in a)c[d++]=b;return c},L=function(a,b){var c;a:{for(c in a)if(b.call(void 0,a[c],c,a))break a;c=void 0}return c&&a[c]},M="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),N=function(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<M.length;f++)c=M[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}},O=function(a){var b=arguments.length;if(1==b&&g(arguments[0]))return O.apply(null,arguments[0]);for(var c={},d=0;b>d;d++)c[arguments[d]]=!0;return c},P=function(a,b){this.p={},this.b=[],this.Ja=this.j=0;var c=arguments.length;if(c>1){if(c%2)throw Error("Uneven number of arguments");for(var d=0;c>d;d+=2)this.set(arguments[d],arguments[d+1])}else a&&this.ha(a)};P.prototype.t=function(){Q(this);for(var a=[],b=0;b<this.b.length;b++)a.push(this.p[this.b[b]]);return a},P.prototype.H=function(){return Q(this),this.b.concat()},P.prototype.T=function(a){return T(this.p,a)},P.prototype.remove=function(a){return T(this.p,a)?(delete this.p[a],this.j--,this.Ja++,this.b.length>2*this.j&&Q(this),!0):!1};var Q=function(a){if(a.j!=a.b.length){for(var b=0,c=0;b<a.b.length;){var d=a.b[b];T(a.p,d)&&(a.b[c++]=d),b++}a.b.length=c}if(a.j!=a.b.length){
for(var e={},c=b=0;b<a.b.length;)d=a.b[b],T(e,d)||(a.b[c++]=d,e[d]=1),b++;a.b.length=c}};a=P.prototype,a.get=function(a,b){return T(this.p,a)?this.p[a]:b},a.set=function(a,b){T(this.p,a)||(this.j++,this.b.push(a),this.Ja++),this.p[a]=b},a.ha=function(a){var b;a instanceof P?(b=a.H(),a=a.t()):(b=K(a),a=J(a));for(var c=0;c<b.length;c++)this.set(b[c],a[c])},a.forEach=function(a,b){for(var c=this.H(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}},a.clone=function(){return new P(this)},a.Nb=function(){Q(this);for(var a={},b=0;b<this.b.length;b++){var c=this.b[b];a[c]=this.p[c]}return a},a.Sb=function(a){Q(this);var b=0,c=this.b,d=this.p,e=this.Ja,f=this,g=new H;return g.next=function(){for(;;){if(e!=f.Ja)throw Error("The map has changed since the iterator was created");if(b>=c.length)throw G;var g=c[b++];return a?g:d[g]}},g};var R,S,T=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},U={id:"hitType",name:"t",valueType:"text",maxLength:void 0,defaultValue:void 0},V={id:"sessionControl",name:"sc",valueType:"text",maxLength:void 0,defaultValue:void 0},W={id:"description",name:"cd",valueType:"text",maxLength:2048,defaultValue:void 0},X={id:"eventCategory",name:"ec",valueType:"text",maxLength:150,defaultValue:void 0},Y={id:"eventAction",name:"ea",valueType:"text",maxLength:500,defaultValue:void 0},Z={id:"eventLabel",name:"el",valueType:"text",maxLength:500,defaultValue:void 0},$={id:"eventValue",name:"ev",valueType:"integer",maxLength:void 0,defaultValue:void 0},_={zd:U,$c:{id:"anonymizeIp",name:"aip",valueType:"boolean",maxLength:void 0,defaultValue:void 0},Kd:{id:"queueTime",name:"qt",valueType:"integer",maxLength:void 0,defaultValue:void 0},fd:{id:"cacheBuster",name:"z",valueType:"text",maxLength:void 0,defaultValue:void 0},Qd:V,Rd:{id:"sessionGroup",name:"sg",valueType:"text",maxLength:void 0,defaultValue:void 0},ge:{id:"userId",name:"uid",valueType:"text",maxLength:void 0,defaultValue:void 0},Hd:{id:"nonInteraction",name:"ni",valueType:"boolean",maxLength:void 0,defaultValue:void 0},qd:W,$d:{id:"title",name:"dt",valueType:"text",maxLength:1500,defaultValue:void 0},bd:{id:"appId",name:"aid",valueType:"text",maxLength:150,defaultValue:void 0},cd:{id:"appInstallerId",name:"aiid",valueType:"text",maxLength:150,defaultValue:void 0},td:X,sd:Y,ud:Z,vd:$,Td:{id:"socialNetwork",name:"sn",valueType:"text",maxLength:50,defaultValue:void 0},Sd:{id:"socialAction",name:"sa",valueType:"text",maxLength:50,defaultValue:void 0},Ud:{id:"socialTarget",name:"st",valueType:"text",maxLength:2048,defaultValue:void 0},ce:{id:"transactionId",name:"ti",valueType:"text",maxLength:500,defaultValue:void 0},be:{id:"transactionAffiliation",name:"ta",valueType:"text",maxLength:500,defaultValue:void 0},de:{id:"transactionRevenue",name:"tr",valueType:"currency",maxLength:void 0,defaultValue:void 0},ee:{id:"transactionShipping",name:"ts",valueType:"currency",maxLength:void 0,defaultValue:void 0},fe:{id:"transactionTax",name:"tt",valueType:"currency",maxLength:void 0,defaultValue:void 0},od:{id:"currencyCode",name:"cu",valueType:"text",maxLength:10,defaultValue:void 0},Dd:{id:"itemPrice",name:"ip",valueType:"currency",maxLength:void 0,defaultValue:void 0},Ed:{id:"itemQuantity",name:"iq",valueType:"integer",maxLength:void 0,defaultValue:void 0},Bd:{id:"itemCode",name:"ic",valueType:"text",maxLength:500,defaultValue:void 0},Cd:{id:"itemName",name:"in",valueType:"text",maxLength:500,defaultValue:void 0},Ad:{id:"itemCategory",name:"iv",valueType:"text",maxLength:500,defaultValue:void 0},md:{id:"campaignSource",name:"cs",valueType:"text",maxLength:100,defaultValue:void 0},kd:{id:"campaignMedium",name:"cm",valueType:"text",maxLength:50,defaultValue:void 0},ld:{id:"campaignName",name:"cn",valueType:"text",maxLength:100,defaultValue:void 0},jd:{id:"campaignKeyword",name:"ck",valueType:"text",maxLength:500,defaultValue:void 0},gd:{id:"campaignContent",name:"cc",valueType:"text",maxLength:500,defaultValue:void 0},hd:{id:"campaignId",name:"ci",valueType:"text",maxLength:100,defaultValue:void 0},yd:{id:"gclid",name:"gclid",valueType:"text",maxLength:void 0,defaultValue:void 0},pd:{id:"dclid",name:"dclid",valueType:"text",maxLength:void 0,defaultValue:void 0},Jd:{id:"pageLoadTime",name:"plt",valueType:"integer",maxLength:void 0,defaultValue:void 0},rd:{id:"dnsTime",name:"dns",valueType:"integer",maxLength:void 0,defaultValue:void 0},Vd:{id:"tcpConnectTime",name:"tcp",valueType:"integer",maxLength:void 0,defaultValue:void 0},Pd:{id:"serverResponseTime",name:"srt",valueType:"integer",maxLength:void 0,defaultValue:void 0},Id:{id:"pageDownloadTime",name:"pdt",valueType:"integer",maxLength:void 0,defaultValue:void 0},Ld:{id:"redirectResponseTime",name:"rrt",valueType:"integer",maxLength:void 0,defaultValue:void 0},Wd:{id:"timingCategory",name:"utc",valueType:"text",maxLength:150,defaultValue:void 0},Zd:{id:"timingVar",name:"utv",valueType:"text",maxLength:500,defaultValue:void 0},Yd:{id:"timingValue",name:"utt",valueType:"integer",maxLength:void 0,defaultValue:void 0},Xd:{id:"timingLabel",name:"utl",valueType:"text",maxLength:500,defaultValue:void 0},wd:{id:"exDescription",name:"exd",valueType:"text",maxLength:150,defaultValue:void 0},xd:{id:"exFatal",name:"exf",valueType:"boolean",maxLength:void 0,defaultValue:"1"}},aa=function(a){if(1>a||a>200)throw Error("Expected dimension index range 1-200, but was : "+a);return{id:"dimension"+a,name:"cd"+a,valueType:"text",maxLength:150,defaultValue:void 0}},ba=function(a){if(1>a||a>200)throw Error("Expected metric index range 1-200, but was : "+a);return{id:"metric"+a,name:"cm"+a,valueType:"integer",maxLength:void 0,defaultValue:void 0}},ca=function(a){return 1>a?"0":3>a?"1-2":(a=Math.floor(Math.log(a-1)/Math.log(2)),Math.pow(2,a)+1+"-"+Math.pow(2,a+1))},da=function(a,b){for(var c=0,d=a.length-1,e=0;d>=c;){var f=Math.floor((c+d)/2),e=a[f];if(e>=b){if(d=0==f?0:a[f-1],b>d)return(d+1).toString()+"-"+e.toString();d=f-1}else if(b>e){if(f>=a.length-1)return(a[a.length-1]+1).toString()+"+";c=f+1}}return"<= 0"},ea=function(){this.gb=[]},fa=function(){return new ea};a=ea.prototype,a.when=function(a){return this.gb.push(a),this},a.Rb=function(a){var b=arguments;return this.when(function(a){return 0<=y(b,a.ub())}),this},a.Yc=function(a,b){var c=F(arguments,1);return this.when(function(b){return b=b.V().get(a),0<=y(c,b)}),this},a.mb=function(a,b){if(m(this.e))throw Error("Filter has already been set.");return this.e=m(b)?p(a,b):a,this},a.ia=function(){if(0==this.gb.length)throw Error("Must specify at least one predicate using #when or a helper method.");if(!m(this.e))throw Error("Must specify a delegate filter using #applyFilter.");return p(function(a){B(this.gb,function(b){return b(a)})&&this.e(a)},this)};var ga=function(){this.lb=!1,this.zb="",this.Kb=!1,this.ya=null};ga.prototype.Wb=function(a){return this.lb=!0,this.zb=a||" - ",this},ga.prototype.Sc=function(){return this.Kb=!0,this},ga.prototype.Dc=function(){return ha(this,ca)},ga.prototype.Ec=function(a){return ha(this,q(da,a))};var ha=function(a,b){if(null!=a.ya)throw Error("LabelerBuilder: Only one labeling strategy may be used.");return a.ya=p(function(a){var c=a.V().get($),d=a.V().get(Z);k(c)&&(c=b(c),null!=d&&this.lb&&(c=d+this.zb+c),a.V().set(Z,c))},a),a};ga.prototype.ia=function(){if(null==this.ya)throw Error("LabelerBuilder: a labeling strategy must be specified prior to calling build().");return fa().Rb("event").mb(p(function(a){this.ya(a),this.Kb&&a.V().remove($)},this)).ia()};var ia=function(a,b){var c=Array.prototype.slice.call(arguments),d=c.shift();if("undefined"==typeof d)throw Error("[goog.string.format] Template required");return d.replace(/%([0\-\ \+]*)(\d+)?(\.(\d+))?([%sfdiu])/g,function(a,b,d,e,f,g,h,i){if("%"==g)return"%";var j=c.shift();if("undefined"==typeof j)throw Error("[goog.string.format] Not enough arguments");return arguments[0]=j,ja[g].apply(null,arguments)})},ja={s:function(a,b,c){return isNaN(c)||""==c||a.length>=c?a:a=-1<b.indexOf("-",0)?a+Array(c-a.length+1).join(" "):Array(c-a.length+1).join(" ")+a},f:function(a,b,c,d,e){d=a.toString(),isNaN(e)||""==e||(d=parseFloat(a).toFixed(e));var f;return f=0>a?"-":0<=b.indexOf("+")?"+":0<=b.indexOf(" ")?" ":"",a>=0&&(d=f+d),isNaN(c)||d.length>=c?d:(d=isNaN(e)?Math.abs(a).toString():Math.abs(a).toFixed(e),a=c-d.length-f.length,d=0<=b.indexOf("-",0)?f+d+Array(a+1).join(" "):f+Array(a+1).join(0<=b.indexOf("0",0)?"0":" ")+d)},d:function(a,b,c,d,e,f,g,h){return ja.f(parseInt(a,10),b,c,d,0,f,g,h)}};ja.i=ja.d,ja.u=ja.d;var ka=function(a){if("function"==typeof a.t)return a.t();if(i(a))return a.split("");if(h(a)){for(var b=[],c=a.length,d=0;c>d;d++)b.push(a[d]);return b}return J(a)},la=function(a,b){if("function"==typeof a.forEach)a.forEach(b,void 0);else if(h(a)||i(a))z(a,b,void 0);else{var c;if("function"==typeof a.H)c=a.H();else if("function"!=typeof a.t)if(h(a)||i(a)){c=[];for(var d=a.length,e=0;d>e;e++)c.push(e)}else c=K(a);else c=void 0;for(var d=ka(a),e=d.length,f=0;e>f;f++)b.call(void 0,d[f],c&&c[f],a)}},ma=function(a){if(this.w=new P,0<arguments.length%2)throw Error("Uneven number of arguments to ParameterMap constructor.");for(var b=arguments,c=0;c<b.length;c+=2)this.set(b[c],b[c+1])};ma.prototype.set=function(a,b){if(null==b)throw Error("undefined-or-null value for key: "+a.name);this.w.set(a.name,{key:a,value:b})},ma.prototype.remove=function(a){this.w.remove(a.name)},ma.prototype.get=function(a){return a=this.w.get(a.name,null),null===a?null:a.value},ma.prototype.ha=function(a){this.w.ha(a.w)};var na=function(a,b){z(a.w.t(),function(a){b(a.key,a.value)})};ma.prototype.Nb=function(){var a={};return na(this,function(b,c){a[b.id]=c}),a},ma.prototype.clone=function(){var a=new ma;return a.w=this.w.clone(),a},ma.prototype.toString=function(){var a={};return na(this,function(b,c){a[b.id]=c}),JSON.stringify(a)};var oa=function(a){this.e=a};a=oa.prototype,a.Yb=function(a){var b=new oa(p(this.M,this));return b.I=X,b.Q=a,b},a.action=function(a){var b=new oa(p(this.M,this));return b.I=Y,b.Q=a,b},a.label=function(a){var b=new oa(p(this.M,this));return b.I=Z,b.Q=a,b},a.value=function(a){var b=new oa(p(this.M,this));return b.I=$,b.Q=a,b},a.fc=function(a){var b=new oa(p(this.M,this));return b.I=aa(a.index),b.Q=a.value,b},a.vc=function(a){var b=new oa(p(this.M,this));return b.I=ba(a.index),b.Q=a.value,b},a.send=function(a){var b=new ma;return this.M(b),a.send("event",b)},a.M=function(a){null!=this.I&&null!=this.Q&&!a.w.T(this.I.name)&&a.set(this.I,this.Q),m(this.e)&&this.e(a)};var pa=new oa(e),qa=function(){this.aa=this.aa,this.Ca=this.Ca};qa.prototype.aa=!1,qa.prototype.ma=function(){this.aa||(this.aa=!0,this.o())},qa.prototype.o=function(){if(this.Ca)for(;this.Ca.length;)this.Ca.shift()()};var ra=function(a,b){this.type=a,this.currentTarget=this.target=b,this.defaultPrevented=this.X=!1,this.Hb=!0};ra.prototype.preventDefault=function(){this.defaultPrevented=!0,this.Hb=!1};var sa=function(a){return sa[" "](a),a};sa[" "]=e;var ta;a:{var ua=c.navigator;if(ua){var va=ua.userAgent;if(va){ta=va;break a}}ta=""}var wa=function(){return-1!=ta.indexOf("Edge")||-1!=ta.indexOf("Trident")||-1!=ta.indexOf("MSIE")},xa=function(){return-1!=ta.indexOf("Edge")},ya=-1!=ta.indexOf("Opera")||-1!=ta.indexOf("OPR"),za=wa(),Aa=!(-1==ta.indexOf("Gecko")||-1!=ta.toLowerCase().indexOf("webkit")&&!xa()||-1!=ta.indexOf("Trident")||-1!=ta.indexOf("MSIE")||xa()),Ba=-1!=ta.toLowerCase().indexOf("webkit")&&!xa(),Ca=function(){var a=ta;return Aa?/rv\:([^\);]+)(\)|;)/.exec(a):za&&xa()?/Edge\/([\d\.]+)/.exec(a):za?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):Ba?/WebKit\/(\S+)/.exec(a):void 0},Da=function(){var a=c.document;return a?a.documentMode:void 0},Ea=function(){if(ya&&c.opera){var a=c.opera.version;return l(a)?a():a}var a="",b=Ca();return b&&(a=b?b[1]:""),za&&!xa()&&(b=Da(),b>parseFloat(a))?String(b):a}(),Fa={},Ga=function(a){var b;if(!(b=Fa[a])){b=0;for(var c=v(String(Ea)).split("."),d=v(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&e>f;f++){var g=c[f]||"",h=d[f]||"",i=/(\d*)(\D*)/g,j=/(\d*)(\D*)/g;do{var k=i.exec(g)||["","",""],l=j.exec(h)||["","",""];if(0==k[0].length&&0==l[0].length)break;b=w(0==k[1].length?0:parseInt(k[1],10),0==l[1].length?0:parseInt(l[1],10))||w(0==k[2].length,0==l[2].length)||w(k[2],l[2])}while(0==b)}b=Fa[a]=b>=0}return b},Ha=c.document,Ia=Da(),Ja=!Ha||!za||!Ia&&xa()?void 0:Ia||("CSS1Compat"==Ha.compatMode?parseInt(Ea,10):5),Ka=!za||za&&(xa()||Ja>=9),La=za&&!Ga("9"),Ma=!Ba||Ga("528"),Na=Aa&&Ga("1.9b")||za&&Ga("8")||ya&&Ga("9.5")||Ba&&Ga("528"),Oa=Aa&&!Ga("8")||za&&!Ga("9"),Pa=function(a,b){if(ra.call(this,a?a.type:""),this.relatedTarget=this.currentTarget=this.target=null,this.charCode=this.keyCode=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.sb=this.state=null,a){var c=this.type=a.type;this.target=a.target||a.srcElement,this.currentTarget=b;var d=a.relatedTarget;if(d){if(Aa){var e;a:{try{sa(d.nodeName),e=!0;break a}catch(f){}e=!1}e||(d=null)}}else"mouseover"==c?d=a.fromElement:"mouseout"==c&&(d=a.toElement);this.relatedTarget=d,this.offsetX=Ba||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=Ba||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0,this.button=a.button,this.keyCode=a.keyCode||0,this.charCode=a.charCode||("keypress"==c?a.keyCode:0),this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.state=a.state,this.sb=a,a.defaultPrevented&&this.preventDefault()}};t(Pa,ra),Pa.prototype.preventDefault=function(){Pa.P.preventDefault.call(this);var a=this.sb;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,La)try{(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)&&(a.keyCode=-1)}catch(b){}};var Qa="closure_listenable_"+(1e6*Math.random()|0),Ra=function(a){return!(!a||!a[Qa])},Sa=0,Ta=function(a,b,c,d,e){this.O=a,this.proxy=null,this.src=b,this.type=c,this.ka=!!d,this.sa=e,this.key=++Sa,this.removed=this.ja=!1},Ua=function(a){a.removed=!0,a.O=null,a.proxy=null,a.src=null,a.sa=null},Va=function(a){this.src=a,this.k={},this.fa=0};Va.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.k[f],a||(a=this.k[f]=[],this.fa++);var g=Xa(a,b,d,e);return g>-1?(b=a[g],c||(b.ja=!1)):(b=new Ta(b,this.src,f,!!d,e),b.ja=c,a.push(b)),b},Va.prototype.remove=function(a,b,c,d){if(a=a.toString(),!(a in this.k))return!1;var e=this.k[a];return b=Xa(e,b,c,d),b>-1?(Ua(e[b]),x.splice.call(e,b,1),0==e.length&&(delete this.k[a],this.fa--),!0):!1};var Wa=function(a,b){var c=b.type;if(!(c in a.k))return!1;var d=D(a.k[c],b);return d&&(Ua(b),0==a.k[c].length&&(delete a.k[c],a.fa--)),d};Va.prototype.removeAll=function(a){a=a&&a.toString();var b,c=0;for(b in this.k)if(!a||b==a){for(var d=this.k[b],e=0;e<d.length;e++)++c,Ua(d[e]);delete this.k[b],this.fa--}return c},Va.prototype.ba=function(a,b,c,d){a=this.k[a.toString()];var e=-1;return a&&(e=Xa(a,b,c,d)),e>-1?a[e]:null};var Xa=function(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.removed&&f.O==b&&f.ka==!!c&&f.sa==d)return e}return-1},Ya="closure_lm_"+(1e6*Math.random()|0),Za={},$a=0,_a=function(a,b,c,d,e){if(g(b)){for(var f=0;f<b.length;f++)_a(a,b[f],c,d,e);return null}return c=lb(c),Ra(a)?a.listen(b,c,d,e):ab(a,b,c,!1,d,e)},ab=function(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e,h=jb(a);return h||(a[Ya]=h=new Va(a)),c=h.add(b,c,d,e,f),c.proxy?c:(d=bb(),c.proxy=d,d.src=a,d.O=c,a.addEventListener?a.addEventListener(b.toString(),d,g):a.attachEvent(fb(b.toString()),d),$a++,c)},bb=function(){var a=ib,b=Ka?function(c){return a.call(b.src,b.O,c)}:function(c){return c=a.call(b.src,b.O,c),c?void 0:c};return b},cb=function(a,b,c,d,e){if(g(b)){for(var f=0;f<b.length;f++)cb(a,b[f],c,d,e);return null}return c=lb(c),Ra(a)?a.cb(b,c,d,e):ab(a,b,c,!0,d,e)},db=function(a,b,c,d,e){if(g(b))for(var f=0;f<b.length;f++)db(a,b[f],c,d,e);else c=lb(c),Ra(a)?a.jb(b,c,d,e):a&&(a=jb(a))&&(b=a.ba(b,c,!!d,e))&&eb(b)},eb=function(a){if(k(a)||!a||a.removed)return!1;var b=a.src;if(Ra(b))return Wa(b.B,a);var c=a.type,d=a.proxy;return b.removeEventListener?b.removeEventListener(c,d,a.ka):b.detachEvent&&b.detachEvent(fb(c),d),$a--,(c=jb(b))?(Wa(c,a),0==c.fa&&(c.src=null,b[Ya]=null)):Ua(a),!0},fb=function(a){return a in Za?Za[a]:Za[a]="on"+a},gb=function(a,b,c,d){var e=!0;if((a=jb(a))&&(b=a.k[b.toString()]))for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.ka==c&&!f.removed&&(f=hb(f,d),e=e&&!1!==f)}return e},hb=function(a,b){var c=a.O,d=a.sa||a.src;return a.ja&&eb(a),c.call(d,b)},ib=function(a,b){if(a.removed)return!0;if(!Ka){var d;if(!(d=b))a:{d=["window","event"];for(var e,f=c;e=d.shift();){if(null==f[e]){d=null;break a}f=f[e]}d=f}if(e=d,d=new Pa(e,this),f=!0,!(0>e.keyCode||void 0!=e.returnValue)){a:{var g=!1;if(0==e.keyCode)try{e.keyCode=-1;break a}catch(h){g=!0}(g||void 0==e.returnValue)&&(e.returnValue=!0)}for(e=[],g=d.currentTarget;g;g=g.parentNode)e.push(g);for(var g=a.type,i=e.length-1;!d.X&&i>=0;i--){d.currentTarget=e[i];var j=gb(e[i],g,!0,d),f=f&&j}for(i=0;!d.X&&i<e.length;i++)d.currentTarget=e[i],j=gb(e[i],g,!1,d),f=f&&j}return f}return hb(a,new Pa(b,this))},jb=function(a){return a=a[Ya],a instanceof Va?a:null},kb="__closure_events_fn_"+(1e9*Math.random()>>>0),lb=function(a){return l(a)?a:(a[kb]||(a[kb]=function(b){return a.handleEvent(b)}),a[kb])},mb=function(){qa.call(this),this.B=new Va(this),this.Tb=this,this.fb=null};t(mb,qa),mb.prototype[Qa]=!0,a=mb.prototype,a.addEventListener=function(a,b,c,d){_a(this,a,b,c,d)},a.removeEventListener=function(a,b,c,d){db(this,a,b,c,d)},a.dispatchEvent=function(a){var b,c=this.fb;if(c){b=[];for(var d=1;c;c=c.fb)b.push(c),++d}if(c=this.Tb,d=a.type||a,i(a))a=new ra(a,c);else if(a instanceof ra)a.target=a.target||c;else{var e=a;a=new ra(d,c),N(a,e)}var f,e=!0;if(b)for(var g=b.length-1;!a.X&&g>=0;g--)f=a.currentTarget=b[g],e=nb(f,d,!0,a)&&e;if(a.X||(f=a.currentTarget=c,e=nb(f,d,!0,a)&&e,a.X||(e=nb(f,d,!1,a)&&e)),b)for(g=0;!a.X&&g<b.length;g++)f=a.currentTarget=b[g],e=nb(f,d,!1,a)&&e;return e},a.o=function(){mb.P.o.call(this),this.B&&this.B.removeAll(void 0),this.fb=null},a.listen=function(a,b,c,d){return this.B.add(String(a),b,!1,c,d)},a.cb=function(a,b,c,d){return this.B.add(String(a),b,!0,c,d)},a.jb=function(a,b,c,d){return this.B.remove(String(a),b,c,d)};var nb=function(a,b,c,d){if(b=a.B.k[String(b)],!b)return!0;b=b.concat();for(var e=!0,f=0;f<b.length;++f){var g=b[f];if(g&&!g.removed&&g.ka==c){var h=g.O,i=g.sa||g.src;g.ja&&Wa(a.B,g),e=!1!==h.call(i,d)&&e}}return e&&0!=d.Hb};mb.prototype.ba=function(a,b,c,d){return this.B.ba(String(a),b,c,d)};var ob=function(a,b,c){this.tc=c,this.dc=a,this.Gc=b,this.Ba=0,this.ta=null};ob.prototype.get=function(){var a;return 0<this.Ba?(this.Ba--,a=this.ta,this.ta=a.next,a.next=null):a=this.dc(),a},ob.prototype.put=function(a){this.Gc(a),this.Ba<this.tc&&(this.Ba++,a.next=this.ta,this.ta=a)};var pb,qb=function(a){c.setTimeout(function(){throw a},0)},rb=function(){var a=c.MessageChannel;if("undefined"==typeof a&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&-1==ta.indexOf("Presto")&&(a=function(){var a=document.createElement("IFRAME");a.style.display="none",a.src="",document.documentElement.appendChild(a);var b=a.contentWindow,a=b.document;a.open(),a.write(""),a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host,a=p(function(a){"*"!=d&&a.origin!=d||a.data!=c||this.port1.onmessage()},this);b.addEventListener("message",a,!1),this.port1={},this.port2={postMessage:function(){b.postMessage(c,d)}}}),"undefined"!=typeof a&&!wa()){var b=new a,e={},f=e;return b.port1.onmessage=function(){if(d(e.next)){e=e.next;var a=e.ob;e.ob=null,a()}},function(a){f.next={ob:a},f=f.next,b.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(a){var b=document.createElement("SCRIPT");b.onreadystatechange=function(){b.onreadystatechange=null,b.parentNode.removeChild(b),b=null,a(),a=null},document.documentElement.appendChild(b)}:function(a){c.setTimeout(a,0)}},sb=function(){this.Ka=this.Z=null},tb=new ob(function(){return new ub},function(a){a.reset()},100);sb.prototype.add=function(a,b){var c=tb.get();c.set(a,b),this.Ka?this.Ka.next=c:this.Z=c,this.Ka=c},sb.prototype.remove=function(){var a=null;return this.Z&&(a=this.Z,this.Z=this.Z.next,this.Z||(this.Ka=null),a.next=null),a};var ub=function(){this.next=this.scope=this.Wa=null};ub.prototype.set=function(a,b){this.Wa=a,this.scope=b,this.next=null},ub.prototype.reset=function(){this.next=this.scope=this.Wa=null};var vb,wb=function(a,b){vb||xb(),yb||(vb(),yb=!0),zb.add(a,b)},xb=function(){if(c.Promise&&c.Promise.resolve){var a=c.Promise.resolve();vb=function(){a.then(Ab)}}else vb=function(){var a=Ab;!l(c.setImmediate)||c.Window&&c.Window.prototype&&c.Window.prototype.setImmediate==c.setImmediate?(pb||(pb=rb()),pb(a)):c.setImmediate(a)}},yb=!1,zb=new sb,Ab=function(){for(var a=null;a=zb.remove();){try{a.Wa.call(a.scope)}catch(b){qb(b)}tb.put(a)}yb=!1},Bb=function(a){a.prototype.then=a.prototype.then,a.prototype.$goog_Thenable=!0},Cb=function(a){if(!a)return!1;try{return!!a.$goog_Thenable}catch(b){return!1}},Db=function(a,b){if(this.m=0,this.D=void 0,this.S=this.G=this.l=null,this.ra=this.Va=!1,a==Hb)Lb(this,2,b);else try{var c=this;a.call(b,function(a){Lb(c,2,a)},function(a){Lb(c,3,a)})}catch(d){Lb(this,3,d)}},Eb=function(){this.next=this.context=this.da=this.Da=this.L=null,this.Na=!1};Eb.prototype.reset=function(){this.context=this.da=this.Da=this.L=null,this.Na=!1};var Fb=new ob(function(){return new Eb},function(a){a.reset()},100),Gb=function(a,b,c){var d=Fb.get();return d.Da=a,d.da=b,d.context=c,d},Hb=function(){};Db.prototype.then=function(a,b,c){return Kb(this,l(a)?a:null,l(b)?b:null,c)},Bb(Db),Db.prototype.cancel=function(a){0==this.m&&wb(function(){var b=new Sb(a);Ib(this,b)},this)};var Ib=function(a,b){if(0==a.m)if(a.l){var c=a.l;if(c.G){for(var d=0,e=null,f=null,g=c.G;g&&(g.Na||(d++,g.L==a&&(e=g),!(e&&d>1)));g=g.next)e||(f=g);e&&(0==c.m&&1==d?Ib(c,b):(f?(d=f,d.next==c.S&&(c.S=d),d.next=d.next.next):Ob(c),Pb(c,e,3,b)))}a.l=null}else Lb(a,3,b)},Jb=function(a,b){a.G||2!=a.m&&3!=a.m||Nb(a),a.S?a.S.next=b:a.G=b,a.S=b},Kb=function(a,b,c,e){var f=Gb(null,null,null);return f.L=new Db(function(a,g){f.Da=b?function(c){try{var d=b.call(e,c);a(d)}catch(f){g(f)}}:a,f.da=c?function(b){try{var f=c.call(e,b);!d(f)&&b instanceof Sb?g(b):a(f)}catch(h){g(h)}}:g}),f.L.l=a,Jb(a,f),f.L};Db.prototype.Pb=function(a){this.m=0,Lb(this,2,a)},Db.prototype.Qb=function(a){this.m=0,Lb(this,3,a)};var Lb=function(a,b,c){if(0==a.m){if(a==c)b=3,c=new TypeError("Promise cannot resolve to itself");else{if(Cb(c)){a.m=1,b=c,c=a.Pb;var d=a.Qb;return void(b instanceof Db?Jb(b,Gb(c||e,d||null,a)):b.then(c,d,a))}if(m(c))try{if(d=c.then,l(d))return void Mb(a,c,d)}catch(f){b=3,c=f}}a.D=c,a.m=b,a.l=null,Nb(a),3!=b||c instanceof Sb||Qb(a,c)}},Mb=function(a,b,c){a.m=1;var d=!1,e=function(b){d||(d=!0,a.Pb(b))},f=function(b){d||(d=!0,a.Qb(b))};try{c.call(b,e,f)}catch(g){f(g)}},Nb=function(a){a.Va||(a.Va=!0,wb(a.gc,a))},Ob=function(a){var b=null;return a.G&&(b=a.G,a.G=b.next,b.next=null),a.G||(a.S=null),b};Db.prototype.gc=function(){for(var a=null;a=Ob(this);)Pb(this,a,this.m,this.D);this.Va=!1};var Pb=function(a,b,c,d){if(b.L&&(b.L.l=null),2==c)b.Da.call(b.context,d);else if(null!=b.da){if(!b.Na)for(;a&&a.ra;a=a.l)a.ra=!1;b.da.call(b.context,d)}Fb.put(b)},Qb=function(a,b){a.ra=!0,wb(function(){a.ra&&Rb.call(null,b)})},Rb=qb,Sb=function(a){u.call(this,a)};t(Sb,u),Sb.prototype.name="cancel";var Tb=function(a,b){this.Fa=[],this.Cb=a,this.rb=b||null,this.ca=this.C=!1,this.D=void 0,this.hb=this.Xb=this.Oa=!1,this.Ia=0,this.l=null,this.Qa=0};Tb.prototype.cancel=function(a){if(this.C)this.D instanceof Tb&&this.D.cancel();else{if(this.l){var b=this.l;delete this.l,a?b.cancel(a):(b.Qa--,0>=b.Qa&&b.cancel())}this.Cb?this.Cb.call(this.rb,this):this.hb=!0,this.C||this.A(new bc)}},Tb.prototype.qb=function(a,b){this.Oa=!1,Ub(this,a,b)};var Ub=function(a,b,c){a.C=!0,a.D=c,a.ca=!b,Zb(a)},Vb=function(a){if(a.C){if(!a.hb)throw new ac;a.hb=!1}};Tb.prototype.v=function(a){Vb(this),Ub(this,!0,a)},Tb.prototype.A=function(a){Vb(this),Ub(this,!1,a)},Tb.prototype.n=function(a,b){return Wb(this,a,null,b)};var Wb=function(a,b,c,d){return a.Fa.push([b,c,d]),a.C&&Zb(a),a};Tb.prototype.then=function(a,b,c){var d,e,f=new Db(function(a,b){d=a,e=b});return Wb(this,d,function(a){a instanceof bc?f.cancel():e(a)}),f.then(a,b,c)},Bb(Tb);var Xb=function(a){var b=new Tb;return Wb(a,b.v,b.A,b),b},Yb=function(a){return A(a.Fa,function(a){return l(a[1])})},Zb=function(a){if(a.Ia&&a.C&&Yb(a)){var b=a.Ia,e=dc[b];e&&(c.clearTimeout(e.ua),delete dc[b]),a.Ia=0}a.l&&(a.l.Qa--,delete a.l);for(var b=a.D,f=e=!1;a.Fa.length&&!a.Oa;){var g=a.Fa.shift(),h=g[0],i=g[1],g=g[2];if(h=a.ca?i:h)try{var j=h.call(g||a.rb,b);d(j)&&(a.ca=a.ca&&(j==b||j instanceof Error),a.D=b=j),Cb(b)&&(f=!0,a.Oa=!0)}catch(k){b=k,a.ca=!0,Yb(a)||(e=!0)}}a.D=b,f&&(j=p(a.qb,a,!0),f=p(a.qb,a,!1),b instanceof Tb?(Wb(b,j,f),b.Xb=!0):b.then(j,f)),e&&(b=new cc(b),dc[b.ua]=b,a.Ia=b.ua)},$b=function(a){var b=new Tb;return b.v(a),b},_b=function(){var a=dd,b=new Tb;return b.A(a),b},ac=function(){u.call(this)};t(ac,u),ac.prototype.message="Deferred has already fired",ac.prototype.name="AlreadyCalledError";var bc=function(){u.call(this)};t(bc,u),bc.prototype.message="Deferred was canceled",bc.prototype.name="CanceledError";var cc=function(a){this.ua=c.setTimeout(p(this.Tc,this),0),this.na=a};cc.prototype.Tc=function(){throw delete dc[this.ua],this.na};var dc={},ec=function(a){this.qa=[],this.e=a};ec.prototype.R=function(a){if(!l(a))throw Error("Invalid filter. Must be a function.");this.qa.push(a)},ec.prototype.send=function(a,b){if(0==this.qa.length)return this.e.send(a,b);var c=new gc(a,b);return fc(this,0,c).n(function(){return c.Sa?void 0:this.e.send(a,b)},this)};var fc=function(a,b,c){return $b().n(function(){return this.qa[b](c)},a).n(function(){return++b<this.qa.length&&!c.Sa?fc(this,b,c):void 0},a)},gc=function(a,b){this.Wc=a,this.Cc=b,this.Sa=!1};gc.prototype.ub=function(){return this.Wc},gc.prototype.V=function(){return this.Cc},gc.prototype.cancel=function(){this.Sa=!0},O("area base br col command embed hr img input keygen link meta param source track wbr".split(" "));var hc=function(a,b){this.width=a,this.height=b};hc.prototype.clone=function(){return new hc(this.width,this.height)},hc.prototype.floor=function(){return this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},!Aa&&!za||za&&za&&(xa()||Ja>=9)||Aa&&Ga("1.9.1"),za&&Ga("9");var ic={id:"apiVersion",name:"v",valueType:"text",maxLength:void 0,defaultValue:void 0},jc={id:"appName",name:"an",valueType:"text",maxLength:100,defaultValue:void 0},kc={id:"appVersion",name:"av",valueType:"text",maxLength:100,defaultValue:void 0},lc={id:"clientId",name:"cid",valueType:"text",maxLength:void 0,defaultValue:void 0},mc={id:"language",name:"ul",valueType:"text",maxLength:20,defaultValue:void 0},nc={id:"libVersion",name:"_v",valueType:"text",maxLength:void 0,defaultValue:void 0},oc={id:"sampleRateOverride",name:"usro",valueType:"integer",maxLength:void 0,defaultValue:void 0},pc={id:"screenColors",name:"sd",valueType:"text",maxLength:20,defaultValue:void 0},qc={id:"screenResolution",name:"sr",valueType:"text",maxLength:20,defaultValue:void 0},rc={id:"trackingId",name:"tid",valueType:"text",maxLength:void 0,defaultValue:void 0},sc={id:"viewportSize",name:"vp",valueType:"text",maxLength:20,defaultValue:void 0},tc={ad:ic,dd:jc,ed:kc,nd:lc,Fd:mc,Gd:nc,Md:oc,Nd:pc,Od:qc,ae:rc,he:sc},uc=function(a){if(!i(a))return a;var b=vc(a,_);if(m(b))return b;if(b=vc(a,tc),m(b))return b;if(b=/^dimension(\d+)$/.exec(a),null!==b)return aa(parseInt(b[1],10));if(b=/^metric(\d+)$/.exec(a),null!==b)return ba(parseInt(b[1],10));throw Error(a+" is not a valid parameter name.")},vc=function(a,b){var c=L(b,function(b){return b.id==a&&"metric"!=a&&"dimension"!=a});return m(c)?c:null},wc=function(a,b){this.ac=b,this.q=b.Xa(),this.Fb=new ma,this.ib=!1};a=wc.prototype,a.set=function(a,b){if(null==b)throw Error("Value must be defined and not null. Parameter="+a.id);var c=uc(a);this.Fb.set(c,b)},a.R=function(a){this.ac.R(a)},a.send=function(a,b){if(a instanceof oa)return a.send(this);var c=this.Fb.clone();return b instanceof ma?c.ha(b):m(b)&&I(b,function(a,b){null!=a&&c.set(uc(b),a)},this),this.ib&&(this.ib=!1,c.set(V,"start")),this.q.send(a,c)},a.Hc=function(a){var b={description:a};return this.set(W,a),this.send("appview",b)},a.Ic=function(a,b,c,d){return this.send("event",{eventCategory:a,eventAction:b,eventLabel:c,eventValue:d})},a.Kc=function(a,b,c){return this.send("social",{socialNetwork:a,socialAction:b,socialTarget:c})},a.Jc=function(a,b){return this.send("exception",{exDescription:a,exFatal:b})},a.Ib=function(a,b,c,d,e){return this.send("timing",{timingCategory:a,timingVar:b,timingLabel:d,timingValue:c,sampleRateOverride:e})},a.jc=function(){this.ib=!0},a.Rc=function(a,b,c,d){return new xc(this,a,b,c,d)};var xc=function(a,b,c,d,e){this.Ob=a,this.Zb=b,this.Xc=c,this.rc=d,this.Ea=e,this.Qc=r()};xc.prototype.send=function(){var a=this.Ob.Ib(this.Zb,this.Xc,r()-this.Qc,this.rc,this.Ea);return this.Ob=null,a};var yc=function(a,b,c,d,e){this.sc=a,this.Ub=b,this.Vb=c,this.g=d,this.$b=e};yc.prototype.mc=function(a){var b=new wc(0,this.$b.create());return b.set(nc,this.sc),b.set(ic,1),b.set(jc,this.Ub),b.set(kc,this.Vb),b.set(rc,a),(a=navigator.language||navigator.browserLanguage)&&b.set(mc,a),(a=screen.colorDepth+"-bit")&&b.set(pc,a),(a=[screen.width,screen.height].join("x"))&&b.set(qc,a),a=window.document,a="CSS1Compat"==a.compatMode?a.documentElement:a.body,a=new hc(a.clientWidth,a.clientHeight),(a=[a.width,a.height].join("x"))&&b.set(sc,a),b},yc.prototype.kc=function(){return Xb(this.g.ea)};var zc=function(a,b,c,d,e,f){for(Tb.call(this,e,f),this.bb=a,this.Ta=[],this.tb=!!b,this.ic=!!c,this.cc=!!d,b=this.Bb=0;b<a.length;b++)Wb(a[b],p(this.vb,this,b,!0),p(this.vb,this,b,!1));0!=a.length||this.tb||this.v(this.Ta)};t(zc,Tb),zc.prototype.vb=function(a,b,c){return this.Bb++,this.Ta[a]=[b,c],this.C||(this.tb&&b?this.v([a,c]):this.ic&&!b?this.A(c):this.Bb==this.bb.length&&this.v(this.Ta)),this.cc&&!b&&(c=null),c},zc.prototype.A=function(a){for(zc.P.A.call(this,a),a=0;a<this.bb.length;a++)this.bb[a].cancel()};var Ac=function(a){return new zc(a,!1,!0).n(function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c][1];return b})},Bc=function(){for(var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split(""),b=0,c=a.length;c>b;b++)switch(a[b]){case"x":a[b]=Math.floor(16*Math.random()).toString(16);break;case"y":a[b]=(Math.floor(4*Math.random())+8).toString(16)}return a.join("")},Cc=function(a){this.J=a,this.Ea=100,this.pb=[],this.W=this.ga=null,this.ea=Dc(this),this.ea.n(function(){this.Jb=_a(this.J,"a",p(this.nc,this))},this)},Dc=function(a){return Ec(a).n(function(){return this},a)},Ec=function(a){return Ac([Gc(a),Ic(a)])};Cc.prototype.nc=function(){Mc(this);var a=Hc(this),b=this.xa();Ec(this).n(function(){a!=Hc(this)&&Lc(this,"analytics.user-id"),b!=this.xa()&&Lc(this,"analytics.tracking-permitted")},this)};var Fc=function(a,b){Mc(a),a.pb.push(b)};Cc.prototype.Oc=function(a){Mc(this);var b=this.W!=a;this.W=a,this.J.set("analytics.tracking-permitted",a.toString()),b&&Lc(this,"analytics.tracking-permitted")},Cc.prototype.xa=function(){Mc(this);var a;return(a=this.W)&&(a=c._gaUserPrefs,a=!(a&&a.ioo&&a.ioo())),a};var Gc=function(a){return a.J.get("analytics.tracking-permitted").n(function(a){if(this.W=!0,a&&d(a))switch(a){case"true":this.W=!0;break;case"false":this.W=!1}},a)},Hc=function(a){if(Mc(a),!i(a.ga))throw Error("Invalid state. UserID is not a string.");return a.ga},Ic=function(a){return a.J.get("analytics.user-id").n(function(a){a&&d(a)?this.ga=a:Jc(this)},a)},Jc=function(a){return a.ga=Bc(),
a.J.set("analytics.user-id",a.ga).n(function(){Lc(this,"analytics.user-id")},a)};Cc.prototype.Nc=function(a){Mc(this),this.Ea=a};var Kc=function(a){return Mc(a),a.Ea};Cc.prototype.Fc=function(){return Jc(this)};var Lc=function(a,b){z(a.pb,function(a){a(b)})};Cc.prototype.ma=function(){null!=this.Jb&&eb(this.Jb)};var Mc=function(a){if(!Xb(a.ea).C)throw Error("Settings object accessed prior to entering ready state.")},Nc=function(){mb.call(this),this.eb="google-analytics",j.isChromeApp?(this.J=chrome.storage.local,chrome.storage.onChanged.addListener(p(this.Ac,this))):(this.J=localStorage,window.addEventListener("storage",function(a){a.key&&"undefined.invalid"!=a.key&&a.key.indexOf(this.eb)>=0&&this.dispatchEvent("a")},!0))};t(Nc,mb),Nc.prototype.Ac=function(a){Oc(this,a)&&this.dispatchEvent("a")};var Oc=function(a,b){return A(K(b),function(a){return 0==a.lastIndexOf(this.eb,0)},a)};Nc.prototype.get=function(a){var b=new Tb,c=this.eb+"."+a;if(j.isChromeApp)this.J.get(c,function(a){chrome.runtime.lastError?b.A(chrome.runtime.lastError):(a=a[c],b.v(null!=a?a.toString():void 0))});else{var d=localStorage.getItem(c);try{b.v(JSON.parse(d))}catch(e){b.v(d)}}return b},Nc.prototype.set=function(a,b){var c=new Tb,d={};return j.isChromeApp?(d[this.eb+"."+a]=b,this.J.set(d,function(){chrome.runtime.lastError?c.A(chrome.runtime.lastError):c.v()})):(b.constructor==Object?localStorage.setItem(this.eb+"."+a,JSON.stringify(b)):localStorage.setItem(this.eb+"."+a,b),c.v()),c};var Pc=function(){};Pc.lc=function(){return Pc.yb?Pc.yb:Pc.yb=new Pc},Pc.prototype.send=function(){return $b()};var Qc=function(a){this.ec=a};Qc.prototype.send=function(a,b){return this.ec.push({pc:a,Bc:b}),$b()};var Rc=function(a,b,c){this.g=a,this.U=[],this.K={enabled:new Qc(this.U),disabled:c},this.q=this.K.enabled,Wb(Xb(this.g.ea),q(this.zc,b),this.yc,this)};Rc.prototype.zc=function(a){if(null===this.U)throw Error("Channel setup already completed.");this.K.enabled=a(),Sc(this),z(this.U,function(a){this.send(a.pc,a.Bc)},this),this.U=null,Fc(this.g,p(this.xc,this))},Rc.prototype.yc=function(){if(null===this.U)throw Error("Channel setup already completed.");this.q=this.K.enabled=this.K.disabled,this.U=null},Rc.prototype.send=function(a,b){return this.q.send(a,b)};var Sc=function(a){a.q=a.g.xa()?a.K.enabled:a.K.disabled};Rc.prototype.xc=function(a){switch(a){case"analytics.tracking-permitted":Sc(this)}};var Tc=function(a,b){this.Ra=[];var c=p(function(){return this.pa=new ec(b.Xa()),z(this.Ra,function(a){this.pa.R(a)},this),this.Ra=null,this.pa},this);this.q=new Rc(a,c,Pc.lc())};Tc.prototype.Xa=function(){return this.q},Tc.prototype.R=function(a){this.pa?this.pa.R(a):this.Ra.push(a)};var Uc=function(a,b){this.g=a,this.Pc=b};Uc.prototype.create=function(){return new Tc(this.g,this.Pc)};var Vc=function(a,b){mb.call(this),this.wa=a||1,this.Y=b||c,this.Pa=p(this.Uc,this),this.ab=r()};t(Vc,mb),a=Vc.prototype,a.enabled=!1,a.h=null,a.Uc=function(){if(this.enabled){var a=r()-this.ab;a>0&&a<.8*this.wa?this.h=this.Y.setTimeout(this.Pa,this.wa-a):(this.h&&(this.Y.clearTimeout(this.h),this.h=null),this.dispatchEvent("tick"),this.enabled&&(this.h=this.Y.setTimeout(this.Pa,this.wa),this.ab=r()))}},a.start=function(){this.enabled=!0,this.h||(this.h=this.Y.setTimeout(this.Pa,this.wa),this.ab=r())},a.stop=function(){this.enabled=!1,this.h&&(this.Y.clearTimeout(this.h),this.h=null)},a.o=function(){Vc.P.o.call(this),this.stop(),delete this.Y};var Wc=function(a,b,d){if(l(a))d&&(a=p(a,d));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=p(a.handleEvent,a)}return b>2147483647?-1:c.setTimeout(a,b||0)},Xc=function(a){qa.call(this),this.Ya=a,this.b={}};t(Xc,qa);var Yc=[];Xc.prototype.listen=function(a,b,c,d){g(b)||(b&&(Yc[0]=b.toString()),b=Yc);for(var e=0;e<b.length;e++){var f=_a(a,b[e],c||this.handleEvent,d||!1,this.Ya||this);if(!f)break;this.b[f.key]=f}return this},Xc.prototype.cb=function(a,b,c,d){return Zc(this,a,b,c,d)};var Zc=function(a,b,c,d,e,f){if(g(c))for(var h=0;h<c.length;h++)Zc(a,b,c[h],d,e,f);else{if(b=cb(b,c,d||a.handleEvent,e,f||a.Ya||a),!b)return a;a.b[b.key]=b}return a};Xc.prototype.jb=function(a,b,c,d,e){if(g(b))for(var f=0;f<b.length;f++)this.jb(a,b[f],c,d,e);else c=c||this.handleEvent,e=e||this.Ya||this,c=lb(c),d=!!d,b=Ra(a)?a.ba(b,c,d,e):a&&(a=jb(a))?a.ba(b,c,d,e):null,b&&(eb(b),delete this.b[b.key]);return this},Xc.prototype.removeAll=function(){I(this.b,eb),this.b={}},Xc.prototype.o=function(){Xc.P.o.call(this),this.removeAll()},Xc.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var $c=function(){mb.call(this),this.oa=new Xc(this),Ma&&(Na?this.oa.listen(Oa?document.body:window,["online","offline"],this.wb):(this.Eb=Ma?navigator.onLine:!0,this.h=new Vc(250),this.oa.listen(this.h,"tick",this.oc),this.h.start()))};t($c,mb),$c.prototype.oc=function(){var a=Ma?navigator.onLine:!0;a!=this.Eb&&(this.Eb=a,this.wb())},$c.prototype.wb=function(){this.dispatchEvent((Ma?navigator.onLine:1)?"online":"offline")},$c.prototype.o=function(){$c.P.o.call(this),this.oa.ma(),this.oa=null,this.h&&(this.h.ma(),this.h=null)};var _c=function(a,b){this.g=a,this.e=b};_c.prototype.send=function(a,b){return b.set(lc,Hc(this.g)),this.e.send(a,b)};var ad=function(a){this.e=a};ad.prototype.send=function(a,b){return bd(b),cd(b),this.e.send(a,b)};var bd=function(a){na(a,function(b,c){d(b.maxLength)&&"text"==b.valueType&&0<b.maxLength&&c.length>b.maxLength&&a.set(b,c.substring(0,b.maxLength))})},cd=function(a){na(a,function(b,c){d(b.defaultValue)&&c==b.defaultValue&&a.remove(b)})},dd={status:"device-offline",la:void 0},ed={status:"rate-limited",la:void 0},fd={status:"sampled-out",la:void 0},gd={status:"sent",la:void 0},hd=function(a,b){this.Vc=a,this.e=b};hd.prototype.send=function(a,b){var c;c=this.Vc;var d=c.Lb(),e=Math.floor((d-c.Ab)*c.hc);return e>0&&(c.$=Math.min(c.$+e,c.uc),c.Ab=d),1>c.$?c=!1:(--c.$,c=!0),c||"item"==a||"transaction"==a?this.e.send(a,b):$b(ed)};var id=function(){this.$=60,this.uc=500,this.hc=5e-4,this.Lb=function(){return(new Date).getTime()},this.Ab=this.Lb()},jd=function(a,b){this.g=a,this.e=b};jd.prototype.send=function(a,b){var c,d=b.get(lc),d=parseInt(d.split("-")[1],16);return"timing"!=a?c=Kc(this.g):((c=b.get(oc))&&b.remove(oc),c=c||Kc(this.g)),655.36*c>d?this.e.send(a,b):$b(fd)};var kd=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,ld=function(a){if(md){md=!1;var b=c.location;if(b){var d=b.href;if(d&&(d=(d=ld(d)[3]||null)?decodeURI(d):d)&&d!=b.hostname)throw md=!0,Error()}}return a.match(kd)},md=Ba,nd=function(a,b){for(var c=a.split("&"),d=0;d<c.length;d++){var e=c[d].indexOf("="),f=null,g=null;e>=0?(f=c[d].substring(0,e),g=c[d].substring(e+1)):f=c[d],b(f,g?decodeURIComponent(g.replace(/\+/g," ")):"")}},od=function(){};od.prototype.nb=null;var pd,qd=function(a){var b;return(b=a.nb)||(b={},td(a)&&(b[0]=!0,b[1]=!0),b=a.nb=b),b},rd=function(){};t(rd,od);var sd=function(a){return(a=td(a))?new ActiveXObject(a):new XMLHttpRequest},td=function(a){if(!a.xb&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<b.length;c++){var d=b[c];try{return new ActiveXObject(d),a.xb=d}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return a.xb};pd=new rd;var ud=function(a){mb.call(this),this.headers=new P,this.Ma=a||null,this.F=!1,this.La=this.a=null,this.za=this.$a="",this.N=this.Za=this.va=this.Ua=!1,this.Ha=0,this.Ga=null,this.Gb="",this.kb=this.Zc=!1};t(ud,mb);var vd=/^https?$/i,wd=["POST","PUT"],xd=[],yd=function(a,b,c){var d=new ud;xd.push(d),b&&d.listen("complete",b),d.cb("ready",d.bc),d.send(a,"POST",c,void 0)};ud.prototype.bc=function(){this.ma(),D(xd,this)},ud.prototype.send=function(a,b,d,e){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.$a+"; newUri="+a);b=b?b.toUpperCase():"GET",this.$a=a,this.za="",this.Ua=!1,this.F=!0,this.a=sd(this.Ma?this.Ma:pd),this.La=qd(this.Ma?this.Ma:pd),this.a.onreadystatechange=p(this.Db,this);try{this.Za=!0,this.a.open(b,String(a),!0),this.Za=!1}catch(f){return void this.na(5,f)}a=d||"";var g=this.headers.clone();e&&la(e,function(a,b){g.set(b,a)}),e=C(g.H()),d=c.FormData&&a instanceof c.FormData,!(0<=y(wd,b))||e||d||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),g.forEach(function(a,b){this.a.setRequestHeader(b,a)},this),this.Gb&&(this.a.responseType=this.Gb),"withCredentials"in this.a&&(this.a.withCredentials=this.Zc);try{Ed(this),0<this.Ha&&((this.kb=zd(this.a))?(this.a.timeout=this.Ha,this.a.ontimeout=p(this.Mb,this)):this.Ga=Wc(this.Mb,this.Ha,this)),this.va=!0,this.a.send(a),this.va=!1}catch(h){this.na(5,h)}};var zd=function(a){return za&&Ga(9)&&k(a.timeout)&&d(a.ontimeout)},Ad=function(a){return"content-type"==a.toLowerCase()};ud.prototype.Mb=function(){"undefined"!=typeof b&&this.a&&(this.za="Timed out after "+this.Ha+"ms, aborting",this.dispatchEvent("timeout"),this.abort(8))},ud.prototype.na=function(a,b){this.F=!1,this.a&&(this.N=!0,this.a.abort(),this.N=!1),this.za=b,Bd(this),Dd(this)};var Bd=function(a){a.Ua||(a.Ua=!0,a.dispatchEvent("complete"),a.dispatchEvent("error"))};ud.prototype.abort=function(){this.a&&this.F&&(this.F=!1,this.N=!0,this.a.abort(),this.N=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Dd(this))},ud.prototype.o=function(){this.a&&(this.F&&(this.F=!1,this.N=!0,this.a.abort(),this.N=!1),Dd(this,!0)),ud.P.o.call(this)},ud.prototype.Db=function(){this.aa||(this.Za||this.va||this.N?Cd(this):this.wc())},ud.prototype.wc=function(){Cd(this)};var Cd=function(a){if(a.F&&"undefined"!=typeof b&&(!a.La[1]||4!=Fd(a)||2!=Gd(a)))if(a.va&&4==Fd(a))Wc(a.Db,0,a);else if(a.dispatchEvent("readystatechange"),4==Fd(a)){a.F=!1;try{var c,d=Gd(a);a:switch(d){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:c=!0;break a;default:c=!1}var e;if(!(e=c)){var f;if(f=0===d){var g=ld(String(a.$a))[1]||null;if(!g&&self.location)var h=self.location.protocol,g=h.substr(0,h.length-1);f=!vd.test(g?g.toLowerCase():"")}e=f}if(e)a.dispatchEvent("complete"),a.dispatchEvent("success");else{var i;try{i=2<Fd(a)?a.a.statusText:""}catch(j){i=""}a.za=i+" ["+Gd(a)+"]",Bd(a)}}finally{Dd(a)}}},Dd=function(a,b){if(a.a){Ed(a);var c=a.a,d=a.La[0]?e:null;a.a=null,a.La=null,b||a.dispatchEvent("ready");try{c.onreadystatechange=d}catch(f){}}},Ed=function(a){a.a&&a.kb&&(a.a.ontimeout=null),k(a.Ga)&&(c.clearTimeout(a.Ga),a.Ga=null)},Fd=function(a){return a.a?a.a.readyState:0},Gd=function(a){try{return 2<Fd(a)?a.a.status:-1}catch(b){return-1}},Hd=function(a,b,c){this.r=a||null,this.qc=!!c},Id=function(a){a.c||(a.c=new P,a.j=0,a.r&&nd(a.r,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)}))};a=Hd.prototype,a.c=null,a.j=null,a.add=function(a,b){Id(this),this.r=null,a=Jd(this,a);var c=this.c.get(a);return c||this.c.set(a,c=[]),c.push(b),this.j++,this},a.remove=function(a){return Id(this),a=Jd(this,a),this.c.T(a)?(this.r=null,this.j-=this.c.get(a).length,this.c.remove(a)):!1},a.T=function(a){return Id(this),a=Jd(this,a),this.c.T(a)},a.H=function(){Id(this);for(var a=this.c.t(),b=this.c.H(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c},a.t=function(a){Id(this);var b=[];if(i(a))this.T(a)&&(b=E(b,this.c.get(Jd(this,a))));else{a=this.c.t();for(var c=0;c<a.length;c++)b=E(b,a[c])}return b},a.set=function(a,b){return Id(this),this.r=null,a=Jd(this,a),this.T(a)&&(this.j-=this.c.get(a).length),this.c.set(a,[b]),this.j++,this},a.get=function(a,b){var c=a?this.t(a):[];return 0<c.length?String(c[0]):b},a.toString=function(){if(this.r)return this.r;if(!this.c)return"";for(var a=[],b=this.c.H(),c=0;c<b.length;c++)for(var d=b[c],e=encodeURIComponent(String(d)),d=this.t(d),f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+encodeURIComponent(String(d[f]))),a.push(g)}return this.r=a.join("&")},a.clone=function(){var a=new Hd;return a.r=this.r,this.c&&(a.c=this.c.clone(),a.j=this.j),a};var Jd=function(a,b){var c=String(b);return a.qc&&(c=c.toLowerCase()),c},Kd=function(a,b){this.Mc=a,this.Aa=b};Kd.prototype.send=function(a,b){if(Ma&&!navigator.onLine)return _b();var c=new Tb,d=Ld(a,b);return d.length>this.Aa?c.A({status:"payload-too-big",la:ia("Encoded hit length == %s, but should be <= %s.",d.length,this.Aa)}):yd(this.Mc,function(){c.v(gd)},d),c};var Ld=function(a,b){var c=new Hd;return c.add(U.name,a),na(b,function(a,b){c.add(a.name,b.toString())}),c.toString()},Md=function(a,b,c){this.g=a,this.Lc=b,this.Aa=c};Md.prototype.Xa=function(){if(!this.q){if(!Xb(this.g.ea).C)throw Error("Cannot construct shared channel prior to settings being ready.");new $c;var a=new ad(new Kd(this.Lc,this.Aa)),b=new id;this.q=new _c(this.g,new jd(this.g,new hd(b,a)))}return this.q};var Nd=new P,Od=function(){return R||(R=new Cc(new Nc)),R};s("goog.async.Deferred",Tb),s("goog.async.Deferred.prototype.addCallback",Tb.prototype.n),s("goog.async.Deferred.prototype.callback",Tb.prototype.v),s("goog.async.Deferred.prototype.then",Tb.prototype.then),s("goog.events.EventTarget",mb),s("goog.events.EventTarget.prototype.listen",mb.prototype.listen),s("analytics.getService",function(a,b){var c=Nd.get(a,null),d=b||j.av;if(null===c){if(c=Od(),!S){var e=Od();S=new Uc(e,new Md(e,"https://www.google-analytics.com/collect",8192))}c=new yc("ca1.6.0",a,d,c,S),Nd.set(a,c)}return c}),s("analytics.internal.GoogleAnalyticsService",yc),s("analytics.internal.GoogleAnalyticsService.prototype.getTracker",yc.prototype.mc),s("analytics.internal.GoogleAnalyticsService.prototype.getConfig",yc.prototype.kc),s("analytics.internal.ServiceSettings",Cc),s("analytics.internal.ServiceSettings.prototype.setTrackingPermitted",Cc.prototype.Oc),s("analytics.internal.ServiceSettings.prototype.isTrackingPermitted",Cc.prototype.xa),s("analytics.internal.ServiceSettings.prototype.setSampleRate",Cc.prototype.Nc),s("analytics.internal.ServiceSettings.prototype.resetUserId",Cc.prototype.Fc),s("analytics.internal.ServiceTracker",wc),s("analytics.internal.ServiceTracker.prototype.send",wc.prototype.send),s("analytics.internal.ServiceTracker.prototype.sendAppView",wc.prototype.Hc),s("analytics.internal.ServiceTracker.prototype.sendEvent",wc.prototype.Ic),s("analytics.internal.ServiceTracker.prototype.sendSocial",wc.prototype.Kc),s("analytics.internal.ServiceTracker.prototype.sendException",wc.prototype.Jc),s("analytics.internal.ServiceTracker.prototype.sendTiming",wc.prototype.Ib),s("analytics.internal.ServiceTracker.prototype.startTiming",wc.prototype.Rc),s("analytics.internal.ServiceTracker.Timing",xc),s("analytics.internal.ServiceTracker.Timing.prototype.send",xc.prototype.send),s("analytics.internal.ServiceTracker.prototype.forceSessionStart",wc.prototype.jc),s("analytics.internal.ServiceTracker.prototype.addFilter",wc.prototype.R),s("analytics.internal.FilterChannel.Hit",gc),s("analytics.internal.FilterChannel.Hit.prototype.getHitType",gc.prototype.ub),s("analytics.internal.FilterChannel.Hit.prototype.getParameters",gc.prototype.V),s("analytics.internal.FilterChannel.Hit.prototype.cancel",gc.prototype.cancel),s("analytics.ParameterMap",ma),s("analytics.ParameterMap.Entry",ma.Entry),s("analytics.ParameterMap.prototype.set",ma.prototype.set),s("analytics.ParameterMap.prototype.get",ma.prototype.get),s("analytics.ParameterMap.prototype.remove",ma.prototype.remove),s("analytics.ParameterMap.prototype.toObject",ma.prototype.Nb),s("analytics.HitTypes.APPVIEW","appview"),s("analytics.HitTypes.EVENT","event"),s("analytics.HitTypes.SOCIAL","social"),s("analytics.HitTypes.TRANSACTION","transaction"),s("analytics.HitTypes.ITEM","item"),s("analytics.HitTypes.TIMING","timing"),s("analytics.HitTypes.EXCEPTION","exception"),I(_,function(a){var b=a.id.replace(/[A-Z]/,"_$&").toUpperCase();s("analytics.Parameters."+b,a)}),s("analytics.filters.EventLabelerBuilder",ga),s("analytics.filters.EventLabelerBuilder.prototype.appendToExistingLabel",ga.prototype.Wb),s("analytics.filters.EventLabelerBuilder.prototype.stripValue",ga.prototype.Sc),s("analytics.filters.EventLabelerBuilder.prototype.powersOfTwo",ga.prototype.Dc),s("analytics.filters.EventLabelerBuilder.prototype.rangeBounds",ga.prototype.Ec),s("analytics.filters.EventLabelerBuilder.prototype.build",ga.prototype.ia),s("analytics.filters.FilterBuilder",ea),s("analytics.filters.FilterBuilder.builder",fa),s("analytics.filters.FilterBuilder.prototype.when",ea.prototype.when),s("analytics.filters.FilterBuilder.prototype.whenHitType",ea.prototype.Rb),s("analytics.filters.FilterBuilder.prototype.whenValue",ea.prototype.Yc),s("analytics.filters.FilterBuilder.prototype.applyFilter",ea.prototype.mb),s("analytics.filters.FilterBuilder.prototype.build",ea.prototype.ia),s("analytics.EventBuilder",oa),s("analytics.EventBuilder.builder",function(){return pa}),s("analytics.EventBuilder.prototype.category",oa.prototype.Yb),s("analytics.EventBuilder.prototype.action",oa.prototype.action),s("analytics.EventBuilder.prototype.label",oa.prototype.label),s("analytics.EventBuilder.prototype.value",oa.prototype.value),s("analytics.EventBuilder.prototype.dimension",oa.prototype.fc),s("analytics.EventBuilder.prototype.metric",oa.prototype.vc),s("analytics.EventBuilder.prototype.send",oa.prototype.send)}.call(this);var h=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],i=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];!function(){"use strict";var a=angular.module("ngImgCrop",[]);a.factory("cropAreaCircle",["cropArea",function(a){var b=function(){a.apply(this,arguments),this._boxResizeBaseSize=20,this._boxResizeNormalRatio=.9,this._boxResizeHoverRatio=1.2,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._boxResizeNormalSize=this._boxResizeBaseSize*this._boxResizeNormalRatio,this._boxResizeHoverSize=this._boxResizeBaseSize*this._boxResizeHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize=0,this._boxResizeIsHover=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!1,this._areaIsDragging=!1};return b.prototype=new a,b.prototype._calcCirclePerimeterCoords=function(a){var b=this._size/2,c=a*(Math.PI/180),d=this._x+b*Math.cos(c),e=this._y+b*Math.sin(c);return[d,e]},b.prototype._calcResizeIconCenterCoords=function(){return this._calcCirclePerimeterCoords(-45)},b.prototype._isCoordWithinArea=function(a){return Math.sqrt((a[0]-this._x)*(a[0]-this._x)+(a[1]-this._y)*(a[1]-this._y))<this._size/2},b.prototype._isCoordWithinBoxResize=function(a){var b=this._calcResizeIconCenterCoords(),c=this._boxResizeHoverSize/2;return a[0]>b[0]-c&&a[0]<b[0]+c&&a[1]>b[1]-c&&a[1]<b[1]+c},b.prototype._drawArea=function(a,b,c){a.arc(b[0],b[1],c/2,0,2*Math.PI)},b.prototype.draw=function(){a.prototype.draw.apply(this,arguments),this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio),this._cropCanvas.drawIconResizeBoxNESW(this._calcResizeIconCenterCoords(),this._boxResizeBaseSize,this._boxResizeIsHover?this._boxResizeHoverRatio:this._boxResizeNormalRatio)},b.prototype.processMouseMove=function(a,b){var c="default",d=!1;if(this._boxResizeIsHover=!1,this._areaIsHover=!1,this._areaIsDragging)this._x=a-this._posDragStartX,this._y=b-this._posDragStartY,this._areaIsHover=!0,c="move",d=!0,this._events.trigger("area-move");else if(this._boxResizeIsDragging){c="nesw-resize";var e,f,g;f=a-this._posResizeStartX,g=this._posResizeStartY-b,e=f>g?this._posResizeStartSize+2*g:this._posResizeStartSize+2*f,this._size=Math.max(this._minSize,e),this._boxResizeIsHover=!0,d=!0,this._events.trigger("area-resize")}else this._isCoordWithinBoxResize([a,b])?(c="nesw-resize",this._areaIsHover=!1,this._boxResizeIsHover=!0,d=!0):this._isCoordWithinArea([a,b])&&(c="move",this._areaIsHover=!0,d=!0);return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:c}),d},b.prototype.processMouseDown=function(a,b){this._isCoordWithinBoxResize([a,b])?(this._areaIsDragging=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!0,this._boxResizeIsHover=!0,this._posResizeStartX=a,this._posResizeStartY=b,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start")):this._isCoordWithinArea([a,b])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._boxResizeIsDragging=!1,this._boxResizeIsHover=!1,this._posDragStartX=a-this._x,this._posDragStartY=b-this._y,this._events.trigger("area-move-start"))},b.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._boxResizeIsDragging&&(this._boxResizeIsDragging=!1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._boxResizeIsHover=!1,this._posDragStartX=0,this._posDragStartY=0},b}]),a.factory("cropAreaSquare",["cropArea",function(a){var b=function(){a.apply(this,arguments),this._resizeCtrlBaseRadius=10,this._resizeCtrlNormalRatio=.75,this._resizeCtrlHoverRatio=1,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio,this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize=0,this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._resizeCtrlIsDragging=-1,this._areaIsDragging=!1};return b.prototype=new a,b.prototype._calcSquareCorners=function(){var a=this._size/2;return[[this._x-a,this._y-a],[this._x+a,this._y-a],[this._x-a,this._y+a],[this._x+a,this._y+a]]},b.prototype._calcSquareDimensions=function(){var a=this._size/2;return{left:this._x-a,top:this._y-a,right:this._x+a,bottom:this._y+a}},b.prototype._isCoordWithinArea=function(a){var b=this._calcSquareDimensions();return a[0]>=b.left&&a[0]<=b.right&&a[1]>=b.top&&a[1]<=b.bottom},b.prototype._isCoordWithinResizeCtrl=function(a){for(var b=this._calcSquareCorners(),c=-1,d=0,e=b.length;e>d;d++){var f=b[d];if(a[0]>f[0]-this._resizeCtrlHoverRadius&&a[0]<f[0]+this._resizeCtrlHoverRadius&&a[1]>f[1]-this._resizeCtrlHoverRadius&&a[1]<f[1]+this._resizeCtrlHoverRadius){c=d;break}}return c},b.prototype._drawArea=function(a,b,c){var d=c/2;a.rect(b[0]-d,b[1]-d,c,c)},b.prototype.draw=function(){a.prototype.draw.apply(this,arguments),this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var b=this._calcSquareCorners(),c=0,d=b.length;d>c;c++){var e=b[c];this._cropCanvas.drawIconResizeCircle(e,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===c?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}},b.prototype.processMouseMove=function(a,b){var c="default",d=!1;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this._x=a-this._posDragStartX,this._y=b-this._posDragStartY,this._areaIsHover=!0,c="move",d=!0,this._events.trigger("area-move");else if(this._resizeCtrlIsDragging>-1){var e,f;switch(this._resizeCtrlIsDragging){case 0:e=-1,f=-1,c="nwse-resize";break;case 1:e=1,f=-1,c="nesw-resize";break;case 2:e=-1,f=1,c="nesw-resize";break;case 3:e=1,f=1,c="nwse-resize"}var g,h=(a-this._posResizeStartX)*e,i=(b-this._posResizeStartY)*f;g=h>i?this._posResizeStartSize+i:this._posResizeStartSize+h;var j=this._size;this._size=Math.max(this._minSize,g);var k=(this._size-j)/2;this._x+=k*e,this._y+=k*f,this._resizeCtrlIsHover=this._resizeCtrlIsDragging,d=!0,this._events.trigger("area-resize")}else{var l=this._isCoordWithinResizeCtrl([a,b]);if(l>-1){switch(l){case 0:c="nwse-resize";break;case 1:c="nesw-resize";break;case 2:c="nesw-resize";break;case 3:c="nwse-resize"}this._areaIsHover=!1,this._resizeCtrlIsHover=l,d=!0}else this._isCoordWithinArea([a,b])&&(c="move",this._areaIsHover=!0,d=!0)}return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:c}),d},b.prototype.processMouseDown=function(a,b){var c=this._isCoordWithinResizeCtrl([a,b]);c>-1?(this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=c,this._resizeCtrlIsHover=c,this._posResizeStartX=a,this._posResizeStartY=b,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start")):this._isCoordWithinArea([a,b])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1,this._posDragStartX=a-this._x,this._posDragStartY=b-this._y,this._events.trigger("area-move-start"))},b.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._resizeCtrlIsDragging>-1&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},b}]),a.factory("cropArea",["cropCanvas",function(a){var b=function(b,c){this._ctx=b,this._events=c,this._minSize=80,this._cropCanvas=new a(b),this._image=new Image,this._x=0,this._y=0,this._size=200};return b.prototype.getImage=function(){return this._image},b.prototype.setImage=function(a){this._image=a},b.prototype.getX=function(){return this._x},b.prototype.setX=function(a){this._x=a,this._dontDragOutside()},b.prototype.getY=function(){return this._y},b.prototype.setY=function(a){this._y=a,this._dontDragOutside()},b.prototype.getSize=function(){return this._size},b.prototype.setSize=function(a){this._size=Math.max(this._minSize,a),this._dontDragOutside()},b.prototype.getMinSize=function(){return this._minSize},b.prototype.setMinSize=function(a){this._minSize=a,this._size=Math.max(this._minSize,this._size),this._dontDragOutside()},b.prototype._dontDragOutside=function(){var a=this._ctx.canvas.height,b=this._ctx.canvas.width;this._size>b&&(this._size=b),this._size>a&&(this._size=a),this._x<this._size/2&&(this._x=this._size/2),this._x>b-this._size/2&&(this._x=b-this._size/2),this._y<this._size/2&&(this._y=this._size/2),this._y>a-this._size/2&&(this._y=a-this._size/2)},b.prototype._drawArea=function(){},b.prototype.draw=function(){this._cropCanvas.drawCropArea(this._image,[this._x,this._y],this._size,this._drawArea)},b.prototype.processMouseMove=function(){},b.prototype.processMouseDown=function(){},b.prototype.processMouseUp=function(){},b}]),a.factory("cropCanvas",[function(){var a=[[-.5,-2],[-3,-4.5],[-.5,-7],[-7,-7],[-7,-.5],[-4.5,-3],[-2,-.5]],b=[[.5,-2],[3,-4.5],[.5,-7],[7,-7],[7,-.5],[4.5,-3],[2,-.5]],c=[[-.5,2],[-3,4.5],[-.5,7],[-7,7],[-7,.5],[-4.5,3],[-2,.5]],d=[[.5,2],[3,4.5],[.5,7],[7,7],[7,.5],[4.5,3],[2,.5]],e=[[-1.5,-2.5],[-1.5,-6],[-5,-6],[0,-11],[5,-6],[1.5,-6],[1.5,-2.5]],f=[[-2.5,-1.5],[-6,-1.5],[-6,-5],[-11,0],[-6,5],[-6,1.5],[-2.5,1.5]],g=[[-1.5,2.5],[-1.5,6],[-5,6],[0,11],[5,6],[1.5,6],[1.5,2.5]],h=[[2.5,-1.5],[6,-1.5],[6,-5],[11,0],[6,5],[6,1.5],[2.5,1.5]],i={areaOutline:"#fff",resizeBoxStroke:"#fff",resizeBoxFill:"#444",resizeBoxArrowFill:"#fff",resizeCircleStroke:"#fff",resizeCircleFill:"#444",moveIconFill:"#fff"};return function(j){var k=function(a,b,c){return[c*a[0]+b[0],c*a[1]+b[1]]},l=function(a,b,c,d){j.save(),j.fillStyle=b,j.beginPath();var e,f=k(a[0],c,d);j.moveTo(f[0],f[1]);for(var g in a)g>0&&(e=k(a[g],c,d),j.lineTo(e[0],e[1]));j.lineTo(f[0],f[1]),j.fill(),j.closePath(),j.restore()};this.drawIconMove=function(a,b){l(e,i.moveIconFill,a,b),l(f,i.moveIconFill,a,b),l(g,i.moveIconFill,a,b),l(h,i.moveIconFill,a,b)},this.drawIconResizeCircle=function(a,b,c){var d=b*c;j.save(),j.strokeStyle=i.resizeCircleStroke,j.lineWidth=2,j.fillStyle=i.resizeCircleFill,j.beginPath(),j.arc(a[0],a[1],d,0,2*Math.PI),j.fill(),j.stroke(),j.closePath(),j.restore()},this.drawIconResizeBoxBase=function(a,b,c){var d=b*c;j.save(),j.strokeStyle=i.resizeBoxStroke,j.lineWidth=2,j.fillStyle=i.resizeBoxFill,j.fillRect(a[0]-d/2,a[1]-d/2,d,d),j.strokeRect(a[0]-d/2,a[1]-d/2,d,d),j.restore()},this.drawIconResizeBoxNESW=function(a,d,e){this.drawIconResizeBoxBase(a,d,e),l(b,i.resizeBoxArrowFill,a,e),l(c,i.resizeBoxArrowFill,a,e)},this.drawIconResizeBoxNWSE=function(b,c,e){this.drawIconResizeBoxBase(b,c,e),l(a,i.resizeBoxArrowFill,b,e),l(d,i.resizeBoxArrowFill,b,e)},this.drawCropArea=function(a,b,c,d){var e=a.width/j.canvas.width,f=a.height/j.canvas.height,g=b[0]-c/2,h=b[1]-c/2;j.save(),j.strokeStyle=i.areaOutline,j.lineWidth=2,j.beginPath(),d(j,b,c),j.stroke(),j.clip(),c>0&&j.drawImage(a,g*e,h*f,c*e,c*f,g,h,c,c),j.beginPath(),d(j,b,c),j.stroke(),j.clip(),j.restore()}}}]),a.service("cropEXIF",[function(){function a(a){return!!a.exifdata}function b(a,b){b=b||a.match(/^data\:([^\;]+)\;base64,/im)[1]||"",a=a.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var c=atob(a),d=c.length,e=new ArrayBuffer(d),f=new Uint8Array(e),g=0;d>g;g++)f[g]=c.charCodeAt(g);return e}function c(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(){(200==this.status||0===this.status)&&b(this.response)},c.send()}function d(a,d){function g(b){var c=e(b),g=f(b);a.exifdata=c||{},a.iptcdata=g||{},d&&d.call(a)}if(a.src)if(/^data\:/i.test(a.src)){var h=b(a.src);g(h)}else if(/^blob\:/i.test(a.src)){var i=new FileReader;i.onload=function(a){g(a.target.result)},c(a.src,function(a){i.readAsArrayBuffer(a)})}else{var j=new XMLHttpRequest;j.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";g(j.response),j=null},j.open("GET",a.src,!0),j.responseType="arraybuffer",j.send(null)}else if(window.FileReader&&(a instanceof window.Blob||a instanceof window.File)){var i=new FileReader;i.onload=function(a){l&&console.log("Got file of length "+a.target.result.byteLength),g(a.target.result)},i.readAsArrayBuffer(a)}}function e(a){var b=new DataView(a);if(l&&console.log("Got file of length "+a.byteLength),255!=b.getUint8(0)||216!=b.getUint8(1))return l&&console.log("Not a valid JPEG"),!1;for(var c,d=2,e=a.byteLength;e>d;){if(255!=b.getUint8(d))return l&&console.log("Not a valid marker at offset "+d+", found: "+b.getUint8(d)),!1;if(c=b.getUint8(d+1),l&&console.log(c),225==c)return l&&console.log("Found 0xFFE1 marker"),k(b,d+4,b.getUint16(d+2)-2);d+=2+b.getUint16(d+2)}}function f(a){var b=new DataView(a);if(l&&console.log("Got file of length "+a.byteLength),255!=b.getUint8(0)||216!=b.getUint8(1))return l&&console.log("Not a valid JPEG"),!1;for(var c=2,d=a.byteLength,e=function(a,b){return 56===a.getUint8(b)&&66===a.getUint8(b+1)&&73===a.getUint8(b+2)&&77===a.getUint8(b+3)&&4===a.getUint8(b+4)&&4===a.getUint8(b+5);
};d>c;){if(e(b,c)){var f=b.getUint8(c+7);f%2!==0&&(f+=1),0===f&&(f=4);var h=c+8+f,i=b.getUint16(c+6+f);return g(a,h,i)}c++}}function g(a,b,c){for(var d,e,f,g,h,i=new DataView(a),k={},l=b;b+c>l;)28===i.getUint8(l)&&2===i.getUint8(l+1)&&(g=i.getUint8(l+2),g in q&&(f=i.getInt16(l+3),h=f+5,e=q[g],d=j(i,l+5,f),k.hasOwnProperty(e)?k[e]instanceof Array?k[e].push(d):k[e]=[k[e],d]:k[e]=d)),l++;return k}function h(a,b,c,d,e){var f,g,h,j=a.getUint16(c,!e),k={};for(h=0;j>h;h++)f=c+12*h+2,g=d[a.getUint16(f,!e)],!g&&l&&console.log("Unknown tag: "+a.getUint16(f,!e)),k[g]=i(a,f,b,c,e);return k}function i(a,b,c,d,e){var f,g,h,i,k,l,m=a.getUint16(b+2,!e),n=a.getUint32(b+4,!e),o=a.getUint32(b+8,!e)+c;switch(m){case 1:case 7:if(1==n)return a.getUint8(b+8,!e);for(f=n>4?o:b+8,g=[],i=0;n>i;i++)g[i]=a.getUint8(f+i);return g;case 2:return f=n>4?o:b+8,j(a,f,n-1);case 3:if(1==n)return a.getUint16(b+8,!e);for(f=n>2?o:b+8,g=[],i=0;n>i;i++)g[i]=a.getUint16(f+2*i,!e);return g;case 4:if(1==n)return a.getUint32(b+8,!e);for(g=[],i=0;n>i;i++)g[i]=a.getUint32(o+4*i,!e);return g;case 5:if(1==n)return k=a.getUint32(o,!e),l=a.getUint32(o+4,!e),h=new Number(k/l),h.numerator=k,h.denominator=l,h;for(g=[],i=0;n>i;i++)k=a.getUint32(o+8*i,!e),l=a.getUint32(o+4+8*i,!e),g[i]=new Number(k/l),g[i].numerator=k,g[i].denominator=l;return g;case 9:if(1==n)return a.getInt32(b+8,!e);for(g=[],i=0;n>i;i++)g[i]=a.getInt32(o+4*i,!e);return g;case 10:if(1==n)return a.getInt32(o,!e)/a.getInt32(o+4,!e);for(g=[],i=0;n>i;i++)g[i]=a.getInt32(o+8*i,!e)/a.getInt32(o+4+8*i,!e);return g}}function j(a,b,c){for(var d="",e=b;b+c>e;e++)d+=String.fromCharCode(a.getUint8(e));return d}function k(a,b){if("Exif"!=j(a,b,4))return l&&console.log("Not valid EXIF data! "+j(a,b,4)),!1;var c,d,e,f,g,i=b+6;if(18761==a.getUint16(i))c=!1;else{if(19789!=a.getUint16(i))return l&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;c=!0}if(42!=a.getUint16(i+2,!c))return l&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var k=a.getUint32(i+4,!c);if(8>k)return l&&console.log("Not valid TIFF data! (First offset less than 8)",a.getUint32(i+4,!c)),!1;if(d=h(a,i,i+k,n,c),d.ExifIFDPointer){f=h(a,i,i+d.ExifIFDPointer,m,c);for(e in f){switch(e){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":f[e]=p[e][f[e]];break;case"ExifVersion":case"FlashpixVersion":f[e]=String.fromCharCode(f[e][0],f[e][1],f[e][2],f[e][3]);break;case"ComponentsConfiguration":f[e]=p.Components[f[e][0]]+p.Components[f[e][1]]+p.Components[f[e][2]]+p.Components[f[e][3]]}d[e]=f[e]}}if(d.GPSInfoIFDPointer){g=h(a,i,i+d.GPSInfoIFDPointer,o,c);for(e in g){switch(e){case"GPSVersionID":g[e]=g[e][0]+"."+g[e][1]+"."+g[e][2]+"."+g[e][3]}d[e]=g[e]}}return d}var l=!1,m=this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},n=this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},o=this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},p=this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},q={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};this.getData=function(b,c){return(b instanceof Image||b instanceof HTMLImageElement)&&!b.complete?!1:(a(b)?c&&c.call(b):d(b,c),!0)},this.getTag=function(b,c){return a(b)?b.exifdata[c]:void 0},this.getAllTags=function(b){if(!a(b))return{};var c,d=b.exifdata,e={};for(c in d)d.hasOwnProperty(c)&&(e[c]=d[c]);return e},this.pretty=function(b){if(!a(b))return"";var c,d=b.exifdata,e="";for(c in d)d.hasOwnProperty(c)&&(e+="object"==typeof d[c]?d[c]instanceof Number?c+" : "+d[c]+" ["+d[c].numerator+"/"+d[c].denominator+"]\r\n":c+" : ["+d[c].length+" values]\r\n":c+" : "+d[c]+"\r\n");return e},this.readFromBinaryFile=function(a){return e(a)}}]),a.factory("cropHost",["$document","cropAreaCircle","cropAreaSquare","cropEXIF",function(a,b,c,d){var e=function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}};return function(f,g,h){function i(){j.clearRect(0,0,j.canvas.width,j.canvas.height),null!==k&&(j.drawImage(k,0,0,j.canvas.width,j.canvas.height),j.save(),j.fillStyle="rgba(0, 0, 0, 0.65)",j.fillRect(0,0,j.canvas.width,j.canvas.height),j.restore(),l.draw())}var j=null,k=null,l=null,m=[100,100],n=[300,300],o=200,p="image/png",q=null,r=function(){if(null!==k){l.setImage(k);var a=[k.width,k.height],b=k.width/k.height,c=a;c[0]>n[0]?(c[0]=n[0],c[1]=c[0]/b):c[0]<m[0]&&(c[0]=m[0],c[1]=c[0]/b),c[1]>n[1]?(c[1]=n[1],c[0]=c[1]*b):c[1]<m[1]&&(c[1]=m[1],c[0]=c[1]*b),f.prop("width",c[0]).prop("height",c[1]).css({"margin-left":-c[0]/2+"px","margin-top":-c[1]/2+"px"}),l.setX(j.canvas.width/2),l.setY(j.canvas.height/2),l.setSize(Math.min(200,j.canvas.width/2,j.canvas.height/2))}else f.prop("width",0).prop("height",0).css({"margin-top":0});i()},s=function(a){return angular.isDefined(a.changedTouches)?a.changedTouches:a.originalEvent.changedTouches},t=function(a){if(null!==k){var b,c,d=e(j.canvas);"touchmove"===a.type?(b=s(a)[0].pageX,c=s(a)[0].pageY):(b=a.pageX,c=a.pageY),l.processMouseMove(b-d.left,c-d.top),i()}},u=function(a){if(a.preventDefault(),a.stopPropagation(),null!==k){var b,c,d=e(j.canvas);"touchstart"===a.type?(b=s(a)[0].pageX,c=s(a)[0].pageY):(b=a.pageX,c=a.pageY),l.processMouseDown(b-d.left,c-d.top),i()}},v=function(a){if(null!==k){var b,c,d=e(j.canvas);"touchend"===a.type?(b=s(a)[0].pageX,c=s(a)[0].pageY):(b=a.pageX,c=a.pageY),l.processMouseUp(b-d.left,c-d.top),i()}};this.getResultImageDataURI=function(){var a,b;return b=angular.element("<canvas></canvas>")[0],a=b.getContext("2d"),b.width=o,b.height=o,null!==k&&a.drawImage(k,(l.getX()-l.getSize()/2)*(k.width/j.canvas.width),(l.getY()-l.getSize()/2)*(k.height/j.canvas.height),l.getSize()*(k.width/j.canvas.width),l.getSize()*(k.height/j.canvas.height),0,0,o,o),null!==q?b.toDataURL(p,q):b.toDataURL(p)},this.setNewImageSource=function(a){if(k=null,r(),h.trigger("image-updated"),a){var b=new Image;"http"===a.substring(0,4).toLowerCase()&&(b.crossOrigin="anonymous"),b.onload=function(){h.trigger("load-done"),d.getData(b,function(){var a=d.getTag(b,"Orientation");if([3,6,8].indexOf(a)>-1){var c=document.createElement("canvas"),e=c.getContext("2d"),f=b.width,g=b.height,i=0,j=0,l=0;switch(a){case 3:i=-b.width,j=-b.height,l=180;break;case 6:f=b.height,g=b.width,j=-b.height,l=90;break;case 8:f=b.height,g=b.width,i=-b.width,l=270}c.width=f,c.height=g,e.rotate(l*Math.PI/180),e.drawImage(b,i,j),k=new Image,k.src=c.toDataURL("image/png")}else k=b;r(),h.trigger("image-updated")})},b.onerror=function(){h.trigger("load-error")},h.trigger("load-start"),b.src=a}},this.setMaxDimensions=function(a,b){if(n=[a,b],null!==k){var c=j.canvas.width,d=j.canvas.height,e=[k.width,k.height],g=k.width/k.height,h=e;h[0]>n[0]?(h[0]=n[0],h[1]=h[0]/g):h[0]<m[0]&&(h[0]=m[0],h[1]=h[0]/g),h[1]>n[1]?(h[1]=n[1],h[0]=h[1]*g):h[1]<m[1]&&(h[1]=m[1],h[0]=h[1]*g),f.prop("width",h[0]).prop("height",h[1]).css({"margin-left":-h[0]/2+"px","margin-top":-h[1]/2+"px"});var o=j.canvas.width/c,p=j.canvas.height/d,q=Math.min(o,p);l.setX(l.getX()*o),l.setY(l.getY()*p),l.setSize(l.getSize()*q)}else f.prop("width",0).prop("height",0).css({"margin-top":0});i()},this.setAreaMinSize=function(a){a=parseInt(a,10),isNaN(a)||(l.setMinSize(a),i())},this.setResultImageSize=function(a){a=parseInt(a,10),isNaN(a)||(o=a)},this.setResultImageFormat=function(a){p=a},this.setResultImageQuality=function(a){a=parseFloat(a),!isNaN(a)&&a>=0&&1>=a&&(q=a)},this.setAreaType=function(a){var d=l.getSize(),e=l.getMinSize(),f=l.getX(),g=l.getY(),m=b;"square"===a&&(m=c),l=new m(j,h),l.setMinSize(e),l.setSize(d),l.setX(f),l.setY(g),null!==k&&l.setImage(k),i()},j=f[0].getContext("2d"),l=new b(j,h),a.on("mousemove",t),f.on("mousedown",u),a.on("mouseup",v),a.on("touchmove",t),f.on("touchstart",u),a.on("touchend",v),this.destroy=function(){a.off("mousemove",t),f.off("mousedown",u),a.off("mouseup",t),a.off("touchmove",t),f.off("touchstart",u),a.off("touchend",t),f.remove()}}}]),a.factory("cropPubSub",[function(){return function(){var a={};this.on=function(b,c){return b.split(" ").forEach(function(b){a[b]||(a[b]=[]),a[b].push(c)}),this},this.trigger=function(b,c){return angular.forEach(a[b],function(a){a.call(null,c)}),this}}}]),a.directive("imgCrop",["$timeout","cropHost","cropPubSub",function(a,b,c){return{restrict:"E",scope:{image:"=",resultImage:"=",changeOnFly:"=",areaType:"@",areaMinSize:"=",resultImageSize:"=",resultImageFormat:"@",resultImageQuality:"=",onChange:"&",onLoadBegin:"&",onLoadDone:"&",onLoadError:"&"},template:"<canvas></canvas>",controller:["$scope",function(a){a.events=new c}],link:function(c,d){var e,f=c.events,g=new b(d.find("canvas"),{},f),h=function(a){var b=g.getResultImageDataURI();e!==b&&(e=b,angular.isDefined(a.resultImage)&&(a.resultImage=b),a.onChange({$dataURI:a.resultImage}))},i=function(b){return function(){a(function(){c.$apply(function(a){b(a)})})}};f.on("load-start",i(function(a){a.onLoadBegin({})})).on("load-done",i(function(a){a.onLoadDone({})})).on("load-error",i(function(a){a.onLoadError({})})).on("area-move area-resize",i(function(a){a.changeOnFly&&h(a)})).on("area-move-end area-resize-end image-updated",i(function(a){h(a)})),c.$watch("image",function(){g.setNewImageSource(c.image)}),c.$watch("areaType",function(){g.setAreaType(c.areaType),h(c)}),c.$watch("areaMinSize",function(){g.setAreaMinSize(c.areaMinSize),h(c)}),c.$watch("resultImageSize",function(){g.setResultImageSize(c.resultImageSize),h(c)}),c.$watch("resultImageFormat",function(){g.setResultImageFormat(c.resultImageFormat),h(c)}),c.$watch("resultImageQuality",function(){g.setResultImageQuality(c.resultImageQuality),h(c)}),c.$watch(function(){return[d[0].clientWidth,d[0].clientHeight]},function(a){g.setMaxDimensions(a[0],a[1]),h(c)},!0),c.$on("$destroy",function(){g.destroy()})}}}])}(),Promise.loop=function(a){return new Promise(function(b,c){var d=new Array;a.reduce(function(a,b){return a.then(function(a){return a&&d.push(a),b.apply(this,arguments)})},Promise.resolve()).then(function(a){a&&d.push(a),b(d)})["catch"](function(a){c(a)})})},function(){var a=this,b=function(b,c){var d=b.split("."),e=window||a;d[0]in e||!e.execScript||e.execScript("var "+d[0]);for(var f;d.length&&(f=d.shift());)d.length||void 0===c?e=e[f]?e[f]:e[f]={}:e[f]=c},c=function(a){var b=chrome.runtime.connect("nmmhkkegccagdldgiimedpiccmgmieda",{}),c=!1;b.onMessage.addListener(function(b){c=!0,"response"in b&&!("errorType"in b.response)?a.success&&a.success(b):a.failure&&a.failure(b)}),b.onDisconnect.addListener(function(){!c&&a.failure&&a.failure({request:{},response:{errorType:"INTERNAL_SERVER_ERROR"}})}),b.postMessage(a)};b("google.payments.inapp.buy",function(a){a.method="buy",c(a)}),b("google.payments.inapp.consumePurchase",function(a){a.method="consumePurchase",c(a)}),b("google.payments.inapp.getPurchases",function(a){a.method="getPurchases",c(a)}),b("google.payments.inapp.getSkuDetails",function(a){a.method="getSkuDetails",c(a)})}(),!function(a){var b=function(){"use strict";var a="s",c={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3,BASELINE_YEAR:2014,MAX_SCORE:864e6,AMBIGUITIES:{"America/Denver":["America/Mazatlan"],"America/Chicago":["America/Mexico_City"],"America/Santiago":["America/Asuncion","America/Campo_Grande"],"America/Montevideo":["America/Sao_Paulo"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Europe/Helsinki","Asia/Damascus","Africa/Cairo","Asia/Gaza","Europe/Minsk"],"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk","Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]}},d=function(a){var b=-a.getTimezoneOffset();return null!==b?b:0},e=function(){var b=d(new Date(c.BASELINE_YEAR,0,2)),e=d(new Date(c.BASELINE_YEAR,5,2)),f=b-e;return 0>f?b+",1":f>0?e+",1,"+a:b+",0"},f=function(){if("undefined"!=typeof Intl&&"undefined"!=typeof Intl.DateTimeFormat){var a=Intl.DateTimeFormat();if("undefined"!=typeof a&&"undefined"!=typeof a.resolvedOptions)return a.resolvedOptions().timeZone}},g=function(a){for(var b=new Date(a,0,1,0,0,1,0).getTime(),c=new Date(a,12,31,23,59,59).getTime(),d=b,e=new Date(d).getTimezoneOffset(),f=null,g=null;c-864e5>d;){var i=new Date(d),j=i.getTimezoneOffset();j!==e&&(e>j&&(f=i),j>e&&(g=i),e=j),d+=864e5}return f&&g?{s:h(f).getTime(),e:h(g).getTime()}:!1},h=function m(a,b,d){"undefined"==typeof b&&(b=c.DAY,d=c.HOUR);for(var e=new Date(a.getTime()-b).getTime(),f=a.getTime()+b,g=new Date(e).getTimezoneOffset(),h=e,i=null;f-d>h;){var j=new Date(h),k=j.getTimezoneOffset();if(k!==g){i=j;break}h+=d}return b===c.DAY?m(i,c.HOUR,c.MINUTE):b===c.HOUR?m(i,c.MINUTE,c.SECOND):i},i=function(a,b,c,d){if("N/A"!==c)return c;if("Asia/Beirut"===b){if("Africa/Cairo"===d.name&&13983768e5===a[6].s&&14116788e5===a[6].e)return 0;if("Asia/Jerusalem"===d.name&&13959648e5===a[6].s&&14118588e5===a[6].e)return 0}else if("America/Santiago"===b){if("America/Asuncion"===d.name&&14124816e5===a[6].s&&1397358e6===a[6].e)return 0;if("America/Campo_Grande"===d.name&&14136912e5===a[6].s&&13925196e5===a[6].e)return 0}else if("America/Montevideo"===b){if("America/Sao_Paulo"===d.name&&14136876e5===a[6].s&&1392516e6===a[6].e)return 0}else if("Pacific/Auckland"===b&&"Pacific/Fiji"===d.name&&14142456e5===a[6].s&&13961016e5===a[6].e)return 0;return c},j=function(a,d){for(var e=function(b){for(var e=0,f=0;f<a.length;f++)if(b.rules[f]&&a[f]){if(!(a[f].s>=b.rules[f].s&&a[f].e<=b.rules[f].e)){e="N/A";break}if(e=0,e+=Math.abs(a[f].s-b.rules[f].s),e+=Math.abs(b.rules[f].e-a[f].e),e>c.MAX_SCORE){e="N/A";break}}return e=i(a,d,e,b)},f={},g=b.olson.dst_rules.zones,h=g.length,j=c.AMBIGUITIES[d],k=0;h>k;k++){var l=g[k],m=e(g[k]);"N/A"!==m&&(f[l.name]=m)}for(var n in f)if(f.hasOwnProperty(n)&&-1!=j.indexOf(n))return n;return d},k=function(a){var c=function(){for(var a=[],c=0;c<b.olson.dst_rules.years.length;c++){var d=g(b.olson.dst_rules.years[c]);a.push(d)}return a},d=function(a){for(var b=0;b<a.length;b++)if(a[b]!==!1)return!0;return!1},e=c(),f=d(e);return f?j(e,a):a},l=function(){var a=f();return a||(a=b.olson.timezones[e()],"undefined"!=typeof c.AMBIGUITIES[a]&&(a=k(a))),{name:function(){return a}}};return{determine:l}}();b.olson=b.olson||{},b.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Santiago","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},b.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572e5,s:12090744e5},{e:1250802e6,s:1240524e6},{e:12858804e5,s:12840696e5},!1,!1,!1,{e:14116788e5,s:1406844e6}]},{name:"America/Asuncion",rules:[{e:12050316e5,s:12243888e5},{e:12364812e5,s:12558384e5},{e:12709548e5,s:12860784e5},{e:13024044e5,s:1317528e6},{e:1333854e6,s:13495824e5},{e:1364094e6,s:1381032e6},{e:13955436e5,s:14124816e5}]},{name:"America/Campo_Grande",rules:[{e:12032172e5,s:12243888e5},{e:12346668e5,s:12558384e5},{e:12667212e5,s:1287288e6},{e:12981708e5,s:13187376e5},{e:13302252e5,s:1350792e6},{e:136107e7,s:13822416e5},{e:13925196e5,s:14136912e5}]},{name:"America/Goose_Bay",rules:[{e:122559486e4,s:120503526e4},{e:125704446e4,s:123648486e4},{e:128909886e4,s:126853926e4},{e:13205556e5,s:129998886e4},{e:13520052e5,s:13314456e5},{e:13834548e5,s:13628952e5},{e:14149044e5,s:13943448e5}]},{name:"America/Havana",rules:[{e:12249972e5,s:12056436e5},{e:12564468e5,s:12364884e5},{e:12885012e5,s:12685428e5},{e:13211604e5,s:13005972e5},{e:13520052e5,s:13332564e5},{e:13834548e5,s:13628916e5},{e:14149044e5,s:13943412e5}]},{name:"America/Mazatlan",rules:[{e:1225008e6,s:12074724e5},{e:12564576e5,s:1238922e6},{e:1288512e6,s:12703716e5},{e:13199616e5,s:13018212e5},{e:13514112e5,s:13332708e5},{e:13828608e5,s:13653252e5},{e:14143104e5,s:13967748e5}]},{name:"America/Mexico_City",rules:[{e:12250044e5,s:12074688e5},{e:1256454e6,s:12389184e5},{e:12885084e5,s:1270368e6},{e:1319958e6,s:13018176e5},{e:13514076e5,s:13332672e5},{e:13828572e5,s:13653216e5},{e:14143068e5,s:13967712e5}]},{name:"America/Miquelon",rules:[{e:12255984e5,s:12050388e5},{e:1257048e6,s:12364884e5},{e:12891024e5,s:12685428e5},{e:1320552e6,s:12999924e5},{e:13520016e5,s:1331442e6},{e:13834512e5,s:13628916e5},{e:14149008e5,s:13943412e5}]},{name:"America/Santa_Isabel",rules:[{e:12250116e5,s:1207476e6},{e:12564612e5,s:12389256e5},{e:12885156e5,s:12703752e5},{e:13199652e5,s:13018248e5},{e:13514148e5,s:13332744e5},{e:13828644e5,s:13653288e5},{e:1414314e6,s:13967784e5}]},{name:"America/Sao_Paulo",rules:[{e:12032136e5,s:12243852e5},{e:12346632e5,s:12558348e5},{e:12667176e5,s:12872844e5},{e:12981672e5,s:1318734e6},{e:13302216e5,s:13507884e5},{e:13610664e5,s:1382238e6},{e:1392516e6,s:14136876e5}]},{name:"Asia/Amman",rules:[{e:1225404e6,s:12066552e5},{e:12568536e5,s:12381048e5},{e:12883032e5,s:12695544e5},{e:13197528e5,s:13016088e5},!1,!1,{e:14147064e5,s:13959576e5}]},{name:"Asia/Damascus",rules:[{e:12254868e5,s:120726e7},{e:125685e7,s:12381048e5},{e:12882996e5,s:12701592e5},{e:13197492e5,s:13016088e5},{e:13511988e5,s:13330584e5},{e:13826484e5,s:1364508e6},{e:14147028e5,s:13959576e5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572e5,s:12066552e5},{e:12520152e5,s:12381048e5},{e:1281474e6,s:126964086e4},{e:1312146e6,s:130160886e4},{e:13481784e5,s:13330584e5},{e:13802292e5,s:1364508e6},{e:14116788e5,s:13959576e5}]},{name:"Asia/Irkutsk",rules:[{e:12249576e5,s:12068136e5},{e:12564072e5,s:12382632e5},{e:12884616e5,s:12697128e5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612e5,s:12066624e5},{e:1254006e6,s:1238112e6},{e:1284246e6,s:12695616e5},{e:131751e7,s:1301616e6},{e:13483548e5,s:13330656e5},{e:13828284e5,s:13645152e5},{e:1414278e6,s:13959648e5}]},{name:"Asia/Kamchatka",rules:[{e:12249432e5,s:12067992e5},{e:12563928e5,s:12382488e5},{e:12884508e5,s:12696984e5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612e5,s:12068172e5},{e:12564108e5,s:12382668e5},{e:12884652e5,s:12697164e5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648e5,s:12068208e5},{e:12564144e5,s:12382704e5},{e:12884688e5,s:126972e7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504e5,s:12068064e5},{e:12564e8,s:1238256e6},{e:12884544e5,s:12697056e5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954e6,s:120681e7},{e:12564036e5,s:12382596e5},{e:1288458e6,s:12697092e5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684e5,s:12068244e5},{e:1256418e6,s:1238274e6},{e:12884724e5,s:12697236e5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972e6,s:1206828e6},{e:12564216e5,s:12382776e5},{e:1288476e6,s:12697272e5},{e:13199256e5,s:13011768e5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076e5,s:12231342e5},{e:12388572e5,s:12545838e5},{e:12703068e5,s:12860334e5},{e:13017564e5,s:1317483e6},{e:1333206e6,s:13495374e5},{e:13652604e5,s:1380987e6},{e:139671e7,s:14124366e5}]},{name:"Australia/Perth",rules:[{e:12068136e5,s:12249576e5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]},{name:"Europe/Minsk",rules:[{e:12249792e5,s:12068352e5},{e:12564288e5,s:12382848e5},{e:12884832e5,s:12697344e5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756e5,s:12068316e5},{e:12564252e5,s:12382812e5},{e:12884796e5,s:12697308e5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528e5,s:13168728e5},{e:13332024e5,s:13489272e5},{e:13652568e5,s:13803768e5},{e:13967064e5,s:14118264e5}]},{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984e5,s:12878424e5},{e:13271544e5,s:1319292e6},{e:1358604e6,s:13507416e5},{e:139005e7,s:1382796e6},{e:14215032e5,s:14148504e5}]}]},"undefined"!=typeof exports?exports.jstz=b:a.jstz=b}(this),function(a){"use strict";angular.module("tmh.dynamicLocale",[]).config(["$provide",function(a){function b(a){return a.$stateful=!0,a}a.decorator("dateFilter",["$delegate",b]),a.decorator("numberFilter",["$delegate",b]),a.decorator("currencyFilter",["$delegate",b])}]).constant("tmhDynamicLocale.STORAGE_KEY","tmhDynamicLocale.locale").provider("tmhDynamicLocale",["tmhDynamicLocale.STORAGE_KEY",function(a){function b(a,b,c,d){var e=document.createElement("script"),f=document.getElementsByTagName("body")[0],g=!1;e.type="text/javascript",e.readyState?e.onreadystatechange=function(){("complete"===e.readyState||"loaded"===e.readyState)&&(e.onreadystatechange=null,d(function(){g||(g=!0,f.removeChild(e),b())},30,!1))}:(e.onload=function(){g||(g=!0,f.removeChild(e),b())},e.onerror=function(){g||(g=!0,f.removeChild(e),c())}),e.src=a,e.async=!1,f.appendChild(e)}function c(a,c,d,g,h,k,l){function m(a,b){f===d&&(angular.forEach(a,function(c,d){b[d]?angular.isArray(b[d])&&(a[d].length=b[d].length):delete a[d]}),angular.forEach(b,function(c,d){angular.isArray(b[d])||angular.isObject(b[d])?(a[d]||(a[d]=angular.isArray(b[d])?[]:{}),m(a[d],b[d])):a[d]=b[d]}))}if(j[d])return j[d];var n,o=h.defer();return d===f?o.resolve(c):(n=k.get(d))?(f=d,g.$evalAsync(function(){m(c,n),g.$broadcast("$localeChangeSuccess",d,c),e.put(i,d),o.resolve(c)})):(f=d,j[d]=o.promise,b(a,function(){var a=angular.injector(["ngLocale"]),b=a.get("$locale");m(c,b),k.put(d,b),delete j[d],g.$apply(function(){g.$broadcast("$localeChangeSuccess",d,c),e.put(i,d),o.resolve(c)})},function(){delete j[d],g.$apply(function(){f===d&&(f=c.id),g.$broadcast("$localeChangeError",d),o.reject(d)})},l)),o.promise}var d,e,f,g="js/i18n/angular-locale_{{locale}}.js",h="tmhDynamicLocaleStorageCache",i=a,j={};this.localeLocationPattern=function(a){return a?(g=a,this):g},this.useStorage=function(a){h=a},this.useCookieStorage=function(){this.useStorage("$cookieStore")},this.defaultLocale=function(a){d=a},this.storageKey=function(a){return a?(i=a,this):i},this.$get=["$rootScope","$injector","$interpolate","$locale","$q","tmhDynamicLocaleCache","$timeout",function(a,b,j,k,l,m,n){var o=j(g);return e=b.get(h),a.$evalAsync(function(){var b;(b=e.get(i)||d)&&c(o({locale:b}),k,b,a,l,m,n)}),{set:function(b){return c(o({locale:b}),k,b,a,l,m,n)},get:function(){return f}}}]}]).provider("tmhDynamicLocaleCache",function(){this.$get=["$cacheFactory",function(a){return a("tmh.dynamicLocales")}]}).provider("tmhDynamicLocaleStorageCache",function(){this.$get=["$cacheFactory",function(a){return a("tmh.dynamicLocales.store")}]}).run(["tmhDynamicLocale",angular.noop])}(window),function(){"use strict";function a(a){return a=String(a),a.charAt(0).toUpperCase()+a.slice(1)}function b(a,b,c){var e={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return b&&c&&/^Win/i.test(a)&&!/^Windows Phone /i.test(a)&&(e=e[/[\d.]+$/.exec(a)])&&(a="Windows "+e),a=String(a),b&&c&&(a=a.replace(RegExp(b,"i"),c)),a=d(a.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function c(a,b){var c=-1,d=a?a.length:0;if("number"==typeof d&&d>-1&&q>=d)for(;++c<d;)b(a[c],c,a);else e(a,b)}function d(b){return b=j(b),/^(?:webOS|i(?:OS|P))/.test(b)?b:a(b)}function e(a,b){for(var c in a)t.call(a,c)&&b(a[c],c,a)}function f(b){return null==b?a(b):u.call(b).slice(8,-1)}function g(a,b){var c=null!=a?typeof a[b]:"number";return!/^(?:boolean|number|string|undefined)$/.test(c)&&("object"==c?!!a[b]:!0)}function h(a){return String(a).replace(/([ -])(?!$)/g,"$1?")}function i(a,b){var d=null;return c(a,function(c,e){d=b(d,c,e,a)}),d}function j(a){return String(a).replace(/^ +| +$/g,"")}function k(a){function c(b){return i(b,function(b,c){return b||RegExp("\\b"+(c.pattern||h(c))+"\\b","i").exec(a)&&(c.label||c)})}function l(b){return i(b,function(b,c,d){return b||(c[U]||c[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+h(d)+"(?:\\b|\\w*\\d)","i").exec(a))&&d;
})}function n(b){return i(b,function(b,c){return b||RegExp("\\b"+(c.pattern||h(c))+"\\b","i").exec(a)&&(c.label||c)})}function o(c){return i(c,function(c,d){var e=d.pattern||h(d);return!c&&(c=RegExp("\\b"+e+"(?:/[\\d.]+|[ \\w.]*)","i").exec(a))&&(c=b(c,e,d.label||d)),c})}function p(b){return i(b,function(b,c){var e=c.pattern||h(c);return!b&&(b=RegExp("\\b"+e+" *\\d+[.\\w_]*","i").exec(a)||RegExp("\\b"+e+" *\\w+-[\\w]*","i").exec(a)||RegExp("\\b"+e+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(a))&&((b=String(c.label&&!RegExp(e,"i").test(c.label)?c.label:b).split("/"))[1]&&!/[\d.]+/.test(b[0])&&(b[0]+=" "+b[1]),c=c.label||c,b=d(b[0].replace(RegExp(e,"i"),c).replace(RegExp("; *(?:"+c+"[_-])?","i")," ").replace(RegExp("("+c+")[-_.]?(\\w)","i"),"$1 $2"))),b})}function q(b){return i(b,function(b,c){return b||(RegExp(c+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(a)||0)[1]||null})}function s(){return this.description||""}var t=m,v=a&&"object"==typeof a&&"String"!=f(a);v&&(t=a,a=null);var w=t.navigator||{},x=w.userAgent||"";a||(a=x);var y,z,A=v?!!w.likeChrome:/\bChrome\b/.test(a)&&!/internal|\n/i.test(u.toString()),B="Object",C=v?B:"ScriptBridgingProxyObject",D=v?B:"Environment",E=v&&t.java?"JavaPackage":f(t.java),F=v?B:"RuntimeObject",G=/\bJava/.test(E)&&t.java,H=G&&f(t.environment)==D,I=G?"a":"α",J=G?"b":"β",K=t.document||{},L=t.operamini||t.opera,M=r.test(M=v&&L?L["[[Class]]"]:f(L))?M:L=null,N=a,O=[],P=null,Q=a==x,R=Q&&L&&"function"==typeof L.version&&L.version(),S=c([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),T=n(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),U=p([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),V=l({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),W=o(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(S&&(S=[S]),V&&!U&&(U=p([V])),(y=/\bGoogle TV\b/.exec(U))&&(U=y[0]),/\bSimulator\b/i.test(a)&&(U=(U?U+" ":"")+"Simulator"),"Opera Mini"==T&&/\bOPiOS\b/.test(a)&&O.push("running in Turbo/Uncompressed mode"),"IE"==T&&/\blike iPhone OS\b/.test(a)?(y=k(a.replace(/like iPhone OS/,"")),V=y.manufacturer,U=y.product):/^iP/.test(U)?(T||(T="Safari"),W="iOS"+((y=/ OS ([\d_]+)/i.exec(a))?" "+y[1].replace(/_/g,"."):"")):"Konqueror"!=T||/buntu/i.test(W)?V&&"Google"!=V&&(/Chrome/.test(T)&&!/\bMobile Safari\b/i.test(a)||/\bVita\b/.test(U))||/\bAndroid\b/.test(W)&&/^Chrome/.test(T)&&/\bVersion\//i.test(a)?(T="Android Browser",W=/\bAndroid\b/.test(W)?W:"Android"):"Silk"==T?(/\bMobi/i.test(a)||(W="Android",O.unshift("desktop mode")),/Accelerated *= *true/i.test(a)&&O.unshift("accelerated")):"PaleMoon"==T&&(y=/\bFirefox\/([\d.]+)\b/.exec(a))?O.push("identifying as Firefox "+y[1]):"Firefox"==T&&(y=/\b(Mobile|Tablet|TV)\b/i.exec(a))?(W||(W="Firefox OS"),U||(U=y[1])):!T||(y=!/\bMinefield\b/i.test(a)&&/\b(?:Firefox|Safari)\b/.exec(T))?(T&&!U&&/[\/,]|^[^(]+?\)/.test(a.slice(a.indexOf(y+"/")+8))&&(T=null),(y=U||V||W)&&(U||V||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(W))&&(T=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(W)?W:y)+" Browser")):"Electron"==T&&(y=(/\bChrome\/([\d.]+)\b/.exec(a)||0)[1])&&O.push("Chromium "+y):W="Kubuntu",R||(R=q(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",h(T),"(?:Firefox|Minefield|NetFront)"])),(y="iCab"==S&&parseFloat(R)>3&&"WebKit"||/\bOpera\b/.test(T)&&(/\bOPR\b/.test(a)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(a)&&!/^(?:Trident|EdgeHTML)$/.test(S)&&"WebKit"||!S&&/\bMSIE\b/i.test(a)&&("Mac OS"==W?"Tasman":"Trident")||"WebKit"==S&&/\bPlayStation\b(?! Vita\b)/i.test(T)&&"NetFront")&&(S=[y]),"IE"==T&&(y=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(a)||0)[1])?(T+=" Mobile",W="Windows Phone "+(/\+$/.test(y)?y:y+".x"),O.unshift("desktop mode")):/\bWPDesktop\b/i.test(a)?(T="IE Mobile",W="Windows Phone 8.x",O.unshift("desktop mode"),R||(R=(/\brv:([\d.]+)/.exec(a)||0)[1])):"IE"!=T&&"Trident"==S&&(y=/\brv:([\d.]+)/.exec(a))&&(T&&O.push("identifying as "+T+(R?" "+R:"")),T="IE",R=y[1]),Q){if(g(t,"global"))if(G&&(y=G.lang.System,N=y.getProperty("os.arch"),W=W||y.getProperty("os.name")+" "+y.getProperty("os.version")),H){try{R=t.require("ringo/engine").version.join("."),T="RingoJS"}catch(X){(y=t.system)&&y.global.system==t.system&&(T="Narwhal",W||(W=y[0].os||null))}T||(T="Rhino")}else"object"==typeof t.process&&!t.process.browser&&(y=t.process)&&("object"==typeof y.versions&&("string"==typeof y.versions.electron?(O.push("Node "+y.versions.node),T="Electron",R=y.versions.electron):"string"==typeof y.versions.nw&&(O.push("Chromium "+R,"Node "+y.versions.node),T="NW.js",R=y.versions.nw)),T||(T="Node.js",N=y.arch,W=y.platform,R=/[\d.]+/.exec(y.version),R=R?R[0]:null));else f(y=t.runtime)==C?(T="Adobe AIR",W=y.flash.system.Capabilities.os):f(y=t.phantom)==F?(T="PhantomJS",R=(y=y.version||null)&&y.major+"."+y.minor+"."+y.patch):"number"==typeof K.documentMode&&(y=/\bTrident\/(\d+)/i.exec(a))?(R=[R,K.documentMode],(y=+y[1]+4)!=R[1]&&(O.push("IE "+R[1]+" mode"),S&&(S[1]=""),R[1]=y),R="IE"==T?String(R[1].toFixed(1)):R[0]):"number"==typeof K.documentMode&&/^(?:Chrome|Firefox)\b/.test(T)&&(O.push("masking as "+T+" "+R),T="IE",R="11.0",S=["Trident"],W="Windows");W=W&&d(W)}if(R&&(y=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(R)||/(?:alpha|beta)(?: ?\d)?/i.exec(a+";"+(Q&&w.appMinorVersion))||/\bMinefield\b/i.test(a)&&"a")&&(P=/b/i.test(y)?"beta":"alpha",R=R.replace(RegExp(y+"\\+?$"),"")+("beta"==P?J:I)+(/\d+\+?/.exec(y)||"")),"Fennec"==T||"Firefox"==T&&/\b(?:Android|Firefox OS)\b/.test(W))T="Firefox Mobile";else if("Maxthon"==T&&R)R=R.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(W=null),"Xbox 360"==U&&/\bIEMobile\b/.test(a)&&O.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(T)&&(!T||U||/Browser|Mobi/.test(T))||"Windows CE"!=W&&!/Mobi/i.test(a))if("IE"==T&&Q)try{null===t.external&&O.unshift("platform preview")}catch(X){O.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(a))&&(y=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(a)||0)[1]||R)?(y=[y,/BB10/.test(a)],W=(y[1]?(U=null,V="BlackBerry"):"Device Software")+" "+y[0],R=null):this!=e&&"Wii"!=U&&(Q&&L||/Opera/.test(T)&&/\b(?:MSIE|Firefox)\b/i.test(a)||"Firefox"==T&&/\bOS X (?:\d+\.){2,}/.test(W)||"IE"==T&&(W&&!/^Win/.test(W)&&R>5.5||/\bWindows XP\b/.test(W)&&R>8||8==R&&!/\bTrident\b/.test(a)))&&!r.test(y=k.call(e,a.replace(r,"")+";"))&&y.name&&(y="ing as "+y.name+((y=y.version)?" "+y:""),r.test(T)?(/\bIE\b/.test(y)&&"Mac OS"==W&&(W=null),y="identify"+y):(y="mask"+y,T=M?d(M.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(y)&&(W=null),Q||(R=null)),S=["Presto"],O.push(y));else T+=" Mobile";(y=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(a)||0)[1])&&(y=[parseFloat(y.replace(/\.(\d)$/,".0$1")),y],"Safari"==T&&"+"==y[1].slice(-1)?(T="WebKit Nightly",P="alpha",R=y[1].slice(0,-1)):(R==y[1]||R==(y[2]=(/\bSafari\/([\d.]+\+?)/i.exec(a)||0)[1]))&&(R=null),y[1]=(/\bChrome\/([\d.]+)/i.exec(a)||0)[1],537.36==y[0]&&537.36==y[2]&&parseFloat(y[1])>=28&&"WebKit"==S&&(S=["Blink"]),Q&&(A||y[1])?(S&&(S[1]="like Chrome"),y=y[1]||(y=y[0],530>y?1:532>y?2:532.05>y?3:533>y?4:534.03>y?5:534.07>y?6:534.1>y?7:534.13>y?8:534.16>y?9:534.24>y?10:534.3>y?11:535.01>y?12:535.02>y?"13+":535.07>y?15:535.11>y?16:535.19>y?17:536.05>y?18:536.1>y?19:537.01>y?20:537.11>y?"21+":537.13>y?23:537.18>y?24:537.24>y?25:537.36>y?26:"Blink"!=S?"27":"28")):(S&&(S[1]="like Safari"),y=y[0],y=400>y?1:500>y?2:526>y?3:533>y?4:534>y?"4+":535>y?5:537>y?6:538>y?7:601>y?8:"8"),S&&(S[1]+=" "+(y+="number"==typeof y?".x":/[.+]/.test(y)?"":"+")),"Safari"==T&&(!R||parseInt(R)>45)&&(R=y)),"Opera"==T&&(y=/\bzbov|zvav$/.exec(W))?(T+=" ",O.unshift("desktop mode"),"zvav"==y?(T+="Mini",R=null):T+="Mobile",W=W.replace(RegExp(" *"+y+"$"),"")):"Safari"==T&&/\bChrome\b/.exec(S&&S[1])&&(O.unshift("desktop mode"),T="Chrome Mobile",R=null,/\bOS X\b/.test(W)?(V="Apple",W="iOS 4.3+"):W=null),R&&0==R.indexOf(y=/[\d.]+$/.exec(W))&&a.indexOf("/"+y+"-")>-1&&(W=j(W.replace(y,""))),S&&!/\b(?:Avant|Nook)\b/.test(T)&&(/Browser|Lunascape|Maxthon/.test(T)||"Safari"!=T&&/^iOS/.test(W)&&/\bSafari\b/.test(S[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(T)&&S[1])&&(y=S[S.length-1])&&O.push(y),O.length&&(O=["("+O.join("; ")+")"]),V&&U&&U.indexOf(V)<0&&O.push("on "+V),U&&O.push((/^on /.test(O[O.length-1])?"":"on ")+U),W&&(y=/ ([\d.+]+)$/.exec(W),z=y&&"/"==W.charAt(W.length-y[0].length-1),W={architecture:32,family:y&&!z?W.replace(y[0],""):W,version:y?y[1]:null,toString:function(){var a=this.version;return this.family+(a&&!z?" "+a:"")+(64==this.architecture?" 64-bit":"")}}),(y=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(N))&&!/\bi686\b/i.test(N)?(W&&(W.architecture=64,W.family=W.family.replace(RegExp(" *"+y),"")),T&&(/\bWOW64\b/i.test(a)||Q&&/\w(?:86|32)$/.test(w.cpuClass||w.platform)&&!/\bWin64; x64\b/i.test(a))&&O.unshift("32-bit")):W&&/^OS X/.test(W.family)&&"Chrome"==T&&parseFloat(R)>=39&&(W.architecture=64),a||(a=null);var Y={};return Y.description=a,Y.layout=S&&S[0],Y.manufacturer=V,Y.name=T,Y.prerelease=P,Y.product=U,Y.ua=a,Y.version=T&&R,Y.os=W||{architecture:null,family:null,version:null,toString:function(){return"null"}},Y.parse=k,Y.toString=s,Y.version&&O.unshift(R),Y.name&&O.unshift(T),W&&T&&(W!=String(W).split(" ")[0]||W!=T.split(" ")[0]&&!U)&&O.push(U?"("+W+")":"on "+W),O.length&&(Y.description=O.join(" ")),Y}var l={"function":!0,object:!0},m=l[typeof window]&&window||this,n=l[typeof exports]&&exports,o=l[typeof module]&&module&&!module.nodeType&&module,p=n&&o&&"object"==typeof global&&global;!p||p.global!==p&&p.window!==p&&p.self!==p||(m=p);var q=Math.pow(2,53)-1,r=/\bOpera/,s=Object.prototype,t=s.hasOwnProperty,u=s.toString,v=k();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(m.platform=v,define(function(){return v})):n&&o?e(v,function(a,b){n[b]=a}):m.platform=v}.call(this);var j={platform:"Chrome",av:"4.3.28",z:7,i:"zy3yu2454Pv",x:"Fb9QK2m38nF8fz4R92Kc6XU63w2GV8Aq",aurl:"https://sync.myhomeworkapp.com/",wurl:"https://myhomeworkapp.com/",isChromeApp:!0,isDebug:!1,isTestKioskMode:!1,analyticsID:"UA-59805419-6",cloudfrontURL:"https://d1z4qtc4rchejh.cloudfront.net/"},l=new Nedb({filename:"syncdb",autoload:!0}),m=function(){function a(a,b,c){return new Promise(function(d,e){var f={t:b,o:a,usrid:c,date:J.formatISO8601(new Date,3)};l.insert(f,function(a,b){return a?void e(a):void d()})})}function b(a){return new Promise(function(b,c){l.find({usrid:a}).sort({date:1}).exec(function(a,d){return a?void c(a):void b(d&&d.length?d:[])})})}function c(a){return new Promise(function(b,c){l.remove({_id:{$in:a}},{multi:!0},function(a,c){a&&J.logError(a),b()})})}function d(){return new Promise(function(a,b){l.find().sort({date:1}).exec(function(b,c){return b?void a(!1):void a(c&&c.length?!0:!1)})})}return{add:function(b,c,d){return a(b,c,d)},getChanges:function(a){return b(a)},clearChanges:function(a){return c(a)},hasChanges:function(){return d()}}}(),n=new Nedb({filename:"hwdb",autoload:!0}),o=function(){function a(a,b){var c={};return a&&b?c={i:a,usrid:b}:b&&(c={usrid:b}),new Promise(function(a,b){n.find(c,function(c,d){return c?void b(c):void a(d)})})}function b(a){return new Promise(function(b,c){n.find({_id:a},function(a,d){return a?void c(a):void b(d)})})}function c(){return new Promise(function(a,b){var c=new Date,d=J.formatISO8601(c,1),e=J.addDaysToDate(c,30),f=J.formatISO8601(e,1);n.find({$or:[{$and:[{rm:{$exists:!0}},{d:{$gte:d}},{d:{$lte:f}}]},{$and:[{rm:{$exists:!0}},{rpt:{$exists:!0}},{rpt:{$ne:null}}]}]},function(c,d){return c?void b(c):void a(d)})})}function d(a,b,c){return new Promise(function(d,e){var f=a.i||null;f||e("ensure homework requires id"),a.usrid=b,n.update({i:f,usrid:b},a,{upsert:!0,multi:!1},function(f,g,h){return f?void e(f):(b&&c&&(delete a.usrid,a.f?m.add({i:a.i,s:a.s,q:a.q||null,rm:a.rm||null,n:a.n||null,rpt:a.rpt||null,u:a.u||J.formatISO8601(new Date,3),k:a.k},10,b):m.add(a,h?2:7,b)),void d(h))})})}function e(a,c,d){var e={u:J.formatISO8601(new Date,3),s:c?2:1,z:j.z};return new Promise(function(f,g){n.update({_id:a},{$set:e},{},function(e,h,i){return e?void g(e):void(d?b(a).then(function(a){if(a.length&&a[0].usrid){var b=a[0],d=b.usrid;delete b.usrid,b.f?m.add({i:b.i,s:b.s,q:b.q||null,rm:b.rm||null,n:b.n||null,rpt:b.rpt||null,u:J.formatISO8601(new Date,3),k:b.k},10,d):(b.u=J.formatISO8601(new Date,3),b.z=j.z,b.s=c?2:1,m.add(b,7,d))}f(h)},function(a){J.logError(a),f(h)}):f(h))})})}function f(a,c,d,e){return new Promise(function(f,g){b(a).then(function(b){if(b.length&&b[0].usrid){var h=b[0],i={u:J.formatISO8601(new Date,3),z:j.z},k=h.rpt,l=k.cd?k.cd:[];E(c,function(a){var b=K.dateFromDateFormat(a),c=J.formatISO8601(b,1);d?l.indexOf(c)<0&&l.push(c):(l.indexOf(c)>=0&&l.splice(l.indexOf(c),1),i.s=1)}),k.cd=l,h.rpt=k,i.rpt=k,n.update({_id:a},{$set:i},{},function(a,b,c){if(a)return void g(a);if(e){var d=h.usrid;delete h.usrid,h.f?m.add({i:h.i,s:h.s,q:h.q||null,rm:h.rm||null,n:h.n||null,rpt:h.rpt||null,u:J.formatISO8601(new Date,3),k:h.k},10,d):(h.u=J.formatISO8601(new Date,3),h.z=j.z,m.add(h,7,d)),f(b)}else f(b)})}})})}function g(a,b,c){var d={u:J.formatISO8601(new Date,3),s:2,z:j.z};return new Promise(function(e,f){n.update({usrid:b,i:{$in:a}},{$set:d},{multi:!0},function(d,g){return d?void f(d):(b&&c&&E(a,function(a){n.find({i:a,usrid:b},function(a,c){if(!a&&c&&c.length){var d=c[0];delete d.usrid,d.f?m.add({i:d.i,s:d.s,q:d.q||null,rm:d.rm||null,n:d.n||null,rpt:d.rpt||null,u:J.formatISO8601(new Date,3),k:d.k},10,b):(d.u=J.formatISO8601(new Date,3),d.z=j.z,d.s=2,m.add(d,7,b))}})}),void e(g))})})}function h(a,b,c){return new Promise(function(d,e){n.update({usrid:b,i:a},{$set:c},{multi:!0},function(a,b){return a?void e(a):void d(b)})})}function i(a){return new Promise(function(b,c){var d=[];n.find({usrid:null},function(a,b){a||E(b,function(a){d.push(a)})});var e={u:J.formatISO8601(new Date,3),z:j.z,usrid:a};n.update({usrid:null},{$set:e},{multi:!0},function(e,f){return e?void c(e):(E(d,function(b){b.u=J.formatISO8601(new Date,3),b.z=j.z,delete b.usrid,m.add(b,2,a)}),void b(f))})})}function k(a,c,d){return new Promise(function(e,f){if(!a)return void f("dbHwID is required");var g={u:J.formatISO8601(new Date,3),z:j.z};if(c&&c.length>0){var h=new Array;for(var i in c){var k=Y.toDBFile(c[i]);k&&h.push(k)}g.fi=h.length>0?h:null}else g.fi=null;n.update({_id:a},{$set:g},{multi:!1},function(c,g,h){return c?void f(c):void(d?b(a).then(function(a){if(a.length&&a[0].usrid){var b=a[0],c=b.usrid;delete b.usrid,m.add(b,7,c)}e(h)},function(a){J.logError(a),e(h)}):e(h))})})}function l(a,c,d){return new Promise(function(e,f){b(a).then(function(b){if(b.length){var g=b[0],h={u:J.formatISO8601(new Date,3),z:j.z},i=g.rpt,k=i.ed?i.ed:[];E(c,function(a){var b=K.dateFromDateFormat(a),c=J.formatISO8601(b,1);k.indexOf(c)<0&&k.push(c)}),i.ed=k,g.rpt=i,h.rpt=i,n.update({_id:a},{$set:h},{},function(a,b,c){if(a)return void f(a);if(d&&g.usrid){var h=g.usrid;delete g.usrid,g.u=J.formatISO8601(new Date,3),g.z=j.z,m.add(g,7,h),e(b)}else e(b)})}})})}function o(a,b,c){if(a){var d={i:a};return b&&(d={i:a,usrid:b}),new Promise(function(e,f){n.remove(d,{},function(d,g){return d?void f(d):(c&&b&&m.add({i:a},4,b),void e(g))})})}}function p(a,b,c){return new Promise(function(d,e){var f={i:{$in:a}};b&&(f={usrid:b,i:{$in:a}}),n.remove(f,{multi:!0},function(f,g){return f?void e(f):(c&&b&&E(a,function(a){m.add({i:a},4,b)}),void d(g))})})}function q(a,b,c){return new Promise(function(d,e){var f={k:a};b&&(f={usrid:b,k:a});var g=[];b&&c&&n.find(f,function(a,b){b&&b.length&&E(b,function(a){g.push(a.i)})}),n.remove(f,{multi:!0},function(a,f){return a?void e(a):(b&&c&&g.length&&E(g,function(a){m.add({i:a},4,b)}),void d(f))})})}function r(a,b){return new Promise(function(c,d){var e={};a&&(e={usrid:a});var f=[];a&&b&&n.find({usrid:a,$or:[{f:{$exists:!1}},{f:null}]},function(a,b){b&&b.length&&E(b,function(a){f.push(a.i)})}),n.remove(e,{multi:!0},function(e,g){return e?void d(e):(a&&b&&f.length&&E(f,function(b){m.add({i:b},4,a)}),void c(g))})})}return{getHw:function(b,c){return a(b,c)},getHws:function(b){return a(null,b)},getHwWithDbId:function(a){return b(a)},getHwsWithReminders:function(){return c()},ensureHw:function(a,b,c){return d(a,b,c)},setHomeworkStatus:function(a,b,c){return e(a,b,c)},setRepeatHomeworkStatus:function(a,b,c,d){return f(a,b,c,d)},markHomeworksAsComplete:function(a,b,c){return g(a,b,c)},setTeacherHomeworkChanges:function(a,b,c){return h(a,b,c)},setHomeworkUserID:function(a){return i(a)},updateHomeworkFiles:function(a,b,c){return k(a,b,c)},deleteRepeatingHomeworkDates:function(a,b,c){return l(a,b,c)},deleteHw:function(a,b,c){return o(a,b,c)},deleteHws:function(a,b,c){return p(a,b,c)},deleteClassHws:function(a,b,c){return q(a,b,c)},deleteAllHws:function(a,b){return r(a,b)}}}(),p=new Nedb({filename:"clsdb",autoload:!0}),q=function(){function a(a,b){var c={};return a&&b?c={i:a,usrid:b}:b&&(c={usrid:b}),new Promise(function(a,b){p.find(c,function(c,d){return c?void b(c):void a(d)})})}function b(a,b,c){return new Promise(function(d,e){var f=a.i||null;f||e("ensure class requires id"),a.tchr&&delete a.tchr,a.schl&&delete a.schl,a.usrid=b,p.update({i:f,usrid:b},a,{upsert:!0,multi:!1},function(f,g,h){return f?void e(f):(b&&c&&(a.g?m.add({i:a.i,d:a.u,clr:a.clr||null,w:a.w||null},17,b):(delete a.usrid,m.add(a,h?1:6,b))),void d(h))})})}function c(a){return new Promise(function(b,c){var d=[];p.find({usrid:null},function(a,b){a||E(b,function(a){d.push(a)})});var e={u:J.formatISO8601(new Date,3),z:j.z,usrid:a};p.update({usrid:null},{$set:e},{multi:!0},function(e,f){return e?void c(e):(E(d,function(b){b.u=J.formatISO8601(new Date,3),b.z=j.z,delete b.usrid,m.add(b,1,a)}),void b(f))})})}function d(a,b,c,d){return new Promise(function(e,f){return a?void p.remove({i:a,usrid:b},{},function(g,h){return g?void f(g):(b&&c&&(d?m.add({i:a},3,b):m.add({i:a,d:J.formatISO8601(new Date,3)},9,b)),void e(h))}):void f("clsID can't be null")})}function e(a,b){return new Promise(function(c,d){var e={};a&&(e={usrid:a});var f=[];a&&b&&p.find(e,function(a,b){b&&b.length&&E(b,function(a){f.push({id:a.i,isManual:a.g?!1:!0})})}),p.remove(e,{multi:!0},function(e,g){return e?void d(e):(a&&b&&f.length&&E(f,function(b){b.isManual?m.add({i:b.id},3,a):m.add({i:b.id,d:J.formatISO8601(new Date,3)},9,a)}),void c(g))})})}function f(a,b,c){return new Promise(function(d,e){var f=b.i||null;f||e("update import class requires id");var g=b.imps||[],h=[];g?E(g,function(a){a.i!=c.i?h.push(a):h.push(c)}):h=[c],b.imps=h,b.usrid=a,p.update({i:f,usrid:a},b,{upsert:!0,multi:!1},function(a,c,f){return a?void e(a):void d(b)})})}return{getClass:function(b,c){return a(b,c)},getClasses:function(b){return a(null,b)},ensureClass:function(a,c,d){return b(a,c,d)},setClassUserID:function(a){return c(a)},deleteClass:function(a,b,c,e){return d(a,b,c,e)},deleteClasses:function(a,b){return e(a,b)},updateImport:function(a,b,c){return f(a,b,c)}}}(),r=new Nedb({filename:"anndb",autoload:!0}),u=function(){function a(a,b){var c={};return a&&b?c={i:a,usrid:b}:b&&(c={usrid:b}),new Promise(function(a,b){r.find(c,function(c,d){return c?void b(c):void a(d)})})}function b(a,b){return new Promise(function(c,d){var e=a.i||null;return e?(a.usrid=b,void r.update({i:e,usrid:b},a,{upsert:!0,multi:!1},function(a,b,e){return a?void d(a):void c(e)})):void d("ensure announcement requires id")})}function c(a,b){return new Promise(function(c,d){return a?void r.remove({i:a,usrid:b},{},function(a,b){return a?void d(a):void c(b)}):void d("annID can't be null")})}function d(a,b){return new Promise(function(c,d){var e={};b&&(e={usrid:b}),r.remove({usrid:b,i:{$in:a}},{multi:!0},function(a,b){return a?void d(a):void c(b)})})}function e(a){return new Promise(function(b,c){var d={};a&&(d={usrid:a}),r.remove(d,{multi:!0},function(a,d){return a?void c(a):void b(d)})})}function f(a,b){return new Promise(function(c,d){var e={k:a};b&&(e={usrid:b,k:a}),r.remove(e,{multi:!0},function(a,b){return a?void d(a):void c(b)})})}function g(a,b){return new Promise(function(c,d){return a||0!=a.length?void r.update({usrid:b,i:{$in:a}},{$set:{r:!0}},{multi:!0},function(e,f){return e?void d(e):(b&&E(a,function(a){m.add({i:a},11,b)}),void c(f))}):void d()})}return{getAnnouncement:function(b,c){return a(b,c)},getAnnouncements:function(b){return a(null,b)},ensureAnnouncement:function(a,c){return b(a,c)},deleteAnnouncement:function(a,b){return c(a,b)},deleteAnnouncements:function(a,b){return d(a,b)},deleteUserAnnouncements:function(a){return e(a)},deleteClassAnnouncements:function(a,b){return f(a,b)},markAnnouncementsAsRead:function(a,b){return g(a,b)}}}(),v=new Nedb({filename:"usrdb",autoload:!0}),w=function(){function a(a){return new Promise(function(b,c){v.find(a?{_id:a}:{},function(a,d){return a?void c(a):void b(d)})})}function b(a){return new Promise(function(b,c){if(!a||!a.t)return void c("t is required");if(a.sc&&a.sc.length>0){var d=[];E(a.sc,function(a){d.push(a.s),y.ensureSchool(a)}),a.scg=d,delete a.sc}var e;e=a.id?a.id:a.ui?a.ui:J.simpleID(15);var f={$set:a};a.id||(a._id=e,f=a),v.update({_id:e},f,{upsert:!0,multi:!1},function(a,d,f){return a?void c(a):void b(e)})})}function c(a){return new Promise(function(b,c){var d={};a&&(d={_id:a}),v.remove(d,{multi:!0},function(a,d){return a?void c(a):void b(d)})})}function d(a,b){return new Promise(function(c,d){v.update({_id:a},{$set:b},{},function(b,e,f){return b?void d(b):void c(a)})})}function e(a){return new Promise(function(b,c){v.find({$or:[{u:a},{e:a}]},function(a,c){return a?void b(!1):void b(c&&c.length>0?!0:!1)})})}function f(a,b,c){return new Promise(function(d,e){a?v.update({_id:a},{$set:{s:b}},{},function(f,g,h){return f?void e(f):(c&&m.add(b,8,a),void d(a))}):(D.setLocalItem("nousersettings",b),d())})}function g(a,b){return new Promise(function(c,d){v.update({_id:a},{$set:{scg:b}},{},function(b,e,f){return b?void d(b):void c(a)})})}function h(a,b){return new Promise(function(c,d){v.update({_id:a},{$set:{grds:b}},{},function(b,e,f){return b?void d(b):void c(a)})})}function i(a,b){return new Promise(function(c,d){D.setLocalItem("reloadtheme",!0),v.update({_id:a},{$set:{thm:b}},{},function(b,e,f){return b?void d(b):void c(a)})})}return{getUser:function(b){return a(b)},getUsers:function(){return a()},ensureUser:function(a){return b(a)},removeUser:function(a){return c(a)},hasUserWithUsername:function(a){return e(a)},setUserInfo:function(a,b){return d(a,b)},setUserSettings:function(a,b,c){return f(a,b,c)},setUserSchools:function(a,b){return g(a,b)},setGuardianInfo:function(a,b){return h(a,b)},setUserActiveTheme:function(a,b){return i(a,b)}}}(),x=new Nedb({filename:"schlsdb",autoload:!0}),y=function(){function a(){return new Promise(function(a,b){x.find({},function(c,d){return c?void b(c):void a(d)})})}function b(a){return new Promise(function(b,c){var d=a.s||null;return d?void x.update({s:d},a,{upsert:!0,multi:!1},function(a,d,e){return a?void c(a):void b(e)}):void c("ensure school require slug")})}return{getSchools:function(){return a()},ensureSchool:function(a){return b(a)}}}(),z=new Nedb({filename:"tchrsdb",autoload:!0}),A=function(){function a(){return new Promise(function(a,b){z.find({},function(c,d){return c?void b(c):void a(d)})})}function b(a){return new Promise(function(b,c){var d=a.i||null;return d?void z.update({i:d},a,{upsert:!0,multi:!1},function(a,d,e){return a?void c(a):void b(e)}):void c("ensure teacher requires id")})}return{getTeachers:function(){return a()},ensureTeacher:function(a){return b(a)}}}(),B=new Nedb({filename:"eventsdb",autoload:!0}),C=function(){function a(a,b){var c={};return a&&b?c={i:a,usrid:b}:b&&(c={usrid:b}),new Promise(function(a,b){B.find(c,function(c,d){return c?void b(c):void a(d)})})}function b(a){return new Promise(function(b,c){B.find({_id:a},function(a,d){return a?void c(a):void b(d)})})}function c(){return new Promise(function(a,b){var c=new Date,d=J.formatISO8601(c,1),e=J.addDaysToDate(c,30),f=J.formatISO8601(e,1);B.find({$or:[{$and:[{rm:{$exists:!0}},{d:{$gte:d}},{d:{$lte:f}}]},{$and:[{rm:{$exists:!0}},{rpt:{$exists:!0}},{rpt:{$ne:null}}]}]},function(c,d){return c?void b(c):void a(d)})})}function d(a,b,c){return new Promise(function(d,e){var f=a.i||null;f||e("ensure event requires id"),a.usrid=b,B.update({i:f,usrid:b},a,{upsert:!0,multi:!1},function(f,g,h){return f?void e(f):(b&&c&&m.add(a,19,b),void d(h))})})}function e(a,c,d){return new Promise(function(e,f){b(a).then(function(b){if(b.length){var g=b[0],h={u:J.formatISO8601(new Date,3),z:j.z},i=g.rpt,k=i.ed?i.ed:[];E(c,function(a){var b=K.dateFromDateFormat(a),c=J.formatISO8601(b,1);k.indexOf(c)<0&&k.push(c)}),i.ed=k,g.rpt=i,h.rpt=i,B.update({_id:a},{$set:h},{},function(a,b,c){if(a)return void f(a);if(d&&g.usrid){var h=g.usrid;delete g.usrid,g.u=J.formatISO8601(new Date,3),g.z=j.z,m.add(g,19,h),e(b)}else e(b)})}})})}function f(a,b,c){if(a){var d={i:a};return b&&(d={i:a,usrid:b}),new Promise(function(e,f){B.remove(d,{},function(d,g){return d?void f(d):(c&&b&&m.add({i:a},20,b),void e(g))})})}}function g(a,b){return new Promise(function(c,d){var e={};a&&(e={usrid:a}),B.remove(e,{multi:!0},function(e,f){return e?void d(e):(a&&b&&deletedIDs.length&&E(deletedIDs,function(b){m.add({i:b},20,a)}),void c(f))})})}function h(a){return new Promise(function(b,c){var d=[];B.find({usrid:null},function(a,b){a||E(b,function(a){d.push(a)})});var e={u:J.formatISO8601(new Date,3),z:j.z,usrid:a};B.update({usrid:null},{$set:e},{multi:!0},function(e,f){return e?void c(e):(E(d,function(b){b.u=J.formatISO8601(new Date,3),b.z=j.z,delete b.usrid,m.add(b,19,a)}),void b(f))})})}function i(a,c,d){return new Promise(function(e,f){if(!a)return void f("eventID is required");var g={u:J.formatISO8601(new Date,3),z:j.z};if(c&&c.length>0){var h=new Array;for(var i in c){var k=Y.toDBFile(c[i]);k&&h.push(k)}g.fi=h.length>0?h:null}else g.fi=null;B.update({_id:a},{$set:g},{multi:!1},function(c,g,h){return c?void f(c):void(d?b(a).then(function(a){if(a.length&&a[0].usrid){var b=a[0],c=b.usrid;delete b.usrid,b.u=J.formatISO8601(new Date,3),b.z=j.z,m.add(b,19,c)}e(h)},function(a){J.logError(a),e(h)}):e(h))})})}return{getEvent:function(b,c){return a(b,c)},getEvents:function(b){return a(null,b)},getEventWithDbId:function(a){return b(a)},getEventsWithReminders:function(){return c()},ensureEvent:function(a,b,c){return d(a,b,c)},deleteRepeatingEventDates:function(a,b,c){return e(a,b,c)},deleteEvent:function(a,b,c){return f(a,b,c)},deleteAllEvents:function(a,b){return g(a,b)},setEventsUserID:function(a){return h(a)},updateEventFiles:function(a,b,c){return i(a,b,c)}}}(),D=function(){return{loadStorage:function(a,b){var c=F.getUserID(a);return D.loadStorageForUser(a,c,b)},loadStorageForUser:function(a,b,c){return new Promise(function(d,e){var f=new Array;f.push(function(){return F.loadUser(a,b,!0)}),f.push(function(){return G.loadSchools(a,!1)}),f.push(function(){return I.loadTeachers(a,!1)}),f.push(function(){return Q.loadClasses(a,!1)}),f.push(function(){return L.loadHomeworks(a,!1)}),f.push(function(){return R.loadEvents(a,!1)}),f.push(function(){return T.loadAnnouncements(a,!1)}),Promise.loop(f).then(function(){c&&!a.$$phase&&a.$apply(a),a.user&&xa.rescheduleReminders(),X.setupLiveTiles(a),d()},function(a){Canadarm.error(a.toString(),a),e(a)})})},unloadUserData:function(a,b){a.userClassOptions=null,a.userClasses=null,a.userHomeworks=null,a.userAnnouncements=null,a.userSchools=null,a.userNoSchoolEvents=null,a.unreadAnnouncements=0,a.mainSpinner=null,a.showTheme=!1,b&&!a.$$phase&&a.$apply()},reloadStorage:function(a,b){return D.loadStorage(a,b)},restartStorage:function(a,b){function c(){e++,e>=d.length&&D.loadStorage(a,!0)}J.debugLog("restartStorage",b);var d=b.reduce(function(a,b){return a.indexOf(b)<0&&a.push(b),a},[]),e=0;d.indexOf("hwdb")>=0&&n.loadDatabase(c),d.indexOf("clsdb")>=0&&p.loadDatabase(c),d.indexOf("usrdb")>=0&&v.loadDatabase(c),d.indexOf("anndb")>=0&&r.loadDatabase(c),d.indexOf("schlsdb")>=0&&x.loadDatabase(c),d.indexOf("tchrsdb")>=0&&z.loadDatabase(c),d.indexOf("syncdb")>=0&&l.loadDatabase(c),d.indexOf("eventsdb")>=0&&B.loadDatabase(c)},restartOnChange:function(){var a,b,c,d=[];window.addEventListener("storage",function(e){var f=["hwdb","clsdb","anndb","schlsdb","tchrsdb","eventsdb"];f.indexOf(e.key)>=0&&null!=e.newValue&&null!=e.oldValue?(J.debugLog(e.key),d.push(e.key),a&&clearTimeout(a),a=setTimeout(function(){D.restartStorage(angular.rootScope(),angular.copy(d)),d=[],a=null},600)):"usrdb"==e.key&&null!=e.newValue&&null!=e.oldValue?(J.debugLog(e.key),c&&clearTimeout(c),c=setTimeout(function(){var a=angular.rootScope(),b=F.getUserID(a);v.loadDatabase(function(){D.getLocalItem("reloadtheme").then(function(c){c?(MacApp.Window.closeAllModals(),a.reloadTheme(),D.setLocalItem("reloadtheme",!1)):F.loadUser(a,b,!0)})}),c=null},600)):"syncdb"==e.key&&null!=e.newValue&&null!=e.oldValue&&(J.debugLog(e.key),b&&clearTimeout(b),b=setTimeout(function(){l.loadDatabase(),b=null},600))},!0)},removeUser:function(a,b){return new Promise(function(c,d){var e=new Array;e.push(function(){return q.deleteClasses(b)}),e.push(function(){return o.deleteAllHws(b)}),e.push(function(){return C.deleteAllEvents(b)}),e.push(function(){return u.deleteUserAnnouncements(b)}),e.push(function(){return w.removeUser(b)}),Promise.loop(e).then(function(){a.user=null,D.reloadStorage(a).then(function(){c()})},function(a){Canadarm.error("Failed to remove user",a),d(a)})})},setLocalItem:function(a,b){if(j.isChromeApp){var c={};return c[a]=b,void chrome.storage.local.set(c)}return j.isMacApp?void(b.constructor==Object?MacApp.Storage.set(a,JSON.stringify(b),function(){}):MacApp.Storage.set(a,b,function(){})):void(b.constructor==Object?localStorage.setItem(a,JSON.stringify(b)):localStorage.setItem(a,b))},getLocalItem:function(a){return new Promise(function(b,c){if(j.isChromeApp)return void chrome.storage.local.get(a,function(c){b(c[a]||null)});if(j.isMacApp)return void MacApp.Storage.get(a,function(a){
try{b(a?JSON.parse(a):null)}catch(c){b(a)}});var d=localStorage.getItem(a);try{b(d?JSON.parse(d):null)}catch(e){b(d)}})}}}();angular.s=function(a){return angular.injector(["myHomework"]).get(a)},angular.f=function(a){return angular.element("html").injector().get("$filter")(a)},angular.l=function(){return angular.element("html").injector().get("$location")},angular.rootScope=function(){var a=angular.element(document.body);return a.scope().$root};var E=angular.forEach;angular.module("angularUtils",[]).factory("$onready",["$timeout",function(a){return function(b){return a(function(){b()})}}]).filter("range",function(){return function(a,b,c){b=parseInt(b),c=parseInt(c);for(var d=b;c>d;d++)a.push(d);return a}}).filter("titleCapitalize",function(){return function(a,b){return null!=a&&(a=a.toLowerCase()),a.substring(0,1).toUpperCase()+a.substring(1)}}).filter("ordinal",function(){return function(a){if(isNaN(a)||null===a)return a;var b=["th","st","nd","rd"],c=a%100;return a+(b[(c-20)%10]||b[c]||b[0])}}).filter("trustAsResourceUrl",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]);var F=function(){function a(a,d,e){return new Promise(function(f,h){w.getUsers().then(function(h){var i=new Array,j=[];for(var k in h)j.push(new Promise(function(a,c){var d=b(h[k]),e=[];d.avatar&&e.push(new Promise(function(a,b){wa.getImage(d.avatar).then(function(b){d.localAvatar=b,a()},b)})),d.myHomeworkAd&&d.myHomeworkAd.adImageURL&&e.push(new Promise(function(a,b){wa.getImage(d.myHomeworkAd.adImageURL).then(function(b){d.myHomeworkAd.adImageURL=b,a()},b)})),e.length?Promise.all(e).then(function(){i.push(d),a()},function(){i.push(d),a()}):(i.push(d),a())}));var l=null;j.push(new Promise(function(a,b){D.getLocalItem("activeUser").then(function(b){l=b,a()})})),Promise.all(j).then(function(b){if(0==i.length)a.user=null,a.users=null,D.getLocalItem("nousersettings").then(function(b){a.userSettings=c({s:b?b:{}}),g(a),e&&!a.$$phase&&a.$apply(),f(a.user)});else if(!d&&i.length>0){var h=null;if(l)for(var j in i){var k=i[j];if(k.id==l){h=k;break}}h?a.user=h:a.user=i[0],a.userSettings=a.user.settings,a.users=i.length>0?i:null,g(a),e&&!a.$$phase&&a.$apply(),f(a.user)}else{for(var j in i){var k=i[j];if(d&&k.id==d){a.user=k,a.userSettings=a.user.settings;break}}a.users=i.length>0?i:null,g(a),e&&!a.$$phase&&a.$apply(),f(a.user)}})["catch"](function(b){J.logError(b),e&&!a.$$phase&&a.$apply(),f()})})})}function b(a){var b={id:a._id,accessToken:a.t,username:a.u,email:a.e,firstName:a.f,lastName:a.l,avatar:a.a,gender:a.g,facebookID:a.fb_i,facebookAvatar:a.fb_a,googleID:a.goog_i,googleAvatar:a.goog_a,schoolSlugs:a.scg||null,grds:a.grds||null,settings:c(a),lastSyncId:a.syi||null};if(a.dob&&(b.dateOfBirth=J.parseISO8601(a.dob,1)),a.f||a.l){var d="";a.f&&(d+=a.f+" "),a.l&&(d+=a.l),b.name=d}if("M"==a.g?b.genderDisplay="Male":"F"==a.g&&(b.genderDisplay="Female"),a.pfs&&(b.promptForSchool=a.pfs),a.gpi&&(b.genericPrompt=a.gpi),a.norwds&&(b.norwds=a.norwds),a.upts&&(b.upts=a.upts),a.jcc&&(b.jcc=a.jcc),a.rdt){var e=new Date,f=J.parseISO8601(a.rdt,1);b.renewByDate=f;var g=0;if(f>e){var h=Math.abs(f.getTime()-e.getTime());g=Math.ceil(h/864e5)}b.daysLeftToRenew=g,30>=g&&(b.canRenew=!0),10>=g&&(b.shouldRenew=!0),0>=g&&(b.mustRenew=!0),g>0&&(b.isPremiumAccount=!0)}if(a.thm){var i=a.thm;i.pur&&(b.purchasedThemes=i.pur),i.cur&&(b.theme=i.cur)}if(a.ss){var j=a.ss,k=(j.ntwk||[],j.ci),l=j.ai,m=j.si,n=j.hp;if(k&&l){var o={adID:l,campaignID:k};m&&(o.schoolSlug=m.s,o.openSchoolPage=m.sp),n&&(o.adURL=n.u,o.adImageURL=n.i),b.myHomeworkAd=o}}return b.isSchoolAccount=b.myHomeworkAd&&b.myHomeworkAd.schoolSlug?!0:!1,b.isPremiumOrSchoolAccount=b.isPremiumAccount||b.isSchoolAccount,b}function c(a){var b={hideCompletedHomework:!1,showCalendarOnStart:!1,dontPromptDelete:!1,defaultPriority:null,defaultReminder:null,periodsPerDay:null,blocksPerDay:null};if(a.s){if(b.hideCompletedHomework=a.s.hc,b.showCalendarOnStart=a.s.ocal,b.dontPromptDelete=a.s.dpd,b.dayAStartDate=a.s.das?J.parseISO8601(a.s.das,!0):null,exbds={},a.s.exbd){var c=angular.f("date");E(a.s.exbd,function(a){var b=c(a.d,"yyyyMMdd");exbds[b]=a})}b.explicitBlockDates=exbds,b.blockDayName="block",b.blockDayPeriodName="block",a.s.bn&&(b.blockDayName=a.s.bn),a.s.bpn&&(b.blockDayPeriodName=a.s.bpn),a.s.q&&(b.defaultPriority=L.homeworkPriorityForID(a.s.q));var d=a.s.rm;if(d)for(key in d)b.defaultReminder=L.homeworkReminderForID(key+":"+d[key]);if(a.s.pp&&(b.periodsPerDay=a.s.pp),0==a.s.lp?b.showZeroPeriod=!0:b.showZeroPeriod=!1,a.s.bd&&(b.blocksPerDay=a.s.bd),0==a.s.lb?b.showZeroBlock=!0:b.showZeroBlock=!1,b.disableRewards=!1,a.s.dkr&&(b.disableRewards=!0),a.s.b){var e=[];E(a.s.b,function(a){var c={day:a.d||null,text:a.l||null,si:a.si||null,color:null};a.si&&(b.hasSchoolBlockSchedule=!0),a.h&&a.c&&(c.color={h:a.h,c:a.c}),e.push(c)}),e.length&&(b.blocks=e)}}return b}function d(a){var b={hc:!1,dpd:!1,q:null,rm:null,z:j.z,u:J.formatISO8601(new Date,3)};if(a){if(b.ocal=a.showCalendarOnStart||!1,b.hc=a.hideCompletedHomework||!1,b.dpd=a.dontPromptDelete||!1,b.das=a.dayAStartDate?J.formatISO8601(a.dayAStartDate,1):null,a.defaultPriority&&(b.q=parseInt(a.defaultPriority.id)),a.defaultReminder){var c=a.defaultReminder.id,d=c.split(":"),e={};e[d[0]]=parseInt(d[1]),b.rm=e}if(b.pp=a.periodsPerDay||null,b.lp=a.showZeroPeriod?0:1,b.lb=a.showZeroBlock?0:1,b.bd=a.blocksPerDay||null,b.dkr=a.disableRewards||null,b.b=null,a.blocks){var f=[];E(a.blocks,function(a){var b={d:a.id?parseInt(a.id):a.day,l:a.text||null};a.color&&(b.h=a.color.h,b.c=a.color.c),f.push(b)}),f.length&&(b.b=f)}}return b}function e(a){return a.userSettings?!a.userSettings.hideCompletedHomework:!0}function f(a,b){return Math.floor(Math.random()*(b-a+1))+a}function g(a){if(a.user&&a.user.isPremiumOrSchoolAccount)return void(a.myHomeworkTip=null);var b=[{url:"https://myhomeworkapp.com/for-schools",text:"For Schools! Colors, logo, handbook...",id:"schools"},{url:"https://myhomeworkapp.com/apps",text:"Have you tried the iOS or Android app?",id:"download"}];if(a.user){if(a.user.myHomeworkAd)return ua.sendEvent("Ads",a.user.myHomeworkAd.adID,"Viewed"),void(a.myHomeworkTip=null);b.push({url:"upgrade",text:"Go Premium! Get more themes & no ads",id:"premium"}),b.push({url:"upgrade",text:"Upgrade to myHomework Premium!",id:"upgrade"}),a.user.avatar||b.push({url:"picture",text:"Tip: Add your profile picture",id:"picture"}),a.user.email||b.push({url:"email",text:"Tip: Add your email to unlock features",id:"email"})}else b.push({url:"signup",text:"Sign up and get homework reminders",id:"signup"});var c=b[f(0,b.length-1)];ua.sendEvent("Tips",c.id,"Viewed"),a.myHomeworkTip=c}return{loadUser:function(b,c,d){return a(b,c,d)},getUserID:function(a){return a||(a=angular.rootScope()),a.user&&a.user.id?a.user.id:null},toDBSettings:function(a){return d(a)},showCompletedHomework:function(a){return e(a)}}}(),G=function(){function a(a,b){return new Promise(function(d,e){y.getSchools().then(function(e){if(0==e.length)return a.userSchools=null,a.schools=null,b&&!a.$$phase&&a.$apply(),void d();var f=[],g=[];E(e,function(a){f.push(new Promise(function(b,d){var e=c(a);e.avatar?wa.getImage(e.avatar).then(function(a){e.localAvatar=a,g.push(e),b()},d):(g.push(e),b())}))}),Promise.all(f).then(function(c){if(0==g.length)a.schools=null,a.userSchools=null;else if(a.schools=g,a.user&&a.user.schoolSlugs){var e=angular.f("filter"),f=e(g,function(b){return a.user.schoolSlugs.indexOf(b.slug)>=0});a.userSchools=f.length?f:null,a.premiumSchool=null,a.userSchools&&E(a.userSchools,function(b){b.isprem&&(a.premiumSchool=b)})}else a.userSchools=null;b&&!a.$$phase&&a.$apply(),d()})["catch"](function(c){J.logError(c),b&&!a.$$phase&&a.$apply(),d()})})})}function b(a){return new Promise(function(b,d){var e=c(a);e.avatar?wa.getImage(e.avatar).then(function(a){e.localAvatar=a,b(e)},d):b(e)})}function c(a){var b={slug:a.s,name:a.n,type:a.t,city:a.c,state:a.st,countryCode:a.cc,postalCode:a.pc,geo:a.l,website:a.w,facebookURL:a.fb,twitterHandle:a.tw,avatar:a.a,lastUpdated:J.parseISO8601(a.u,2),emailDomains:a.sed};b.geo&&2==b.geo.length&&(b.latitude=b.geo[0],b.longitude=b.geo[1]),a.ptinf&&(b.ptinf=a.ptinf),a.isprem&&(b.isprem=a.isprem),a.hall_passes_on&&(b.hall_passes_on=a.hall_passes_on),a.short_name&&(b.short_name=a.short_name);var c="";if(b.city&&(c+=b.city),b.state&&(c+=", "+b.state),b.postalCode&&(c+=" "+b.postalCode),b.countryCode&&"US"!=b.countryCode&&(c+=" "+b.countryCode),b.location=c,a.tchr){var e=[];E(a.tchr,function(a){var b=I.toUITeacher(a);b&&e.push(b)}),e.length&&(b.teachers=e)}var f=[];if(a.lnk){var g=[];E(a.lnk,function(a){var b=Y.toUILink(a);b&&(g.push(b),f.push(b))}),g.length&&(b.links=g)}if(a.fls){var h=[];E(a.fls,function(a){var b=Y.toUIFile(a);b&&(h.push(b),f.push(b))}),h.length&&(b.files=h)}if(f.length&&(d(f),b.resources=f),a.an){var i=[];E(a.an,function(a){var b=T.toUIAnnouncement(a);b&&i.push(b)}),i.length&&(b.announcements=i)}return b.dbschl=angular.copy(a),b}function d(a){function b(a,b){if(a&&a.length>0){if(!(b&&b.length>0))return-1;var c=a.toLowerCase(),d=b.toLowerCase();if(d>c)return-1;if(c>d)return 1}else if(b&&b.length>0)return 1;return 0}function c(a,c){return a.sq&&!c.sq?-1:c.sq&&!a.sq?1:a.sq&&c.sq&&a.sq!=c.sq?a.sq>c.sq?1:-1:b(a.displayText,c.displayText)}!a||a.length<2||a.sort(c)}return{loadSchools:function(b,c){return a(b,c)},loadSchool:function(a){return b(a)},toUISchool:function(a){return c(a)},toDBSchool:function(a){return _toDBSchool(schl)},sortResources:function(a){return d(a)}}}(),I=function(){function a(a,c){return new Promise(function(d,e){A.getTeachers().then(function(e){if(0==e.length)return a.teachers=null,c&&!a.$$phase&&a.$apply(),void d();var f=[],g=[];E(e,function(a){f.push(b(a,g))}),Promise.all(f).then(function(b){a.teachers=g.length?g:null,c&&!a.$$phase&&a.$apply(),d()})["catch"](function(b){J.logError(b),c&&!a.$$phase&&a.$apply(),d()})})})}function b(a,b){return new Promise(function(d,e){var f=c(a),g=[];f.avatar&&g.push(new Promise(function(a,b){wa.getImage(f.avatar).then(function(b){f.localAvatar=b,a()},b)})),f.smallAvatar&&g.push(new Promise(function(a,b){wa.getImage(f.smallAvatar).then(function(b){f.localSmallAvatar=b,a()},b)})),g.length?Promise.all(g).then(function(){b&&b.push(f),d(f)},function(){b&&b.push(f),d(f)}):(b&&b.push(f),d(f))})}function c(a){var b={id:a.i,nameKnownAs:a.k,namePrefix:a.r,nameFirst:a.f,nameLast:a.l,nameSuffix:a.sf,username:a.m,avatar:a.a,smallAvatar:a.a_s,about:a.ab,aboutText:a.ab_c,hasBlog:a.hb},c=a.s;if(c&&c.length&&c.constructor==Array){var e=[];E(c,function(a){var c={schoolSlug:a.s,schoolName:a.n,title:a.t,email:a.e,phone:a.p,altPhone:a.q,officeLocation:a.l,officeHours:a.h,website:a.w};c.title&&!b.title&&(b.title=c.title),e.push(c)}),e.length&&(b.schools=e)}else if(c&&c.t){var e=[],f={schoolSlug:c.s,schoolName:c.n,title:c.t,email:c.e,phone:c.p,altPhone:c.q,officeLocation:c.l,officeHours:c.h,website:c.w};f.title&&!b.title&&(b.title=f.title),e.push(f),b.schools=e}else if(a.si){var g=a.si,e=[];E(g,function(a){var c={schoolSlug:a.ss,schoolName:a.sn,title:a.t};c.title&&!b.title&&(b.title=c.title),e.push(c)}),e.length&&(b.schools=e)}var h=a.ci;if(h){var i={title:h.t,location:h.l,email:h.e,website:h.w};i.title&&!b.title&&(b.title=i.title),b.contact=i}var j=a.ed;if(j&&j.length){var k=[];E(j,function(a){var b={type:a.t,title:a.d,year:a.y,schoolSlug:a.s,schoolName:a.n},c="";b.type&&(c+=b.type+" "),b.type&&b.title&&(c+="in "),b.title&&(c+=b.title),(b.title||b.type)&&b.year&&(c+=", "+b.year),b.schoolSlug&&b.schoolName&&(c+=" - "),c.length&&(b.typeTitleYear=c),k.push(b)}),k.length&&(b.education=k)}var l=a.aw;if(l&&l.length){var m=[];E(l,function(a){var b={title:a.t,year:a.y,url:a.u},c="";b.year&&(c+=b.year+", "),b.title&&(c+=b.title),c.length&&(b.titleYear=c),m.push(b)}),m.length&&(b.awards=m)}var n=a.pb;if(n&&n.length){var o=[];E(n,function(a){var b={title:a.t,url:a.u};o.push(b)}),o.length&&(b.publications=o)}return b.name=d(b),b}function d(a){var b=a.nameKnownAs;if(b&&b.length>0)return b;var c=a.namePrefix,d=a.nameFirst,e=a.nameLast,f=a.nameSuffix,g="";return c&&c.length&&(g+=c+" "),d&&d.length&&(g+=d+" "),e&&e.length&&(g+=e+" "),f&&f.length&&(g+=f),g}return{loadTeachers:function(b,c){return a(b,c)},loadTeacher:function(a){return b(a)},toUITeacher:function(a){return c(a)}}}(),J=function(){var a="23456789ABCDEFGHIJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz".split(""),b="23456789".split("");return{simpleID:function(c){(!c||3>c)&&(c=11),id=[];for(var d=0;c>d;++d)d%3==0?id[d]=b[0|Math.random()*b.length]:id[d]=a[0|Math.random()*a.length];return id.join("")},formatISO8601:function(a,b){function c(a){return 10>a?"0"+a:a}return b&&2!=b?3==b?a.getUTCFullYear()+"-"+c(a.getUTCMonth()+1)+"-"+c(a.getUTCDate())+"T"+c(a.getUTCHours())+":"+c(a.getUTCMinutes())+":"+c(a.getUTCSeconds())+"Z":a.getFullYear()+"-"+c(a.getMonth()+1)+"-"+c(a.getDate()):a.getUTCFullYear()+"-"+c(a.getUTCMonth()+1)+"-"+c(a.getUTCDate())+"T"+c(a.getUTCHours())+":"+c(a.getUTCMinutes())+"Z"},parseISO8601:function(a,b){var c=a.split("T"),d=c[0].split("-"),e=Number(d[0]),f=Number(d[1])-1,g=Number(d[2]);if(b&&1==b||1==c.length)return new Date(e,f,g);var h=c[1].split("Z"),i=h[0].split(":"),j=Number(i[0]),k=Number(i[1]),l=0;if(i.length>2){var m=i[2].split(".");l=Number(m[0])}return new Date(Date.UTC(e,f,g,j,k,l))},parseTimeStr:function(a,b){b||(b=new Date);var c=a.match(/(\d+)(?::(\d\d))?\s*(p?a?P?A?)/i);if(!c)return null;var d=parseInt(c[1],10);return 12!=d||c[3]?12==d&&"a"===c[3].toLowerCase()?d=0:d+=12>d&&"p"===c[3].toLowerCase()?12:0:d=12,b.setHours(d),b.setMinutes(parseInt(c[2],10)||0),b.setSeconds(0,0),b},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},strStartsWith:function(a,b){return 0===a.lastIndexOf(b)},strEndsWith:function(a,b){return-1!=a.indexOf(b,a.length-b.length)},strContains:function(a,b){return a.indexOf(b)>=0},addHoursToDate:function(a,b){var c=new Date(a.getTime());return c.setHours(c.getHours()+b),c},addDaysToDate:function(a,b){return this.addHoursToDate(a,24*b)},openURL:function(a,b){b&&(j.isMacApp?MacApp.openURL(b):a.open(b,"_blank"))},openAppURL:function(a,b){b&&(j.isMacApp?MacApp.openAppURL(b):a.url(b))},logError:function(a){j.isDebug&&a&&console.log("Error",a)},debugLog:function(){j.isDebug&&j.debugLogEnabled&&arguments&&console.log.apply(console,arguments)},getGeolocation:function(){return new Promise(function(a){if(j.isMacApp){var b=setTimeout(function(){a(null)},15e3);MacApp.Geo.getGeolocation(function(c){clearTimeout(b),c.length?(D.setLocalItem("usrgeo",c),a(c)):a(null)},function(){clearTimeout(b),a(null)})}else if(j.isWindowsApp){var c=new Windows.Devices.Geolocation.Geolocator;if(c&&c.locationStatus!=Windows.Devices.Geolocation.PositionStatus.disabled&&c.locationStatus!=Windows.Devices.Geolocation.PositionStatus.noData&&c.locationStatus!=Windows.Devices.Geolocation.PositionStatus.notAvailable){var b=setTimeout(function(){a(null)},15e3);return void c.getGeopositionAsync().then(function(c){if(clearTimeout(b),c.coordinate.point.position.latitude&&c.coordinate.point.position.longitude){var d=c.coordinate.point.position.latitude+","+c.coordinate.point.position.longitude;D.setLocalItem("usrgeo",d),setTimeout(function(){a(d)},1e3)}else a(null)},function(c){clearTimeout(b),a(null)})}a(null)}else if("geolocation"in navigator){var b=setTimeout(function(){a(null)},1e4);navigator.geolocation.getCurrentPosition(function(c){if(clearTimeout(b),c.coords.latitude&&c.coords.longitude){var d=c.coords.latitude+","+c.coords.longitude;D.setLocalItem("usrgeo",d),a(d)}else a(null)},function(c){clearTimeout(b),a(null)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:36e5})}else a(null)})}}}(),K=function(){return{dateFirstDayOfTheWeek:function(a){var b=new Date(a);return b.setDate(a.getDate()-a.getDay()),b},dateLastDayOfTheWeek:function(a){var b=new Date(a);return b.setDate(a.getDate()-a.getDay()),b.setDate(b.getDate()+6),b},daysInBetween:function(a,b){return Math.round(Math.abs(a.getTime()-b.getTime())/864e5)},minutesInBetween:function(a,b){return Math.round(Math.abs(a.getTime()-b.getTime())/6e4)},ordinalNumber:function(a){var b=["th","st","nd","rd"],c=a%100;return a+(b[(c-20)%10]||b[c]||b[0])},dateFromDateFormat:function(a){var b=parseInt(a.substring(0,4)),c=parseInt(a.substring(4,6)),d=parseInt(a.substring(6,8));return new Date(b,c-1,d)},isDateValid:function(a){return a&&"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())?!0:!1}}}();Date.isLeapYear=function(a){return a%4===0&&a%100!==0||a%400===0},Date.getDaysInMonth=function(a,b){return[31,Date.isLeapYear(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]},Date.prototype.isLeapYear=function(){return Date.isLeapYear(this.getFullYear())},Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())},Date.prototype.addMonths=function(a){var b=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+a),this.setDate(Math.min(b,this.getDaysInMonth())),this};var L=function(){function a(a,b,e){var f=F.getUserID(a);return new Promise(function(h,i){o.getHws(f).then(function(f){if(0==f.length)return a.userHomeworks=new Array,b&&!a.$$phase&&a.$apply(),void h();var i={};if(a.userClassOptions)for(k in a.userClassOptions){var j=a.userClassOptions[k];i[j.id]=j}var l=angular.f("date"),m=new Array;for(var n in f){var p=f[n];if(p.t&&!g(p)&&(!e||e(p))){var q=c(p,l);if(q){if(q.dueDate&&(q.hasTime?(q.shortDateFormat=l(q.dueDate,"EEE, MMM d - h:mm a"),q.longDateFormat=l(q.dueDate,"EEEE, MMM d - h:mm a")):(q.shortDateFormat=l(q.dueDate,"EEE, MMM d"),q.longDateFormat=l(q.dueDate,"EEEE, MMM d")),q.calendarDayFormat=l(q.dueDate,"yyyyMMdd")),q.classId){var j=i[q.classId];j&&(q.className=j.name),j&&j.color&&(q.classColor=j.color)}m.push(q)}else o.deleteHw(p.i,p.usrid,!0)}}m.length>1&&d(m,!1),a.userHomeworks=m,b&&!a.$$phase&&a.$apply(),h()})})}function b(a){var b=a.id||J.simpleID(15),c=J.formatISO8601(new Date,3),d={i:b,t:a.title,s:a.complete?2:1,y:a.type?parseInt(a.type.id):null,q:a.priority?parseInt(a.priority.id):null,n:a.additionalInfo||null,c:a.created?J.formatISO8601(a.created,3):c,a:a.createdAppId||j.z,u:c,z:j.z};a.cls?d.k=a.cls.id:a.classId?d.k=a.classId:d.k=null,a.isManual||(d.f=a.teacherID,d.tn=a.teacherNotes||null,d.tn_c=a.teacherNotesClean||null,d.sod=a.showOnDate?J.formatISO8601(a.showOnDate):null);var e=a.dueDate,f=a.hasTime?2:1;if(a.dueTime&&(f=2,e=J.parseTimeStr(a.dueTime,e)),d.d=J.formatISO8601(e,f),d.p=f,a.repeats&&a.repeatEnds){var g={e:J.formatISO8601(a.repeatEnds,1)};if("1"==a.repeats.id?(g.t=1,g.dd=[1,2,3,4,5,6,7]):"2"==a.repeats.id?(g.t=1,g.dd=[1,2,3,4,5]):g.t=parseInt(a.repeats.id)-1,a.repeatCompleted){var h=[];E(a.repeatCompleted,function(a){h.push(J.formatISO8601(K.dateFromDateFormat(a),1))}),h.length&&(g.cd=h)}if(a.repeatExcept){var i=[];E(a.repeatExcept,function(a){i.push(J.formatISO8601(K.dateFromDateFormat(a),1))}),i.length&&(g.ed=i)}d.rpt=g}if(a.files){var k=new Array;E(a.files,function(a){var b=Y.toDBFile(a);b&&k.push(b)}),d.fi=k.length>0?k:null}else d.fi=null;if(a.reminder)if("c"==a.reminder.id.charAt(0))d.rm={c:a.reminder.id.substring(2)};else{var l=a.reminder.id.split(":"),m={};m[l[0]]=parseInt(l[1]),d.rm=m}else d.rm=null;return d}function c(a,b){var c=2==a.p?!0:!1,d=J.parseISO8601(a.d,a.p),e=new Date;"undefined"==typeof b&&(b=angular.f("date"));var f={id:a.i,dbID:a._id,title:a.t,classId:a.k,dueDate:d,hasTime:c,additionalInfo:a.n,files:null,created:a.c?J.parseISO8601(a.c):null,createdAppId:a.a,updated:a.u?J.parseISO8601(a.u):null,updatedAppId:a.z,complete:2==a.s?!0:!1,ss:a.ss,ssic:a.ssic};if(a.fi&&a.fi.length>0){var g=a.fi,j=new Array;for(var k in g)j.push(Y.toUIFile(g[k]));f.files=j}var o=a.y;if(o){var p=C(o);p&&(f.type=C(o),f.isNeverLateType=h(a),f.isDueType=D(o))}var v=a.q;v&&(f.priority=A(v));var y=a.rm;if(y){f.rm=a.rm;for(key in y)f.reminder=B(key+":"+y[key])}var z=a.rpt;if(z){f.repeatBegins=d;var o=0;if(z.t&&(o=1==z.t?z.dd&&5==z.dd.length?2:1:z.t+1),E(P,function(a){a.id==o.toString()&&(f.repeats=a)}),z.e&&(f.repeatEnds=J.parseISO8601(z.e,1),w(f,a,e,b),0==f.repeatDates.length))return null;if(z.ed){var F=[];E(z.ed,function(a){F.push(b(J.parseISO8601(a,1),"yyyyMMdd"))}),F.length&&(f.repeatExcept=F)}if(z.cd){var G=[];E(z.cd,function(a){G.push(b(J.parseISO8601(a,1),"yyyyMMdd"))}),G.length&&(f.repeatCompleted=G)}}f.isComplete=l(a,d,c,e),f.isLate=m(a,d,c,e),f.isDueToday=q(d,e),f.isDueTomorrow=r(d,e),f.isUpcoming=n(f,d,c,e),f.isPastHwDueDate=i(d,c,e),f.isUpcomingOrFuture=f.isComplete||f.isLate||f.isPastHwDueDate?!1:!0,f.isImportant=u(a),f.isDueWithinAWeek=s(f.dueDate,e),f.isNeverLateType?f.isComplete?(f.isCompleteable=!1,f.isUncompleteable=!f.isPastHwDueDate):(f.isCompleteable=!0,f.isUncompleteable=!1):f.isComplete?(f.isCompleteable=!1,f.isUncompleteable=!0):(f.isCompleteable=!0,f.isUncompleteable=!1);var H=a.f;return H?(f.isManual=!1,f.isDeletable=!1,f.teacherID=H,f.teacherNotes=a.tn||null,f.teacherNotesClean=a.tn_c||null,f.showOnDate=a.sod?J.parseISO8601(a.sod):null):(f.isManual=!0,f.isDeletable=!0),f.displayClasses=t(f),f.repeats&&f.repeatDates&&x(f),f}function d(a,b){function c(a,c){if(!b){if(a.isComplete){if(!c.isComplete)return 1}else if(c.isComplete)return-1;if(a.isLate){if(!c.isLate)return-1}else if(c.isLate)return 1}var d=a.dueDate,e=a.hasTime?!0:!1,g=c.dueDate,h=c.hasTime?!0:!1;if(e==h){if(g>d)return!b&&a.isComplete?1:-1;if(d>g)return!b&&a.isComplete?-1:1}else{var i=new Date(d.getFullYear(),d.getMonth(),d.getDate()),j=new Date(g.getFullYear(),g.getMonth(),g.getDate());if(j>i)return!b&&a.isComplete?1:-1;if(i>j)return!b&&a.isComplete?-1:1;if(!e&&h)return-1;if(!h&&e)return 1}var k=a.priority&&parseInt(a.priority)>0?parseInt(a.priority):3,l=c.priority&&parseInt(c.priority)>0?parseInt(c.priority):3;if(l>k)return-1;if(k>l)return 1;var m=f(a.title,c.title);return 0!=m?m:a.created<c.created?!b&&a.isComplete?1:-1:c.created<a.created?!b&&a.isComplete?-1:1:0}!a||a.length<2||a.sort(c)}function e(a,b){a.userHomeworks&&(d(a.userHomeworks,b),a.$$phase||a.$apply())}function f(a,b){if(a&&a.length>0){if(!(b&&b.length>0))return-1;var c=a.toLowerCase(),d=b.toLowerCase();if(d>c)return-1;if(c>d)return 1}else if(b&&b.length>0)return 1;return 0}function g(a){var b=a.sod;if(!b)return!1;var c=new Date;return c<J.parseISO8601(b)?!0:!1}function h(a){var b=new Date(2017,8,6);if(a.created<b){if(a.y)return 14==a.y}else{if(!a.f)return!1;if(a.y)return 14==a.y}}function i(a,b,c){return b?c>a:c.getFullYear()!=a.getFullYear()?a.getFullYear()<c.getFullYear():c.getMonth()!=a.getMonth()?a.getMonth()<c.getMonth():c.getDate()!=a.getDate()?a.getDate()<c.getDate():!1}function l(a,b,c,d){return 2==a.s?!0:h(a)?i(b,c,d):!1}function m(a,b,c,d){return 2==a.s||h(a)?!1:i(b,c,d)}function n(a,b,c,d){if(a.isComplete)return!1;if(a.isDueToday||a.isDueTomorrow)return!0;var e=d.getDay();if(5==e){var f=new Date(d.getTime());if(f.setDate(f.getDate()+2),p(f,b))return!0;if(f.setDate(f.getDate()+1),p(f,b))return!0}else if(6==e){var f=new Date(d.getTime());if(f.setDate(f.getDate()+2),p(f,b))return!0}return!1}function p(a,b){return a.getFullYear()==b.getFullYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate()}function q(a,b){return p(b,a)}function r(a,b){var c=new Date(b.getTime());return c.setDate(c.getDate()+1),p(c,a)}function s(a,b){if(q(a,b))return!0;for(var c=0;7>c;c++)if(b.setDate(b.getDate()+1),p(a,b))return!0;return!1}function t(a){var b="";return a.isComplete?b+="complete ":a.isLate?b+="late ":a.isUpcoming&&(b+="upcoming "),a.priority&&("1"==a.priority.id?b+="rimportant ":"2"==a.priority.id&&(b+="important ")),a.repeats&&(b+="repeats "),a.reminder&&(b+="reminder "),a.files&&(b+="attachment "),a.isDeletable&&(b+="deletable "),a.isCompleteable&&(b+="completable "),a.isUncompleteable&&(b+="uncompletable "),a.isCompleting&&(b+="is-completing"),b}function u(a){var b=[2,5,6,8,9,10,11];if(a.y)for(var c=0;c<b.length;c++)if(a.y==b[c])return!0;return!1}function v(a){var b=new Date;a.isLate=i(a.dueDate,a.hasTime,b),a.isDueToday=q(a.dueDate,b),a.isDueTomorrow=r(a.dueDate,b),a.isUpcoming=n(a,a.dueDate,a.hasTime,b),a.isUpcomingOrFuture=a.isComplete||a.isLate||a.isPastHwDueDate?!1:!0,a.isImportant=u(a),a.isDueWithinAWeek=s(a.dueDate,b)}function w(a,b,c,d){function e(a){if(k.length){var b=J.formatISO8601(a,1);if(k.indexOf(b)>=0)return}j.push(d(a,"yyyyMMdd"))}var f=b.rpt,g=f.t,h=a.dueDate;a.hasTime&&(h=new Date(a.dueDate.getFullYear(),a.dueDate.getMonth(),a.dueDate.getDate()));var i=new Date(a.repeatEnds.getFullYear(),a.repeatEnds.getMonth(),a.repeatEnds.getDate()),j=[],k=f.ed&&f.ed.length?f.ed:[];if(e(h),i>h)if(1==g){var l=f.dd?f.dd:[],m=new Date(h);for(m.setDate(m.getDate()+1);i>=m&&j.length<366;){var n=m.getDay();0==n&&(n=7),l.indexOf(n)>=0&&e(m),m=new Date(m),m.setDate(m.getDate()+1)}}else if(2==g){var m=new Date(h);for(m.setDate(m.getDate()+7);i>=m&&j.length<100;)e(m),m=new Date(m),m.setDate(m.getDate()+7)}else if(3==g){var m=new Date(h);for(m.setDate(m.getDate()+14);i>=m&&j.length<100;)e(m),m=new Date(m),m.setDate(m.getDate()+14)}else if(4==g){var m=new Date(h);m.addMonths(1);for(var o=2;i>=m&&j.length<20;)m.getDate()==h.getDate()&&e(m),m=new Date(h),m.addMonths(o),o++}j.length>1&&j.sort(),a.repeatDates=j}function x(a){if(a.repeatCompleted){var b=[];if(E(a.repeatDates,function(c){a.repeatCompleted.indexOf(c)<0&&b.push(c)}),0==b.length){var c=K.dateFromDateFormat(a.repeatDates[a.repeatDates.length-1]);y(a,c)}else{var d=K.dateFromDateFormat(b[0]);y(a,d)}}else{var d=K.dateFromDateFormat(a.repeatDates[0]);y(a,d)}}function y(a,c){var d=angular.f("date"),e=new Date,f=J.formatISO8601(c,2),g=J.parseISO8601(f,2),h=!1;a.hasTime&&(g=J.parseTimeStr(d(a.dueDate,"shortTime"),g),h=!0),a.dueDate=g,a.isEvent&&(a.eventDate=g),a.hasTime?a.isEvent?(a.shortDateFormat=d(a.eventDate,"h:mm a"),a.endTime&&(a.shortDateFormat=a.shortDateFormat+" - "+d(a.endTime,"h:mm a")),a.longDateFormat=a.shortDateFormat):(a.shortDateFormat=d(a.dueDate,"EEE, MMM d - h:mm a"),a.longDateFormat=d(a.dueDate,"EEEE, MMM d - h:mm a")):(a.shortDateFormat=d(a.dueDate,"EEE, MMM d"),a.longDateFormat=d(a.dueDate,"EEEE, MMM d")),a.calendarDayFormat=d(a.dueDate,"yyyyMMdd");var j=b(a),k=d(c,"yyyyMMdd");a.repeatCompleted&&a.repeatCompleted.indexOf(k)>=0?a.isComplete=!0:a.isComplete=l(j,g,h,e),a.complete=a.isComplete?!0:!1,a.isLate=m(j,g,h,e),a.isDueToday=q(g,e),a.isDueTomorrow=r(g,e),a.isUpcoming=n(a,g,h,e),a.isPastHwDueDate=i(g,h,e),a.isUpcomingOrFuture=a.isComplete||a.isLate||a.isPastHwDueDate?!1:!0,a.isNeverLateType?a.isComplete?(a.isCompleteable=!1,a.isUncompleteable=!a.isPastHwDueDate):(a.isCompleteable=!0,a.isUncompleteable=!1):a.isComplete?(a.isCompleteable=!1,a.isUncompleteable=!0):(a.isCompleteable=!0,a.isUncompleteable=!1),a.isEvent&&(a.isCompleteable=!1,a.isUncompleteable=!1,a.isDeletable=!0),a.displayClasses=t(a)}function z(a){var b=a.repeatCompleted?a.repeatCompleted:[],c=[];if(E(a.repeatDates,function(a){b.indexOf(a)<0&&c.push(a)}),0==c.length)return[];var d=angular.f("date"),e=new Date,f=d(e,"yyyyMMdd"),g=[];return E(c,function(b){f>b?g.push(b):b==f&&a.hasTime&&(a.dueDate.getHours()<e.getHours()||a.dueDate.getHours()==e.getHours()&&a.dueDate.getMinutes()<=e.getMinutes())&&g.push(b)}),g}function A(a){var b=null;return E(N,function(c){c.id==a.toString()&&(b=c)}),b}function B(a){var b=null;if(E(O,function(c){c.id==a&&(b=c)}),!b&&"c"==a.charAt(0))try{var c=J.parseISO8601(a.substring(2));if(c){var d=angular.f("date");b={id:a,display:d(c,"MMMM d - h:mm a")}}}catch(e){J.logError(e)}return b}function C(a){var b=null,c=a.toString();return E(M,function(a){a.id==c&&(b=a)}),b}function D(a){return 1==a||5==a||11==a||12==a?!0:!1}function G(a){return a&&(a=a.trim().toLowerCase()),a?"final"==a||"finals"==a||"final exam"==a||"final test"==a?"8":"read"==a||"reading"==a||J.strStartsWith(a,"read ")||J.strStartsWith(a,"reading ")||J.strContains(a," read")?"4":"study"==a||"studying"==a||J.strStartsWith(a,"study ")||J.strStartsWith(a,"studying ")||J.strContains(a," study")?"3":J.strContains(a,"homework")||J.strContains(a,"assignment")||J.strContains(a," hw")||J.strContains(a,"hw ")?"1":"paper"==a||J.strStartsWith(a,"paper ")||J.strContains(a," paper")?"5":"presentation"==a||J.strStartsWith(a,"presentation ")||J.strContains(a," presentation")?"6":"lab"==a||J.strStartsWith(a,"lab ")||J.strContains(a," lab ")||J.strEndsWith(a," lab")?"7":"project"==a||J.strStartsWith(a,"project ")||J.strContains(a," project ")||J.strEndsWith(a," project")?"11":J.strContains(a,"worksheet")||J.strContains(a,"workbook")||J.strContains(a,"work book")||J.strContains("work sheet")?"12":J.strContains(a,"quiz")?"10":J.strContains(a,"midterm")||J.strContains(a,"mid-term")||J.strContains(a,"mid term")?"9":"test"==a||"exam"==a||J.strStartsWith(a,"test ")||J.strStartsWith(a,"exam ")||J.strEndsWith(a," test")||J.strEndsWith(a," exam")?"2":J.strContains(a,"essay")?"5":J.strContains(a,"lesson")?"14":null:null}function H(a,b,c,d,e,f){return a?(e||(e=20),f||(f=[]),d&&(a=angular.f("filter")(a,{classId:d},!0)),"class"==b?I(a,c,e,f):"priority"==b?L(a,c,e,f):"type"==b?Q(a,c,e,f):"complete"==b?S(a,e):"late"==b?T(a,e):"upcoming"==b?U(a,e):R(a,c,e,f)):{hasmore:!1,groups:[]}}function I(a,b,c,d){var e=[],f=angular.f("filter"),g={};E(a,function(a){a.classId&&a.className&&!g[a.classId]&&(g[a.classId]=a.className)});var h=[];E(g,function(a,b){h.push({id:b,name:a})}),h.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}),h.push({id:null,name:"No Class"});var i=0,j=!1;return E(h,function(g){if(c>i){var h=g.id?{classId:g.id}:{className:void 0};b||(h.isComplete=!1);var k=g.id?g.id:"no-class",l=d.indexOf(k)>=0?!0:!1,m=f(a,h,!0);if(m.length){if(l)m=[];else{var n=c-i;m.length>n?(m=m.slice(0,n),i=c,j=!0):i+=m.length}e.push({title:g.name,id:k,items:m,closed:l})}}}),{hasmore:j,groups:e}}function L(a,b,c,d){var e=[],f=angular.f("filter"),g=angular.copy(N);g.push({id:null,display:"Not Prioritized"});var h=0,i=!1;return E(g,function(g){if(c>h){var j=g.id?{priority:{id:g.id}}:{priority:void 0};b||(j.isComplete=!1);var k=g.id?g.id:"no-priority",l=d.indexOf(k)>=0?!0:!1,m=f(a,j,!0);if(m.length){if(l)m=[];else{var n=c-h;m.length>n?(m=m.slice(0,n),h=c,i=!0):h+=m.length}e.push({title:g.display,id:k,items:m,closed:l})}}}),{hasmore:i,groups:e}}function Q(a,b,c,d){var e=[],f=angular.f("filter"),g=angular.copy(M);g.push({id:null,display:"Not Categorized"});var h=0,i=!1;return E(g,function(g){if(c>h){var j=g.id?{type:{id:g.id}}:{type:void 0};b||(j.isComplete=!1);var k=g.id?g.id:"no-type",l=d.indexOf(k)>=0?!0:!1,m=f(a,j,!0);if(m.length){if(l)m=[];else{var n=c-h;m.length>n?(m=m.slice(0,n),h=c,i=!0):h+=m.length}e.push({title:g.display,id:k,items:m,closed:l})}}}),{hasmore:i,groups:e}}function R(a,b,c,d){var e=[],f=[],g=[],h=c?c:a.length;h>a.length&&(h=a.length);var i=h<a.length?!0:!1,j=d.indexOf("all")>=0?!0:!1,k=d.indexOf("completed")>=0?!0:!1,l=!1,m=!1,n=0;return E(a,function(a){c>n&&(a.isComplete?(m=!0,k||(f.push(a),n++)):(l=!0,j||(g.push(a),n++)))}),l&&e.push({title:"All",id:"all",items:g,closed:j}),m&&b&&e.push({title:"Completed",id:"completed",items:f,closed:k}),{hasmore:i,groups:e}}function S(a,b){var c=angular.f("filter"),d=c(a,{isComplete:!0},!0);if(d&&d.length){var e=!1;return d.length>b&&(d=d.slice(0,b),e=!0),{hasmore:e,groups:[{title:"Completed",id:"completed-hw",items:d}]}}return null}function T(a,b){var c=angular.f("filter"),d=c(a,{isLate:!0,isComplete:!1},!0);if(d&&d.length){var e=!1;return d.length>b&&(d=d.slice(0,b),e=!0),{hasmore:e,groups:[{title:"Late",id:"late-hw",items:d}]}}return null}function U(a,b){var c=angular.f("filter"),d=c(a,{isUpcomingOrFuture:!0},!0);if(d&&d.length){var e=!1;return d.length>b&&(d=d.slice(0,b),e=!0),{hasmore:!1,groups:[{title:"Upcoming",id:"upcoming-hw",items:d}]}}return null}return{loadHomeworks:function(b,c,d){return a(b,c,d)},toDBHomework:function(a){return b(a)},toUIHomework:function(a){return c(a)},sortUIHomeworks:function(a,b){return d(a,b)},resortUIHomework:function(a,b){return e(a,b)},isHwHidden:function(a){return g(a)},homeworkPriorityForID:function(a){return A(a)},homeworkReminderForID:function(a){return B(a)},homeworkTypeForID:function(a){return C(a);
},homeworkDisplayClasses:function(a){return t(a)},notHomeworkDueTypes:["2","3","4","7","8","9","10","14"],guessHomeworkType:function(a){return G(a)},updateRepeatHomeworkDate:function(a){return x(a)},updateRepeatHomeworkStatus:function(a,b){return y(a,b)},updateHomeworkLateUpcomingStatus:function(a){return v(a)},getLateRepeatHomeworkDates:function(a){return z(a)},filterHomeworksBy:function(a,b,c,d,e){return H(a,b,c,null,d,e)},filterClassHomeworksBy:function(a,b,c,d,e,f){return H(b,c,d,a,e,f)}}}(),M=[{id:"1",display:"Homework"},{id:"2",display:"Test"},{id:"3",display:"Study"},{id:"4",display:"Read"},{id:"5",display:"Paper"},{id:"6",display:"Presentation"},{id:"7",display:"Lab"},{id:"8",display:"Final"},{id:"9",display:"Midterm"},{id:"10",display:"Quiz"},{id:"11",display:"Project"},{id:"12",display:"Workbook"},{id:"14",display:"Lesson"},{id:"13",display:"Other"}],N=[{id:"1",display:"High"},{id:"2",display:"Medium"},{id:"3",display:"Low"}],O=[{id:"n:1",display:"Night Before"},{id:"a:0",display:"When Due"},{id:"a:1",display:"1 Hour Before"},{id:"a:2",display:"2 Hours Before"},{id:"d:1",display:"1 Day Before"},{id:"d:2",display:"2 Days Before"},{id:"d:3",display:"3 Days Before"},{id:"d:4",display:"4 Days Before"},{id:"d:5",display:"5 Days Before"},{id:"d:6",display:"6 Days Before"},{id:"w:1",display:"1 Week Before"},{id:"w:2",display:"2 Weeks Before"},{id:"w:3",display:"3 Weeks Before"}],P=[{id:"1",display:"Every Day"},{id:"2",display:"Every Weekday (Mon - Fri)"},{id:"3",display:"Every Week"},{id:"4",display:"Every Other Week"},{id:"5",display:"Every Month"}],Q=function(){function a(a,b){var c=F.getUserID(a);return new Promise(function(e,g){q.getClasses(c).then(function(c){if(0==c.length)return a.userClassOptions=new Array,a.userClasses=new Array,b&&!a.$$phase&&a.$apply(),void e();var g={};if(a.schools)for(s in a.schools){var h=a.schools[s];g[h.slug]=h}var i={};if(a.teachers)for(t in a.teachers){var j=a.teachers[t];i[j.id]=j}var l=new Array;for(var m in c){var n=c[m];if(n.t){var o=d(n);o.schoolSlug&&g[o.schoolSlug]&&(o.school=g[o.schoolSlug]),o.teacherId&&i[o.teacherId]&&(o.teacher=i[o.teacherId]),l.push(o)}}l.length>1&&l.sort(f);var p=new Array;for(k in l){var n=l[k];n.id&&n.name&&p.push({id:n.id,name:n.name,color:n.color||null,isCurrent:n.isCurrent,isFuture:n.isFuture,isPast:n.isPast})}a.userClassOptions=p,a.userClasses=l,b&&!a.$$phase&&a.$apply(),e()})})}function b(a,b){return new Promise(function(c,e){var f=d(b),g=!0;if(a.userClassOptions)for(k in a.userClassOptions){var h=a.userClassOptions[k];h.id==b.id&&(g=!1)}var i={};if(a.schools)for(s in a.schools){var j=a.schools[s];i[j.slug]=j}var l={};if(a.teachers)for(t in a.teachers){var m=a.teachers[t];l[m.id]=m}f.schoolSlug&&i[f.schoolSlug]&&(f.school=i[f.schoolSlug]),f.teacherId&&l[f.teacherId]&&(f.teacher=l[f.teacherId]),g&&(f.ends>=new Date&&(f.isJoinable=!0),f.isDeletable=!1,f.isLeaveable=!1),f.cnj&&(f.isJoinable=!1,f.isLeaveable=!1,f.isDeletable=!1),c(f)})}function c(a){var b=a.id||J.simpleID(15),c=J.formatISO8601(new Date,3),d={i:b,t:a.name,b:a.building||null,r:a.room||null,ai:a.additionalInfo||null,syf:a.syllabusFile?Y.toDBFile(a.syllabusFile):null,fi:null,w:a.classTimes?S.toDBClassTimes(a.classTimes):null,c:a.created?J.formatISO8601(a.created,3):c,a:a.createdAppId||j.z,u:c,z:j.z};if(a.imps&&(d.imps=a.imps),a.color?d.clr={h:a.color.h,c:a.color.c}:d.clr=null,a.classFiles){var e=new Array;E(a.classFiles,function(a){var b=Y.toDBFile(a);b&&e.push(b)}),d.fi=e.length>0?e:null}if(a.isTeachersIOClass){if(d.s=a.starts?J.formatISO8601(a.starts,1):null,d.e=a.ends?J.formatISO8601(a.ends,1):null,d.ti=a.termId,d.ts=a.termSlug,d.td=a.termDisplay,d.g=a.slug,d.f=a.teacherId,d.d=a.description,d.ss=a.schoolSlug,d.cw=a.isCustomSchedules?!0:!1,d.sy=a.syllabusSections||null,d.ln=null,a.cnj&&(d.cnj=a.cnj),a.classLinks){var f=new Array;E(a.classLinks,function(a){var b=Y.toDBLink(a);b&&f.push(b)}),d.ln=f.length>0?f:null}}else d.sd=a.starts?J.formatISO8601(a.starts,1):null,d.ed=a.ends?J.formatISO8601(a.ends,1):null,d.p=a.teacherName||null;return d}function d(a){var b=a.f?!0:!1,c={id:a.i,dbID:a._id,name:a.t,building:a.b,room:a.r,locationDescription:g(a),additionalInfo:a.ai,created:a.c?J.parseISO8601(a.c):null,createdAppId:a.a,updated:a.u?J.parseISO8601(a.u):null,updatedAppId:a.z,color:a.clr,classTimes:S.toUIClassTimes(a.w),syllabusFile:a.syf?Y.toUIFile(a.syf):null,isTeachersIOClass:b,isDeletable:!0,isLeaveable:!1,isJoinable:!1};if(a.imps&&(c.imps=a.imps),a.fi&&a.fi.length>0){var d=a.fi,e=new Array;for(var f in d)e.push(Y.toUIFile(d[f]));c.classFiles=e}else c.classFiles=null;if(b)if(c.starts=a.s?J.parseISO8601(a.s,1):null,c.ends=a.e?J.parseISO8601(a.e,1):null,c.slug=a.g,c.description=a.d,c.termId=a.ti,c.termSlug=a.ts,c.termDisplay=a.td,c.schoolSlug=a.ss,c.teacherId=a.f,c.syllabusSections=a.sy&&a.sy.length?a.sy:null,c.isCustomSchedules=a.cw,c.isDeletable=!1,c.isLeaveable=!0,void 0!=a.cnj&&(c.cnj=a.cnj,a.cnj&&(c.isJoinable=!1)),a.ln&&a.ln.length>0){var h=a.ln,i=new Array;for(var f in h)i.push(Y.toUILink(h[f]));c.classLinks=i}else c.classLinks=null;else c.starts=a.sd?J.parseISO8601(a.sd,1):null,c.ends=a.ed?J.parseISO8601(a.ed,1):null,c.teacherName=a.p||null;var j=c.starts,k=c.ends,l=!1,m=!1,n=!1;if(j||k){var o=new Date;j&&j>o?n=!0:k&&o>k?m=!0:l=!0}else l=!0;return c.isCurrent=l,c.isPast=m,c.isFuture=n,c}function e(a){var b=[],c=new Date,d=angular.f("date"),e=angular.rootScope(),f={};if(e&&e.userClassOptions)for(k in e.userClassOptions){var g=e.userClassOptions[k];f[g.id]=g}return E(a,function(a){var e={id:a.ti,slug:a.ts,title:a.td,starts:J.parseISO8601(a.tb,1),ends:J.parseISO8601(a.te,1)},g=[];E(a.c,function(a){var b={id:a.i,slug:a.g,name:a.t,starts:a.s?J.parseISO8601(a.s,1):null,ends:a.e?J.parseISO8601(a.e,1):null,description:a.d,schoolSlug:a.ss,building:a.b,room:a.r,isLeaveable:f[a.i]?!0:!1,isJoinable:!1,classTimes:S.toUIClassTimes(a.w)};b.starts&&b.ends&&(b.ends<c?b.dates="Ended "+d(b.ends,"longDate"):b.dates=d(b.starts,"longDate")+" - "+d(b.ends,"longDate")),!b.isLeaveable&&b.ends&&b.ends>=c&&(b.isJoinable=!0),void 0!=a.cnj&&(b.cnj=a.cnj,a.cnj&&(b.isJoinable=!1)),g.push(b)}),e.classes=g,b.push(e)}),b}function f(a,b){if(a.isCurrent){if(!b.isCurrent)return-1}else{if(b.isCurrent)return 1;if(a.isFuture){if(!b.isFuture)return-1}else if(b.isFuture)return 1}return a.name.toLowerCase().localeCompare(b.name.toLowerCase())}function g(a){var b=a.b,c=a.r,d=null;if((b||c)&&(b&&(b=b.trim(),d=b),c&&(c=c.trim())))if(b)d=b+" "+c;else{roomDescription=c;var e=c.toLowerCase();d=J.strStartsWith(e,"room")||J.strStartsWith(e,"rm ")?c:"Room "+c}return d}function h(a,b,c){if(!a||"all"!=b&&!c)return[];if("all"==b)return i(a);var d=J.formatISO8601(c,1),e=J.parseISO8601(d,1);return S.filterClassesByDate(a,e)}function i(a){var b=[],c=[],d=[];E(a,function(a){a.isCurrent?b.push(a):a.isFuture?c.push(a):a.isPast&&d.push(a)});var e=[];return b.length&&e.push({title:"Current Classes",id:J.simpleID(4),items:b}),c.length&&e.push({title:"Future Classes",id:J.simpleID(4),items:c}),d.length&&e.push({title:"Past Classes",id:J.simpleID(4),items:d}),e}return{loadClasses:function(b,c){return a(b,c)},loadClass:function(a,c){return b(a,c)},toUIClass:function(a){return d(a)},toDBClass:function(a){return c(a)},toUITermClasses:function(a){return e(a)},filterClassesBy:function(a,b,c){return h(a,b,c)}}}(),R=function(){function a(a,b){var c=F.getUserID(a);return new Promise(function(d,f){C.getEvents(c).then(function(c){if(0==c.length)return a.userNoSchoolEvents=new Array,a.userNoSchoolDays={},a.userRegularEvents=new Array,b&&!a.$$phase&&a.$apply(),void d();var f=angular.f("date"),g=new Array,h=new Array;for(var i in c){var j=c[i];if(j.t){var k=e(j,f);k?(k.eventDate&&(k.hasTime&&!k.isNoSchoolEvent?(k.shortDateFormat=f(k.eventDate,"h:mm a"),k.endTime&&(k.shortDateFormat=k.shortDateFormat+" - "+f(k.endTime,"h:mm a")),k.longDateFormat=k.shortDateFormat):k.isNoSchoolEvent||(k.shortDateFormat=f(k.eventDate,"EEE, MMM d"),k.longDateFormat=f(k.eventDate,"EEEE, MMM d")),k.calendarDayFormat=f(k.eventDate,"yyyyMMdd")),k.isNoSchoolEvent?h.push(k):g.push(k)):C.deleteEvent(j.i,j.usrid,!0)}}a.userNoSchoolEvents=h,a.userRegularEvents=g;var l={};E(h,function(a){a.isAllDayEvent&&(a.repeats&&a.repeatDates?E(a.repeatDates,function(a){l[a]||(l[a]=0),l[a]=l[a]+1}):a.calendarDayFormat&&(l[a.calendarDayFormat]||(l[a.calendarDayFormat]=0),l[a.calendarDayFormat]=l[a.calendarDayFormat]+1))}),a.userNoSchoolDays=l,b&&!a.$$phase&&a.$apply(),d()})})}function b(a){var b=a.id||J.simpleID(15),c=J.formatISO8601(new Date,3),d={i:b,t:a.description||null,ns:a.isNoSchoolEvent?!0:!1,ad:a.isAllDayEvent?!0:!1,n:a.additionalInfo||null,c:a.created?J.formatISO8601(a.created,3):c,a:a.createdAppId||j.z,u:c,z:j.z,hp:a.isHallPass?!0:!1,hpi:a.hpi||null},e=a.eventDate,f=a.hasTime?2:1;if(a.eventTime&&(f=2,e=J.parseTimeStr(a.eventTime,e)),d.d=J.formatISO8601(e,f),d.p=f,!a.isAllDayEvent&&a.eventEndsTime){var g=J.parseTimeStr(a.eventEndsTime,a.eventDate);d.et=J.formatISO8601(g,2)}if(a.repeats&&a.repeatEnds){var h={e:J.formatISO8601(a.repeatEnds,1)};if("1"==a.repeats.id?(h.t=1,h.dd=[1,2,3,4,5,6,7]):"2"==a.repeats.id?(h.t=1,h.dd=[1,2,3,4,5]):h.t=parseInt(a.repeats.id)-1,a.repeatExcept){var i=[];E(a.repeatExcept,function(a){i.push(J.formatISO8601(K.dateFromDateFormat(a),1))}),i.length&&(h.ed=i)}d.rpt=h}if(a.files){var k=new Array;E(a.files,function(a){var b=Y.toDBFile(a);b&&k.push(b)}),d.fi=k.length>0?k:null}else d.fi=null;if(a.reminder)if("c"==a.reminder.id.charAt(0))d.rm={c:a.reminder.id.substring(2)};else{var l=a.reminder.id.split(":"),m={};m[l[0]]=parseInt(l[1]),d.rm=m}else d.rm=null;return d}function c(a,b){return a.getFullYear()==b.getFullYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate()}function d(a,b){for(var d=0;4>d;d++){if(c(a,b))return!0;b.setDate(b.getDate()+1)}return!1}function e(a,b){var c=2==a.p?!0:!1,e=J.parseISO8601(a.d,a.p),g=new Date;"undefined"==typeof b&&(b=angular.f("date"));var h={id:a.i,dbID:a._id,description:a.t,title:a.t,eventDate:e,dueDate:e,hasTime:c,additionalInfo:a.n,isNoSchoolEvent:a.ns?!0:!1,isAllDayEvent:a.ad?!0:!1,isHallPass:a.hp?!0:!1,hallPassInfo:a.hpi?a.hpi:null,created:a.c?J.parseISO8601(a.c):null,createdAppId:a.a,updated:a.u?J.parseISO8601(a.u):null,updatedAppId:a.z,isDeletable:!0,isEditable:!0,isCompleteable:!1,isUncompleteable:!1,isManual:!0,schoolSlug:a.ss?a.ss:null,showOnSchoolPage:!1};if(h.isHallPass&&(h.isDeletable=!1,h.isEditable=!1),h.hallPassInfo&&"p"==h.hallPassInfo&&(h.isDeletable=!0),h.schoolSlug&&(h.isDeletable=!1,h.isEditable=!1),h.hallPassInfo&&h.hallPassInfo.spg&&(h.showOnSchoolPage=!0),h.isNoSchoolEvent?a.et?(h.endTime=J.parseISO8601(a.et,2),h.isLateStart=!0):h.isAllDayEvent||(h.isEarlyRelease=!0):(a.et&&(h.endTime=J.parseISO8601(a.et,2)),h.isEvent=!0),a.fi&&a.fi.length>0){var i=a.fi,j=new Array;for(var k in i)j.push(Y.toUIFile(i[k]));h.files=j}var l=a.rm;if(l){h.rm=a.rm;for(key in l)h.reminder=L.homeworkReminderForID(key+":"+l[key])}var m=a.rpt;if(m){h.repeatBegins=e;var n=0;if(m.t&&(n=1==m.t?m.dd&&5==m.dd.length?2:1:m.t+1),E(P,function(a){a.id==n.toString()&&(h.repeats=a)}),m.e&&(h.repeatEnds=J.parseISO8601(m.e,1),h.eventEnds=J.parseISO8601(m.e,1),f(h,a,g,b),0==h.repeatDates.length))return null;if(m.ed){var o=[];E(m.ed,function(a){o.push(b(J.parseISO8601(a,1),"yyyyMMdd"))}),o.length&&(h.repeatExcept=o)}}if(!h.isAllDayEvent){var p={type:"time"};h.isLateStart?(p.isLateStartEvent="true",p.startTimeSort=b(h.endTime,"HHmm"),h.timeFormat=b(h.endTime,"shortTime")):(p.startTimeSort=b(h.eventDate,"HHmm"),h.timeFormat=b(h.eventDate,"shortTime")),h.dateClassTimes=[p]}return h.displayClasses=L.homeworkDisplayClasses(h),h.startsInNext4days=d(e,g),h}function f(a,b,c,d){function e(a){if(k.length){var b=J.formatISO8601(a,1);if(k.indexOf(b)>=0)return}j.push(d(a,"yyyyMMdd"))}var f=b.rpt,g=f.t,h=a.eventDate;a.hasTime&&(h=new Date(a.eventDate.getFullYear(),a.eventDate.getMonth(),a.eventDate.getDate()));var i=new Date(a.repeatEnds.getFullYear(),a.repeatEnds.getMonth(),a.repeatEnds.getDate()),j=[],k=f.ed&&f.ed.length?f.ed:[];if(e(h),i>h)if(1==g){var l=f.dd?f.dd:[],m=new Date(h);for(m.setDate(m.getDate()+1);i>=m&&j.length<366;){var n=m.getDay();0==n&&(n=7),l.indexOf(n)>=0&&e(m),m=new Date(m),m.setDate(m.getDate()+1)}}else if(2==g){var m=new Date(h);for(m.setDate(m.getDate()+7);i>=m&&j.length<100;)e(m),m=new Date(m),m.setDate(m.getDate()+7)}else if(3==g){var m=new Date(h);for(m.setDate(m.getDate()+14);i>=m&&j.length<100;)e(m),m=new Date(m),m.setDate(m.getDate()+14)}else if(4==g){var m=new Date(h);m.addMonths(1);for(var o=2;i>=m&&j.length<20;)m.getDate()==h.getDate()&&e(m),m=new Date(h),m.addMonths(o),o++}j.length>1&&j.sort(),a.repeatDates=j}return{loadEvents:function(b,c){return a(b,c)},toDBEvent:function(a){return b(a)},toUIEvent:function(a){return e(a)}}}(),S=function(){function a(a){if(!a)return null;var e=angular.rootScope(),f=e.userSettings.blocks?e.userSettings.blocks:null,g=[];return E(a,function(a){1==a.t?g.push(b(a)):2==a.t?g.push(c(a,f)):3==a.t?g.push(d(a)):4==a.t&&g.push({id:J.simpleID(4),type:"other",freeText:a.ft})}),g.length?g:null}function b(a){function b(a){if(!a)return null;var b=[];return E(a,function(a){var d={startTime:a.b?J.parseTimeStr(a.b):null,endTime:a.e?J.parseTimeStr(a.e):null,days:a.d||[]};d.startTime&&(d.startTimeFormat=c(d.startTime,"shortTime"),d.startTimeSort=c(d.startTime,"HHmm")),d.endTime&&(d.endTimeFormat=c(d.endTime,"shortTime")),d.days.length?d.daysClassname="d"+d.days.join(" d"):d.daysClassname="",b.push(d)}),b}var c=angular.f("date"),d={id:J.simpleID(4),type:"time",numberOfWeeks:a.w,week1:b(a.w1),week2:b(a.w2)};return d}function c(a,b){var c={id:J.simpleID(4),type:"block"},d=[],e=1;return E(a.b,function(a){var c={day:a.d,blocks:a.b||[]},f=c.day||e;if(f){var g=!1;E(b,function(a){a.day==f&&(g=!0,c.color=a.color||null,c.label=a.text||"Day "+String.fromCharCode(96+f).toUpperCase())}),b&&0!=b.length&&g||(c.label="Day "+String.fromCharCode(96+f).toUpperCase())}var h="block";if(angular.rootScope().userSettings.blockDayPeriodName&&(h=angular.rootScope().userSettings.blockDayPeriodName),1==c.blocks.length)c.blocksDisplay=K.ordinalNumber(c.blocks[0])+" "+h;else if(c.blocks.length){var i="",j=1;E(c.blocks,function(a){i+=1==j?K.ordinalNumber(a):c.blocks.length==j?" and "+K.ordinalNumber(a)+" "+h+"s":", "+K.ordinalNumber(a),j++}),c.blocksDisplay=i}d.push(c),e++}),c.blocks=d,c}function d(a){function b(a){if(!a)return null;var b=[];return E(a,function(a){var c={days:a.d||[],periods:a.p||[]};if(c.days.length?c.daysClassname="d"+c.days.join(" d"):c.daysClassname="",1==c.periods.length)c.periodsDisplay=K.ordinalNumber(c.periods[0])+" period";else if(c.periods.length){var d="",e=1;E(c.periods,function(a){d+=1==e?K.ordinalNumber(a):c.periods.length==e?" and "+K.ordinalNumber(a)+" periods":", "+K.ordinalNumber(a),e++}),c.periodsDisplay=d}b.push(c)}),b}var c={id:J.simpleID(4),type:"period",numberOfWeeks:a.w,periodsPerDay:a.pp,week1:b(a.w1),week2:b(a.w2)};return c}function e(a){if(!a)return null;var b=[];return E(a,function(a){"time"==a.type?b.push(f(a)):"block"==a.type?b.push(g(a)):"period"==a.type?b.push(h(a)):"other"==a.type&&b.push({t:4,ft:a.freeText})}),b.length?b:null}function f(a){function b(a){if(!a)return null;var b=[];return E(a,function(a){b.push({d:a.days,b:a.startTime?c(a.startTime,"HH:mm"):null,e:a.endTime?c(a.endTime,"HH:mm"):null})}),b}var c=angular.f("date"),d={t:1,w:a.numberOfWeeks,w1:b(a.week1),w2:2==a.numberOfWeeks?b(a.week2):null};return d}function g(a){var b={t:2,b:[]},c=[];return E(a.blocks,function(a){c.push({d:a.day,b:a.blocks})}),b.b=c,b}function h(a){function b(a){if(!a)return null;var b=[];return E(a,function(a){b.push({d:a.days,p:a.periods})}),b}var c={t:3,w:a.numberOfWeeks,pp:a.periodsPerDay,w1:b(a.week1),w2:2==a.numberOfWeeks?b(a.week2):null};return c}function i(a,b){function c(a){if("time"!=a.type)return!0;var b=!0;return E(i,function(c){c.isLateStart?a.startTimeSort<c.dateClassTimes[0].startTimeSort&&(b=!1):c.isEarlyRelease&&a.startTimeSort>=c.dateClassTimes[0].startTimeSort&&(b=!1)}),b}var d=angular.f("filter"),e=[],f=0==b.getDay()?7:b.getDay(),g=angular.rootScope(),h=g.userSettings.dayAStartDate?g.userSettings.dayAStartDate:null,i=new Array;if(g.userNoSchoolEvents){var o=angular.f("date"),p=o(b,"yyyyMMdd"),q=new Array;if(E(g.userNoSchoolEvents,function(a){if(a.repeats&&a.repeatDates){var b=!1;E(a.repeatDates,function(a){a==p&&(b=!0)}),b&&a.isAllDayEvent?q.push(a):b&&i.push(a)}else a.calendarDayFormat==p&&(a.isAllDayEvent?q.push(a):i.push(a))}),q.length>0)return[{title:"Classes",id:J.simpleID(4),items:q}]}var r=2;g.userSettings.blocks&&E(g.userSettings.blocks,function(a){1!=a.day&&2!=a.day&&(r+=1)});var s=d(a,function(a){return a.starts&&a.starts>b?!1:a.ends&&a.ends<b?!1:!0}),t=-1;if(h&&r)if(g.userSettings.hasSchoolBlockSchedule){var u=k(b,g.userSettings,g.userNoSchoolDays);u&&(t=u.day)}else t=l(h,b,r);var v=[];return E(s,function(a){if(a.classTimes){var d=a.starts?j(a.starts,b):!0,g=!1;0>t&&a.starts&&r&&!h&&(t=l(a.starts,b,r));var i=[];if(E(a.classTimes,function(a){"time"==a.type||"period"==a.type?2!=a.numberOfWeeks||d?a.week1&&a.week1.length?E(a.week1,function(b){b.days&&b.days.length&&b.days.indexOf(f)>=0&&(b.type=a.type,c(b)&&i.push(b)),2==a.numberOfWeeks&&(g=!0)}):2==a.numberOfWeeks&&(g=!0):a.week2&&a.week2.length&&E(a.week2,function(b){b.days&&b.days.length&&b.days.indexOf(f)>=0?(b.type=a.type,c(b)&&(i.push(b),g=!0)):g=!0}):"block"==a.type&&t>0&&E(a.blocks,function(b){b.day==t&&(b.type=a.type,i.push(b))})}),i.length)i.length>1&&i.sort(m),a.dateClassTimes=i,g&&(a.classTimesAlternate=g,a.classTimesIsWeek1=d),e.push(a);else if(g){var k={classTimesAlternate:!0,classTimesIsWeek1:d};v.push(k)}}}),E(i,function(a){e.push(a)}),e.length||v.length?(e.length>1&&e.sort(n),[{title:"Classes",id:J.simpleID(4),items:e,altItems:v}]):[]}function j(a,b){var c=K.dateFirstDayOfTheWeek(a),d=K.dateFirstDayOfTheWeek(b),e=K.daysInBetween(c,d);return e/7%2==0}function k(a,b,c){if(!b||!a)return null;if(!b.blocks||0==b.blocks.length)return null;if(0==a.getDay()||6==a.getDay())return null;var d=angular.f("date"),e=d(a,"yyyyMMdd"),f={};b.blocks&&E(b.blocks,function(a){a.si&&(f[a.si]=a)});var g=new Array;if(b.explicitBlockDates){g=Object.keys(b.explicitBlockDates);var h=b.explicitBlockDates[e];if(h){var i=f[h.si];if(i)return b.blocks[i.day-1]}}var j=new Array;if(c){j=Object.keys(c);var k=c[e];if(k)return null}var l=g.concat(j),m=1,n=b.dayAStartDate;if(n>a)return null;for(var o=n;a>o;)0==o.getDay()||6==o.getDay()||l&&-1!=l.indexOf(d(o,"yyyyMMdd"))||(m==b.blocks.length?m=1:m++),o=J.addDaysToDate(o,1);return b.blocks[m-1]}function l(a,b,c){if(!c||0==c||0==b.getDay()||6==b.getDay())return-1;var d=angular.rootScope(),e=new Array;d.userNoSchoolDays&&E(d.userNoSchoolDays,function(a,b){if(8==b.length){var c=parseInt(b.substring(0,4)),d=parseInt(b.substring(4,6)),f=parseInt(b.substring(6,8)),g=new Date(c,d-1,f);e.push(g)}});for(var f=0;b>a;)0!=a.getDay()&&6!=a.getDay()&&(f>=c&&(f=0),e.map(Number).indexOf(+a)<0&&f++),a=J.addDaysToDate(a,1);return f>=c&&(f=0),f+1}function m(a,b){return"time"==a.type?"time"!=b.type?-1:a.startTime&&b.startTime?a.startTime<b.startTime?-1:b.startTime<a.startTime?1:0:a.startTime?-1:b.startTime?1:0:"time"==b.type?1:"period"==a.type&&"period"!=b.type?-1:"period"==b.type?1:"block"==a.type&&"block"!=b.type?-1:"block"==b.type?1:0}function n(a,b){var c=a.dateClassTimes[0],d=b.dateClassTimes[0];return"time"==c.type?"time"!=d.type?-1:c.startTimeSort&&d.startTimeSort?c.startTimeSort<d.startTimeSort?-1:d.startTimeSort<c.startTimeSort?1:c.isLateStartEvent&&!d.isLateStartEvent?-1:d.isLateStartEvent&&!c.isLateStartEvent?1:0:c.startTimeSort?-1:d.startTimeSort?1:0:"time"==d.type?1:"period"==c.type?"period"!=d.type?-1:c.periods[0]<=d.periods[0]?-1:1:"period"==d.type?1:"block"==c.type?"block"!=d.type?-1:c.blocks[0]<=d.blocks[0]?-1:1:"block"==d.type?1:0}function o(a,b){function c(a,b){var c=!0;return E(a,function(a){a.isLateStart?b.startTimeSort<a.dateClassTimes[0].startTimeSort&&(c=!1):a.isEarlyRelease&&b.startTimeSort>=a.dateClassTimes[0].startTimeSort&&(c=!1)}),c}for(var d=new Date,e=(b.userSettings.blocks?b.userSettings.blocks.length:null,b.userSettings.dayAStartDate?b.userSettings.dayAStartDate:null,!0),f=null,g=!1,h=angular.f("date"),i=0;14>i;i++)if(a.starts&&a.starts>d)d=J.addDaysToDate(d,1),e=!1;else{if(a.ends&&a.ends<d)break;var l=h(d,"yyyyMMdd");if(b.userNoSchoolDays&&b.userNoSchoolDays[l])d=J.addDaysToDate(d,1),e=!1;else{var m=new Array;b.userNoSchoolEvents&&E(b.userNoSchoolEvents,function(a){if(a.repeats&&a.repeatDates){var b=!1;E(a.repeatDates,function(a){a==l&&(b=!0)}),b&&!a.isAllDayEvent&&m.push(a)}else a.calendarDayFormat==l&&(a.isAllDayEvent||m.push(a))});var n=0==d.getDay()?7:d.getDay(),o=a.starts?j(a.starts,d):!0,p=-1,q=J.formatISO8601(d,1),r=J.parseISO8601(q,1),s=k(r,b.userSettings,b.userNoSchoolDays);s&&(p=s.day);for(var t=0;t<a.classTimes.length;t++){var u=a.classTimes[t];if("time"==u.type||"period"==u.type?2!=u.numberOfWeeks||o?u.week1&&u.week1.length&&E(u.week1,function(a){!f&&a.days&&a.days.length&&a.days.indexOf(n)>=0&&("time"==u.type?c(m,a)&&(e?a.startTime&&(a.startTime.getHours()>d.getHours()||a.startTime.getHours()==d.getHours()&&a.startTime.getMinutes()>=d.getMinutes())&&(f=d,f.setHours(a.startTime.getHours()),f.setMinutes(a.startTime.getMinutes()),g=!0):(f=d,a.startTime&&(f.setHours(a.startTime.getHours()),f.setMinutes(a.startTime.getMinutes()),g=!0))):e||(f=d))}):u.week2&&u.week2.length&&E(u.week2,function(a){!f&&a.days&&a.days.length&&a.days.indexOf(n)>=0&&("time"==u.type?c(m,a)&&(e?a.startTime&&(a.startTime.getHours()>d.getHours()||a.startTime.getHours()==d.getHours()&&a.startTime.getMinutes()>=d.getMinutes())&&(f=d,f.setHours(a.startTime.getHours()),f.setMinutes(a.startTime.getMinutes()),g=!0):(f=d,a.startTime&&(f.setHours(a.startTime.getHours()),f.setMinutes(a.startTime.getMinutes()),g=!0))):e||(f=d))}):"block"==u.type&&p>0&&E(u.blocks,function(a){f||a.day!=p||e||(f=d)}),f)break}if(f)break;d=J.addDaysToDate(d,1),e=!1}}return f?{date:f,hasTime:g}:null}return{toUIClassTimes:function(b){return a(b)},toDBClassTimes:function(a){return e(a)},filterClassesByDate:function(a,b){return i(a,b)},getActiveBlockDay:function(a,b,c){return l(a,b,c)},getUserBlockDayInfoForDate:function(a,b,c){return k(a,b,c)},getNextClassDate:function(a,b){return o(a,b)}}}(),T=function(){function a(a,d){var e=F.getUserID(a);return new Promise(function(f,g){u.getAnnouncements().then(function(g){if(0==g.length)return a.userAnnouncements=null,a.unreadAnnouncements=0,d&&!a.$$phase&&a.$apply(),void f();var h={};if(a.userClassOptions)for(k in a.userClassOptions){var i=a.userClassOptions[k];h[i.id]=i}var j={};if(a.schools)for(s in a.schools){var l=a.schools[s];j[l.slug]=l}var m={};if(a.teachers)for(t in a.teachers){var n=a.teachers[t];m[n.id]=n}var o={},p=new Array;E(g,function(a){if(a.usrid==e){var c=b(a);if(c.classIds){var d=new Array;for(var f in c.classIds){var g=c.classIds[f];if(g){var i=h[g];i&&d.push({id:i.id,name:i.name})}}d.length&&(c.classes=d)}c.isRead||(o[e]?o[e]=o[e]+1:o[e]=1),c.schoolSlug&&j[c.schoolSlug]&&(c.school=j[c.schoolSlug]),c.teacherId&&m[c.teacherId]&&(c.teacher=m[c.teacherId]),p.push(c)}else a.r||(o[a.usrid]?o[a.usrid]=o[a.usrid]+1:o[a.usrid]=1)}),p.length>1&&p.sort(c),a.userAnnouncements=p.length?p:null,a.unreadAnnouncements=o[e]||0,a.users&&E(a.users,function(a){o[a.id]?a.unreadAnnouncements=o[a.id]:a.unreadAnnouncements=0}),d&&!a.$$phase&&a.$apply(),f()})})}function b(a){var b={id:a.i,dbID:a._id,text:a.t,textHTML:a.th,fromType:a.ft||1,schoolSlug:a.ss||null,teacherId:a.f||null,created:a.c?J.parseISO8601(a.c,2):null,classIds:a.k||null,isRead:a.r?!0:!1,hallPassId:a.hp_id||null};if(b.textHTML){var c=$("<p>"+b.textHTML+"</p>");c.find("a").attr("target","_blank"),b.textHTML=c.html()}return b}function c(a,b){var c=a.created,d=b.created;if(d>c)return 1;if(c>d)return-1;if(a.isRead){if(!b.isRead)return 1}else if(b.isRead)return-1;return 0}function d(a){var b=new Date;if(b.setSeconds(b.getSeconds()+2),j.isChromeApp)chrome.notifications.getPermissionLevel(function(c){"granted"==c&&chrome.alarms.create("announcement:"+a,{when:b.getTime()})});else if(j.isWindowsApp){var c=Windows.UI.Notifications.ToastNotificationManager.getTemplateContent(Windows.UI.Notifications.ToastTemplateType.toastText01),d=c.getElementsByTagName("text");d[0].appendChild(c.createTextNode(a));var e=c.selectSingleNode("/toast");e.setAttribute("launch",'{"type":"toast","hw":"announcement"}');var f=new Windows.UI.Notifications.ScheduledToastNotification(c,b),g=Windows.UI.Notifications.ToastNotificationManager.createToastNotifier();g.addToSchedule(f),H}else j.isMacApp&&MacApp.Notifications.notify({id:"announcement",title:"myHomework",content:a,when:J.formatISO8601(b,2)})}return{loadAnnouncements:function(b,c){return a(b,c)},toUIAnnouncement:function(a){return b(a)},notify:function(a){return d(a)}}}(),U=function(){return{isMac:function(){return/(Mac)/g.test(navigator.userAgent)},isMacModalWindow:function(){return"undefined"==typeof MacApp?!1:"undefined"!=typeof MacApp.ModalProp},hasTransparentTitleBar:function(){return/(transparent-title-bar)/g.test(navigator.userAgent)},isElCaptain:function(){return/(el-captain)/g.test(navigator.userAgent)},updateMainRouteToModal:function(a){a.templateUrl=MacApp.ModalProp.templateUrl,a.controller=MacApp.ModalProp.controller,ra.provider("$modalParams",function(){this.$get=function(){return MacApp.ModalProp.params?MacApp.ModalProp.params:{}}}),"ThemeCtrl"==a.controller?U.adjustModalHeightAndShow(350):U.adjustModalHeightAndShow()},updateModalScope:function(a){if(MacApp.ModalProp.windowScope)for(var b in MacApp.ModalProp.windowScope)a[b]=MacApp.ModalProp.windowScope[b]},adjustModalHeightAndShow:function(a){document.addEventListener("MacApp.load.complete",function(){var b=setInterval(function(){var c=document.querySelector(".lightbox-content");c&&(clearInterval(b),setTimeout(function(){if(a)MacApp.Window.finishedLoadingWithHeight(a);else{var b=document.querySelector(".lightbox-content").offsetHeight;U.hasTransparentTitleBar()||(b+=23),MacApp.Window.finishedLoadingWithHeight(b)}},50))},50)})},adjustModalHeight:function(){j.isMacApp&&setTimeout(function(){var a=document.querySelector(".lightbox-content").scrollHeight;U.hasTransparentTitleBar()||(a+=22),MacApp.Window.adjustModalHeight(a),U.setNoDragAreas()},50)},saveNavLayoutSetting:function(a){D.setLocalItem("navLayout",{open:a.hasClass("open"),width:a.width()})},getNavLayoutSetting:function(){return new Promise(function(a,b){D.getLocalItem("navLayout").then(function(b){a(b)})})},setMenuItemState:function(a,b,c){if(j.isMacApp)try{MacApp.Menu.getItem(a)&&MacApp.Menu.getItem(a).submenu.getItem(b)&&MacApp.Menu.getItem(a).submenu.getItem(b).setState(c)}catch(d){Canadarm.error("Failed to set Menu Item State",d)}},setMenuItemEnabled:function(a,b,c){if(j.isMacApp)try{MacApp.Menu.getItem(a)&&MacApp.Menu.getItem(a).submenu.getItem(b)&&MacApp.Menu.getItem(a).submenu.getItem(b).setEnabled(c)}catch(d){Canadarm.error("Failed to set Menu Item Enabled",d)}},setNoDragAreas:function(){if(j.isMacApp||U.isElCaptain()){var a=[];E($(".no-drag-area"),function(b){var c=$(b)[0].getBoundingClientRect().left,d=c+$(b).width();a.push([c,d])}),MacApp.Window.setNoDragAreas(a)}}}}(),V=function(){return{openAppURL:function(a){var b=angular.element(document.body),c=b.scope().$root,d=b.injector().get("$location");d.url(a),c.$$phase||c.$apply()},changeUser:function(a){var b=angular.rootScope();b.changeUser(a)},changeUserAndOpenUpgrade:function(a){var b=angular.rootScope();b.changeUser(a,!0)},signUserOut:function(a){var b=angular.rootScope();b.performSignout(a)},openSettings:function(){var a=angular.rootScope();a.openSettings()},openAbout:function(){var a=angular.rootScope();a.openAbout()},sync:function(){var a=angular.rootScope();a.manualSync()},forceSync:function(){var a=angular.rootScope();a.forceSync()},reloadStorage:function(){D.reloadStorage(angular.rootScope(),!0)},openReminder:function(a){xa.openHwReminderWithID(a)}}}();!U.isMacModalWindow()&&j.isMacApp&&D.restartOnChange();var W;j.isWindowsApp&&(W=Windows.UI.Notifications,W.TileUpdateManager.createTileUpdaterForApplication().enableNotificationQueue(!0));var X=function(){function a(a){if(j.isWindowsApp){var g=angular.f("filter");if(b(),a.unreadAnnouncements&&c(a.unreadAnnouncements),a.userHomeworks){var h=g(a.userHomeworks,{isLate:!0},!0),i=g(a.userHomeworks,{isDueToday:!0},!0),k=g(a.userHomeworks,{isDueTomorrow:!0},!0);(h.length||i.length||k.length)&&(d(),e()),k.length&&(f(k.length+" Tomorrow",k,"tomorrow",W.TileTemplateType.tileWideText01),f(k.length+" Tomorrow",k,"tomorrow-sq",W.TileTemplateType.tileSquare310x310Text01)),i.length&&(f(i.length+" Today",i,"today",W.TileTemplateType.tileWideText01),f(i.length+" Today",i,"today-sq",W.TileTemplateType.tileSquare310x310Text01)),h.length&&(f(h.length+" Late",h,"late",W.TileTemplateType.tileWideText01),f(h.length+" Late",h,"late-sq",W.TileTemplateType.tileSquare310x310Text01))}}}function b(){j.isWindowsApp&&(W.TileUpdateManager.createTileUpdaterForApplication().clear(),W.BadgeUpdateManager.createBadgeUpdaterForApplication().clear())}function c(a){var b=W.BadgeTemplateType.badgeNumber,c=W.BadgeUpdateManager.getTemplateContent(b),d=c.getElementsByTagName("badge");d[0].setAttribute("value",a);var e=new W.BadgeNotification(c);W.BadgeUpdateManager.createBadgeUpdaterForApplication().update(e)}function d(){var a=W.TileUpdateManager.getTemplateContent(W.TileTemplateType.tileWideImage),b=a.getElementsByTagName("image");b[0].setAttribute("src","ms-appx:///images/WideLogo.scale-100.png"),b[0].setAttribute("alt","myHomework Logo");var c=a.getElementsByTagName("binding");c[0]&&c[0].setAttribute("branding","none");var d=new W.TileNotification(a);d.tag="myhw";var e=new Date;d.expirationTime=new Date(e.getTime()+6e5),W.TileUpdateManager.createTileUpdaterForApplication().update(d)}function e(){var a=W.TileUpdateManager.getTemplateContent(W.TileTemplateType.tileSquare310x310Image),b=a.getElementsByTagName("image");b[0].setAttribute("src","ms-appx:///images/LargeSquareLogo.scale-100.png"),b[0].setAttribute("alt","myHomework Logo");var c=a.getElementsByTagName("binding");c[0]&&c[0].setAttribute("branding","none");var d=new W.TileNotification(a);d.tag="myhw";var e=new Date;d.expirationTime=new Date(e.getTime()+6e5),W.TileUpdateManager.createTileUpdaterForApplication().update(d)}function f(a,b,c,d){var e=W.TileUpdateManager.getTemplateContent(d),f=e.getElementsByTagName("text");f[0].appendChild(e.createTextNode(a));var g=1;E(b,function(a){var b="- "+a.title;a.className&&(b+=", "+a.className),f[g]&&f[g].appendChild(e.createTextNode(b)),g++});var h=new W.TileNotification(e);h.tag=c;var i=new Date;h.expirationTime=new Date(i.getTime()+6e5),W.TileUpdateManager.createTileUpdaterForApplication().update(h)}return{setupLiveTiles:function(b){a(b)},clearLiveTiles:function(){b()}}}(),Y=function(){function a(a,b){if("file"==b&&a.contentType){if(Z.indexOf(a.contentType)>=0)return"word";if(_.indexOf(a.contentType)>=0)return"excel";if(aa.indexOf(a.contentType)>=0)return"powerpoint";if(ba.indexOf(a.contentType)>=0)return"document";if(ca.indexOf(a.contentType)>=0)return"spreadsheet";if(da.indexOf(a.contentType)>=0)return"presentation";if(ha.indexOf(a.contentType)>=0)return"image";if(ia.indexOf(a.contentType)>=0)return"text";if(ja.indexOf(a.contentType)>=0)return"pdf";if(ka.indexOf(a.contentType)>=0)return"zip";if(la.indexOf(a.contentType)>=0)return"video";if(ma.indexOf(a.contentType)>=0)return"audio";if(ga.indexOf(a.contentType)>=0)return"keynote";if(ea.indexOf(a.contentType)>=0)return"pages";if(fa.indexOf(a.contentType)>=0)return"numbers"}var c=URI(a.url),d=c.hostname().replace("www.","");if(na.indexOf(d)>=0)return"video";if(oa.indexOf(d)>=0)return"audio";if(pa.indexOf(d)>=0)return"image";if("docs.google.com"==d){var e=c.path().split("/");if("document"==e[1])return"document";if("spreadsheet"==e[1])return"spreadsheet";if("presentation"==e[1])return"presentation"}return"link"==b?"link_":""}function b(a){return a?ha.indexOf(a)>=0?!0:ia.indexOf(a)>=0?!0:ja.indexOf(a)>=0?!0:Z.indexOf(a)>=0?!0:_.indexOf(a)>=0?!0:aa.indexOf(a)>=0?!0:ba.indexOf(a)>=0?!0:ca.indexOf(a)>=0?!0:da.indexOf(a)>=0?!0:ka.indexOf(a)>=0?!0:la.indexOf(a)>=0?!0:ma.indexOf(a)>=0?!0:ga.indexOf(a)>=0?!0:ea.indexOf(a)>=0?!0:fa.indexOf(a)>=0?!0:!1:!1;
}function c(a){if(!a)return!1;var b=["image/gif","image/pjpeg","image/jpeg","image/png","image/x-png"];return b.indexOf(a)>=0?!0:!1}return{resourceType:function(b,c){return a(b,c)},supportedType:function(a){return b(a)},supportedPictureType:function(a){return c(a)},toUIFile:function(b){var c={id:b.i,url:b.u,displayText:b.t,contentType:b.c,sizeInBytes:b.s,uploadedDate:b.d?J.parseISO8601(b.d):null,sq:b.sq,t:"file"};return c.resourceType=a(c,"file"),c},toDBFile:function(a){return{i:a.id,u:a.url,t:a.displayText,c:a.contentType,s:a.sizeInBytes,d:J.formatISO8601(a.uploadedDate,3),sq:a.sq}},toUILink:function(b){var c={id:b.i,url:b.u,displayText:b.t,createdDate:b.d?J.parseISO8601(b.d):null,sq:b.sq,t:"link"};return c.resourceType=a(c,"link"),c},toDBLink:function(a){return{i:a.id,u:a.url,t:a.displayText,d:J.formatISO8601(a.createdDate,3),sq:a.sq}}}}(),Z=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/msword","application/docx","application/vnd.ms-word.document","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],_=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","application/x-msexcel","application/ms-excel","application/msexcel","application/x-excel"],aa=["application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint","application/mspowerpoint","application/vnd.ms-powerpoint.presentation.macroenabled.12"],ba=["application/vnd.oasis.opendocument.text","application/vnd.google-apps.document","application/vnd.google-apps.kix"],ca=["application/vnd.oasis.opendocument.spreadsheet","application/vnd.google-apps.spreadsheet"],da=["application/vnd.oasis.opendocument.presentation","application/vnd.google-apps.presentation"],ea=["application/x-iwork-pages-sffpages"],fa=["application/x-iwork-numbers-sffnumbers"],ga=["application/x-iwork-keynote-sffkey"],ha=["image/gif","image/pjpeg","image/jpeg","image/png","image/svg+xml","image/tiff","image/vnd.microsoft.icon","image/x-png","application/vnd.google-apps.photo"],ia=["text/plain","text/cmd","text/css","text/csv","text/html","text/javascript","application/javascript","text/plain","text/vcard","text/xml","text/rtf","text/json","application/json","application/x-tex"],ja=["application/pdf","application/x-pdf","pdf/pdf"],ka=["application/zip","application/x-gzip","application/x-gtar","application/x-tar","application/x-ustar","application/x-rar-compressed"],la=["video/mpeg","video/mpeg2","video/quicktime","video/x-msvideo","video/x-sgi-movie","video/mp4","video/ogg","video/webm","video/x-flv","video/x-matroska","video/x-ms-wmv","video/x-ms-asf","application/vnd.google-apps.video"],ma=["audio/basic","audio/L24","audio/mp3","audio/mp4","audio/mpeg","audio/ogg","audio/vorbis","audio/x-ms-wma","audio/x-ms-wax","audio/vnd.rn-realaudio","audio/vnd.wave","audio/webm","audio/x-mpeg","audio/x-mpeg2","audio/x-wav","text/x-speech","application/vnd.google-apps.audio","audio/m4a","audio/x-m4a"],na=["youtube.com","youtu.be","vimeo.com","hulu.com","netflix.com","veoh.com","dailymotion.com","metacafe.com"],oa=["open.spotify.com","spotify.com","grooveshark.com","rd.io","rdio.com","pandora.com"],pa=["instagram.com","instagr.am","twitpic.com","yfrog.com","pic.twitter.com","flickr.com","smugmug.com"],qa=["ngRoute","ngSanitize","ui.bootstrap.modal","ui.bootstrap.datepicker","ui.bootstrap.carousel","ui.bootstrap.tooltip","angularUtils","ngImgCrop","tmh.dynamicLocale","relativeDate"];j.isMacApp||qa.push("ngAnimate");var ra=angular.module("myHomework",qa);ra.config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|file|mailto|chrome-extension|ms-appx):/)}]),ra.controller("FrameCtrl",["$rootScope","$scope","$window","$location","$modal","$modalParams","$timeout","$interval","$sce","hwSync","tmhDynamicLocale",function(a,b,c,d,e,f,g,h,i,j,k){b.url=angular.copy(f.url),b.viewtitle=angular.copy(f.viewtitle),b.frameUrl=i.trustAsResourceUrl(b.url),b.cancel=function(){e.close()};var l=function(a){console.log(a)};window.addEventListener("message",l,!1)}]),ra.controller("WinWebviewCtrl",["$rootScope","$scope","$window","$onready","$location","$modal","$modalParams","$timeout","$interval","$sce","hwSync","tmhDynamicLocale",function(a,b,c,d,e,f,g,h,i,j,k,l){b.url=angular.copy(g.url),b.viewtitle=angular.copy(g.viewtitle),b.frameUrl=j.trustAsResourceUrl(b.url),b.cancel=function(){f.close()};var m=function(){console.log("got it!");var b=angular.element(document.querySelector("#webviewmain")),c=document.getElementById("webviewmain");c.addEventListener("MSWebViewNavigationStarting",function(b){b.uri&&b.uri.indexOf("success-sync")>0&&(k.sync(a.user.id,!1,!0),f.close())}),b.on("MSWebViewContentLoading",function(a){console.log(a)}),b.on("MSWebViewUnsupportedUriSchemeIdentified",function(a){console.log(a)})};d(m)}]),ra.controller("AppCtrl",["$rootScope","$scope","$window","$location","$modal","$timeout","$interval","hwSync","tmhDynamicLocale",function(a,b,c,d,f,g,h,i,k){function l(){D.loadStorage(a,!0).then(function(){if(a.showTheme=a.user&&a.user.theme?!0:!1,a.$$phase||a.$apply(),U.isMacModalWindow())g(function(){U.setNoDragAreas()},600);else{if(h(r,6e4),r(),h(H,864e5),H(),a.startGoogleAnalyticsSession(),ua.sendAppView("App Launched"),p(),a.isKioskApp&&!a.user&&d.url("/login"),a.userSettings&&a.userSettings.showCalendarOnStart)d.url("/calendar");else if(a.premiumSchool&&a.premiumSchool.hall_passes_on){new Array;a.userClassOptions&&E(a.userClassOptions,function(b){(b.isCurrent||b.isFuture)&&d.url("/schools/"+a.premiumSchool.slug)})}g(function(){a.splashScreenClass="hiding",g(function(){a.splashScreenClass="hidden",G(),U.setNoDragAreas()},600)},300)}})}function n(){return new Promise(function(a){for(var b=0;b<localStorage.length;b++){var c=localStorage.key(b);"com."!==c.substring(0,4)&&MacApp.Storage.set(c,localStorage.getItem(c),function(){})}MacApp.Storage.set("dataMigrated","true",function(){a()})})}function p(){if(j.isMacApp){var c=a.user?!0:!1;try{var e=MacApp.Menu.getItem("File").submenu;e.addItem({label:"New Homework",keys:"cmd+n",index:0},function(){f.open({templateUrl:"templates/homework/add-edit.html",controller:"AddHomeworkCtrl",title:"Add Homework",size:"medium"})}),e.addItem({label:"New Class",keys:"shift+cmd+n",index:1},function(){f.open({templateUrl:"templates/classes/add-or-join.html",controller:"AddOrJoinClassCtrl",title:"Add or Join Class",size:a.userSchools?"medium":"medium-large"})}),e.addSeparator({index:2}),e.addItem({label:"Sync",keys:"shift+cmd+s",index:3,enabled:c},function(){a.manualSync()}),e.addSeparator({index:4}),a.user?e.addItem({label:"Sign out",keys:"shift+cmd+w"},function(){a.signOut(a.user.id)}):e.addItem({label:"Sign in",keys:"shift+cmd+w"},function(){d.url("/login"),b.$$phase||b.$apply()});var g=MacApp.Menu.getItem("View").submenu;g.addItem({label:"Narrow Menu",keys:"cmd+[",index:0},function(){a.navOpened=!a.navOpened,a.$$phase||a.$apply(),U.setNoDragAreas()}),g.addSeparator({index:1}),g.addItem({label:"Account",keys:"cmd+1",index:2,enabled:c},function(){a.openAccount()}),g.addItem({label:a.macOnlyColumn&&"middle-right"!=a.macOnlyColumn?"Classes":"Home",keys:"cmd+2",index:3,state:a.macOnlyColumn?"off":"on"},function(){d.url("/home"),b.$$phase||b.$apply()}),g.addItem({label:"Calendar",keys:"cmd+3",index:4},function(){d.url("/calendar"),b.$$phase||b.$apply()}),g.addItem({label:"Homework",keys:"cmd+4",index:5},function(){d.url("/homework"),b.$$phase||b.$apply()}),g.addItem({label:"Teachers",keys:"cmd+5",index:6},function(){d.url("/teachers"),b.$$phase||b.$apply()}),g.addItem({label:"Announcements",keys:"cmd+6",index:7},function(){d.url("/announcements"),b.$$phase||b.$apply()}),g.addItem({label:"Themes",keys:"cmd+7",index:8,enabled:c},function(){a.openThemes()}),g.addSeparator({index:9})}catch(h){Canadarm.error("Failed to load Menu on Mac",h)}}}function q(){j.isWebApp||D.getLocalItem("rateCount").then(function(a){if(null!=a){if(0>a)return;a>=14?(ua.sendEvent("Rate","Display","Question"),nAlert({title:"Enjoying myHomework?",text:"If so, please take a moment to rate it!",confirmButtonText:"Rate myHomework",altButtonText:"No, Thanks",cancelButtonText:"Ask me later",showCancelButton:!0,showAltButton:!0,width:510},function(a,b){a?(ua.sendEvent("Rate","Clicked","Rate"),D.setLocalItem("rateCount",-1),j.isChromeApp?J.openURL(c,"https://chrome.google.com/webstore/detail/myhomework-student-planner/pembccdigcahnckbjcbehhcacplbbomj/reviews"):j.isWindowsApp?J.openURL(c,"http://apps.microsoft.com/windows/en-us/app/myhomework/438f2bec-f200-4b9d-96ad-7f95fbe93409"):j.isMacApp&&J.openURL(c,"macappstore://itunes.apple.com/app/id970610831")):b?(ua.sendEvent("Rate","Clicked","Never"),D.setLocalItem("rateCount",-1)):(ua.sendEvent("Rate","Clicked","Later"),D.setLocalItem("rateCount",1),g(q,864e5))})):(D.setLocalItem("rateCount",a+1),g(q,864e5))}else D.setLocalItem("rateCount",1),g(q,864e5)})}function r(){!a.syncing&&a.users&&m.hasChanges().then(function(a){if(S==Q||1==a){s(!1,!1);var b=R+S;R=S,S=b,0==R&&0==S&&(S=1),1==R&&1==S&&(Q-=1)}else x();Q++,Q>=60&&(Q=0,R=0,S=0)})}function s(c,d){if(b.showLastSyncWarning=!1,!a.syncing&&a.users){t(c);var e=new Array;E(a.users,function(a){e.push(function(){return i.sync(a,d?!0:!1,c)})}),Promise.loop(e).then(function(b){var d=!1,e=0;b&&b.length&&E(b,function(b){b.userid==a.user.id&&(c&&b.data&&b.data.pfs&&b.data.pfs.length?g(function(){z(b.data.pfs)},1e3):c&&b.data&&b.data.gpi&&b.data.gpi.i&&y(b.data.gpi),b.themeChanged&&(d=!0),e=b.unreadAnnouncements)}),D.reloadStorage(a,!0).then(function(){if(u(c,d),x(),e>0&&!j.isWebApp){var a=new Date;if(V&&6e4>a-V)return;1==e?T.notify("You have 1 new unread announcement."):T.notify("You have "+e+" new unread announcements."),V=a}})},function(b){if(x(),J.logError(b),c&&v(b),402==b.status&&a.user.daysLeftToRenew>0){var d=new Date;a.user.daysLeftToRenew=0,a.user.renewByDate=d,a.user.mustRenew=!0,w.setUserInfo(a.user.id,{rdt:J.formatISO8601(d,1)}),a.$$phase||a.$apply()}u(c)})}}function t(b){W=new Date,a.syncing=!0,b&&(a.mainSpinner={type:"sync",text:"Syncing",show:!0}),a.$$phase||a.$apply()}function u(b,c){var d=new Date-W,e=2e3-d%2e3;g(function(){a.syncing=!1,b&&(a.mainSpinner.show=!1),c&&a.user.theme?(a.showTheme=!1,a.$$phase||a.$apply(),a.showTheme=!0,a.$$phase||a.$apply()):a.$$phase||a.$apply()},e)}function v(a){return a&&a.status?402==a.status?void f.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Renew Account",size:"small",params:{isRenew:!0}}):void(403==a.status?nAlert("We were unable to sync your account. Please sign out and sign back in."):420==a.status?nAlert("Oops! There's been a lot of syncs from your account recently. Please try again later."):500==a.status?nAlert("Oops! Looks like there was a problem. We've been notified of the issue. Please try again later."):503==a.status?nAlert("Oops! Sync is unavailable right now. Please try again later."):408==a.status?nAlert("Oops! Looks like there was a connection issue. Please try again."):400==a.status||401==a.status||404==a.status||405==a.status?nAlert("Something went wrong :( Try logging out and log back in. If that doesn't fix the problem, please contactus@myhomeworkapp.com ("+a.status+")"):nAlert("An error occurred while trying to sync. Please try again in a few minutes.")):void(navigator.onLine?nAlert("An error occurred while trying to sync. Please try again in a few minutes."):nAlert({title:"Unable to Sync",text:"Please make sure you are connected to the internet and try again."}))}function x(){a.lastSyncDate=null,a.$$phase||a.$apply(),a.user&&D.getLocalItem("lsyncdt").then(function(c){if(c){var d=J.parseISO8601(c);a.lastSyncDate=d,a.$$phase||a.$apply();var e=K.minutesInBetween(new Date,d);if(e>=5){var f=!1;if(a.userClasses&&E(a.userClasses,function(a){a.isTeachersIOClass&&a.isCurrent&&(f=!0)}),f||e>=30)return X&&5>=Y?void(Y+=1):(X=!1,Y=0,void(b.showLastSyncWarning=!0))}b.showLastSyncWarning=!1}})}function y(b){w.setUserInfo(a.user.id,{genericPrompt:null}),a.user.prompt=null,a.$$phase||a.$apply(),nAlert({html:b.b,confirmButtonText:b.bt,closeOnConfirm:!1,cancelButtonText:"Close",showCancelButton:!0},function(d){if(ua.sendAppView("Generic Prompt:"+b.i),d)if(ua.sendAppView("Generic Prompt Clicked:"+b.i),b.myhwtt)nAlert.toggleLoading(),i.openMyHwFromToken(a.user,b.myhwtt).then(function(a){nAlert.close();var b=a.url;b=b.indexOf("?")>0?b+"&tat="+a.t:b+"?tat="+a.t,J.openURL(c,b)},function(){nAlert({title:"Failed to Communicate with Servers.",text:"Try again in a minute"},function(){nAlert.close()})});else{nAlert.close();var e=b.url;e=e.replace("__MYHWUID__",a.user.id),"com.myhomeworkapp:goog-connect"==e?a.connectWithGoogle():"com.myhomeworkapp:themes"==e?a.openThemes():"com.myhomeworkapp:upgrade"==e?a.upgradeToPremium():"com.myhomeworkapp:earnupgradepoints"==e?a.upgradePoints():J.openURL(c,e)}})}function z(b){w.setUserInfo(a.user.id,{pfs:null}),a.user.promptForSchool=null,a.$$phase||a.$apply(),nAlert({title:"School",text:b,confirmButtonText:"Find Your School",cancelButtonText:"Close",closeOnConfirm:!1,showCancelButton:!0},function(a){a&&(ua.sendAppView("School Prompt"),nAlert.close(),f.open({templateUrl:"templates/schools/find-schools.html",controller:"FindSchoolCtrl",title:"Find Your School",size:"medium"}))})}function A(b,c){o.getHwWithDbId(b).then(function(d){if(d.length>0){var e=d[0];if(e.usrid){if(a.user&&a.user.id==e.usrid)return;a.changeUser(e.usrid,null,c)}}else B(b,c)},function(a){B(b,c)})}function B(b,c){C.getEventWithDbId(b).then(function(b){if(b.length>0){var d=b[0];if(d.usrid){if(a.user&&a.user.id==d.usrid)return;a.changeUser(d.usrid,null,c)}}},function(a){J.logError(a)})}function G(){a.isKioskApp||D.getLocalItem("r1Orientation").then(function(b){if(b)q();else{if(a.user)return D.setLocalItem("r1Orientation",!0),void q();f.open({templateUrl:"templates/orientation/welcome.html",controller:"WelcomeOrientationCtrl",size:"medium",analyticsTitle:"Welcome Orientation"})}})}function H(){j.isWebApp||(j.isChromeApp?chrome.runtime.requestUpdateCheck(function(a){"update_available"==a&&J.debugLog("Update Pending")}):a.user?i.getLatestAppVersionWithUser(a.user).then(function(a){a>j.av&&D.getLocalItem("updtmsg-"+a).then(function(c){c||(b.updateToVersion=a,g(function(){b.showUpdateMessage=!0},600))})}):i.getLatestAppVersion().then(function(a){a>j.av&&D.getLocalItem("updtmsg-"+a).then(function(c){c||(b.updateToVersion=a,g(function(){b.showUpdateMessage=!0},600))})}))}function I(b){a.mainSpinner={type:"update",show:!0},i.downloadAppVersion(b).then(function(b){g(function(){a.mainSpinner=null,MacApp.restart()},1e3)},function(b){a.mainSpinner=null,rootScope.$$phase||rootScope.$apply(),J.openURL(c,"macappstore://itunes.apple.com/app/id970610831")})}a.today=new Date,a.isWebApp=j.isWebApp,a.isMacApp=j.isMacApp,a.isChromeApp=j.isChromeApp,a.isWindowsApp=j.isWindowsApp,k.set(navigator.language.toLocaleLowerCase()),U.isMac()&&(b.isMac=!0,b.isLatestMac=U.hasTransparentTitleBar()),U.isMacModalWindow()?(U.updateModalScope(a),a.isMacModal=!0):(a.typeOptions=M,a.priorityOptions=N,a.reminderOptions=O,a.repeatOptions=P,a.navOpened=j.isMacApp?!0:!1,a.isMacModal=!1),j.isChromeApp?chrome.storage.local.get("launchData",function(b){b.launchData&&b.launchData.isKioskSession?a.isKioskApp=!0:j.isDebug&&j.isTestKioskMode?a.isKioskApp=!0:a.isKioskApp=!1}):(j.isDebug&&j.isTestKioskMode&&(a.isKioskApp=!0),a.isKioskApp=!1),j.isMacApp?(MacApp.Storage.get("dataMigrated",function(a){console.log("dataMigrated",a),a?l():n().then(function(){l()})}),b.$on("$routeChangeSuccess",function(a,b){g(function(){U.setNoDragAreas()},400)})):l(),b.$on("$routeChangeStart",function(b,c){if(j.isMacApp||(a.navOpened&&(a.navOpened=!1),f.close()),c&&"HomeCtrl"==c.controller)if(a.user&&a.user.promptForSchool){if(j.isMacApp&&a.isMacModal)return;z(a.user.promptForSchool)}else if(a.user&&a.user.genericPrompt){if(j.isMacApp&&a.isMacModal)return;y(a.user.genericPrompt)}}),a.startGoogleAnalyticsSession=function(){var b=a.user?"true":"false",c="false";a.user&&a.user.isPremiumOrSchoolAccount&&(c="true");var d="No School";if(a.userSchools){var e=[];E(a.userSchools,function(a){e.push(a.slug)}),e.length&&(d=e.join(","))}ua.set("dimension1",b),ua.set("dimension2",d),ua.set("dimension4",c),ua.sendEvent("App","Session","Start")},a.toggleNav=function(){a.navOpened=!a.navOpened},a.signOut=function(b){a.user&&b&&(ua.sendAppView("Logout"),nAlert({title:"Sign out",text:"Are you sure you want to sign out?",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,showCancelButton:!0},function(c){c&&(nAlert.close(),a.performSignout(b))}))},a.performSignout=function(c){function e(){D.removeUser(a,c).then(function(){if(j.isMacApp&&(D.setLocalItem("defaultHwFilter","all"),D.setLocalItem("defaultClsFilter","all"),D.setLocalItem("defaultCalFilter","month")),xa.rescheduleReminders(),a.mainSpinner=null,a.themeBanner=null,a.premiumSchool=null,a.showTheme=a.user&&a.user.theme?!0:!1,a.isKioskApp&&!a.user?d.url("/login"):d.url("/"),a.$apply(),!a.user&&j.isMacApp){var c=MacApp.Menu.getItem("File").submenu,e=c.getItem("Sign out");e&&(e.remove(),c.addItem({label:"Sign in",keys:"shift+cmd+w"},function(){d.url("/login"),b.$$phase||b.$apply()})),c.getItem("Sync")&&c.getItem("Sync").setEnabled(!1);var f=MacApp.Menu.getItem("View").submenu;f.getItem("Account")&&f.getItem("Account").setEnabled(!1),f.getItem("Themes")&&f.getItem("Themes").setEnabled(!1)}})}a.showTheme=!1,a.mainSpinner={show:!0,text:"Signing out"},a.$apply(),j.isChromeApp&&(a.isKioskApp?chrome.identity.launchWebAuthFlow({url:"https://accounts.google.com/logout"},function(){chrome.runtime.lastError&&J.debugLog(chrome.runtime.lastError.message)}):chrome.identity.getAuthToken({interactive:!1},function(a){if(a){var b="https://accounts.google.com/o/oauth2/revoke?token="+a;window.fetch(b),chrome.identity.removeCachedAuthToken({token:a},function(){})}})),i.logoutSync(a.user).then(function(){ua.sendAppView("Logout Success"),e()},function(){g(function(){nAlert({title:"Unable to Sync",text:"You may have unsynced changes that could be lost. Do you still want to sign out?",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,showCancelButton:!0},function(b){b?(nAlert.close(),e()):(a.showTheme=a.user&&a.user.theme?!0:!1,a.mainSpinner=null,a.$$phase||a.$apply())})},400)})},a.changeUser=function(b,c,g){if(b&&a.user&&a.user.id!=b&&1!=a.users.length){var h=!1;E(a.users,function(a){a.id==b&&(h=!0)}),h&&(ua.sendAppView("Change User"),e(),a.showTheme=!1,D.loadStorageForUser(a,b,!1).then(function(){D.setLocalItem("activeUser",b),d.url("/"),a.themeBanner=null,a.showTheme=a.user&&a.user.theme&&"default"!=a.user.theme.i?!0:!1,a.$apply(),a.startGoogleAnalyticsSession(),c?a.user.shouldRenew?f.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Renew Account",size:"small",params:{isRenew:!0}}):a.user.isPremiumAccount||f.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"}):g&&a.openHomeworkFromNotification(g)}))}};var Q=0,R=0,S=0,V=null;a.manualSync=function(){s(!0)},a.forceSync=function(){s(!0,!0)},a.silentSyncAppInUse=function(){s(!1,!0)},a.silentSync=function(){s(!1,!1)};var W=null,X=!1,Y=0;b.closeLastSyncWarning=function(){X=!0,Y=1,b.showLastSyncWarning=!1},b.syncFromSyncWarning=function(){X=!0,Y=1,s(!0)},a.$watch("mainSpinner",function(b){if(b&&"login-sync"==b.type)if(a.user.mustRenew)a.showTheme=!1,a.mainSpinner=null,a.$apply(),f.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Renew Account",size:"small",params:{isRenew:!0}});else{var c=g(function(){$(".main-spinner .spinner-text").text("Still Syncing, Please Wait...")},1e4);if(i.loginSync(a.user).then(function(){D.reloadStorage(a,!0).then(function(){if(a.user&&a.user.theme&&"default"!=a.user.theme.i?a.showTheme=!0:(a.showTheme=!1,a.mainSpinner=null),g.cancel(c),Q=0,R=0,S=0,a.$apply(),a.userSettings&&a.userSettings.showCalendarOnStart)d.url("/calendar");else if(a.premiumSchool&&a.premiumSchool.hall_passes_on){new Array;a.userClassOptions&&E(a.userClassOptions,function(b){(b.isCurrent||b.isFuture)&&d.url("/schools/"+a.premiumSchool.slug)})}})},function(b){g.cancel(c),a.mainSpinner=null,a.showTheme=!1,a.$apply(),v(b)}),j.isMacApp){var e=MacApp.Menu.getItem("File").submenu,h=e.getItem("Sign in");h&&(h.remove(),e.addItem({label:"Sign out",keys:"shift+cmd+w"},function(){a.signOut(a.user.id)})),e.getItem("Sync")&&e.getItem("Sync").setEnabled(!0);var k=MacApp.Menu.getItem("View").submenu;k.getItem("Account")&&k.getItem("Account").setEnabled(!0),k.getItem("Themes")&&k.getItem("Themes").setEnabled(!0)}}}),a.openAccount=function(){f.open({templateUrl:"templates/account/view-account.html",controller:"AccountCtrl",size:"small",title:"Account"})},a.upgradePoints=function(){f.open({templateUrl:"templates/account/upgrade-points.html",controller:"UpgradePointsCtrl",title:"Upgrade Points",size:"small"})},a.openSettings=function(){f.open({templateUrl:"templates/settings/view-settings.html",controller:"UserSettingsCtrl",size:"medium",title:"Settings"})},a.openAbout=function(){f.open({templateUrl:"templates/settings/about.html",controller:"AboutCtrl",size:"medium",title:"About"})},a.openClassesOnMac=function(){d.url(a.macOnlyColumn&&"right"==a.macOnlyColumn?"/classes":"/"),b.$$phase||b.$apply()},a.openSchool=function(a){d.url("/schools/"+a),b.$$phase||b.$apply()},a.openHomework=function(b){if(b.isHallPass)return void a.openViewHallPass(b.id);if(b.isEvent)return void f.open({templateUrl:"templates/events/view-event.html",controller:"ViewEventCtrl",title:"View Event",analyticsTitle:"View Event",size:"medium",params:{regularEvent:b}});var c=b.type&&"13"!=b.type.id?b.type.display+" Details":"Homework Details";f.open({templateUrl:"templates/homework/view-homework.html",controller:"ViewHomeworkCtrl",title:c,analyticsTitle:"View Homework",size:"medium",params:{homework:b}})},a.openHomeworks=function(){d.url("/homework/"),b.$$phase||b.$apply()},a.openHomeworkFromNotification=function(b){var c=null,d=b;if(0==b.indexOf("REPEAT")&&(c=b.substring(7,15),b=b.substring(16)),a.user&&a.userHomeworks){var e=angular.f("filter")(a.userHomeworks,{dbID:b},!0);if(e.length){var g=e[0],h=g.type&&"13"!=g.type.id?g.type.display+" Details":"Homework Details";if(g.repeats&&c){var i=angular.copy(g),j=K.dateFromDateFormat(c);L.updateRepeatHomeworkStatus(i,j),f.open({templateUrl:"templates/homework/view-homework.html",controller:"ViewHomeworkCtrl",size:"medium",title:h,analyticsTitle:"View Homework (Notification)",params:{homework:i}})}else f.open({templateUrl:"templates/homework/view-homework.html",controller:"ViewHomeworkCtrl",size:"medium",title:h,analyticsTitle:"View Homework (Notification)",params:{homework:g}})}else{var k=angular.f("filter")(a.userRegularEvents,{dbID:b},!0);if(k.length){var l=k[0];if(l.isHallPass)a.openViewHallPass(l.id);else if(l.repeats&&c){var m=angular.copy(l),j=K.dateFromDateFormat(c);L.updateRepeatHomeworkStatus(m,j),f.open({templateUrl:"templates/events/view-event.html",controller:"ViewEventCtrl",title:"View Event",analyticsTitle:"View Event",size:"medium",params:{regularEvent:m}})}else f.open({templateUrl:"templates/events/view-event.html",controller:"ViewEventCtrl",title:"View Event",analyticsTitle:"View Event",size:"medium",params:{regularEvent:l}})}else A(b,d)}}else A(b,d)},a.connectWithGoogle=function(){ua.sendAppView("Connect with Google"),j.isWebApp||(b.spinnerText="Connecting with Google",b.showSpinner=!0),i.connectinWithGoogle(b).then(function(b){F.loadUser(a,b.usrID,!0).then(function(){ua.sendAppView("Connect with Google - Success"),nAlert({title:"Connected to Google!",text:"Your myHomework account is now connected with Google. You are now able to sign in using only your google account.",closeOnConfirm:!1},function(){nAlert.close(),f.close()})})},function(a){ua.sendAppView("Connect with Google - Failed");var c=a&&a.cancel?null:"We were unable to connect your account with Google. Please make sure you are connected to the internet and try again.";a&&400==a.status&&a.data&&a.data.error_description?c=a.data.error_description:a&&503==a.status&&(c="myHomework is currently down for maintenance. Try again later."),c&&nAlert({title:"Failed to Connect",text:c}),b.showSpinner=!1,b.$apply()})},a.openViewHallPass=function(b){var c=!1;(j.isChromeApp||j.isMacApp||j.isWindowsApp)&&(c=!0),i.openMyHwFromToken(a.user,"view_hall_pass",b,c).then(function(b){nAlert.close();var c=b.url;c=c.indexOf("?")>0?c+"&tat="+b.t:c+"?tat="+b.t,a.openFrameView("View Hall Pass",c)},function(){nAlert({title:"Failed to Communicate with Servers.",text:"Check your internet. Then, try again in a minute"},function(){nAlert.close()})})},a.openNewHallPass=function(){var b=!1;(j.isChromeApp||j.isMacApp||j.isWindowsApp)&&(b=!0),i.openMyHwFromToken(a.user,"new_hall_pass",null,b).then(function(b){nAlert.close();var c=b.url;c=c.indexOf("?")>0?c+"&tat="+b.t:c+"?tat="+b.t,a.openFrameView("New Hall Pass",c)},function(){nAlert({title:"Failed to Communicate with Servers.",text:"Check your internet. Then, try again in a minute"},function(){nAlert.close()})})},a.openFrameView=function(d,e){j.isMacApp?MacApp.MyhwAuthedWebview.openAuthedWindow(e,function(c){a.user&&a.silentSync(),b.$apply()},function(a){console.log(a)}):j.isChromeApp?chrome.app.window.create("myHomework Chrome/webview.html",{hidden:!0,width:500,height:608},function(c){c.contentWindow.addEventListener("DOMContentLoaded",function(d){var f=c.contentWindow.document.querySelector("webview");f.src=e,f.addEventListener("close",function(){c.contentWindow.close()}),f.addEventListener("loadredirect",function(d){var e=d.newUrl.split("success");if(e&&e.length>1)a.user&&a.silentSync(),c.contentWindow.close(),b.$apply();else{var e=d.newUrl.split("login");e&&e.length>1&&(a.user&&a.silentSync(),c.contentWindow.close())}}),c.show()})}):j.isWindowsApp?f.open({templateUrl:"templates/components/webview-windows.html",controller:"WinWebviewCtrl",title:d,size:"eighty",params:{url:e,viewtitle:d}}):J.openURL(c,e)},a.syncIfTooLong=function(){D.getLocalItem("lsyncdt").then(function(b){if(b){var c=J.parseISO8601(b);a.lastSyncDate=c;var d=K.minutesInBetween(new Date,c);d>=2&&a.silentSyncAppInUse()}})},a.openThemes=function(){f.open({templateUrl:"templates/themes/themes.html",controller:"ThemesCtrl",size:"medium",title:"Themes"})},a.reloadTheme=function(){a.showTheme=!1,F.loadUser(a,a.user.id,!0).then(function(){a.showTheme=!0,a.$apply()})},a.upgradeToPremium=function(){j.isChromeApp||j.isWebApp?chrome.app.window.create("myHomework Chrome/webview.html",{hidden:!0,width:500,height:608},function(c){c.contentWindow.addEventListener("DOMContentLoaded",function(d){var e=c.contentWindow.document.querySelector("webview");e.src=j.wurl+"account/upgrade-chrome/?isapp=t&_u="+a.user.id,e.addEventListener("close",function(){c.contentWindow.close()}),e.addEventListener("loadredirect",function(a){var d=a.newUrl.split("success");if(d&&d.length>1)c.contentWindow.close(),b.goHome(),b.$apply();else{var d=a.newUrl.split("login");d&&d.length>1&&c.contentWindow.close()}}),c.show()})}):f.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"})},j.isChromeApp&&chrome.runtime.onUpdateAvailable.addListener(function(a){D.getLocalItem("updtmsg-"+a.version).then(function(c){c||(b.updateToVersion=a.version,g(function(){b.showUpdateMessage=!0},600))})}),b.doUpdate=function(a){b.showUpdateMessage=!1,g(function(){b.updateToVersion=null},600),D.setLocalItem("updtmsg-"+a,"true"),j.isChromeApp?chrome.runtime.reload():j.isMacApp?I(a):j.isWindowsApp&&J.openURL(c,"http://apps.microsoft.com/windows/en-us/app/myhomework/438f2bec-f200-4b9d-96ad-7f95fbe93409")},b.closeUpdateMessage=function(a){D.setLocalItem("updtmsg-"+a,"true"),b.showUpdateMessage=!1,g(function(){b.updateToVersion=null},600)}}]),ra.directive("mainNav",["$rootScope","$location",function(a,b){return{restrict:"E",templateUrl:"templates/components/main-nav.html",link:function(a,c,d){a.openCalendar=function(){D.getLocalItem("defaultCalFilter").then(function(c){c&&"month"!=c?b.url("/calendar/week"):b.url("/calendar"),a.$$phase||a.$apply()})}}}}]),Canadarm.init({onError:!0,wrapEvents:!0,appenders:[Canadarm.Appender.standardLogAppender,function(){return{appPlatform:j.platform,appVersion:j.av}}],handlers:[Canadarm.Handler.beaconLogHandler("https://logs-01.loggly.com/inputs/6da101b2-fe0c-4ce3-af77-cb77d42b758a/tag/http/"),Canadarm.Handler.consoleLogHandler]}),ra.run(["$templateCache",function(a){"use strict";a.put("templates/account/account-choice.html",'<style>\n.account-choice{ display:table; table-layout:fixed; }\n.row{ display: table-row; }\n.row > div{ display:table-cell;}\n.basic{ }\n.premium{ }\n.col1{ max-width: 280px;}\n.col1 button{ background-color: #575757; color: #fff; text-align: center; }\n.col2 button{ font-size:110%;}\n.col1, .col2{ width: 45%}\nheader h3{ text-align: center; padding-bottom: 8px;}\n.hdr > div{ padding: 0 0 8px 6px;}\n.hdr{ text-align: center; }\n.btns{ text-align: center;}\n.col1{ padding-right: 10px;}\n.account-choice .basic li, .account-choice .premium li{ padding: 0 0 5px 50px; margin: 0 0 0 -20px; list-style-type: none;  background-position: 22px 5px; }\n.hdr .col2 span{ cursor: default; }\nbody.centered-layout .main-content > header{ height: auto;}\n.vid-link{ text-align: center; padding: 8 px; }\n</style>\n<header><span class="logo"><span class="ico"></span>myHomework</span><h3>{{ title }}</h3></header>\n<section>\n<div class="account-choice">\n <div class="row hdr"> \n   <div class="col1">    \n    <h4>{{ freeplanname }}</h4>\n    <span>Free with Ads</span>\n   </div>\n   <div class="col2">    \n    <h4>{{ premiumplanname }}</h4>\n    <span title="Does not auto-renew" ng-if="upgradePrice">{{ upgradePrice }} per Year</span><span ng-if="!upgradePrice">Loading...</span>\n</div>\n </div>\n\n <div class="row"> \n  <div class="basic col1">\n    <ul>\n      <li ng-repeat="item in freeitems">{{ item }}</li>\n    </ul>\n  </div>\n  <div class="premium col2">\n    <ul>\n      <li ng-repeat="item in premiumitems">{{ item }}</li>\n    </ul>\n  </div>\n  </div>\n <div class="row btns"> \n   <div class="col1">\n    <button ng-click="chooseFree()">{{ freeaction }}</button>\n   </div>\n   <div class="col2">\n    <button ng-click="choosePremium()">{{ premiumaction }}</button>\n   </div>\n </div>  \n</div>\n <div ng-if="videourl" class="vid-link">\n    <a href="{{ videourl }}" target="_blank">{{ vidoectatext }}</a>\n </div>\n\n</section>\n<footer><a href="https://instin.com/" target="_blank">© 2019 instin, LLC</a></footer>\n<spinner ng-if="upgradeSpinner.show" spinner-text="{{ upgradeSpinner.text }}"></spinner>\n'),a.put("templates/account/create-account.html",'<header><a href="#/" class="logo"><span class="ico"></span>myHomework</a></header>\n<section>\n<h3>Sign Up</h3>\n<form name="form" class="block" novalidate>\n  <fieldset>\n    <div class="field" ng-class="{error: ((form.email.$error.email || form.email.$error.reallyRequired) && form.$submitted) || form.emailValidationError}">\n      <label>Email</label>\n      <div class="input">\n        <input autocomplete="off" type="email" name="email" maxlength="75" ng-model="newAccount.email" ng-blur="validateEmail(form)" ng-focus="resetEmailValidation(form)" really-required>\n        <span class="error-msg" ng-show="(form.email.$error.email || form.email.$error.reallyRequired) && form.$submitted">Please enter a valid email.</span>\n        <span class="error-msg" ng-if="!form.email.$error.email && !form.email.$error.reallyRequired && form.emailValidationError">{{ form.emailValidationError }}</span>\n      </div>\n    </div>\n    <div class="field" ng-class="{error: form.$submitted && (form.password.$error.reallyRequired || form.password.$error.minlength || form.password.$error.maxlength)}">\n      <label>Password</label>\n      <div class="input">\n        <input name="password" ng-model="newAccount.password" minlength="6" maxlength="40" type="password" really-required>\n        <span class="error-msg" ng-show="form.password.$error.reallyRequired && form.$submitted">This field is required.</span> \n        <span class="error-msg" ng-show="form.password.$error.minlength && form.$submitted">Please enter at least 6 characters for your password.</span>  \n        <span class="error-msg" ng-show="form.password.$error.maxlength && form.$submitted">Password must be between 6 and 40 characters long.</span>        \n      </div>\n    </div>\n    <div class="field" ng-class="{error: (form.age.$error.reallyRequired || form.age.$error.validateage) && form.$submitted}">\n      <label>Age</label>\n      <div class="input">\n        <input autocomplete="off" type="number" name="age" ng-model="newAccount.age" really-required validateage>\n        <span class="error-msg" ng-show="form.age.$error.validateage && form.$submitted">Students under 13 should have their parent or guardian create their myHomework account.</span>\n        <span class="error-msg" ng-show="form.age.$error.reallyRequired && form.$submitted">This field is required.</span>\n      </div>\n    </div>\n  </fieldset>\n  <fieldset class="cage">\n    <p>By signing up you agree with myHomework\'s <a href="https://myhomeworkapp.com/terms" target="_blank">Terms of Use</a></p>\n    <input class="button" type="submit" value="Sign up" ng-click="signup(form)"><a href="#/">Cancel</a>\n  </fieldset>\n</form>\n</section>\n<footer><a href="https://instin.com/" target="_blank">© 2015 instin, LLC</a></footer>\n<spinner ng-show="showSpinner" spinner-text="{{ spinnerText }}"></spinner>'),
a.put("templates/account/edit-account.html",'<div class="lightbox-header">\n  <h2>Edit Account</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n<form name="form" class="inline tidy" novalidate>\n  <fieldset>\n    <div class="field account-details">\n      <div class="input">\n        <img ng-src="{{ account.localAvatar }}" id="user-avatar-bg" class="user-avatar" ng-if="account.localAvatar" ng-click="changePicture()" />\n        <span class="s-icon account" ng-if="!account.localAvatar" ng-click="changePicture()"></span>\n        <a ng-click="changePicture()" ng-if="account.localAvatar">Change Picture</a>\n        <a ng-click="changePicture()" ng-if="!account.localAvatar">Add a Picture</a>\n      </div>\n    </div>\n    <div class="field" ng-class="{error: form.firstName.$error.required && form.$submitted}">\n      <label>First Name <span class="required" ng-if="user.firstName">*</span></label>\n      <div class="input">\n        <input autocomplete="off" type="text" name="firstName" maxlength="30" ng-model="account.firstName" ng-required="user.firstName" autofocus>\n        <span class="error-msg" ng-show="form.firstName.$error.required && form.$submitted">This field is required.</span>\n      </div>\n    </div>\n    <div class="field" ng-class="{error: form.lastName.$error.required && form.$submitted}">\n      <label>Last Name <span class="required" ng-if="user.lastName">*</span></label>\n      <div class="input">\n        <input autocomplete="off" type="text" name="lastName" maxlength="30" ng-model="account.lastName" ng-required="user.lastName">\n        <span class="error-msg" ng-show="form.lastName.$error.required && form.$submitted" >This field is required.</span>\n      </div>\n    </div>\n    <div class="field" ng-class="{error: (form.email.$error.email || form.email.$error.required) && form.$submitted}">\n      <label>Email <span class="required" ng-if="user.email">*</span></label>\n      <div class="input">\n        <input autocomplete="off" type="email" name="email" maxlength="75" ng-model="account.email" ng-required="user.email">\n        <span class="error-msg" ng-show="(form.email.$error.email || form.email.$error.required) && form.$submitted">Please enter a valid email.</span>\n      </div>\n    </div>\n  </fieldset>\n  <fieldset class="cage">\n    <input type="submit" class="button" name="save" value="Save" ng-click="save(form, account)">\n    <a class="close" ng-click="cancel()">Cancel</a>\n  </fieldset>\n</form>\n</div>\n<spinner ng-if="saveSpinner.show" spinner-text="{{ saveSpinner.text }}"></spinner>\n\n\n'),a.put("templates/account/edit-picture.html",'<div class="lightbox-header">\n  <h2 ng-if="!user.localAvatar">Add Picture</h2>\n  <h2 ng-if="user.localAvatar">Edit Picture</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <form name="form" class="edit-picture-form" ng-class="{\'inline\': !isCropPicture}"  novalidate>  \n    <fieldset ng-if="account.localAvatar && !isCropPicture">\n      <div class="field account-details">\n        <div class="input">\n          <img ng-src="{{ account.localAvatar }}" id="user-avatar-bg" class="user-avatar" ng-click="deletePicture()" />\n          <a ng-click="deletePicture()">Delete Picture</a>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset ng-model="manualPicture" picture-upload></fieldset>\n    <fieldset ng-if="(user.facebookAvatar || user.googleAvatar) && !isCropPicture">\n      <div class="field">\n        <label>OR</label>\n        <div class="input" ng-if="user.facebookAvatar">\n          <button class="facebook-btn no-icon" ng-click="useFacebookPicture()">Use Facebook Picture</button>\n        </div>\n        <div class="input" ng-if="user.googleAvatar">\n          <button class="google-btn no-icon" ng-click="useGooglePicture()">Use Google Picture</button>\n        </div>\n      </div>\n    </fieldset>\n  </form>\n</form>\n</div>\n<spinner ng-if="saveSpinner.show" spinner-text="{{ saveSpinner.text }}"></spinner>'),a.put("templates/account/guardian-add.html",'<div class="lightbox-header">\n  <h2>Add Parent or Guardian</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n<form name="form" class="tidy" novalidate>\n  <fieldset>\n    <div class="field" ng-class="{error: (form.email.$error.email || form.email.$error.required) && form.$submitted}">\n      <label>Email <span class="required">*</span></label>\n      <div class="input">\n        <input autocomplete="off" type="email" name="email" maxlength="75" ng-model="guardian.email" placeholder="Email is required" really-required autofocus>\n        <span class="error-msg" ng-show="(form.email.$error.email || form.email.$error.required) && form.$submitted">Please enter a valid email.</span>\n      </div>\n    </div>\n    <div class="field" ng-class="{error: form.firstName.$error.required && form.$submitted}">\n      <label>First Name</label>\n      <div class="input">\n        <input autocomplete="off" type="text" name="firstName" maxlength="30" ng-model="guardian.firstName" placeholder="(Optional)">\n      </div>\n    </div>\n    <div class="field" ng-class="{error: form.lastName.$error.required && form.$submitted}">\n      <label>Last Name</label>\n      <div class="input">\n        <input autocomplete="off" type="text" name="lastName" maxlength="30" ng-model="guardian.lastName" placeholder="(Optional)">\n      </div>\n    </div>\n  </fieldset>\n  <fieldset class="cage">\n    <input type="submit" class="button" name="save" value="Save" ng-click="save(form, guardian)">\n    <a class="close" ng-click="cancel()">Cancel</a>\n  </fieldset>\n</form>\n</div>\n<spinner ng-if="saveSpinner.show" spinner-text="{{ saveSpinner.text }}"></spinner>\n\n\n'),a.put("templates/account/login.html",'<script type="text/javascript" src="js/libs/web-google-signin.js" ng-if="isWebApp" async defer></script>\n<script type="text/javascript" src="js/libs/web-facebook.js" ng-if="isWebApp" async defer></script>\n<header><a href="#/" class="logo"><span class="ico"></span>myHomework</a></header>\n<section>\n<p ng-if="isKioskApp" class="goog-sign-in" style="padding-bottom:12px;"><button class="google-btn" ng-click="signinWithGoogle()">Sign in with Google</button></p>\n<form name="form" class="login-form placeholder-form" novalidate> \n  <fieldset>\n    <div class="field" ng-class="{error: form.username.$error.reallyRequired && form.$submitted}">\n      <div class="input">\n        <input id="username-field" name="username" ng-model="login.username" maxlength="75" placeholder="Email or Username" type="text" autofocus really-required>\n        <span class="error-msg" ng-show="form.username.$error.reallyRequired && form.$submitted">This field is required.</span>\n      </div>\n    </div>\n    <div class="field" g-class="{error: form.$submitted && form.password.$error.reallyRequired}">\n      <div class="input">\n        <input name="password" ng-model="login.password" maxlength="50" type="password" placeholder="Password" really-required>\n        <span class="error-msg" ng-show="form.$submitted && form.password.$error.reallyRequired">This field is required.</span>\n        <span ng-if="!isKioskApp" class="help-text"><a href="https://myhomeworkapp.com/forgot-password" target="_blank" tabindex="-1">Forgot your password?</a></span>\n      </div>\n    </div>\n  </fieldset>\n  <fieldset class="cage">\n    <input class="button" type="submit" value="Sign in" ng-click="signin(form, login)"><a ng-if="!isKioskApp" href="#/">Cancel</a>\n  </fieldset>\n</form>\n<p ng-if="!isKioskApp" class="fb-sign-in"><button class="facebook-btn" ng-click="signinWithFacebook()">Sign in with Facebook</button></p>\n<p ng-if="!isKioskApp" class="goog-sign-in"><button class="google-btn" ng-click="signinWithGoogle()">Sign in with Google</button></p>\n<div  ng-if="!isKioskApp" class="signup-div">\n  <span>Don\'t have an account yet?</span>\n  <a href="#/signup">Sign up</a>\n</div>\n</section>\n<footer><a href="http://instin.com/" target="_blank">© 2019 instin, LLC</a></footer>\n<spinner ng-show="showSpinner" spinner-text="{{ spinnerText }}"></spinner>'),a.put("templates/account/signup.html",'<script type="text/javascript" src="js/libs/web-google-signin.js" ng-if="isWebApp" async defer></script>\n<script type="text/javascript" src="js/libs/web-facebook.js" ng-if="isWebApp" async defer></script>\n<header><a href="#/" class="logo"><span class="ico"></span>myHomework</a></header>\n<section>\n<h3>Sign up</h3>\n<div class="left">\n<p class="fb-sign-in"><button class="facebook-btn" ng-click="signupWithFacebook()">Sign up with Facebook</button></p>\n<p class="goog-sign-in"><button class="google-btn" ng-click="signupWithGoogle()">Sign up with Google</button></p>\n</div>\n<div class="right">\n<form name="form" class="block" novalidate>\n  <fieldset>\n    <div class="field" ng-class="{error: ((form.email.$error.email || form.email.$error.reallyRequired) && form.$submitted) || form.emailValidationError}">\n      <label>Email</label>\n      <div class="input">\n        <input autocomplete="off" type="email" name="email" maxlength="75" ng-model="newAccount.email" ng-blur="validateEmail(form)" ng-focus="resetEmailValidation(form)" really-required>\n        <span class="error-msg" ng-show="(form.email.$error.email || form.email.$error.reallyRequired) && form.$submitted">Please enter a valid email.</span>\n        <span class="error-msg" ng-if="!form.email.$error.email && !form.email.$error.reallyRequired && form.emailValidationError">{{ form.emailValidationError }}</span>\n      </div>\n    </div>\n    <div class="field" ng-class="{error: form.$submitted && (form.password.$error.reallyRequired || form.password.$error.minlength || form.password.$error.maxlength)}">\n      <label>Password</label>\n      <div class="input">\n        <input name="password" ng-model="newAccount.password" minlength="6" maxlength="40" type="password" really-required>\n        <span class="error-msg" ng-show="form.password.$error.reallyRequired && form.$submitted">This field is required.</span> \n        <span class="error-msg" ng-show="form.password.$error.minlength && form.$submitted">Please enter at least 6 characters for your password.</span>  \n        <span class="error-msg" ng-show="form.password.$error.maxlength && form.$submitted">Password must be between 6 and 40 characters long.</span>        \n      </div>\n    </div>\n  </fieldset>\n  <fieldset class="cage">\n    <input class="button" type="submit" value="Sign up with Email" ng-click="signup(form)"><a href="#/">Cancel</a>\n  </fieldset>\n</form>\n</div>\n<p>By signing up, you agree to myHomework\'s <a href="https://myhomeworkapp.com/terms" target="_blank">Terms of Use</a></p>\n<div class="signup-div">\n  <span>Already have an account?</span> <a href="#/login">Sign in</a>\n</div>\n</section>\n<footer><a href="https://instin.com/" target="_blank">© 2019 instin, LLC</a></footer>\n<spinner ng-show="showSpinner" spinner-text="{{ spinnerText }}"></spinner>'),a.put("templates/account/upgrade-account.html",'<div class="lightbox-header">\n  <h2 ng-if="!isRenew">Upgrade Account</h2>\n  <h2 ng-if="isRenew">Renew Account</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content upgrade-acct">\n  <p ng-if="user.mustRenew" class="alert-message">Premium access to your myHomework account has expired. You won\'t be able to sync until you renew it or switch to a standard account.</p>\n  <p ng-if="!isRenew">Upgrade to <strong>myHomework Premium</strong> and get 1 year of these benefits:</p>\n  <p ng-if="isRenew">Renew your <strong>myHomework Premium</strong> account and get 1 year of these benefits:</p>\n  <ul>\n    <li><span class="icon ads"></span>No Ads</li>\n    <li><span class="icon themes"></span>All Themes</li>\n    <li><span class="icon attach"></span>File Attachments</li>\n    <li><span class="icon widget"></span>Enhanced Mobile App Widgets</li>\n  </ul>\n  <button ng-class="{\'alt-button disabled\': !upgradePrice}" ng-disabled="!upgradePrice" ng-click="upgradeAccount()"><span ng-if="upgradePrice">Upgrade: {{ upgradePrice }}</span><span ng-if="!upgradePrice">Loading...</span></button>\n  <p class="renew-info" ng-if="isRenew">You can also switch to a standard account and no longer have the benefits of a premium account.</p>\n  <button ng-if="isRenew" class="alt-button" ng-click="switchToStandard()">Switch to Standard</button>\n</div>\n<spinner ng-if="upgradeSpinner.show" spinner-text="{{ upgradeSpinner.text }}"></spinner>'),a.put("templates/account/upgrade-points.html",'<div class="lightbox-header">\n  <h2>Upgrade Points</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content upgrade-acct">\n  <p><strong>Current Points:</strong>&nbsp;<span ng-if="user.upts.p">{{ user.upts.p }}</span><span ng-if="!user.upts.p">0</span></p>\n  <p>Upgrade points can be used to get free themes or earn premium time.</p>\n  <p>Keep rewards enabled and we will automatically show you opportunities to get upgrade points as you complete your homework.</p>\n  <form name="form" novalidate>\n    <fieldset>\n      <div class="field boolean-field">\n        <div class="checker" ng-class="{checked: settings.disableRewards}">\n          <label><span class="fld"></span><input type="checkbox" name="complete" ng-model="settings.disableRewards" ng-change="saveChange()">Stop showing points opportunities automatically</label>\n        </div>\n      </div>\n    </fieldset>\n  </form>  \n  <p>Earn points whenever you want if the button below loads.</p>  \n  <button ng-class="{\'alt-button disabled\': !rewardAvailable}" ng-disabled="!rewardAvailable" ng-click="showReward()"><span ng-if="rewardAvailable">Earn Points</span><span ng-if="!rewardAvailable">Loading ...</span></button>\n  <small>*Points should be rewarded in seconds but may take longer.</small>\n</div>\n<spinner ng-if="upgradeSpinner.show" spinner-text="{{ upgradeSpinner.text }}"></spinner>'),a.put("templates/account/view-account.html",'<script type="text/javascript" src="js/libs/web-google-signin.js" ng-if="isWebApp" async defer></script>\n<script type="text/javascript" src="js/libs/web-facebook.js" ng-if="isWebApp" async defer></script>\n<div class="lightbox-header" ng-class="{\'alt-header\': user.localAvatar && !isWebApp }">\n  <h2>Account</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content account-sec" ng-class="{\'has-img\': user.localAvatar && !isWebApp }">\n  <div class="user-avatar-blur" ng-if="user.localAvatar && !isWebApp">\n    <canvas id="user-avatar-canvas" class="user-avatar-canvas"></canvas>  \n  </div>\n  <div class="account-details" id="account-details">\n    <img ng-src="{{ user.localAvatar }}" id="user-avatar-bg" class="user-avatar" ng-if="user.localAvatar" ng-click="changePicture()" />\n    <span class="s-icon account" ng-if="!user.localAvatar" ng-click="changePicture()"></span>\n    <h3 class="account-name h4" ng-if="user.name">{{ user.name }}</h3>\n    <dl class="inline">\n      <dt ng-if="user.username">Username</dt><dd ng-if="user.username">{{ user.username }}</dd>\n      <dt ng-if="user.email">Email</dt><dd ng-if="user.email">{{ user.email }}</dd>\n      <dt ng-if="!user.norwds && !user.isPremiumOrSchoolAccount">Upgrade Points</dt><dd ng-if="!user.norwds && !user.isPremiumOrSchoolAccount"><span ng-if="user.upts.p">{{ user.upts.p }}</span><span ng-if="!user.upts.p">0</span></dd>\n      <dt ng-if="user.renewByDate && !user.mustRenew">Premium Until</dt><dd ng-if="user.renewByDate && !user.mustRenew">{{ user.renewByDate | date: \'longDate\' }}</dd>\n    </dl>\n    <button class="alt-button" ng-click="editAccount()"><span class="icon edit"></span>Edit Account</button>\n    <button class="alt-button" ng-if="!user.norwds && !user.isPremiumOrSchoolAccount" class="button" ng-click="upgradePoints()">Upgrade Points</button>\n    <button class="alt-button" class="button" ng-click="openThemes()">Change Theme</button>\n    <button ng-if="!user.isPremiumOrSchoolAccount" class="button" ng-click="upgradeAccount()">Upgrade to Premium</button>\n    <button ng-if="user.isPremiumOrSchoolAccount && (user.shouldRenew || user.canRenew)" class="button renew-btn" ng-click="renewAccount()">Renew Account</button>\n    <div class="connections" ng-if="!user.facebookID || !user.googleID">\n      <button class="facebook-btn" ng-if="!user.facebookID" ng-click="connectWithFacebook()">Connect with Facebook</button>\n      <button class="google-btn" ng-if="!user.googleID" ng-click="connectWithGoogle()">Connect with Google</button>\n    </div>\n  </div>\n</div>\n<spinner ng-show="showSpinner" spinner-text="{{ spinnerText }}"></spinner>'),a.put("templates/announcements/announcements.html",'<div class="full-col" one-col="true">\n  <div class="box">\n    <h2 class="box-title">Announcements</h2>\n    <div class="empty-box-content" ng-if="!userAnnouncements">\n      <span class="m-icon blue ann"></span>\n      <div class="empty-content">\n        <p>This is where announcements from your school and any Teachers.io classes you join will display.</p>\n        <p ng-if="user">You haven\'t received an announcement yet. We\'ll notify you when a new announcement arrives.</p>\n        <p ng-if="!user"><a href="#/signup">Sign up</a> now to join your class and have assignments, resources and announcements automatically synced to your myHomework account!</p>\n      </div>\n    </div>\n    <ul class="box-content announcements-list" ng-if="userAnnouncements">\n      <li ng-repeat="announcement in userAnnouncements track by announcement.id" class="ann">\n        <div class="ann-pic">\n          <a ng-if="announcement.fromType == 1" ng-click="openSender(announcement)">\n            <img ng-if="announcement.teacher && announcement.teacher.localAvatar" ng-src="{{ announcement.teacher.localAvatar }}" alt="Teacher Picture" />\n            <span ng-if="!announcement.teacher || !announcement.teacher.localAvatar" class="s-icon blue account"></span>\n          </a>\n          <a ng-if="announcement.fromType == 2" ng-click="openSender(announcement)">\n            <img ng-if="announcement.school && announcement.school.localAvatar" ng-src="{{ announcement.school.localAvatar }}" alt="Teacher Picture" />\n            <span ng-if="!announcement.school || !announcement.school.localAvatar" class="s-icon blue schools"></span>\n          </a>\n          <img src="imgs/app-icon.png" alt="myHomework"  ng-if="announcement.fromType == 3 || announcement.fromType == 4" />\n        </div>\n        <div class="ann-details">\n          <div class="ann-text">\n            <span class="unread" ng-if="!announcement.isRead">Unread:</span>\n            <span ng-bind-html="announcement.textHTML" ng-if="announcement.textHTML"></span>\n            <span ng-if="!announcement.textHTML">{{ announcement.text }}</span>\n          </div>\n          <div class="ann-date">{{ announcement.created | date:\'MMMM d - h:mm a\' }}</div>\n          <ul class="ann-classes inline" ng-if="announcement.classes || announcement.hallPassId">\n            <li ng-if="announcement.hallPassId">\n              <a ng-click="openViewHallPass(announcement.hallPassId)">View Pass</a>\n            </li>\n            <li ng-repeat="cls in announcement.classes track by cls.id">\n              <a href="#/classes/{{cls.id}}">{{ cls.name }}</a>\n            </li>            \n          </ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>'),a.put("templates/calendar/calendar.html",'<div class="left-col calendar-sec">\n  <div class="box datepicker-box">\n    <div class="calendar-filters">\n      <ul class="filters two month no-drag-area">\n        <li>\n          <div class="radio month" tooltip-placement="bottom" tooltip="Month View" tooltip-enable="isMacApp">\n            <label><span class="fld"></span><input type="radio" value="month"><span class="icon month b"></span><span class="txt">Month</span></label>\n          </div>\n        </li>\n        <li>\n          <div class="radio week" tooltip-placement="bottom" tooltip="Week View" tooltip-enable="isMacApp">\n            <label><span class="fld"></span><input type="radio" ng-model="weekActive" value="week" ng-change="openWeekView()"><span class="icon week b"></span><span class="txt">Week</span></label>\n          </div>\n        </li>\n      </ul>\n      <a class="filter-button no-drag-area" ng-class="{\'sel\': isToday, \'alt\': isMacApp && (showFull || macOnlyColumn == \'left\') }" ng-click="setToday()" tooltip-placement="bottom" tooltip="Today" tooltip-enable="isMacApp"><span class="icon today b"></span><span class="txt">Today</span></a>\n      <a class="box-title-button no-drag-area" ng-click="addHomework()" ng-if="isMacApp && (showFull || macOnlyColumn == \'left\')"><span class="icon add" tooltip-placement="left" tooltip="Add Homework"></span></a>    \n    </div>\n    <div class="calendar-datepicker">\n      <datepicker ng-model="seletedDate" busy-days="busyDays" no-school-days="userNoSchoolDays" auto-select-month="true"></datepicker>\n    </div>\n  </div>\n  <div class="box classes-box bottom-box" ng-if="!showFull && macOnlyColumn != \'left\'">\n    <h2 class="box-title">Classes - {{ seletedDate | date:\'MMMM d\' }}</h2>\n    <a class="box-title-button no-drag-area" ng-click="toggleClassesAddOptions($event)"><span class="icon add" tooltip-placement="bottom" tooltip="Add ..."></span></a>\n    <div class="box-options" ng-class="{\'show\': showClassesAddOptions}">\n      <ul class="box-options-content">\n        <li><a ng-click="addClass()">Add Class</a></li>\n        <li><a ng-click="addEvent()">Add Event</a></li>\n        <li><a ng-click="addNoSchoolDay()">Add No School Day</a></li>\n        <li><a ng-click="addLateStart()">Add Late Start</a></li>\n        <li><a ng-click="addEarlyRelease()">Add Early Release</a></li>\n      </ul>      \n    </div>\n    <div class="empty-box-content no-icon" ng-if="!dayClasses || dayClasses.length == 0 || dayClasses[0].items.length == 0">\n      <div class="empty-content">\n        <div ng-if="blockDayInfo" class="class-schedule day">\n        <div class="blocks">\n          <span ng-if="blockDayInfo.color" class="block" ng-style="{\'background-color\': \'#\' + blockDayInfo.color.h}"></span>\n          <span>{{ blockDayInfo.label }}</span>\n        </div>\n        </div>    \n        <p>No class times for this day.</p>\n      </div>\n    </div>\n    <classes-list ng-if="dayClasses" list-control="clsListControl" class-items="dayClasses" grouping-disabled="true" block-schedule-change-label="blockScheduleChangeLabel" alternate-week-switcher-week="alternateWeekSwitcherWeek" block-day-info="blockDayInfo"></classes-list>\n  </div>\n  <div class="box homework-class-box bottom-box" ng-if="showFull || macOnlyColumn == \'left\'">\n    <h2 class="box-title">{{ seletedDate | date:\'MMMM d\' }}</h2>\n    <a class="box-title-button no-drag-area" ng-click="addHomework()"><span class="icon add" tooltip-placement="bottom" tooltip="Add Homework"></span></a>    \n    <div class="empty-box-content no-icon" ng-if="!dayHomeworks">\n      <div class="empty-content">\n        <p>Nothing due on this day.</p>\n      </div>\n    </div>\n    <div class="box-scroll">\n      <homework-list ng-if="dayHomeworks" list-control="hwListControl" homework-items="dayHomeworks" sticky-headers-disabled="true" show-complete-checkbox="false" always-show-group-headers="true" box-already-scrolls="true" is-calendar="true" reload-on-complete-repeating="true"></homework-list>\n      <classes-list ng-if="dayClasses" list-control="clsListControl" class-items="dayClasses"  sticky-headers-disabled="true"  always-show-group-headers="true" box-already-scrolls="true" block-schedule-change-label="blockScheduleChangeLabel" alternate-week-switcher-week="alternateWeekSwitcherWeek"></classes-list>\n    </div>\n  </div>\n</div>\n<draggable-cols></draggable-cols>\n<div class="right-col calendar-sec">\n  <div class="box">\n    <h2 class="box-title">{{ seletedDate | date:\'MMMM d\' }}</h2>\n    <a class="box-title-button no-drag-area"><span class="icon add" ng-click="toggleHomeworkAddOptions($event)" tooltip-placement="left" tooltip="Add ..."></span></a>\n    <div class="box-options" ng-class="{\'show\': showHomemeworkAddOptions}">\n      <ul class="box-options-content">\n        <li><a ng-click="addHomework()">Add Homework</a></li>\n        <li ng-if="premiumSchool.hall_passes_on"><a ng-click="openNewHallPass()">Add Hall Pass</a></li>\n        <li><a ng-click="addEvent()">Add Event</a></li>\n        <li><a ng-click="addNoSchoolDay()">Add No School Day</a></li>\n        <li><a ng-click="addLateStart()">Add Late Start</a></li>\n        <li><a ng-click="addEarlyRelease()">Add Early Release</a></li>\n      </ul>      \n    </div>\n    <div class="empty-box-content no-icon" ng-if="!dayHomeworks">\n      <div class="empty-content">\n        <p>Nothing due on this day.</p>\n      </div>\n    </div>\n    <homework-list ng-if="dayHomeworks" list-control="hwListControl" homework-items="dayHomeworks" grouping-disabled="true" show-complete-checkbox="false" is-calendar="true" reload-on-complete-repeating="true"></homework-list>\n  </div>\n</div>'),a.put("templates/calendar/week-calendar.html",'<div class="full-col week-calendar" one-col="true">\n  <div class="box">\n    <div class="calendar-filters">\n      <ul class="filters two week no-drag-area">\n        <li>\n          <div class="radio month" tooltip-placement="bottom" tooltip="Month View" tooltip-enable="isMacApp">\n            <label><span class="fld"></span><input type="radio" ng-model="monthActive" value="month" ng-change="openMonthView()"><span class="icon month b"></span><span class="txt">Month</span></label>\n          </div>\n        </li>\n        <li>\n          <div class="radio week" tooltip-placement="bottom" tooltip="Week View" tooltip-enable="isMacApp">\n            <label><span class="fld"></span><input type="radio" value="week"><span class="icon week b"></span><span class="txt">Week</span></label>\n          </div>\n        </li>\n      </ul>\n      <a class="box-title-button no-drag-area" ng-click="toggleHomeworkAddOptions($event)"><span class="icon add" tooltip-placement="left" tooltip="Add ..."></span></a>\n    </div>\n    <h2 class="box-title">\n      <a ng-click="openPreviousWeek()" class="no-drag-area"><span class="icon prev b" tooltip-placement="bottom" tooltip="Previous Week"></span></a>\n      <span>{{ weekStartDate | date: \'MMMM d\' }} - {{ weekEndDate | date: \'MMMM d\' }}</span>\n      <a ng-click="openNextWeek()" class="no-drag-area"><span class="icon next b" tooltip-placement="bottom" tooltip="Next Week"></span></a>\n    </h2>\n    <div class="box-options" ng-class="{\'show\': showHomemeworkAddOptions}">\n      <ul class="box-options-content">\n        <li><a ng-click="addHomework()">Add Homework</a></li>\n        <li><a ng-click="addEvent()">Add Event</a></li>        \n      </ul>      \n    </div>\n    <div class="box-scroll">\n      <div class="empty-box-content no-icon" ng-if="noWeekHomework">\n        <div class="empty-content">\n         <p>Nothing due this week.</p>\n        </div>\n      </div>\n      <ul ng-repeat="day in week track by $index" class="box-content homework-list weekday-{{ $index }}" ng-class="{\'empty\': day.items.length == 0, \'collapsed\': day.collapsed}">\n        <li class="group-row" ng-class="{\'today\': day.isToday}">\n          <span class="large">{{ day.date | date: \'EEEE, d\' }}</span>\n          <span class="small">{{ day.date | date: \'EEE, d\' }}</span>\n        </li>\n        <li ng-repeat="homework in day.items" class="hw-row {{ homework.displayClasses }}" ng-click="openHomework(homework)" class-color>\n          <div class="line">\n            <div class="h-name"><a>{{ homework.title }}</a></div>\n            <div class="h-date"> \n              <span class="long">{{ homework.longDateFormat }}</span>\n              <span class="short">{{ homework.shortDateFormat }}</span>\n            </div>\n          </div>\n          <div class="line">\n            <div class="h-class" ng-if="homework.className"><span>{{ homework.className }}</span></div>\n            <div class="h-type" ng-if="homework.type">{{ homework.type.display }}</div>\n            <div class="h-type" ng-if="!homework.type && homework.isLate && !homework.isEvent">Late</div>\n            <div class="h-type" ng-if="!homework.type && homework.isUpcoming && !homework.isEvent">Upcoming</div>\n            <div class="h-type" ng-if="!homework.type && homework.isComplete && !homework.isEvent">Complete</div>\n            <span class="hw-icon repeats" tooltip="Repeats"></span>\n            <span class="hw-icon rimportant" tooltip="Really Important"></span>\n            <span class="hw-icon important" tooltip="Important"></span>\n            <span class="hw-icon reminder" tooltip="Reminder"></span>\n            <span class="hw-icon attachment" tooltip="Attachment"></span>\n            <span class="h-actions">\n              <span class="icon edit g" tooltip="Edit" ng-click="editHomework(homework, $event)"></span>\n              <span class="icon delete g" tooltip="Delete" ng-click="deleteHomework(homework, $event)"></span>\n              <span class="icon g unchecked" tooltip="Complete" ng-click="completeHomework(homework, $event)"></span>\n            </span>\n          </div>\n        </li>\n        <li class="weekday-counter" ng-click="expandWeek($index)"><span>{{ day.items.length }}</span></li>\n      </ul>\n    </div>\n  </div>\n</div>'),a.put("templates/classes/add-classes.html",'<div class="lightbox-header">\n  <h2>Add Classes</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <p>Quickly add your classes. You will be able to enter details, class times and colors later.</p>\n  <form name="form" class="inline tidy" novalidate>\n    <fieldset>\n      <div class="field" ng-class="{error: form.class1.$error.required && form.$submitted}">\n        <label>Class Name</label>\n        <div class="input">\n          <input autocomplete="off" type="text" name="class1" maxlength="100" ng-model="clss.class1" placeholder="e.g. Algebra" autofocus required>\n          <span class="error-msg" ng-show="form.class1.$error.required && form.$submitted">This field is required.</span>\n        </div>\n      </div>\n      <div class="field">\n        <label>Class Name</label>\n        <div class="input">\n          <input autocomplete="off" type="text" name="class2" maxlength="100" ng-model="clss.class2" placeholder="e.g. Biology">\n        </div>\n      </div>\n      <div class="field">\n        <label>Class Name</label>\n        <div class="input">\n          <input autocomplete="off" type="text" name="class3" maxlength="100" ng-model="clss.class3" placeholder="e.g. History">\n        </div>\n      </div>\n      <div class="field">\n        <label>Class Name</label>\n        <div class="input">\n          <input autocomplete="off" type="text" name="class4" maxlength="100" ng-model="clss.class4" placeholder="e.g. English">\n        </div>\n      </div>\n      <div class="field">\n        <label>Class Name</label>\n        <div class="input">\n          <input autocomplete="off" type="text" name="class5" maxlength="100" ng-model="clss.class5" placeholder="e.g. Social Studies">\n        </div>\n      </div>\n      <div class="field" ng-if="showingClassNames >= 6">\n        <label>Class Name</label>\n        <div class="input">\n          <input autocomplete="off" type="text" name="class6" maxlength="100" ng-model="clss.class6">\n        </div>\n      </div>\n      <div class="field" ng-if="showingClassNames >= 7">\n        <label>Class Name</label>\n        <div class="input">\n          <input autocomplete="off" type="text" name="class7" maxlength="100" ng-model="clss.class7">\n        </div>\n      </div>\n      <div class="field" ng-if="showingClassNames >= 8">\n        <label>Class Name</label>\n        <div class="input">\n          <input autocomplete="off" type="text" name="class8" maxlength="100" ng-model="clss.class8">\n        </div>\n      </div>\n      <div class="field" ng-if="showingClassNames >= 9">\n        <label>Class Name</label>\n        <div class="input">\n          <input autocomplete="off" type="text" name="class9" maxlength="100" ng-model="clss.class9">\n        </div>\n      </div>\n      <div class="field" ng-if="showingClassNames >= 10">\n        <label>Class Name</label>\n        <div class="input">\n          <input autocomplete="off" type="text" name="class10" maxlength="100" ng-model="clss.class10">\n        </div>\n      </div>\n      <div class="field" ng-if="showingClassNames < 10">\n        <div class="input">\n          <button class="alt-button" ng-click="addMoreClassNames()">Add More Class Names</button>\n        </div> \n      </div>\n      <div class="field" ng-class="{error: form.starts.$error.daterange && form.$submitted}">\n        <label>Classes Start Date</label>\n        <div class="input" ng-class="{\'focus\': startDatePicker.opened}">\n          <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'starts\')"></span>\n          <input type="text" name="starts" class="datepicker" ng-model="clss.starts" datepicker-popup="M/d/yyyy" is-open="startDatePicker.opened" ng-focus="openDatePicker($event, \'starts\')" ng-click="openDatePicker($event, \'starts\')" validate-date-range />\n          <span class="error-msg" ng-show="form.starts.$error.daterange && form.$submitted">Please enter a valid date.</span>\n        </div>\n      </div>\n      <div class="field" ng-class="{error: (form.ends.$error.daterange && form.$submitted) || (form.ends.$error.endDateBeforeStartDate && (form.$submitted || form.ends.$touched))}">\n        <label>Classes End Date</label>\n        <div class="input" ng-class="{\'focus\': endDatePicker.opened}">\n          <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'ends\')"></span>\n          <input type="text" name="ends" class="datepicker" ng-model="clss.ends" datepicker-popup="M/d/yyyy" is-open="endDatePicker.opened" ng-focus="openDatePicker($event, \'ends\')" ng-click="openDatePicker($event, \'ends\')" validate-date-range validate-classes-dates />\n          <span class="error-msg" ng-show="form.ends.$error.endDateBeforeStartDate && (form.$submitted || form.ends.$touched)">End date must be after the start date.</span>\n          <span class="error-msg" ng-show="form.ends.$error.daterange && form.$submitted">Please enter a valid date.</span>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset class="cage">\n      <div>\n        <input type="submit" class="button" value="Continue" ng-click="save(form, clss)">\n        <a class="close" ng-click="cancel()" ng-if="isEditForm">Cancel</a>\n      </div>\n    </fieldset>\n  </form>\n</div>\n'),
a.put("templates/classes/add-edit.html",'<div class="lightbox-header">\n  <h2>{{ formTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <div ng-if="!isEditForm && classAdded" class="alert-message success" ng-class="{\'hiding\': alertHiding }">Class Added Successfully!<a class="close-button" ng-click="closeAlert()"></a></div>\n  <form name="form" class="inline tidy" novalidate>\n    <div class="required"><span>*</span>Required Fields</div>\n    <fieldset>\n      <div class="field" ng-class="{error: form.name.$error.required && form.$submitted}">\n        <label>Class Name <span class="required">*</span></label>\n        <div class="input">\n          <input autocomplete="off" type="text" name="name" maxlength="100" ng-model="cls.name" autofocus required>\n          <span class="error-msg" ng-show="form.name.$error.required && form.$submitted">This field is required.</span>\n        </div>\n      </div>\n      <div class="field" ng-class="{error: form.starts.$error && form.$submitted}">\n        <label>Starts</label>\n        <div class="input" ng-class="{\'focus\': startDatePicker.opened}">\n          <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'starts\')"></span>\n          <input type="text" name="starts" class="datepicker" ng-model="cls.starts" datepicker-popup="M/d/yyyy" is-open="startDatePicker.opened" ng-focus="openDatePicker($event, \'starts\')" ng-click="openDatePicker($event, \'starts\')" validate-date-range />\n          <span class="error-msg" ng-show="form.starts.$error && form.$submitted">Please enter a valid date.</span>\n        </div>\n      </div>\n      <div class="field" ng-class="{error: (form.ends.$error.daterange && form.$submitted) || (form.ends.$error.endDateBeforeStartDate && (form.$submitted || form.ends.$touched))}">\n        <label>Ends</label>\n        <div class="input" ng-class="{\'focus\': endDatePicker.opened}">\n          <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'ends\')"></span>\n          <input type="text" name="ends" class="datepicker" ng-model="cls.ends" datepicker-popup="M/d/yyyy" is-open="endDatePicker.opened" ng-focus="openDatePicker($event, \'ends\')" ng-click="openDatePicker($event, \'ends\')" validate-date-range validate-class-dates />\n          <span class="error-msg" ng-show="form.ends.$error.endDateBeforeStartDate && (form.$submitted || form.ends.$touched)">End date must be after the start date.</span>\n          <span class="error-msg" ng-show="form.ends.$error.daterange && form.$submitted">Please enter a valid date.</span>\n        </div>\n      </div>\n      <div class="field">\n        <label>Building</label>\n        <div class="input">\n          <input type="text" name="building" ng-model="cls.building" maxlength="40" autocomplete="off">\n        </div>\n      </div>\n      <div class="field">\n        <label>Room</label>\n        <div class="input">\n          <input type="text" name="room" ng-model="cls.room" maxlength="40" autocomplete="off">\n        </div>\n      </div>\n      <div class="field">\n        <label>Teacher</label>\n        <div class="input">\n          <input type="text" name="teacher" ng-model="cls.teacherName" maxlength="40" autocomplete="off">\n        </div>\n      </div>\n      <div class="field">\n        <label>Class Color</label>\n        <div class="input" ng-class="{\'focus\': colorFocus || colorPicker.opened}">\n          <div class="selector" ng-click="openColorPicker($event)">\n            <span><span class="color" ng-style="{\'background-color\': \'#\' + cls.color.h }"></span>{{ cls.color.c }}</span>\n            <color-picker is-open="colorPicker.opened" ng-model="cls.color"></color-picker>\n            <select ng-focus="colorFocus=true" ng-blur="colorFocus=false" ng-if="!isWindowsApp"> </select>\n          </div>\n        </div>\n      </div>\n      <div class="field">\n        <label>Other Info</label>\n        <div class="input">\n          <textarea rows="5" cols="25" name="info" maxlength="4096" ng-model="cls.additionalInfo"></textarea>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset class="cage">\n      <div class="form-actions">\n        <input type="submit" class="button" value="Save" ng-click="save(form, cls)">\n        <input type="submit" class="button" ng-if="!isEditForm" value="Save &amp; Add Class Times" ng-click="save(form, cls, \'times\')">\n        <a class="close" ng-click="cancel()" ng-if="isEditForm">Cancel</a>\n      </div>\n      <div ng-if="!isEditForm">\n        <input type="submit" class="alt-button" value="Save &amp; Add Another Class" ng-click="save(form, cls, \'another\')">\n        <a class="close" ng-click="cancel()">Cancel</a>\n      </div>\n    </fieldset>\n  </form>\n</div>'),a.put("templates/classes/add-file.html",'<div class="lightbox-header">\n  <h2>Add File</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <form name="form" class="inline tidy" novalidate>  \n    <fieldset ng-model="files.uploadedFile" file-upload take-pic-disabled="true"></fieldset>\n  </form>\n</div>'),a.put("templates/classes/add-or-join.html",'<div class="lightbox-header">\n  <h2 ng-if="user">Add or Find Your Class</h2>\n  <h2 ng-if="!user">Sign Up or Add Your Class</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div ng-if="user" class="lightbox-content">\n  <div ng-if="userSchools" class="find-class-schools">\n    <h3 class="h5">Your Schools</h3>\n    <schools-list schools="userSchools"></schools-list>\n    <button ng-click="openAddManualClass()" ng-if="!showAddClasses">Add a Class Manually</button>\n    <button ng-click="openAddClasses()" ng-if="showAddClasses">Add Classes Manually</button>\n    <button class="alt-button find-class-button" ng-click="openFindClass()">Find Your Class<span class="icon next"></span></button>\n  </div>\n  <div class="grid" ng-if="!userSchools">\n    <div class="size1of2">\n      <p ng-if="user">If your teacher uses <a href="https://teachers.io" target="_blank">Teachers.io</a>, you can simply find your teacher, join their class and their class information will automatically sync to your myHomework account!</p>\n      <p ng-if="!user">Is your teacher using <a href="https://teachers.io" target="_blank">Teachers.io</a>? Sign up now to join your class and have assignments, resources and announcements automatically synced to your myHomework account!</p>\n      <ul class="no-list-style">\n        <li ng-if="user"><button class="alt-button" ng-click="openFindClass()">Find Your Class<span class="icon next"></span></button></li>\n        <li ng-if="!user"><button class="alt-button" ng-click="openSignup()">Sign up for myHomework</button></li>\n        <li ng-if="!showAddClasses"><button ng-click="openAddManualClass()">Add a Class Manually</button></li>\n        <li ng-if="showAddClasses"><button ng-click="openAddClasses()">Add Classes Manually</button></li>\n      </ul>\n    </div>\n    <div class="size1of2 connect">\n      <span class="icon-wrapper schedule"><span class="icon schedule b"></span></span>\n      <span class="icon-wrapper syllabus"><span class="icon syllabus b"></span></span>\n      <span class="icon-wrapper announcement"><span class="icon announcement b"></span></span>\n      <span class="icon-wrapper attach"><span class="icon attach b"></span></span>\n      <span class="icon-wrapper classes"><span class="icon classes b"></span></span>\n      <span class="connect-tio"></span>\n      <span class="connect-hw"></span>\n    </div>\n  </div>\n</div>\n<div ng-if="!user" class="lightbox-content">\n  <div class="grid">\n    <div>\n      <p>Sign Up for a free myHomework account to sync to other devices, the web and get additional features.</p>\n      <ul class="no-list-style">\n        <li><button ng-click="openSignup()">Sign up for myHomework</button></li>\n        <li ng-if="!showAddClasses"><button class="alt-button" ng-click="openAddManualClass()">Add a Class Manually</button></li>\n        <li ng-if="showAddClasses"><button class="alt-button" ng-click="openAddClasses()">Add Classes Manually</button></li>\n      </ul>\n    </div>\n  </div>\n</div>\n  \n'),a.put("templates/classes/add-syllabus.html",'<div class="lightbox-header">\n  <h2 ng-if="cls.syllabusFile">Replace Syllabus</h2>\n  <h2 ng-if="!cls.syllabusFile">Add Syllabus</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <ul class="box-content resources-list" ng-if="cls.syllabusFile">\n    <li resource-item="cls.syllabusFile" delete-enabled="false" is-syllabus="true"></li>\n  </ul>\n  <form name="form" class="inline tidy" novalidate>  \n    <fieldset ng-model="syllabus.uploadedFile" file-upload auto-upload="true" take-pic-disabled="true" default-file-description="Syllabus"></fieldset>\n  </form>\n</div>'),a.put("templates/classes/classes-list.html",'<div sticky-headers="{{ !groupingDisabled && !stickyHeadersDisabled }}" ng-class="{\'box-scroll\': !boxAlreadyScrolls, \'groups-disabled\': groupingDisabled}">\n  <div ng-if="clsFiltersEnabled" class="box-filters filters-row" id="cls-filter-options">\n    <ul class="filters three {{ clsFilters.active }}">\n      <li>\n        <div class="radio all">\n          <label><span class="fld"></span><input type="radio" ng-model="clsFilters.active" value="all"><span class="txt">All</span></label>\n        </div>\n      </li>\n      <li>\n        <div class="radio today">\n          <label><span class="fld"></span><input type="radio" ng-model="clsFilters.active" value="today"><span class="txt">Today</span></label>\n        </div>\n      </li>\n      <li>\n        <div class="radio tomorrow">\n          <label><span class="fld"></span><input type="radio" ng-model="clsFilters.active" value="tomorrow"><span class="txt">Tomorrow</span></label>\n        </div>\n      </li>\n    </ul>\n  </div>\n  <ul ng-repeat="group in classItems track by group.id" class="box-content classes-list" ng-class="{\'no-groups\': !(classItems.length > 1 || (group.items.length > 1 && alwaysShowGroupHeaders)) && clsFilters }">\n    <li ng-if="classItems.length > 1 || (group.items.length > 1 && alwaysShowGroupHeaders)" id="group-{{ ::group.id }}" class="group-row group-{{ ::group.id }}" ng-click="toggleGroup(group)"> \n      <span class="group-title">{{ group.title }}</span>\n      <span class="icon"></span>\n    </li>\n    <li ng-if="blockDayInfo && (!clsFilters || (clsFilters.active && clsFilters.active != \'all\'))" class="class-row block-day-info group-{{ ::group.id }}">\n		<div class="class-schedule day">\n		<div class="blocks">\n		  <span ng-if="blockDayInfo.color" class="block" ng-style="{\'background-color\': \'#\' + blockDayInfo.color.h}"></span>\n		  <span>{{ blockDayInfo.label }}</span>\n		</div>\n		</div>    \n    </li>\n    <li ng-repeat="cls in group.items track by cls.dbID" class="class-row group-{{ ::group.id }}" ng-click="openClass(cls)" class-color>\n      <div ng-if="!cls.isNoSchoolEvent">\n        <a ng-class="{\'no-class-time\': !cls.classTimes, \'has-location\': cls.locationDescription && (!clsFilters || !(!clsFilters.active || clsFilters.active == \'all\'))}">{{ cls.name }}</a>\n        <span ng-if="cls.locationDescription && (!clsFilters || !(!clsFilters.active || clsFilters.active == \'all\'))" class="class-location">{{ cls.locationDescription }}</span>\n        <class-times ng-if="cls.classTimes && clsFilters && (!clsFilters.active || clsFilters.active == \'all\')" class-item="cls" ></class-times>\n        <day-class-times ng-if="cls.classTimes && (!clsFilters || !(!clsFilters.active || clsFilters.active == \'all\'))" class-item="cls" block-day-info="blockDayInfo"></day-class-times>\n      </div>\n      <div ng-if="cls.isNoSchoolEvent">\n        <a ng-class="{\'no-class-time\': cls.isAllDayEvent }">{{cls.description}}</a>\n        <div class="class-schedule day" ng-if="!cls.isAllDayEvent && cls.timeFormat">\n          <span class="detail">{{ cls.timeFormat }}</span>\n        </div>\n      </div>\n    </li>\n    <li ng-if="group.items && group.items.length == 0 && (clsFilters.active == \'today\' || clsFilters.active == \'tomorrow\')" class="empty-box-content no-icon empty-content-row">      \n      <div class="empty-content">\n        <p ng-if="clsFilters.active == \'today\'">You have no class times today.</p>\n        <p ng-if="clsFilters.active == \'tomorrow\'">You have no class times tomorrow.</p>\n      </div>\n    </li>\n    <li ng-if="blockScheduleChangeLabel && !settings.hasSchoolBlockSchedule">Not {{ blockScheduleChangeLabel }}? <a ng-click="changeBlockDay()">Change it here...</a></li>\n    <li ng-if="alternateWeekSwitcherWeek && !blockScheduleChangeLabel">Not Week {{ alternateWeekSwitcherWeek }}? <a ng-click="changeAltWeek()">Change it here...</a></li>\n    <li ng-if="showAddClassTimes && $index==0" ng-click="addClassTimes()"><a>Add Class Times</a><span class="icon next b"></span></li>\n  </ul>\n</div>'),a.put("templates/classes/classes.html",'<div class="full-col" ng-class="{\'hasad\': user && themeBanner && showTheme || user.myHomeworkAd.adImageURL || user.shouldRenew || myHomeworkTip}" one-col="true">\n  <div class="box" ng-class="{\'has-filters\': clsFiltersEnabled && !isMacApp}">\n    <h2 class="box-title" ng-if="!isMacApp || clsFilters.active == \'all\'">Classes</h2>\n    <h2 class="box-title" ng-if="isMacApp && clsFilters.active == \'today\'">Today\'s Classes</h2>\n    <h2 class="box-title" ng-if="isMacApp && clsFilters.active == \'tomorrow\'">Tomorrow\'s Classes</h2>\n    <a class="box-title-button no-drag-area" ng-click="addClass()"><span class="icon add" tooltip-placement="left" tooltip="Add Class"></span></a>\n    <a class="box-title-button left no-drag-area" ng-if="clsFiltersEnabled && isMacApp" ng-click="clsListControl.toggleFilters($event)"><span class="icon filter" tooltip-placement="bottom" tooltip="Filter by"></span></a>\n    <div class="empty-box-content" ng-if="((!userClasses || userClasses.length == 0) && (!clsFilters.active || cls.clsFilters.active == \'all\')) || !clsFiltersEnabled">\n      <span class="m-icon blue classes"></span>\n      <div class="empty-content">\n        <p>This is where all your classes will be displayed.</p>\n        <p ng-if="user">Enter your first class or search for a Teachers.io class using the + button up above.</p>\n        <p ng-if="!user">Enter your first class using the + button up above.</p>\n      </div>\n    </div>\n    <div class="box-scroll empty" ng-if="userClasses && userClasses.length > 0 && clsFiltersEnabled && (clsFilters.active == \'today\' || clsFilters.active == \'tomorrow\') && filteredClasses.length == 0">\n     <div class="empty-box-content no-icon">\n        <div class="empty-content">\n          <p ng-if="clsFilters.active == \'today\'">You have no class times today.</p>\n          <p ng-if="clsFilters.active == \'tomorrow\'">You have no class times tomorrow.</p>\n        </div>\n      </div>\n    </div>\n    <classes-list ng-if="userClasses && userClasses.length > 0" list-control="clsListControl" class-items="filteredClasses" cls-filters-enabled="clsFiltersEnabled" cls-filters="clsFilters" grouping-disabled="groupingDisabled" block-schedule-change-label="blockScheduleChangeLabel" alternate-week-switcher-week="alternateWeekSwitcherWeek" show-add-class-times="showAddClassTimes"></classes-list>\n  </div>\n  <div class="instinad themead" ng-if="user && themeBanner && showTheme && !user.shouldRenew">\n    <a ng-click="openThemeBanner(themeBanner)"><img ng-src="{{ themeBanner.i }}" /></a>\n  </div>\n  <div class="instinad" ng-if="!themeBanner && user.myHomeworkAd.adImageURL && !user.shouldRenew">\n    <a ng-click="openmyHomeworkAd(user.myHomeworkAd)"><img ng-src="{{ user.myHomeworkAd.adImageURL }}" /></a>\n  </div>\n  <div class="adtip" ng-if="myHomeworkTip && !themeBanner && !user.shouldRenew" ng-click="openTip(myHomeworkTip)">\n    <span class="tip-icon"></span>\n    <span class="tip-text">{{ myHomeworkTip.text }}</span>\n  </div>\n  <div class="renewal" ng-if="user.shouldRenew && !user.mustRenew">\n    <div ng-if="user.daysLeftToRenew == 1">Your 1-year myHomework Premium expires tomorrow.</div>\n    <div ng-if="user.daysLeftToRenew > 1">Your 1-year myHomework Premium expires in {{ user.daysLeftToRenew }} days.</div>\n    <a class="image-link" ng-click="openRenew()">Renew<span class="icon next w"></span></a>\n  </div>\n  <div class="renewal important" ng-if="user.shouldRenew && user.mustRenew">\n    <div>Your 1 year myHomework Premium has expired.</div>\n    <a class="image-link" ng-click="openRenew()">Renew<span class="icon next w"></span></a>\n  </div>\n<div>'),a.put("templates/classes/edit-class-color.html",'<div class="lightbox-header">\n  <h2 ng-if="isEditForm">Edit Class Color</h2>\n  <h2 ng-if="!isEditForm">Add Class Color</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content edit-class-color">\n  <form name="form" class="inline tidy" novalidate>\n    <fieldset>\n     <div class="field">\n        <label>Class Color</label>\n        <div class="input">\n          <div class="selector" ng-click="openColorPicker($event)">\n            <span><span class="color" ng-style="{\'background-color\': \'#\' + color.h }"></span>{{ color.c }}</span>\n            <color-picker is-open="colorPicker.opened" ng-model="color"></color-picker>\n          </div>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset class="cage">\n      <div class="form-actions">\n        <input type="submit" class="button" value="Save" ng-click="save(form)">\n        <a class="close" ng-click="cancel()">Cancel</a>\n      </div>\n    </fieldset>\n  </form>\n</div>'),a.put("templates/classes/find-class.html",'<div class="lightbox-header">\n  <h2>Find Your Class</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content find-class">\n  <form name="form" class="search-form" novalidate>\n    <fieldset>\n      <div class="field" ng-class="{error: form.query.$error.required && form.$submitted}">\n        <div class="input">\n          <input autocomplete="off" type="text" name="query" maxlength="512" placeholder="School or Teacher Name" ng-model="searchQuery" required>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset class="cage">\n      <input type="submit" class="button" value="Search" ng-click="searchSchoolsAndTeachers(form)">\n      <span class="error-msg" ng-show="form.query.$error.required && form.$submitted">Please enter a search term.</span>\n    </fieldset>\n  </form>\n  <div class="geo-schools" ng-if="geoSchools">\n    <div ng-if="geoSchools.facebookSchools && geoSchools.facebookSchools.length">\n      <h3 class="h5">Facebook Schools</h3>\n      <schools-list schools="geoSchools.facebookSchools"></schools-list>\n    </div>\n    <div ng-if="geoSchools.possibleSchools && geoSchools.possibleSchools.length">\n      <h3 class="h5">Possible Schools</h3>\n      <schools-list schools="geoSchools.possibleSchools"></schools-list>\n    </div>\n    <div ng-if="geoSchools.nearbySchools && geoSchools.nearbySchools.length">\n      <h3 class="h5">Nearby Schools</h3>\n      <schools-list schools="geoSchools.nearbySchools"></schools-list>\n    </div>\n    <h3 class="h5">Can\'t find your school?</h3>\n    <p>Our schools database is still growing. <a href="https://myhomeworkapp.com/contact" target="_blank">Let us know</a> if your school is missing.</p>\n  </div>\n  <div class="search-results" ng-if="searchResult">\n    <ul class="tabs">\n     <li ng-class="{\'sel\': defaultResult == \'schools\'}"><a ng-click="changeDefaultResult(\'schools\')">Schools</a></li>\n     <li ng-class="{\'sel\': defaultResult == \'teachers\'}"><a ng-click="changeDefaultResult(\'teachers\')">Teachers</a></li>\n    </ul>\n    <div class="search-result-schools" ng-if="defaultResult == \'schools\'" ng-class="{\'has-schools\': searchResult.schools && searchResult.schools.length}">\n      <schools-list ng-if="searchResult.schools && searchResult.schools.length" schools="searchResult.schools"></schools-list>\n      <p ng-if="!searchResult.schools || searchResult.schools.length == 0">We couldn\'t find any schools. Try a different search.</p>\n      <p ng-if="searchResult.schools && searchResult.schools.length">Didn\'t find your school? You might try a different search.</p>\n      <p>Our schools database is still growing. <a href="https://myhomeworkapp.com/contact" target="_blank">Let us know</a> if your school is missing.</p>\n    </div>\n    <div class="search-result-teachers" ng-if="defaultResult == \'teachers\'" ng-class="{\'has-teachers\': searchResult.teachers && searchResult.teachers.length}">\n      <teachers-list ng-if="searchResult.teachers && searchResult.teachers.length" teachers="searchResult.teachers"></teachers-list>\n      <p>Didn\'t find your teacher? You might try a different search.</p>\n    </div>\n  </div>\n  <spinner ng-if="fetchSpinner.show" spinner-text="{{ fetchSpinner.text }}"></spinner>\n</div>'),a.put("templates/classes/find-school-teachers.html",'<div class="lightbox-header">\n  <h2>{{ school.name }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content find-school-teachers">\n  <div ng-if="school.teachers">\n    <h3 class="h5">Choose your teacher</h3>\n    <teachers-list teachers="school.teachers"></teachers-list>\n    <h3 class="h5">Can\'t find your teacher at this school?</h3>\n    <p><a href="https://teachers.io" target="_blank">Teachers.io</a> is a free app where teachers can share everything about their classes with myHomework users. If your teachers use Teachers.io, you can easily join their class and get all of the due dates, files, links and announcements right in your myHomework planner! Tell your teachers they can go to <a href="https://teachers.io" target="_blank">https://teachers.io</a> to get started.</p>\n    <button ng-click="openAddManualClass()">Add a Class Manually</button>\n  </div>\n  <div ng-if="!school.teachers && !fetchSpinner.show">\n    <h3 class="h6">It doesn\'t look like any teachers at this school are using Teachers.io yet.</h3>\n    <p><a href="https://teachers.io" target="_blank">Teachers.io</a> is a free app where teachers can share everything about their classes with myHomework users. If your teachers use Teachers.io, you can easily join their class and get all of the due dates, files, links and announcements right in your myHomework planner!</p>\n    <p>Tell your teachers they can go to <a href="https://teachers.io" target="_blank">https://teachers.io</a> to get started.</p>\n    <button ng-click="openAddManualClass()">Add a Class Manually</button>\n  </div>\n  <spinner ng-if="fetchSpinner.show" spinner-text="{{ fetchSpinner.text }}"></spinner>\n</div>'),a.put("templates/classes/view-announcements.html",'<div class="box">\n  <h2 class="box-title">Announcements</h2>\n  <div class="empty-box-content no-icon" ng-if="!announcements">\n    <div class="empty-content">\n      <p ng-if="cls.isDeletable || cls.isLeaveable">The teacher hasn\'t shared any announcements for this class.</p>\n      <p ng-if="cls.cnj && !cls.isDeletable && !cls.isLeaveable && !cls.isJoinable">Contact the teacher to join or leave this class.</p>\n      <p ng-if="!cls.cnj && !cls.isDeletable && !cls.isLeaveable && !cls.isJoinable">This class has ended.</p>\n      <p ng-if="cls.isJoinable">Join this class to see any class announcements.</p>\n      <p ng-if="cls.isJoinable"><button class="button" ng-click="joinClass(cls)"><span class="icon add"></span>Join Class</button></p>\n    </div>\n  </div>\n  <ul class="box-content announcements-list" ng-if="announcements">\n    <li ng-repeat="announcement in announcements track by announcement.id" class="ann">\n      <div class="ann-text">\n        <span class="unread" ng-if="!announcement.isRead">Unread:</span>\n        <span ng-bind-html="announcement.textHTML" ng-if="announcement.textHTML"></span>\n        <span ng-if="!announcement.textHTML">{{ announcement.text }}</span>\n      </div>\n      <div class="ann-date">{{ announcement.created | date:\'MMMM d - h:mm a\' }}</div>\n    </li>\n  </ul>\n</div>\n'),a.put("templates/classes/view-class.html",'<div class="left-col">\n  <class-details></class-details>\n</div>\n<draggable-cols></draggable-cols>\n<div class="right-col class-sec has-toolbar mac-always-right {{activeTab}}" ng-switch="activeTab">\n  <ul class="toolbar" ng-class="{\'three\': !cls.isTeachersIOClass && !isMacApp, \'four\': cls.isTeachersIOClass && !isMacApp}">\n    <li class="toolbar-class-info"><a class="info" ng-class="{\'sel\': activeTab == \'info\'}" ng-click="changeTab(\'info\')" tooltip="About" tooltip-enable="isMacApp"><span class="i"></span><span>About</span></a></li>\n    <li><a class="schedule" ng-class="{\'sel\': activeTab == \'schedule\' || activeTab == \'details\'}" ng-click="changeTab(\'schedule\')" tooltip="Schedule" tooltip-enable="isMacApp"><span class="i"></span><span>Schedule</span></a></li>\n    <li><a class="syllabus" ng-class="{\'sel\': activeTab == \'syllabus\'}" ng-click="changeTab(\'syllabus\')" tooltip="Syllabus" tooltip-enable="isMacApp"><span class="i"></span><span>Syllabus</span></a></li>\n    <li ng-if="!cls.isTeachersIOClass"><a class="resources" ng-class="{\'sel\': activeTab == \'files\'}" ng-click="changeTab(\'files\')" tooltip="Files" tooltip-enable="isMacApp"><span class="i"></span><span>Files</span></a></li>\n    <li ng-if="cls.isTeachersIOClass"><a class="resources" ng-class="{\'sel\': activeTab == \'resources\'}" ng-click="changeTab(\'resources\')" tooltip="Resources" tooltip-enable="isMacApp"><span class="i"></span><span>Resources</span></a></li>\n    <li ng-if="cls.isTeachersIOClass"><a class="announcements" ng-class="{\'sel\': activeTab == \'announcements\'}" ng-click="changeTab(\'announcements\')" tooltip="Announcements" tooltip-enable="isMacApp"><span class="i"></span><span>Announcements</span></a></li>\n  </ul>\n  <class-details class="class-info-page"></class-details>\n  <class-schedule class="class-schedule-page" ng-switch-default></class-schedule>\n  <class-syllabus ng-switch-when="syllabus"></class-syllabus>\n  <class-resources ng-switch-when="files"></class-resources>\n  <class-resources ng-switch-when="resources"></class-resources>\n  <class-announcements ng-switch-when="announcements" ng-if="cls.isTeachersIOClass"></class-announcements>\n</div>\n<spinner ng-if="fetchSpinner.show" spinner-text="{{ fetchSpinner.text }}"></spinner>'),a.put("templates/classes/view-details.html",' <div class="box">\n  <h2 class="box-title">Class Details</h2>\n  <div class="box-scroll">\n    <div class="box-content class-content">\n      <h3>{{ cls.name }}</h3>\n      <p ng-if="cls.termDisplay">{{ cls.termDisplay }}</p> \n      <dl class="inline">\n        <dt ng-if="cls.starts && (cls.isPast || cls.isCurrent)">Started</dt><dt ng-if="cls.starts && cls.isFuture">Started</dt><dd ng-if="cls.starts">{{ cls.starts | date:\'EEEE, MMM d\' }}</dd>\n        <dt ng-if="cls.ends && cls.isPast">Ended</dt><dt ng-if="cls.ends && (cls.isFuture || cls.isCurrent)">Ends</dt><dd ng-if="cls.ends">{{ cls.ends | date:\'EEEE, MMM d\' }}</dd>\n        <dt ng-if="cls.building && cls.room">Location</dt><dt ng-if="cls.building && !cls.room">Building</dt><dt ng-if="!cls.building && cls.room">Room</dt><dd ng-if="cls.building && cls.room">{{ cls.building }}, {{ cls.room }}</dd><dd ng-if="cls.building && !cls.room">{{ cls.building }}</dd><dd ng-if="!cls.building && cls.room">{{ cls.room }}</dd>\n        <dt ng-if="cls.teacherName">Teacher</dt><dd ng-if="cls.teacherName">{{ cls.teacherName }}</dd>\n        <dt ng-if="cls.color">Color</dt><dd ng-if="cls.color"><span class="class-color" ng-style="{\'background-color\': \'#\' + cls.color.h }"></span>{{ cls.color.c }}<a class="image-link color-link" ng-click="editClassColor(cls)" ng-if="cls.isTeachersIOClass"><span class="icon edit"></span>Change Color</a></dd>\n        <dt ng-if="!cls.color && (cls.isDeletable || cls.isLeaveable)">Color</dt><dd ng-if="!cls.color && (cls.isDeletable || cls.isLeaveable)"><a class="image-link" ng-click="editClassColor(cls)"><span class="icon add"></span>Add Class Color</a></dd>\n        <dt ng-if="cls.additionalInfo" ng-class="{\'long-txt\': cls.additionalInfo.length > 60 }">Other Info</dt><dd ng-if="cls.additionalInfo" class="additional-info" ng-class="{\'long-txt\': cls.additionalInfo.length > 60 }" ng-bind-html="cls.additionalInfo | linky:\'_blank\'"></dd>\n      </dl>\n      <h3 ng-if="cls.description">Class Description</h3>\n      <p ng-if="cls.description">{{ cls.description | limitTo:1024 }}{{ cls.description.length > 1024 ? \'...\' : \'\' }}</p>\n      <h3 ng-if="cls.isDeletable || cls.isLeaveable">Class Times</h3>\n      <class-times ng-if="cls.classTimes" class-item="cls" edit-enabled="true"></class-times>\n      <p ng-if="!cls.classTimes && (cls.isDeletable || cls.isLeaveable)"><a class="alt-button" ng-click="addClassTime(cls)"><span class="icon add"></span>Add Class Times</a></p>\n      <p ng-if="cls.classTimes && (cls.isDeletable || cls.isLeaveable)"><a class="alt-button" ng-click="addClassTime(cls)"><span class="icon add"></span>Add More Class Times</a></p>\n      <div ng-if="cls.imps">\n        <class-import-details></class-import-details>\n      </div>\n      <div class="teacher-snippet" ng-if="cls.teacher">\n        <a href="#/teachers/{{ cls.teacher.username }}">\n          <img ng-src="{{ cls.teacher.localAvatar }}" alt="Teacher Picture" ng-if="cls.teacher.localAvatar" />\n          <span class="s-icon account" ng-if="!cls.teacher.localAvatar"></span>\n        </a>\n        <div class="teacher-details">\n          <div class="teacher-name"><a href="#/teachers/{{ cls.teacher.username }}">{{ cls.teacher.name }}</a></div>\n          <div class="teacher-info" ng-if="cls.teacher.title"><span>{{ cls.teacher.title }}</span></div>\n        </div>\n      </div>\n      <div class="school-snippet" ng-if="cls.school">\n        <a href="#/schools/{{ cls.school.slug }}">\n          <img ng-src="{{ cls.school.localAvatar }}" alt="School Logo" ng-if="cls.school.localAvatar" />\n          <span class="s-icon schools" ng-if="!cls.school.localAvatar"></span>\n        </a>\n        <div class="school-details">\n          <p class="school-name"><a href="#/schools/{{ cls.school.slug }}">{{ cls.school.name }}</a></p>\n          <p class="school-addr"><span ng-if="cls.school.location">{{ cls.school.location }}</span></p>\n        </div>\n      </div>\n      <div>\n        <button class="button" ng-if="cls.isJoinable" ng-click="joinClass(cls)"><span class="icon add"></span>Join Class</button>\n        <button class="delete-button" ng-if="cls.isLeaveable" ng-click="leaveClass(cls)"><span class="icon delete"></span>Leave Class</button>\n        <button class="alt-button" ng-if="!cls.isTeachersIOClass" ng-click="editClass(cls)"><span class="icon edit"></span>Edit Class</button>\n        <button class="delete-button" ng-if="cls.isDeletable" ng-click="deleteClass(cls)"><span class="icon delete"></span>Delete Class</button>\n      </div>  \n    </div>\n  </div>\n</div>'),a.put("templates/classes/view-import-details.html",'<div>\n<div ng-repeat="imp in cls.imps" title="Click to pull latest information" style="cursor: pointer;" ng-click="updateFromImport(imp, cls);">\n    <h3><img style="margin-top:2px; padding-right: 8px;" ng-if="imp.ico" src="{{ imp.ico }}"></img>{{ imp.disp }}</h3>\n      <dl class="inline">\n        <dt>Last Updated</dt><dd>{{ imp.lu | date:\'EEEE, MMM d y - h:mm a\' }}</dd>\n        <dt ng-if="prb" class="error">Issue</dt><dd>{{ imp.prb }}</dd>\n      </dl>\n</div>\n</div>'),a.put("templates/classes/view-resources.html",'<div class="box">\n  <h2 class="box-title" ng-if="cls.isTeachersIOClass">Resources</h2>\n  <h2 class="box-title" ng-if="!cls.isTeachersIOClass">Files</h2>\n  <a class="box-title-button no-drag-area" ng-click="addFile(cls)" ng-if="!cls.isTeachersIOClass && user && user.isPremiumOrSchoolAccount"><span class="icon add" tooltip-placement="left" tooltip="Upload File"></span></a>\n  <div class="empty-box-content no-icon" ng-if="!cls.isTeachersIOClass && !cls.classFiles">\n    <div class="empty-content" ng-if="user && user.isPremiumOrSchoolAccount">\n      <a class="alt-button" ng-click="addFile(cls)"><span class="icon add"></span>Upload a File</a>\n    </div>\n    <div class="empty-content" ng-if="!user || !user.isPremiumOrSchoolAccount">\n      <p>You need to have a Premium myHomework account in order to upload files.</p>\n      <a class="button" ng-click="openSignup()" ng-if="!user">Sign up</a>\n      <a class="button" ng-click="openUpgradeAccount()" ng-if="user && !user.isPremiumOrSchoolAccount">Upgrade your Account</a>\n    </div>\n  </div>\n  <div class="empty-box-content no-icon" ng-if="cls.isTeachersIOClass && !cls.classFiles && !cls.classLinks">\n    <div class="empty-content">\n      <p ng-if="cls.isDeletable || cls.isLeaveable || cls.isJoinable">The teacher hasn\'t shared any files or links for this class.</p>\n      <p ng-if="cls.cnj && !cls.isDeletable && !cls.isLeaveable && !cls.isJoinable">Contact the teacher to join or leave this class.</p>\n      <p ng-if="!cls.cnj && !cls.isDeletable && !cls.isLeaveable && !cls.isJoinable">This class has ended.</p>\n    </div>\n  </div>\n  <div class="box-scroll" ng-class="{\'no-filters\': isTeachersIOClass || isMacApp }" sticky-headers="true">\n    <ul ng-repeat="group in filteredResources track by group.id" class="box-content resources-list">\n      <li id="group-{{ ::group.id }}" class="group-row group-{{ ::group.id }}" ng-class="{\'closed\': group.closed}" ng-click="toggleGroup(group)" ng-if="isTeachersIOClass"> \n        <span class="group-title">{{ group.title }}</span>\n        <span class="icon"></span>\n      </li>\n      <li ng-repeat="item in group.items track by item.id" class="r-row group-{{ ::group.id }}" resource-item="item" delete-enabled="!isTeachersIOClass"></li>\n    </ul>\n  </div>\n</div>\n'),
a.put("templates/classes/view-schedule.html",'<div class="box" ng-class="{\'has-filters\': hwFiltersEnabled && !isMacApp}">\n  <h2 class="box-title">Schedule</h2>\n  <a class="box-title-button no-drag-area" ng-click="addHomework()" ng-if="cls.isDeletable || cls.isLeaveable"><span class="icon add" tooltip-placement="left" tooltip="Add Homework"></span></a>\n  <a class="box-title-button left no-drag-area" ng-if="hwFiltersEnabled && isMacApp" ng-click="hwListControl.toggleFilters($event)"><span class="icon filter" tooltip-placement="bottom" tooltip="Filter by"></span></a>\n  <div class="empty-box-content no-icon" ng-if="!hasHomework">\n    <div class="empty-content">\n      <p ng-if="cls.isDeletable || cls.isLeaveable">No assignments have been added yet.</p>\n      <p ng-if="cls.cnj && !cls.isDeletable && !cls.isLeaveable && !cls.isJoinable">Contact the teacher to join or leave this class.</p>\n      <p ng-if="!cls.cnj && !cls.isDeletable && !cls.isLeaveable && !cls.isJoinable">This class has ended.</p>\n      <p ng-if="cls.isJoinable">Join this class to see the class schedule.</p>\n      <p ng-if="cls.isJoinable"><button class="button" ng-click="joinClass(cls)"><span class="icon add"></span>Join Class</button></p>\n    </div>\n  </div>  \n  <homework-list ng-if="userHomeworks" list-control="hwListControl" homework-items="filteredHomeworks" hw-filters-enabled="hwFiltersEnabled" hw-filters="hwFilters"></homework-list>\n</div>'),a.put("templates/classes/view-syllabus.html",'<div class="box">\n  <h2 class="box-title">Syllabus</h2>\n  <a class="box-title-button no-drag-area" ng-click="addSyllabus(cls)" ng-if="!cls.isTeachersIOClass && user && user.isPremiumOrSchoolAccount"><span class="icon add" tooltip-placement="left" tooltip="Upload Syllabus"></span></a>\n  <div class="empty-box-content no-icon" ng-if="!cls.isTeachersIOClass && !cls.syllabusFile">\n    <div class="empty-content" ng-if="user && user.isPremiumOrSchoolAccount">\n      <a class="alt-button" ng-click="addSyllabus(cls)"><span class="icon add"></span>Upload your Syllabus</a>\n    </div>\n    <div class="empty-content" ng-if="!user || !user.isPremiumOrSchoolAccount">\n      <p>You need to have a Premium myHomework account in order to upload your syllabus.</p>\n      <a class="button" ng-click="openSignup()" ng-if="!user">Sign up</a>\n      <a class="button" ng-click="openUpgradeAccount()" ng-if="user && !user.isPremiumOrSchoolAccount">Upgrade your Account</a>\n    </div>\n  </div>\n  <div class="empty-box-content no-icon" ng-if="cls.isTeachersIOClass && !cls.syllabusFile && !cls.syllabusSections">\n    <div class="empty-content">\n      <p ng-if="cls.isDeletable || cls.isLeaveable || cls.isJoinable">The teacher hasn\'t shared a syllabus for this class.</p>\n      <p ng-if="cls.cnj && !cls.isDeletable && !cls.isLeaveable && !cls.isJoinable">Contact the teacher to join or leave this class.</p>\n      <p ng-if="!cls.cnj && !cls.isDeletable && !cls.isLeaveable && !cls.isJoinable">This class has ended.</p>\n    </div>\n  </div>\n  <ul class="box-content resources-list" ng-if="cls.syllabusFile">\n    <li resource-item="cls.syllabusFile" delete-enabled="true" is-syllabus="true" ng-if="!cls.isTeachersIOClass"></li>\n    <li resource-item="cls.syllabusFile" delete-enabled="false" is-syllabus="true" ng-if="cls.isTeachersIOClass"></li>\n  </ul>\n  <div class="box-scroll" ng-if="cls.isTeachersIOClass && cls.syllabusSections">\n    <div class="box-content syllabus-sec rich-text-editor-content" ng-repeat="section in cls.syllabusSections track by $index">\n      <h4 class="h5">{{ section.h }}</h4>\n      <div ng-bind-html="section.t"></div>\n    </div>\n  </div>\n</div>'),a.put("templates/classtimes/add-block-based.html",'<div class="lightbox-header">\n  <h2>{{ formTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <form name="form" class="class-times-form" novalidate ng-if="blocksPerDay">\n    <fieldset>\n      <table>\n        <thead>\n          <tr>\n            <th>{{ settings.blockDayName | titleCapitalize }}s</th>\n            <th ng-repeat="n in blocksRange track by $index">\n              {{ n | ordinal }}\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr ng-repeat="day in blockOptions">\n            <td class="block-label">\n              <span ng-if="day.color" class="block" ng-style="{\'background-color\': \'#\' + day.color.h}"></span>\n              <span ng-if="day.text">{{ day.text }}</span>\n              <span ng-if="!day.text">{{ day.label }}</span>\n            </td>\n            <td ng-repeat="b in day.blocks track by $index">\n              <div class="checker" ng-class="{\'checked\': b.active }"><label><span class="fld"></span><input type="checkbox" ng-model="b.active" value="true"></label></div>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </fieldset>\n    <fieldset class="cage" ng-if="!hasMoreClasses">\n      <input type="submit" class="button" name="submit" value="Save" ng-click="save()">\n      <a ng-click="cancel()" class="close">Cancel</a>\n      <button class="delete-button" ng-click="deleteClassTime()" ng-if="isEdit"><span class="icon delete"></span>Delete Block Schedule</button>\n    </fieldset>\n    <fieldset class="cage" ng-if="hasMoreClasses">\n      <input type="submit" class="button" name="submit" value="Continue" ng-click="save(form)">\n      <a ng-click="skip()" class="close">Skip</a>\n    </fieldset>\n  </form>\n  <div class="add-class-times-block" ng-if="!blocksPerDay">\n    <class-settings></class-settings>\n  </div>\n</div>'),a.put("templates/classtimes/add-class-times.html",'<div class="lightbox-header">\n  <h2>{{ formTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <form name="form" class="sectioned tidy" novalidate>\n    <fieldset ng-class="{\'no-border\': !types.active}">\n      <div ng-if="settings.hasSchoolBlockSchedule" class="field">\n          <input class="button" name="block" value="{{ settings.blockDayName | titleCapitalize }} Day Class Time" ng-click="blockSelected();"></input>      \n      </div>\n      <div class="field">\n        <legend><span ng-if="settings.hasSchoolBlockSchedule">Or </span>Choose a Type</legend>\n        <div class="input">\n          <ul>\n            <li>\n              <div class="radio" ng-class="{\'checked\': types.active == \'time\'}">\n                <label><span class="fld"></span><input type="radio" ng-model="types.active" value="time" name="type" ng-change="typeSelected()"><span class="txt">Time based <span class="alt-txt">(e.g. Mon-Fri 8:30-9:15)</span></span></label>\n              </div>\n            </li>\n            <li>\n              <div class="radio" ng-class="{\'checked\': types.active == \'period\'}">\n                <label><span class="fld"></span><input type="radio" ng-model="types.active" value="period" name="type" ng-change="typeSelected()"><span class="txt">Period based <span class="alt-txt">(e.g. Tue-Thur 3rd Period)</span></span></label>\n              </div>\n            </li>\n            <li>\n              <div ng-if="!settings.hasSchoolBlockSchedule" class="radio" ng-class="{\'checked\': types.active == \'block\'}">\n                <label><span class="fld"></span><input id="block-radio-input" type="radio" ng-model="types.active" value="block" name="type" ng-change="typeSelected()"><span class="txt">Block based <span class="alt-txt">(e.g. Purple Days 2nd block, Gold Days 5th block)</span></span></label>\n              </div>\n            </li>\n            <li ng-if="otherTypeEnabled">\n              <div class="radio" ng-class="{\'checked\': types.active == \'other\'}">\n                <label><span class="fld"></span><input type="radio" ng-model="types.active" value="other" name="type" ng-change="typeSelected()"><span>Other</span></label>\n              </div>\n            </li>\n          </ul>  \n        </div>\n      </div>\n    </fieldset>\n    <fieldset ng-if="types.active == \'time\'" class="no-border">\n      <div class="field">\n        <legend>Time Based Options</legend>\n        <div class="input">\n          <ul>\n            <li>\n              <div class="radio" ng-class="{\'checked\': weekType.active == \'same\'}">\n                <label><span class="fld"></span><input type="radio" ng-model="weekType.active" value="same" name="type" ng-change="weekTypeSelected()"><span class="txt">Same schedule each week <span class="alt-txt">(e.g. Mon-Fri 8:30-9:15)</span></span></label>\n              </div>\n            </li>\n            <li>\n              <div class="radio" ng-class="{\'checked\': weekType.active == \'alternate\'}">\n                <label><span class="fld"></span><input type="radio" ng-model="weekType.active" value="alternate" name="type" ng-change="weekTypeSelected()"><span class="txt">Alternating weeks <span class="alt-txt">(e.g. Mon-Fri 8:30-9:15 1st week, Tue-Thur 10:00-11:00 2nd week)</span></span></label>\n              </div>\n            </li>\n          </ul>  \n        </div>\n      </div>\n    </fieldset>\n    <fieldset ng-if="types.active == \'period\'" class="no-border">\n      <div class="field">\n        <legend>Period Based Options</legend>\n        <div class="input">\n          <ul>\n            <li>\n              <div class="radio" ng-class="{\'checked\': weekType.active == \'same\'}">\n                <label><span class="fld"></span><input type="radio" ng-model="weekType.active" value="same" name="type" ng-change="weekTypeSelected()"><span class="txt">Same schedule each week <span class="alt-txt">(e.g. Mon-Fri 3rd period)</span></span></label>\n              </div>\n            </li>\n            <li>\n              <div class="radio" ng-class="{\'checked\': weekType.active == \'alternate\'}">\n                <label><span class="fld"></span><input type="radio" ng-model="weekType.active" value="alternate" name="type" ng-change="weekTypeSelected()"><span class="txt">Alternating weeks <span class="alt-txt">(e.g. Mon-Fri 3rd period 1st week, Tue-Thur 4th period 2nd week)</span></span></label>\n              </div>\n            </li>\n          </ul>  \n        </div>\n      </div>      \n    </fieldset>\n  </form>\n  <div class="add-class-times-block" ng-if="types.active == \'block\' && !settings.blocksPerDay">\n    <class-settings></class-settings>\n  </div>\n</div>'),a.put("templates/classtimes/add-freetext-based.html",'<div class="lightbox-header">\n  <h2 ng-if="!isEdit">Add Class Times</h2>\n  <h2 ng-if="isEdit">Edit Class Times</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <form name="form" class="class-times-form" novalidate>\n  <fieldset>\n    <div class="field" ng-class="{error: form.otherContent.$error.required && form.$submitted}">\n      <label>Describe the class times</label>\n      <div class="input">\n        <textarea rows="8" cols="48" name="otherContent" ng-model="otherContent" autofocus required></textarea>\n        <span class="error-msg" ng-show="form.otherContent.$error.required && form.$submitted">This field is required.</span>\n        <span class="help-text">Please note that "Other" class times won\'t appear in the Calendar.</span>\n      </div>\n    </div>\n  </fieldset>\n  <fieldset class="cage">\n    <input type="submit" class="button" name="submit" value="Save" ng-click="save(form)">\n    <a ng-click="cancel()" class="close">Cancel</a>\n    <button class="delete-button" ng-click="deleteClassTime()" ng-if="isEdit"><span class="icon delete"></span>Delete Class Time</button>\n  </fieldset>\n </form>\n</div>'),a.put("templates/classtimes/add-period-based.html",'<div class="lightbox-header">\n  <h2>{{ formTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <form name="form" class="class-times-form" novalidate>\n    <fieldset ng-if="showTypePicker" class="no-border">\n      <div class="field">\n        <legend>Period Based Options</legend>\n        <div class="input">\n          <ul>\n            <li>\n              <div class="radio" ng-class="{\'checked\': weekType.active == \'same\'}">\n                <label><span class="fld"></span><input type="radio" ng-model="weekType.active" value="same" name="type" ng-change="weekTypeChanged()"><span class="txt">Same schedule each week <span class="alt-txt">(e.g. Mon-Fri 3rd period)</span></span></label>\n              </div>\n            </li>\n            <li>\n              <div class="radio" ng-class="{\'checked\': weekType.active == \'alternate\'}">\n                <label><span class="fld"></span><input type="radio" ng-model="weekType.active" value="alternate" name="type" ng-change="weekTypeChanged()"><span class="txt">Alternating weeks <span class="alt-txt">(e.g. Mon-Fri 3rd period 1st week, Tue-Thur 4th period 2nd week)</span></span></label>\n              </div>\n            </li>\n          </ul>  \n        </div>\n      </div>\n    </fieldset>\n    <fieldset ng-if="weekType.active == \'alternate\' && needsClassDate" class="class-times-dates">\n      <div class="field" ng-class="{error: (form.starts.$error.daterange || form.starts.$error.required) && form.$submitted}">\n        <label>Class Starts</label>\n        <div class="input" ng-class="{\'focus\': startDatePicker.opened}">\n          <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'starts\')"></span>\n          <input type="text" name="starts" class="datepicker" ng-model="cls.starts" datepicker-popup="M/d/yyyy" is-open="startDatePicker.opened" ng-focus="openDatePicker($event, \'starts\')" ng-click="openDatePicker($event, \'starts\')" required validate-date-range>\n          <span class="error-msg" ng-show="form.starts.$error.required && form.$submitted">Please enter the class start and end date so it appears correctly in the calendar.</span>\n          <span class="error-msg" ng-show="form.starts.$error.daterange && form.$submitted">Please enter a valid date.</span>\n        </div>\n      </div>\n      <div class="field" ng-class="{error: (form.ends.$error.daterange && form.$submitted) || (form.ends.$error.endDateBeforeStartDate && (form.$submitted || form.ends.$touched))}">\n        <label>Class Ends</label>\n        <div class="input" ng-class="{\'focus\': endDatePicker.opened}">\n          <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'ends\')"></span>\n          <input type="text" name="ends" class="datepicker" ng-model="cls.ends" datepicker-popup="M/d/yyyy" is-open="endDatePicker.opened" ng-focus="openDatePicker($event, \'ends\')" ng-click="openDatePicker($event, \'ends\')" validate-date-range validate-class-dates>\n          <span class="error-msg" ng-show="form.ends.$error.endDateBeforeStartDate && (form.$submitted || form.ends.$touched)">End date must be after the start date.</span>\n          <span class="error-msg" ng-show="form.ends.$error.daterange && form.$submitted">Please enter a valid date.</span>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset>\n      <legend ng-if="weekType.active == \'alternate\'">Week 1</legend>\n      <table>\n        <thead>\n          <tr>\n            <th>Periods</th>\n            <th ng-repeat="n in periodsRange track by $index">\n              {{ n | ordinal }}\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr ng-repeat="day in week1Periods">\n            <td>{{day.label}}</td>\n            <td ng-repeat="p in day.periods track by $index">\n              <div class="checker" ng-class="{\'checked\': p.active }"><label><span class="fld"></span><input type="checkbox" ng-model="p.active" value="true"></label></div>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </fieldset>\n    <fieldset ng-if="weekType.active == \'alternate\'">\n      <legend>Week 2</legend>\n      <table>\n        <thead>\n          <tr>\n            <th>Periods</th>\n            <th ng-repeat="n in periodsRange track by $index">\n              {{ n | ordinal }}\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr ng-repeat="day in week2Periods">\n            <td>{{day.label}}</td>\n            <td ng-repeat="p in day.periods track by $index">\n              <div class="checker" ng-class="{\'checked\': p.active }"><label><span class="fld"></span><input type="checkbox" ng-model="p.active" value="true"></label></div>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </fieldset>\n    <fieldset class="cage" ng-if="!hasMoreClasses">\n      <input type="submit" class="button" name="submit" value="Save" ng-click="save(form)">\n      <a ng-click="cancel()" class="close">Cancel</a>\n      <button class="delete-button" ng-click="deleteClassTime()" ng-if="isEdit"><span class="icon delete"></span>Delete Class Periods</button>\n    </fieldset>\n    <fieldset class="cage" ng-if="hasMoreClasses">\n      <input type="submit" class="button" name="submit" value="Continue" ng-click="save(form)">\n      <a ng-click="skip()" class="close">Skip</a>\n    </fieldset>\n  </form>\n</div>'),a.put("templates/classtimes/add-time-based.html",'<div class="lightbox-header">\n  <h2>{{ formTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <form name="form" class="class-times-form" novalidate>\n    <fieldset ng-if="showTypePicker" class="no-border">\n      <div class="field">\n        <legend>Time Based Options</legend>\n        <div class="input">\n          <ul>\n            <li>\n              <div class="radio" ng-class="{\'checked\': weekType.active == \'same\'}">\n                <label><span class="fld"></span><input type="radio" ng-model="weekType.active" value="same" name="type" ng-change="weekTypeChanged()"><span class="txt">Same schedule each week <span class="alt-txt">(e.g. Mon-Fri 8:30-9:15)</span></span></label>\n              </div>\n            </li>\n            <li>\n              <div class="radio" ng-class="{\'checked\': weekType.active == \'alternate\'}">\n                <label><span class="fld"></span><input type="radio" ng-model="weekType.active" value="alternate" name="type" ng-change="weekTypeChanged()"><span class="txt">Alternating weeks <span class="alt-txt">(e.g. Mon-Fri 8:30-9:15 1st week, Tue-Thur 10:00-11:00 2nd week)</span></span></label>\n              </div>\n            </li>\n          </ul>  \n        </div>\n      </div>\n    </fieldset>\n    <fieldset ng-if="weekType.active == \'alternate\' && needsClassDate" class="class-times-dates">\n      <div class="field" ng-class="{error: (form.starts.$error.daterange || form.starts.$error.required) && form.$submitted}">\n        <label>Class Starts</label>\n        <div class="input" ng-class="{\'focus\': startDatePicker.opened}">\n          <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'starts\')"></span>\n          <input type="text" name="starts" class="datepicker" ng-model="cls.starts" datepicker-popup="M/d/yyyy" is-open="startDatePicker.opened" ng-focus="openDatePicker($event, \'starts\')" ng-click="openDatePicker($event, \'starts\')" required validate-date-range>\n          <span class="error-msg" ng-show="form.starts.$error.required && form.$submitted">Please enter the class start and end date so it appears correctly in the calendar.</span>\n          <span class="error-msg" ng-show="form.starts.$error.daterange && form.$submitted">Please enter a valid date.</span>\n        </div>\n      </div>\n      <div class="field" ng-class="{error: (form.ends.$error.daterange && form.$submitted) || (form.ends.$error.endDateBeforeStartDate && (form.$submitted || form.ends.$touched))}">\n        <label>Class Ends</label>\n        <div class="input" ng-class="{\'focus\': endDatePicker.opened}">\n          <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'ends\')"></span>\n          <input type="text" name="ends" class="datepicker" ng-model="cls.ends" datepicker-popup="M/d/yyyy" is-open="endDatePicker.opened" ng-focus="openDatePicker($event, \'ends\')" ng-click="openDatePicker($event, \'ends\')" validate-date-range validate-class-dates>\n          <span class="error-msg" ng-show="form.ends.$error.endDateBeforeStartDate && (form.$submitted || form.ends.$touched)">End date must be after the start date.</span>\n          <span class="error-msg" ng-show="form.ends.$error.daterange && form.$submitted">Please enter a valid date.</span>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset>\n      <legend ng-if="weekType.active == \'alternate\'">Week 1</legend>\n      <div class="field" ng-class="{\'error\': week1DaysError}">\n        <label>Days</label>\n        <div class="input">\n          <ul class="inline">\n            <li><div class="checker" ng-class="{\'checked\': week1Days.d7 }"><label><span class="fld"></span><input type="checkbox" ng-model="week1Days.d7" value="true">Sun</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week1Days.d1 }"><label><span class="fld"></span><input type="checkbox" ng-model="week1Days.d1" value="true">Mon</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week1Days.d2 }"><label><span class="fld"></span><input type="checkbox" ng-model="week1Days.d2" value="true">Tue</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week1Days.d3 }"><label><span class="fld"></span><input type="checkbox" ng-model="week1Days.d3" value="true">Wed</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week1Days.d4 }"><label><span class="fld"></span><input type="checkbox" ng-model="week1Days.d4" value="true">Thu</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week1Days.d5 }"><label><span class="fld"></span><input type="checkbox" ng-model="week1Days.d5" value="true">Fri</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week1Days.d6 }"><label><span class="fld"></span><input type="checkbox" ng-model="week1Days.d6" value="true">Sat</label></div></li>\n          </ul>  \n          <span class="error-msg" ng-if="week1DaysError">{{ week1DaysError }}</span>\n        </div>\n      </div>\n      <div class="field" ng-class="{\'error\': week1StartError}">\n        <label>Start Time</label>\n        <div class="input">\n          <input type="text" ng-model="week1Times.start">\n          <span class="error-msg" ng-if="week1StartError">{{ week1StartError }}</span>\n          <span class="help-text">e.g. 8:30 or 2:15 pm</span>\n        </div>\n      </div>\n      <div class="field" ng-class="{\'error\': week1EndError}">\n        <label>End Time</label>\n        <div class="input">\n          <input type="text" name="week1End" ng-model="week1Times.end">\n          <span class="error-msg" ng-if="week1EndError">{{ week1EndError }}</span>\n          <span class="help-text">e.g. 9:15 or 3 pm</span>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset ng-if="weekType.active == \'alternate\'">\n      <legend>Week 2</legend>\n      <div class="field" ng-class="{\'error\': week2DaysError}">\n        <label>Days</label>\n        <div class="input">\n          <ul class="inline">\n            <li><div class="checker" ng-class="{\'checked\': week2Days.d7 }"><label><span class="fld"></span><input type="checkbox" ng-model="week2Days.d7" value="true">Sun</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week2Days.d1 }"><label><span class="fld"></span><input type="checkbox" ng-model="week2Days.d1" value="true">Mon</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week2Days.d2 }"><label><span class="fld"></span><input type="checkbox" ng-model="week2Days.d2" value="true">Tue</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week2Days.d3 }"><label><span class="fld"></span><input type="checkbox" ng-model="week2Days.d3" value="true">Wed</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week2Days.d4 }"><label><span class="fld"></span><input type="checkbox" ng-model="week2Days.d4" value="true">Thu</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week2Days.d5 }"><label><span class="fld"></span><input type="checkbox" ng-model="week2Days.d5" value="true">Fri</label></div></li>\n            <li><div class="checker" ng-class="{\'checked\': week2Days.d6 }"><label><span class="fld"></span><input type="checkbox" ng-model="week2Days.d6" value="true">Sat</label></div></li>\n          </ul>\n          <span class="error-msg" ng-if="week2DaysError">{{ week2DaysError }}</span>\n        </div>\n      </div>\n      <div class="field" ng-class="{\'error\': week2StartError}">\n        <label>Start Time</label>\n        <div class="input">\n          <input type="text" ng-model="week2Times.start">\n          <span class="error-msg" ng-if="week2StartError">{{ week2StartError }}</span>\n          <span class="help-text">e.g. 8:30 or 2:15 pm</span>\n        </div>\n      </div>\n      <div class="field" ng-class="{\'error\': week2EndError}">\n        <label>End Time</label>\n        <div class="input">\n          <input type="text" ng-model="week2Times.end">\n          <span class="error-msg" ng-if="week2EndError">{{ week2EndError }}</span>\n          <span class="help-text">e.g. 9:15 or 3 pm</span>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset class="cage" ng-if="!hasMoreClasses">\n      <input type="submit" class="button" name="submit" value="Save" ng-click="save(form)">\n      <a ng-click="cancel()" class="close">Cancel</a>\n      <button class="delete-button" ng-click="deleteClassTime()" ng-if="isEdit"><span class="icon delete"></span>Delete Class Time</button>\n    </fieldset>\n    <fieldset class="cage" ng-if="hasMoreClasses">\n      <input type="submit" class="button" name="submit" value="Continue" ng-click="save(form)">\n      <a ng-click="skip()" class="close">Skip</a>\n    </fieldset>\n  </form>\n</div>'),a.put("templates/classtimes/block-based.html",'<div ng-repeat="blockDay in classTime.blocks track by $index" class="class-schedule">\n  <div class="blocks">\n    <span ng-if="blockDay.color" class="block" ng-style="{\'background-color\': \'#\' + blockDay.color.h}"></span>\n    <span>{{ blockDay.label }}</span>\n  </div>\n  <div class="detail" ng-if="blockDay.blocksDisplay">{{ blockDay.blocksDisplay }}</div>\n</div>'),a.put("templates/classtimes/change-alternate-week.html",'<div class="lightbox-header">\n  <h2>Alternate Week</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <p>Which week is it?</p>\n  <form name="form" class="inline tidy change-week-day" novalidate>\n    <div class="radio" ng-class="{\'checked\': todayWeek.id == \'1\' }">\n      <label><span class="fld"></span><input type="radio" ng-model="todayWeek.id" value="1" name="week" ng-change="saveAlternateWeek()"><span class="txt">Week 1</span></label>\n    </div>\n    <div class="radio" ng-class="{\'checked\': todayWeek.id == \'2\' }">\n      <label><span class="fld"></span><input type="radio" ng-model="todayWeek.id" value="2" name="week" ng-change="saveAlternateWeek()"><span class="txt">Week 2</span></label>\n    </div>\n  </form>\n</div>'),a.put("templates/classtimes/change-block-day.html",'<div class="lightbox-header">\n  <h2>Change Block Day</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <p>What block day is today?</p>\n  <form name="form" class="inline tidy change-block-day" novalidate>\n    <div class="radio" ng-class="{\'checked\': todayBlockDay.id == blockOption.id }" ng-repeat="blockOption in blockOptions track by blockOption.id">\n      <label><span class="fld"></span><input type="radio" ng-model="todayBlockDay.id" value="{{ blockOption.id }}" name="block" ng-change="saveBlockDay()"><span class="color" ng-style="{\'background-color\': \'#\' + blockOption.color.h }" ng-show="blockOption.color.h"></span><span class="txt" ng-if="blockOption.text">{{ blockOption.text }}</span><span class="txt" ng-if="!blockOption.text">{{ blockOption.label }}</span></label>\n    </div>\n  </form>\n</div>'),a.put("templates/classtimes/class-times.html",'<div ng-repeat="classTime in classItem.classTimes track by $index" ng-class="{\'class-schedules\': classItem.classTimes.length > 1}">\n  <div ng-if="classTime.type == \'time\'" ng-include="\'templates/classtimes/time-based.html\'" ng-click="editClassTime(classTime)"></div>\n  <div ng-if="classTime.type == \'block\'" ng-include="\'templates/classtimes/block-based.html\'" ng-click="editClassTime(classTime)"></div>\n  <div ng-if="classTime.type == \'period\'" ng-include="\'templates/classtimes/period-based.html\'" ng-click="editClassTime(classTime)"></div>\n  <div ng-if="classTime.type == \'other\'" ng-include="\'templates/classtimes/freetext-based.html\'" ng-click="editClassTime(classTime)"></div>\n</div>'),a.put("templates/classtimes/day-class-times.html",'<div ng-repeat="classTime in classItem.dateClassTimes track by $index">\n  <div class="class-schedule day" ng-if="classTime.type == \'time\' && (classTime.startTimeFormat || classTime.endTimeFormat)">\n    <div class="detail">\n      <span ng-if="classTime.startTimeFormat">{{ classTime.startTimeFormat }}</span>\n      <span ng-if="classTime.startTimeFormat && classTime.endTimeFormat"> - </span>\n      <span ng-if="classTime.endTimeFormat">{{ classTime.endTimeFormat }}</span>\n    </div>\n  </div>\n  <div class="class-schedule day" ng-if="classTime.type == \'block\'">\n    <div class="blocks" ng-if="!blockDayInfo">\n      <span ng-if="classTime.color" class="block" ng-style="{\'background-color\': \'#\' + classTime.color.h}"></span>\n      <span>{{ classTime.label }}</span>\n    </div>\n    <div class="detail" ng-if="classTime.blocksDisplay">{{ classTime.blocksDisplay }}</div>\n  </div>\n  <div class="class-schedule day" ng-if="classTime.type == \'period\' && classTime.periodsDisplay">\n    <div class="detail">{{ classTime.periodsDisplay }}</div>\n  </div>\n</div>'),a.put("templates/classtimes/freetext-based.html",'<div class="class-schedule">\n  <div class="detail freetext">{{ classTime.freeText }}</div>\n</div>\n'),a.put("templates/classtimes/period-based.html",'<div class="class-schedule">\n  <h5 ng-if="classTime.numberOfWeeks == 2">Week 1</h5>\n  <div ng-repeat="week in classTime.week1 track by $index" ng-if="classTime.week1">\n    <div class="days {{ week.daysClassname }}">\n      <span class="d7">Sun</span>\n      <span class="d1">Mon</span>\n      <span class="d2">Tue</span>\n      <span class="d3">Wed</span>\n      <span class="d4">Thu</span>\n      <span class="d5">Fri</span>\n      <span class="d6">Sat</span>\n    </div>  \n    <div class="detail" ng-if="week.periodsDisplay">{{ week.periodsDisplay }}</div>\n  </div>\n  <div class="detail" ng-if="!classTime.week1 || classTime.week1.length == 0">No Class</div>\n</div>\n<div class="class-schedule" ng-if="classTime.numberOfWeeks == 2">\n  <h5>Week 2</h5>\n  <div ng-repeat="week in classTime.week2 track by $index" ng-if="classTime.week2">\n    <div class="days {{ week.daysClassname }}">\n      <span class="d7">Sun</span>\n      <span class="d1">Mon</span>\n      <span class="d2">Tue</span>\n      <span class="d3">Wed</span>\n      <span class="d4">Thu</span>\n      <span class="d5">Fri</span>\n      <span class="d6">Sat</span>\n    </div>  \n    <div class="detail" ng-if="week.periodsDisplay">{{ week.periodsDisplay }}</div>\n  </div>\n  <div class="detail" ng-if="!classTime.week2 || classTime.week2.length == 0">No Class</div>\n</div>'),a.put("templates/classtimes/time-based.html",'<div class="class-schedule">\n  <h5 ng-if="classTime.numberOfWeeks == 2">Week 1</h5>\n  <div ng-repeat="week in classTime.week1 track by $index" ng-if="classTime.week1">\n    <div class="days {{ week.daysClassname }}">\n      <span class="d7">Sun</span>\n      <span class="d1">Mon</span>\n      <span class="d2">Tue</span>\n      <span class="d3">Wed</span>\n      <span class="d4">Thu</span>\n      <span class="d5">Fri</span>\n      <span class="d6">Sat</span>\n    </div>  \n    <div class="detail">\n      <span ng-if="week.startTimeFormat">{{ week.startTimeFormat }}</span>\n      <span ng-if="week.startTimeFormat && week.endTimeFormat"> - </span>\n      <span ng-if="week.endTimeFormat">{{ week.endTimeFormat }}</span>\n    </div>\n  </div>\n  <div class="detail" ng-if="!classTime.week1 || classTime.week1.length == 0">No Class</div>\n</div>\n<div class="class-schedule" ng-if="classTime.numberOfWeeks == 2">\n  <h5>Week 2</h5>\n  <div ng-repeat="week in classTime.week2 track by $index" ng-if="classTime.week2">\n    <div class="days {{ week.daysClassname }}">\n      <span class="d7">Sun</span>\n      <span class="d1">Mon</span>\n      <span class="d2">Tue</span>\n      <span class="d3">Wed</span>\n      <span class="d4">Thu</span>\n      <span class="d5">Fri</span>\n      <span class="d6">Sat</span>\n    </div>  \n    <div class="detail">\n      <span ng-if="week.startTimeFormat">{{ week.startTimeFormat }}</span>\n      <span ng-if="week.startTimeFormat && week.endTimeFormat"> - </span>\n      <span ng-if="week.endTimeFormat">{{ week.endTimeFormat }}</span>\n    </div>\n  </div>\n  <div class="detail" ng-if="!classTime.week2 || classTime.week2.length == 0">No Class</div>\n</div>'),
a.put("templates/components/color-picker.html",'<ul class="color-picker" ng-style="{display: (isOpen && \'block\') || \'none\'}" ng-model="selectedColor">\n  <li class="clear"><a ng-click="clearColor($event)">No Color</a></li>\n  <li ng-repeat="color in colors track by $index"><a ng-style="{\'background-color\': \'#\' + color.h }" ng-click="selectColor($event, color)">{{color.c}}</a></li>\n</ul>'),a.put("templates/components/file-upload.html",'<legend ng-if="showTitle">Attach a File</legend>\n<div class="field">\n  <label>File</label>\n  <div class="input" ng-class="{error: fileUpload.filePickerError}">\n    <div class="file-picker" ng-model="droppedFile" file-drop>\n      <span class="file-picker-info browse" ng-if="!selectedFile.name && !fileUpload.fileUploading && !takePictureAvailable" ng-click="openFilePicker()">\n        <span ng-if="fileDropAvailable">Drag and drop a file here or <span class="link inline">browse</span> for a file to upload.</span>\n        <span ng-if="!fileDropAvailable"><span class="link inline">Browse</span> for a file to upload.</span>\n      </span>\n      <span class="file-picker-info" ng-if="!selectedFile.name && !fileUpload.fileUploading && takePictureAvailable">\n        <span ng-if="fileDropAvailable">Drag and drop a file here or <span class="link inline" ng-click="openFilePicker()">browse</span> for a file to upload or <span class="link inline" ng-click="openTakePicture()">take a picture.</span></span>\n        <span ng-if="!fileDropAvailable"><span class="link inline" ng-click="openFilePicker()">Browse</span> for a file to upload or <span class="link inline" ng-click="openTakePicture()">take a picture</span>.</span>\n      </span>\n      <span class="file-picker-info" ng-if="selectedFile.name">\n        <div ng-if="fileUpload.fileUploading"><strong>Uploading</strong></div>\n        <span class="file-upload-name">{{ selectedFile.name }}</span>\n        <div><a class="file-remove" ng-click="resetFilePicker()" ng-if="!fileUpload.fileUploading">remove</a></div>\n      </span>\n      <span class="file-picker-progress" ng-if="fileUpload.fileUploading">\n        <span ng-style="progressWidth()"></span>\n      </span>\n      <input type="file" name="file" ng-model="file" id="file">\n    </div>\n    <span class="error-msg" ng-if="fileUpload.filePickerError">{{ fileUpload.filePickerError }}</span>\n    <span class="help-text">Files must be 6 MB or smaller</span>\n  </div>\n</div>\n<div class="field" ng-if="!defaultFileDescription">\n  <label>File Description</label>\n  <div class="input" ng-class="{error: fileUpload.fileDescriptionError}">\n    <input type="text" name="display" maxlength="128" ng-model="fileUpload.fileDescription">\n    <span class="error-msg" ng-if="fileUpload.fileDescriptionError">{{ fileUpload.fileDescriptionError }}</span>\n    <span class="help-text">If you want the file link to say something other than the file name</span>\n  </div>\n</div>\n<div class="field" ng-if="!fileUpload.fileUploading && !autoUpload">\n  <div class="input">\n    <a class="button" ng-click="uploadFile()">Upload File</a>\n    <a ng-click="closeFileUpload()">Cancel</a>\n  </div>\n</div>'),a.put("templates/components/kiip-reward.html",'<button class="kiip-button-close" id="close-button" title="I don\'t want this reward" ng-click="cancel()" href="#" tabindex="0" style="transform: translate3d(0px, 0px, 0px) scale(1);">Close reward</button>\n<a class="kiip-close-text" ng-click="cancel()">Close Window</a>\n<iframe id="kiip_iframe" style="display:block; background: none transparent;" height="100%" width="100%" ng-src="{{ kiip_body_url|trustAsResourceUrl }}" onLoad="uploadDone(this);") allowtransparency="true">'),a.put("templates/components/lazy-image.html",'<span class="lazy-image">\n  <spinner ng-if="loadingImage" spinner-color="{{ spinnerColor }}"></spinner>\n  <span ng-if="!loadingImage && lazyBgImage" class="lazy-image-bg" ng-style="{\'background-image\': \'url(\' + loadedImageUrl + \')\'}"></span>\n  <img ng-if="!loadingImage && !lazyBgImage" ng-src="{{ loadedImageUrl }}" />\n</span>'),a.put("templates/components/main-nav.html",'<nav class="main-nav" ng-class="{\'open\':navOpened, \'has-accounts\': users && users.length > 1, \'two\': users && users.length > 2}">\n  <a href="#/" class="logo"><span class="ico"></span>myHomework</a>\n  <span ng-if="user" class="sync-btn no-drag-area" ng-class="{\'animate\':syncing}" ng-click="manualSync()"><span class="icon sync" tooltip-placement="left" tooltip="Sync"></span></span>\n  <ul class="nav-links">\n    <li class="profile-btn" ng-class="{\'sel\': nav == \'school\'}" ng-if="premiumSchool"><a ng-click="openSchool( premiumSchool.slug )" tooltip="School" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><img ng-src="{{ premiumSchool.localAvatar }}" class="user-avatar" ng-if="premiumSchool.localAvatar" /><span class="m-icon schools" ng-if="!premiumSchool.localAvatar"></span><span class="txt" ng-if="premiumSchool.short_name">{{ premiumSchool.short_name }}</span><span class="txt" ng-if="!premiumSchool.short_name">{{ premiumSchool.name }}</span></a></li>  \n    <li class="profile-btn" ng-class="{\'sel\': nav == \'account\'}" ng-if="user"><a ng-click="openAccount()" tooltip="Account" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><img ng-src="{{ user.localAvatar }}" class="user-avatar" ng-if="user && user.localAvatar" /><span class="m-icon profile"></span><span class="txt" ng-if="user.firstName">{{user.firstName}}</span><span class="txt" ng-if="!user.firstName && user.username">{{user.username}}</span><span class="txt" ng-if="!user.firstName && !user.username">Account</span></a></li>\n    <li class="home-btn" ng-class="{\'sel\' : nav == \'home\'}" ><a href="#/" tooltip="Home" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon home"></span><span class="txt">Home</span></a></li>\n    <li class="classes-btn-mac" ng-class="{\'sel\' : nav == \'classes\' || (nav == \'home\' && macOnlyColumn == \'left\')}"><a ng-click="openClassesOnMac()" tooltip="Classes" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon classes"></span><span class="txt">Classes</span></a></li> \n    <li ng-class="{sel:nav === \'calendar\'}">\n      <a ng-click="openCalendar()" tooltip="Calendar" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened">\n      <span class="m-icon calendar">\n        <span class="day">{{ today | date: \'d\' }}</span>\n      </span>\n      <span class="txt">Calendar</span>\n      </a>\n    </li>\n    <li class="homework-btn-full" ng-class="{\'sel\' : nav == \'homework\'}"><a href="#/homework" tooltip="Homework" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon homework"></span><span class="txt">Homework</span></a></li>\n    <li class="homework-btn" ng-class="{\'sel\' : nav == \'homework\' || (nav == \'home\' && !macOnlyColumn) || (nav == \'home\' && macOnlyColumn == \'right\')}"><a href="#/homework" tooltip="Homework" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon homework"></span><span class="txt">Homework</span></a></li>\n    <li class="classes-btn" ng-class="{\'sel\' : nav == \'classes\' || (nav == \'home\' && macOnlyColumn == \'left\')}"><a href="#/classes" tooltip="Classes" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon classes"></span><span class="txt">Classes</span></a></li> \n    <li ng-class="{\'sel\' : nav == \'teachers\'}"><a href="#/teachers" tooltip="Teachers" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon teachers"></span><span class="txt">Teachers</span></a></li>\n    <li ng-class="{\'sel\' : nav == \'announcements\'}"><a href="#/announcements" tooltip="Announcements" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon ann"></span><span class="txt">Announcements</span><span class="unread-indicator" ng-class="{\'show\': unreadAnnouncements}">{{ unreadAnnouncements }}</span></a></li>\n    <li ng-class="{\'sel\' : nav == \'themes\'}" ng-if="user && !premiumSchool"><a ng-click="openThemes()" tooltip="Themes" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon themes"></span><span class="txt">Themes</span></a></li>\n    <li ng-class="{\'sel\': nav == \'settings\'}"><a ng-click="openSettings()" tooltip="Settings" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon settings"></span><span class="txt">Settings</span></a></li>\n    <li ng-if="user" class="nav-sync-btn" ng-class="{\'animate\':syncing}"><a ng-click="manualSync()" tooltip="Sync" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon sync"></span><span class="txt">Sync</span></a></li>\n    <li ng-if="user" class="signout-btn"><a ng-click="signOut(user.id)" tooltip="Sign out" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon power"></span><span class="txt">Sign out</span></a></li>\n    <li ng-if="!user" class="signin-btn"><a href="#/login" tooltip="Sign in" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened"><span class="m-icon power"></span><span class="txt">Sign in / Sign up</span></a></li>\n  </ul>\n  <ul class="accounts" ng-if="users && users.length > 1">\n    <li ng-repeat="usr in users track by usr.id" ng-show="!user || usr.id != user.id">\n      <a ng-click="changeUser(usr.id)" tooltip="{{ usr.name }}" tooltip-placement="right" tooltip-enable="isMacApp && !navOpened && usr.name">\n        <img ng-src="{{ usr.localAvatar }}" class="user-avatar" ng-if="usr && usr.localAvatar" />\n        <span class="m-icon profile"></span>\n        <span class="txt" ng-if="usr.firstName">{{usr.firstName}}</span>\n        <span class="txt" ng-if="!usr.firstName && usr.username">{{usr.username}}</span>\n        <span class="unread-indicator" ng-class="{\'show\': usr.unreadAnnouncements}">{{ usr.unreadAnnouncements }}</span>\n      </a>\n    </li>    \n  </ul>\n  <span class="nav-btn" ng-click="toggleNav()">\n    <span class="nav-btn-bar nb-1"></span>\n    <span class="nav-btn-bar nb-2"></span>\n    <span class="nav-btn-bar nb-3"></span>\n  </span>\n</nav>\n<draggable-nav></draggable-nav>'),a.put("templates/components/picture-upload.html",'<div class="field" ng-show="!selectedFile.name && !fileUpload.fileUploading">\n  <label>Picture</label>\n  <div class="input" ng-class="{error: fileUpload.filePickerError}">\n    <div class="file-picker" ng-model="droppedFile" file-drop>\n      <span class="file-picker-info browse" ng-if="!takePictureAvailable" ng-click="openFilePicker()">\n        <span ng-if="fileDropAvailable">Drag and drop a picture here or <span class="link inline">browse</span> for a picture to upload.</span>\n        <span ng-if="!fileDropAvailable"><span class="link inline">Browse</span> for a picture to upload.</span>\n      </span>\n      <span class="file-picker-info" ng-if="takePictureAvailable">\n        <span ng-if="fileDropAvailable">Drag and drop a file here or <span class="link inline" ng-click="openFilePicker()">browse</span> for a file to upload or <span class="link inline" ng-click="openTakePicture()">take a picture.</span></span>\n        <span ng-if="!fileDropAvailable"><span class="link inline" ng-click="openFilePicker()">Browse</span> for a picture to upload or <span class="link inline" ng-click="openTakePicture()">take a picture</span>.</span>\n      </span>\n      <input type="file" name="file" ng-model="file" id="file">\n    </div>\n    <span class="error-msg" ng-if="fileUpload.filePickerError">{{ fileUpload.filePickerError }}</span>\n    <span class="help-text">Use a .PNG, .GIF or .JPG file.</span>\n  </div>\n</div>\n<div class="field" ng-show="selectedFile.name || fileUpload.fileUploading">\n  <label ng-if="!fileUpload.fileUploading">Please adjust your picture to properly fit the outlined circle:</label>  \n  <div class="input">\n    <div class="crop-picture">\n      <div class="crop-area" ng-if="!fileUpload.fileUploading">\n        <img-crop image="selectedFile.base64Image" result-image="selectedFile.croppedImage" class="img-crop"></img-crop>\n      </div>\n      <div class="crop-preview" ng-class="{\'uploading\': fileUpload.fileUploading}">\n        <div class="crop-upload-progress" ng-style="progress()">\n          <img ng-src="{{ selectedFile.croppedImage }}" />\n        </div>\n        <h4 ng-if="!fileUpload.fileUploading">Picture Preview</h4>\n        <h4 ng-if="fileUpload.fileUploading">Uploading Picture</h4>\n      </div>\n    </div>\n  </div>\n  <div class="input crop-actions" ng-if="!fileUpload.fileUploading">\n    <a class="button" ng-click="uploadFile()">Save</a>\n    <a ng-click="cancelPictureUpload()">Cancel</a>\n  </div>\n</div>'),a.put("templates/components/resource-windows.html",'<div>\n  <a class="resource-icon-link"><span class="resource-icon" ng-class="file.resourceType"></span></a>\n  <span class="resource-text" ng-class="{\'alt\': !file.uploadedDate && !file.sizeInBytes}">\n    <a target="_blank" href="{{ ::file.url }}"><span ng-if="!isSyllabus" >{{ ::file.displayText }}</span><span ng-if="isSyllabus">Syllabus</span></a>\n    <span class="resource-info">\n      <span class="date"><span ng-if="file.uploadedDate">{{ ::file.uploadedDate | date:\'EEE, MMM d - h:mm a\' }}</span><span ng-if="file.sizeInBytes"><span ng-if="file.uploadedDate"> - </span>{{ ::file.sizeInBytes | bytes}}</span></span>\n      <a class="image-link" ng-if="deleteEnabled" ng-click="deleteAttachment($event, file)"><span class="icon delete g" tooltip="Delete"><span></a>\n    </span>\n  </span>\n</div>'),a.put("templates/components/resource.html",'<div class="resource" ng-click="openAttachment($event, file)">\n  <a class="resource-icon-link"><span class="resource-icon" ng-class="file.resourceType"></span></a>\n  <span class="resource-text" ng-class="{\'alt\': !file.uploadedDate && !file.sizeInBytes}">\n    <a ng-if="!isSyllabus">{{ ::file.displayText }}</a><a ng-if="isSyllabus">Syllabus</a>\n    <span class="resource-info">\n      <span class="date"><span ng-if="file.uploadedDate">{{ ::file.uploadedDate | date:\'EEE, MMM d - h:mm a\' }}</span><span ng-if="file.sizeInBytes"><span ng-if="file.uploadedDate"> - </span>{{ ::file.sizeInBytes | bytes}}</span></span>\n      <a class="image-link" ng-if="deleteEnabled" ng-click="deleteAttachment($event, file)"><span class="icon delete g" tooltip="Delete"><span></a>\n    </span>\n  </span>\n</div>'),a.put("templates/components/spinner.html",'<span class="spinner">\n  <span class="spinner-container" ng-class="{\'with-text\': spinnerText}">\n    <span class="spinner-bar" ng-if="!spinnerBarColor"></span>\n    <span class="spinner-bar" ng-if="spinnerBarColor" ng-style="{\'border-left-color\': \'#\' + spinnerBarColor}"></span>\n    <span class="spinner-text" ng-if="spinnerText">{{ spinnerText }}</span>\n  </span>\n</span>'),a.put("templates/components/webview-windows.html",'<div class="lightbox-header">\n  <h2>{{ formTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <x-ms-webview id="webviewmain" style="width: 100%; height: 500px" src="{{ frameUrl }}"></x-ms-webview>  \n    <div style="display:none;" ng-init="webviewReady"></div>\n</div>'),a.put("templates/events/add-edit-early-release.html",'<div class="lightbox-header">\n  <h2>{{ formTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n<form name="form" class="inline tidy" novalidate>\n<div class="required"><span>*</span>Required Fields</div>\n  <fieldset>\n    <div class="field">\n      <label>Description (Optional)</label>\n      <div class="input">\n        <input autocomplete="off" type="text" name="description" maxlength="100" ng-model="schoolEvent.description" autofocus>      \n      </div>\n    </div>\n    <div class="field" ng-class="{error: (form.eventDate.$error.required || form.eventDate.$error.date || form.eventDate.$error.daterange) && form.$submitted}">\n      <label>Date <span class="required">*</span></label>\n      <div class="input" ng-class="{\'focus\': datepicker.opened}">\n        <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'eventDate\')"></span>\n        <input type="text" name="eventDate" class="datepicker" ng-model="schoolEvent.eventDate" datepicker-popup="M/d/yyyy" is-open="datepicker.opened" ng-required="true" ng-focus="openDatePicker($event, \'eventDate\')" ng-click="openDatePicker($event, \'eventDate\')" validate-date-range />\n        <span class="error-msg" ng-show="form.eventDate.$error.required && form.$submitted">This field is required.</span>\n        <span class="error-msg" ng-show="(form.eventDate.$error.date || form.eventDate.$error.daterange) && !form.eventDate.$error.required && form.$submitted">Please enter a valid date.</span>\n      </div>\n    </div>\n    <div class="field" ng-class="{error: (form.eventTime.$error.required || form.eventTime.$error.validatetime) && form.$submitted}">\n      <label>Classes End Time <span class="required">*</span></label>\n      <div class="input">\n        <input type="text" name="eventTime" ng-required="true" ng-model="schoolEvent.eventTime" validatetime>\n        <span class="error-msg" ng-show="form.eventTime.$error.required && form.$submitted">This field is required.</span>\n        <span class="error-msg" ng-show="form.eventTime.$error.validatetime && form.$submitted">Enter a valid time.</span>\n      </div>\n    </div>\n    <div class="field">\n      <label>Repeats</label>\n      <div class="input" ng-class="{\'focus\': repeatFocus}">\n        <div class="selector"><span>{{ schoolEvent.repeats.display }}</span>\n          <select name="repeats" ng-model="schoolEvent.repeats" ng-options="r.display for r in repeatOptions track by r.id" ng-focus="repeatFocus=true" ng-blur="repeatFocus=false" ng-change="repeatChanged()">\n            <option value=""></option>\n          </select>\n        </div> \n      </div>\n    </div>\n    <div class="field" ng-class="{error: (form.repeatEnds.$error.required || form.repeatEnds.$error.date || form.repeatEnds.$error.daterange || form.repeatEnds.$error.endDateBeforeDueDate || form.repeatEnds.$error.endDateWithinOneYear) && form.$submitted}" ng-if="schoolEvent.repeats">\n      <label>Repeat Ends <span class="required">*</span></label>\n      <div class="input" ng-class="{\'focus\': repeatEndsDatepicker.opened}">\n        <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'repeatEnds\')"></span>\n        <input type="text" name="repeatEnds" class="datepicker" ng-model="schoolEvent.repeatEnds" datepicker-popup="M/d/yyyy" is-open="repeatEndsDatepicker.opened" ng-required="schoolEvent.repeats" ng-focus="openDatePicker($event, \'repeatEnds\')" ng-click="openDatePicker($event, \'repeatEnds\')" validate-date-range validate-repeat-end-date />\n        <span class="error-msg" ng-show="form.repeatEnds.$error.required && form.$submitted">This field is required.</span>\n        <span class="error-msg" ng-show="(form.repeatEnds.$error.date || form.repeatEnds.$error.daterange) && !form.repeatEnds.$error.required && form.$submitted">Please enter a valid date.</span>\n        <span class="error-msg" ng-show="form.repeatEnds.$error.endDateBeforeDueDate && form.$submitted">Repeat end date must be after the begin date.</span>\n        <span class="error-msg" ng-show="form.repeatEnds.$error.endDateWithinOneYear && form.$submitted">End date needs to be within a year of the begin date.</span>\n      </div>\n    </div>\n  </fieldset>\n  <fieldset class="cage">\n    <input type="submit" class="button" name="save" value="Save" ng-click="save(form, schoolEvent)">  \n    <div class="delete-button" ng-if="isEditForm" ng-click="deleteEvent(schoolEvent)">Delete</div>\n    <a class="close" ng-click="cancel()">Cancel</a>\n  </fieldset>\n</form>\n</div>'),a.put("templates/events/add-edit-late-start.html",'<div class="lightbox-header">\n  <h2>{{ formTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n<form name="form" class="inline tidy" novalidate>\n<div class="required"><span>*</span>Required Fields</div>\n  <fieldset>\n    <div class="field">\n      <label>Description (Optional)</label>\n      <div class="input">\n        <input autocomplete="off" type="text" name="description" maxlength="100" ng-model="schoolEvent.description" autofocus>      \n      </div>\n    </div>\n    <div class="field" ng-class="{error: (form.eventDate.$error.required || form.eventDate.$error.date || form.eventDate.$error.daterange) && form.$submitted}">\n      <label>Date <span class="required">*</span></label>\n      <div class="input" ng-class="{\'focus\': datepicker.opened}">\n        <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'eventDate\')"></span>\n        <input type="text" name="eventDate" class="datepicker" ng-model="schoolEvent.eventDate" datepicker-popup="M/d/yyyy" is-open="datepicker.opened" ng-required="true" ng-focus="openDatePicker($event, \'eventDate\')" ng-click="openDatePicker($event, \'eventDate\')" validate-date-range />\n        <span class="error-msg" ng-show="form.eventDate.$error.required && form.$submitted">This field is required.</span>\n        <span class="error-msg" ng-show="(form.eventDate.$error.date || form.eventDate.$error.daterange) && !form.eventDate.$error.required && form.$submitted">Please enter a valid date.</span>\n      </div>\n    </div>\n    <div class="field" ng-class="{error: (form.eventEndsTime.$error.required || form.eventEndsTime.$error.validatetime) && form.$submitted}">\n      <label>Classes Begin Time <span class="required">*</span></label>\n      <div class="input">\n        <input type="text" name="eventEndsTime" ng-required="true" ng-model="schoolEvent.eventEndsTime" validatetime>\n        <span class="error-msg" ng-show="form.eventEndsTime.$error.required && form.$submitted">This field is required.</span>\n        <span class="error-msg" ng-show="form.eventEndsTime.$error.validatetime && form.$submitted">Enter a valid time.</span>\n      </div>\n    </div>\n    <div class="field">\n      <label>Repeats</label>\n      <div class="input" ng-class="{\'focus\': repeatFocus}">\n        <div class="selector"><span>{{ schoolEvent.repeats.display }}</span>\n          <select name="repeats" ng-model="schoolEvent.repeats" ng-options="r.display for r in repeatOptions track by r.id" ng-focus="repeatFocus=true" ng-blur="repeatFocus=false" ng-change="repeatChanged()">\n            <option value=""></option>\n          </select>\n        </div> \n      </div>\n    </div>\n    <div class="field" ng-class="{error: (form.repeatEnds.$error.required || form.repeatEnds.$error.date || form.repeatEnds.$error.daterange || form.repeatEnds.$error.endDateBeforeDueDate || form.repeatEnds.$error.endDateWithinOneYear) && form.$submitted}" ng-if="schoolEvent.repeats">\n      <label>Repeat Ends <span class="required">*</span></label>\n      <div class="input" ng-class="{\'focus\': repeatEndsDatepicker.opened}">\n        <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'repeatEnds\')"></span>\n        <input type="text" name="repeatEnds" class="datepicker" ng-model="schoolEvent.repeatEnds" datepicker-popup="M/d/yyyy" is-open="repeatEndsDatepicker.opened" ng-required="schoolEvent.repeats" ng-focus="openDatePicker($event, \'repeatEnds\')" ng-click="openDatePicker($event, \'repeatEnds\')" validate-date-range validate-repeat-end-date />\n        <span class="error-msg" ng-show="form.repeatEnds.$error.required && form.$submitted">This field is required.</span>\n        <span class="error-msg" ng-show="(form.repeatEnds.$error.date || form.repeatEnds.$error.daterange) && !form.repeatEnds.$error.required && form.$submitted">Please enter a valid date.</span>\n        <span class="error-msg" ng-show="form.repeatEnds.$error.endDateBeforeDueDate && form.$submitted">Repeat end date must be after the begin date.</span>\n        <span class="error-msg" ng-show="form.repeatEnds.$error.endDateWithinOneYear && form.$submitted">End date needs to be within a year of the begin date.</span>\n      </div>\n    </div>\n  </fieldset>\n  <fieldset class="cage">\n    <input type="submit" class="button" name="save" value="Save" ng-click="save(form, schoolEvent)">  \n    <div class="delete-button" ng-if="isEditForm" ng-click="deleteEvent(schoolEvent)">Delete</div>\n    <a class="close" ng-click="cancel()">Cancel</a>\n  </fieldset>\n</form>\n</div>'),a.put("templates/events/add-edit-no-school.html",'<div class="lightbox-header">\n  <h2>{{ formTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n<form name="form" class="inline tidy" novalidate>\n<div class="required"><span>*</span>Required Fields</div>\n  <fieldset>\n    <div class="field">\n      <label>Description (Optional)</label>\n      <div class="input">\n        <input autocomplete="off" type="text" name="description" maxlength="100" ng-model="schoolEvent.description" autofocus>      \n      </div>\n    </div>\n    <div class="field" ng-class="{error: (form.eventDate.$error.required || form.eventDate.$error.date || form.eventDate.$error.daterange) && form.$submitted}">\n      <label>Date <span class="required">*</span></label>\n      <div class="input" ng-class="{\'focus\': datepicker.opened}">\n        <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'eventDate\')"></span>\n        <input type="text" name="eventDate" class="datepicker" ng-model="schoolEvent.eventDate" datepicker-popup="M/d/yyyy" is-open="datepicker.opened" ng-required="true" ng-focus="openDatePicker($event, \'eventDate\')" ng-click="openDatePicker($event, \'eventDate\')" validate-date-range />\n        <span class="error-msg" ng-show="form.eventDate.$error.required && form.$submitted">This field is required.</span>\n        <span class="error-msg" ng-show="(form.eventDate.$error.date || form.eventDate.$error.daterange) && !form.eventDate.$error.required && form.$submitted">Please enter a valid date.</span>\n      </div>\n    </div>\n    <div class="field" ng-class="{error: (form.eventEnds.$error.daterange && form.$submitted) || (form.eventEnds.$error.endDateBeforeStartDate && (form.$submitted || form.eventEnds.$touched))}">\n      <label>Ends</label>\n      <div class="input" ng-class="{\'focus\': eventEndsDatepicker.opened}">\n        <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'eventEnds\')"></span>\n        <input type="text" name="eventEnds" class="datepicker" ng-model="schoolEvent.eventEnds" datepicker-popup="M/d/yyyy" is-open="eventEndsDatepicker.opened" ng-focus="openDatePicker($event, \'eventEnds\')" ng-click="openDatePicker($event, \'eventEnds\')" init-date="schoolEvent.eventDate" validate-date-range validate-no-school-dates/>      \n        <span class="help-text" ng-show="!form.eventEnds.$error.endDateBeforeStartDate && !form.eventEnds.$error.date && !form.eventEnds.$error.daterange">If more than 1 day</span>\n        <span class="error-msg" ng-show="form.eventEnds.$error.endDateBeforeStartDate && (form.$submitted || form.eventEnds.$touched)">End date must be after the start date.</span>\n        <span class="error-msg" ng-show="(form.eventEnds.$error.date || form.eventEnds.$error.daterange) && form.$submitted">Please enter a valid date.</span>\n      </div>\n    </div>\n  </fieldset>\n  <fieldset class="cage">\n    <input type="submit" class="button" name="save" value="Save" ng-click="save(form, schoolEvent)">\n    <div class="delete-button" ng-if="isEditForm" ng-click="deleteEvent(schoolEvent)">Delete</div>\n    <a class="close" ng-click="cancel()">Cancel</a>\n   </fieldset>\n</form>\n</div>'),a.put("templates/events/add-edit.html",'<div class="lightbox-header">\n  <h2>{{ formTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n<form name="form" class="inline tidy" novalidate ng-show="!showCustomReminderForm">\n<div class="required" ng-show="!showFileUpload"><span>*</span>Required Fields</div>\n<fieldset ng-show="!showFileUpload">\n  <div class="field" ng-class="{error: form.description.$error.required && form.$submitted}">\n    <label>Description <span class="required">*</span></label>\n    <div class="input">\n      <input autocomplete="off" type="text" name="description" maxlength="1024" ng-model="regularEvent.description" autofocus required>\n      <span class="error-msg" ng-show="form.description.$error.required && form.$submitted">This field is required.</span>\n    </div>\n  </div>\n  <div class="field" ng-class="{error: (form.eventDate.$error.required || form.eventDate.$error.date || form.eventDate.$error.daterange) && form.$submitted}">\n    <label>{{ eventDateTitle }} <span class="required">*</span></label>\n    <div class="input" ng-class="{\'focus\': datepicker.opened}">\n      <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'eventDate\')"></span>\n      <input type="text" name="eventDate" class="datepicker" ng-model="regularEvent.eventDate" datepicker-popup="M/d/yyyy" is-open="datepicker.opened" ng-required="true" ng-focus="openDatePicker($event, \'eventDate\')" ng-click="openDatePicker($event, \'eventDate\')" validate-date-range />\n      <span class="error-msg" ng-show="form.eventDate.$error.required && form.$submitted">This field is required.</span>\n      <span class="error-msg" ng-show="(form.eventDate.$error.date || form.eventDate.$error.daterange) && !form.eventDate.$error.required && form.$submitted">Please enter a valid date.</span>\n    </div>\n  </div>\n  <div class="field" ng-class="{error: form.eventTime.$error.validatetime && form.$submitted}">\n    <label>Time</label>\n    <div class="input">\n      <input type="text" name="eventTime" ng-model="regularEvent.eventTime" validatetime>    \n      <span class="error-msg" ng-show="form.eventTime.$error.validatetime && form.$submitted">Enter a valid time.</span>\n    </div>\n  </div>\n  <div class="field" ng-class="{error: form.eventEndsTime.$error.validatetime && form.$submitted}">\n    <label>End Time</label>\n    <div class="input">\n      <input type="text" name="eventEndsTime" ng-model="regularEvent.eventEndsTime" validatetime>    \n      <span class="error-msg" ng-show="form.eventEndsTime.$error.validatetime && form.$submitted">Enter a valid time.</span>\n    </div>\n  </div>\n  <div class="field" ng-if="repeatEnabled">\n    <label>Repeats</label>\n    <div class="input" ng-class="{\'focus\': repeatFocus}">\n      <div class="selector"><span>{{ regularEvent.repeats.display }}</span>\n        <select name="repeats" ng-model="regularEvent.repeats" ng-options="r.display for r in repeatOptions track by r.id" ng-focus="repeatFocus=true" ng-blur="repeatFocus=false" ng-change="repeatChanged()">\n          <option value=""></option>\n        </select>\n      </div> \n    </div>\n  </div>\n  <div class="field" ng-class="{error: (form.repeatEnds.$error.required || form.repeatEnds.$error.date || form.repeatEnds.$error.daterange || form.repeatEnds.$error.endDateBeforeDueDate || form.repeatEnds.$error.endDateWithinOneYear) && form.$submitted}" ng-if="regularEvent.repeats && repeatEnabled">\n    <label>Repeat Ends <span class="required">*</span></label>\n    <div class="input" ng-class="{\'focus\': repeatEndsDatepicker.opened}">\n      <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'repeatEnds\')"></span>\n      <input type="text" name="repeatEnds" class="datepicker" ng-model="regularEvent.repeatEnds" datepicker-popup="M/d/yyyy" is-open="repeatEndsDatepicker.opened" no-school-days="userNoSchoolDays" ng-required="regularEvent.repeats" ng-focus="openDatePicker($event, \'repeatEnds\')" ng-click="openDatePicker($event, \'repeatEnds\')" validate-date-range validate-repeat-end-date />\n      <span class="error-msg" ng-show="form.repeatEnds.$error.required && form.$submitted">This field is required.</span>\n      <span class="error-msg" ng-show="(form.repeatEnds.$error.date || form.repeatEnds.$error.daterange) && !form.repeatEnds.$error.required && form.$submitted">Please enter a valid date.</span>\n      <span class="error-msg" ng-show="form.repeatEnds.$error.endDateBeforeDueDate && form.$submitted">Repeat end date must be after the begin date.</span>\n      <span class="error-msg" ng-show="form.repeatEnds.$error.endDateWithinOneYear && form.$submitted">End date needs to be within a year of the begin date.</span>\n    </div>\n  </div>  \n  <div class="field">\n    <label>Reminder</label>\n    <div class="input" ng-class="{\'focus\': reminderFocus}" ng-click="alertReminder()">\n      <div class="selector"><span>{{ regularEvent.reminder.display }}</span>\n        <select name="reminder" ng-if="user" ng-model="regularEvent.reminder" ng-options="rm.display for rm in eventReminderOptions track by rm.id" ng-focus="reminderFocus=true" ng-blur="reminderFocus=false" ng-change="reminderChanged()">\n          <option value="">No Reminder</option>\n        </select>\n      </div>\n    </div>\n  </div>\n  <div class="field">\n    <label>Other Info</label>\n    <div class="input">\n      <textarea rows="5" cols="25" name="additional_info" ng-model="regularEvent.additionalInfo" maxlength="4096"></textarea>\n    </div>\n  </div>\n</fieldset> \n<fieldset ng-show="showFileUpload" ng-if="user.isPremiumOrSchoolAccount" ng-model="regularEvent.uploadedFile" file-upload show-title="true"></fieldset>\n<fieldset class="hw-form-attach" style="display: block;" ng-show="!showFileUpload">\n  <div class="field">\n    <label>File Attachments</label>\n    <div class="input">\n      <ul class="resources-list" style="margin-bottom: 10px;" ng-if="regularEvent.files">\n        <li ng-repeat="file in regularEvent.files track by $index" resource-item="file" delete-enabled="true"></li>\n      </ul>\n      <a class="alt-button" ng-click="showAddAttachment()" ng-if="user.isPremiumOrSchoolAccount && (!regularEvent.files || regularEvent.files.length < 5)"><span class="icon add"></span><span ng-if="regularEvent.files">Attach another file</span><span ng-if="!regularEvent.files">Attach a file</span></a>\n      <span class="form-info" ng-if="!user.isPremiumOrSchoolAccount && !regularEvent.files">\n        Available on premium accounts, <a ng-if="user" ng-click="attachmentsUpgradeOrSignUp()">upgrade your account</a><a ng-if="!user" ng-click="attachmentsUpgradeOrSignUp()">sign up</a>.\n      </span>\n    </div>\n  </div>\n </fieldset>\n <fieldset class="cage" ng-show="!showFileUpload">\n  <input type="submit" class="button" name="save" value="Save" ng-click="save(form, regularEvent)">  \n  <a class="close" ng-click="cancel()">Cancel</a>\n </fieldset>\n</form>\n<form name="reminderForm" class="inline tidy custom-reminder-form" novalidate ng-if="showCustomReminderForm">\n  <fieldset>\n    <legend>Custom Reminder</legend>\n    <div class="field reminder-date">\n      <label>Reminder Date</label>\n      <div class="input">\n        <datepicker ng-model="customReminder.date"></datepicker>\n      </div>\n    </div>\n    <div class="field" ng-class="{error: reminderForm.time.$error && reminderForm.$submitted}">\n      <label>Reminder Time</label>\n      <div class="input">\n        <input type="text" name="time" ng-model="customReminder.time" validatetime required>\n        <span class="error-msg" ng-show="reminderForm.time.$error && reminderForm.$submitted">Enter a valid time.</span>\n      </div>\n    </div>\n    <fieldset class="cage" ng-show="!showFileUpload">\n      <input type="submit" class="button" name="save" value="Done" ng-click="selectCustomReminder(reminderForm)">\n      <a class="close" ng-click="cancelCustomReminder(reminderForm)">Cancel</a>\n     </fieldset>\n  </fieldset>\n</div>\n</div>'),
a.put("templates/events/view-event.html",'<div class="lightbox-header">\n  <h2>Event Details</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <dl class="inline">\n    <dt>Description</dt><dd>{{ regularEvent.title }}</dd>    \n    <dt ng-if="regularEvent.repeatBegins && regularEvent.eventDate.toISOString() != regularEvent.repeatBegins.toISOString()">Date</dt>\n      <dd ng-if="regularEvent.repeatBegins && regularEvent.eventDate.toISOString() != regularEvent.repeatBegins.toISOString() && regularEvent.hasTime">{{ regularEvent.eventDate | date:\'EEEE, MMM d y - h:mm a\' }}<span ng-if="regularEvent.endTime"> - {{ regularEvent.endTime | date:\'h:mm a\' }}</span></dd>\n      <dd ng-if="regularEvent.repeatBegins && regularEvent.eventDate.toISOString() != regularEvent.repeatBegins.toISOString() && !regularEvent.hasTime">{{ regularEvent.eventDate | date:\'EEEE, MMM d y\' }}</dd>\n    <dt>{{ eventDateTitle }}</dt>\n      <dd ng-if="regularEvent.hasTime && !regularEvent.repeatBegins">{{ regularEvent.eventDate | date:\'EEEE, MMM d y - h:mm a\' }}<span ng-if="regularEvent.endTime"> - {{ regularEvent.endTime | date:\'h:mm a\' }}</span></dd>\n      <dd ng-if="!regularEvent.hasTime && !regularEvent.repeatBegins">{{ regularEvent.eventDate | date:\'EEEE, MMM d y\' }}</dd>\n      <dd ng-if="regularEvent.hasTime && regularEvent.repeatBegins">{{ regularEvent.repeatBegins | date:\'EEEE, MMM d y - h:mm a\' }}<span ng-if="regularEvent.endTime"> - {{ regularEvent.endTime | date:\'h:mm a\' }}</span></dd>\n      <dd ng-if="!regularEvent.hasTime && regularEvent.repeatBegins">{{ regularEvent.repeatBegins | date:\'EEEE, MMM d y\' }}</dd>\n    <dt ng-if="regularEvent.repeats">Repeats</dt><dd ng-if="regularEvent.repeats"><span class="hw-icon repeats"></span>{{ regularEvent.repeats.display }}<span ng-if="regularEvent.repeatEnds"> until {{ regularEvent.repeatEnds | date:\'MMMM d\' }}</span></dd>\n    <dt ng-if="regularEvent.reminder">Reminder</dt><dd ng-if="regularEvent.reminder"><span class="hw-icon reminder"></span>{{ regularEvent.reminder.display }}</dd>    \n    <dt ng-if="!regularEvent.isManual && regularEvent.teacherNotes">Additional Info</dt><dd ng-if="!regularEvent.isManual && regularEvent.teacherNotes" ng-bind-html="regularEvent.teacherNotes"></dd>    \n    <dt ng-if="regularEvent.additionalInfo">Other Info</dt><dd ng-if="regularEvent.additionalInfo" class="additional-info" ng-bind-html="regularEvent.additionalInfo | linky:\'_blank\'"></dd>    \n  </dl>\n  <div ng-if="regularEvent.files">\n    <h4 class="h5">Attachments</h4>\n    <ul class="resources-list">\n      <li ng-repeat="file in regularEvent.files track by file.id" resource-item="file" delete-enabled="false"></li>\n    </ul>\n  </div>\n  <div class="alt-button" ng-if="regularEvent.isEditable" sng-click="editEvent(regularEvent)"><span class="icon edit"></span>Edit</div>\n  <div class="delete-button" ng-if="regularEvent.isDeletable" ng-click="deleteEvent(regularEvent)"><span class="icon delete"></span>Delete</div>\n</div>'),a.put("templates/home.html",'<div class="left-col" ng-class="{\'hasad\': user && themeBanner && showTheme || user.myHomeworkAd.adImageURL && !user.showWindowsAds || user.shouldRenew || myHomeworkTip && !user.showWindowsAds && !isWindowsApp}" >\n  <div class="box" ng-class="{\'has-filters\': clsFiltersEnabled && !isMacApp}">\n    <h2 class="box-title" ng-if="!isMacApp || clsFilters.active == \'all\'">Classes</h2>\n    <h2 class="box-title" ng-if="isMacApp && clsFilters.active == \'today\'">Today\'s Classes</h2>\n    <h2 class="box-title" ng-if="isMacApp && clsFilters.active == \'tomorrow\'">Tomorrow\'s Classes</h2>\n    <a class="box-title-button no-drag-area" ng-click="toggleClassesAddOptions($event)"><span class="icon add" tooltip-placement="bottom" tooltip="Add Class"></span></a>\n    <a class="box-title-button left no-drag-area" ng-if="clsFiltersEnabled && isMacApp" ng-click="clsListControl.toggleFilters($event)"><span class="icon filter" tooltip-placement="bottom" tooltip="Filter by"></span></a>\n    <div class="box-options" ng-class="{\'show\': showClassesAddOptions}">\n      <ul class="box-options-content">\n        <li><a ng-click="addClass()">Add Class</a></li>\n        <li><a ng-click="addNoSchoolDay()">Add No School Day</a></li>\n        <li><a ng-click="addLateStart()">Add Late Start</a></li>\n        <li><a ng-click="addEarlyRelease()">Add Early Release</a></li>\n      </ul>      \n    </div>\n    <div class="empty-box-content" ng-if="!userClasses || userClasses.length == 0">\n      <span class="m-icon blue classes"></span>\n      <div class="empty-content">\n        <p>This is where all your classes will be displayed.</p>\n        <p ng-if="user">Enter your first class or search for a Teachers.io class using the + button up above.</p>\n        <p ng-if="!user">Enter your first class using the + button up above.</p>\n      </div>\n    </div>\n    <div class="box-scroll" ng-if="userClasses && userClasses.length > 0 && (clsFilters.active == \'today\' || clsFilters.active == \'tomorrow\') && filteredClasses.length == 0">\n     <div class="empty-box-content no-icon">\n        <div class="empty-content">\n          <p ng-if="clsFilters.active == \'today\'">You have no class times today.</p>\n          <p ng-if="clsFilters.active == \'tomorrow\'">You have no class times tomorrow.</p>\n        </div>\n      </div>\n    </div>\n    <classes-list ng-if="userClasses && userClasses.length > 0" list-control="clsListControl" class-items="filteredClasses" cls-filters-enabled="clsFiltersEnabled" cls-filters="clsFilters" grouping-disabled="groupingDisabled" block-schedule-change-label="blockScheduleChangeLabel" alternate-week-switcher-week="alternateWeekSwitcherWeek" show-add-class-times="showAddClassTimes" block-day-info="blockDayInfo"></classes-list>\n  </div>\n  <div class="instinad themead" ng-if="user && themeBanner && showTheme && !user.shouldRenew && !user.showWindowsAds">\n    <a ng-click="openThemeBanner(themeBanner)"><img ng-src="{{ themeBanner.i }}" /></a>\n  </div>\n  <div class="instinad" ng-if="!themeBanner && user.myHomeworkAd.adImageURL && !user.shouldRenew">\n    <a ng-click="openmyHomeworkAd(user.myHomeworkAd)"><img ng-src="{{ user.myHomeworkAd.adImageURL }}" /></a>\n  </div>\n  <div class="adtip" ng-if="myHomeworkTip && !themeBanner && !user.shouldRenew && !user.showWindowsAds" ng-click="openTip(myHomeworkTip)">\n    <span class="tip-icon"></span>\n    <span class="tip-text">{{ myHomeworkTip.text }}</span>\n  </div>\n  <div class="renewal" ng-if="user.shouldRenew && !user.mustRenew">\n    <div ng-if="user.daysLeftToRenew == 1">Your 1-year myHomework Premium expires tomorrow.</div>\n    <div ng-if="user.daysLeftToRenew > 1">Your 1-year myHomework Premium expires in {{ user.daysLeftToRenew }} days.</div>\n    <a class="image-link" ng-click="openRenew()">Renew<span class="icon next w"></span></a>\n  </div>\n  <div class="renewal important" ng-if="user.shouldRenew && user.mustRenew">\n    <div>Your 1 year myHomework Premium has expired.</div>\n    <a class="image-link" ng-click="openRenew()">Renew<span class="icon next w"></span></a>\n  </div>\n</div>\n<draggable-cols></draggable-cols>\n<div class="right-col">\n  <div class="box" ng-class="{\'has-filters\': hwFiltersEnabled && !isMacApp}">\n    <h2 class="box-title">Homework</h2>\n    <a class="box-title-button no-drag-area" ng-click="addHomework()"><span class="icon add" tooltip-placement="left" tooltip="Add Homework"></span></a>\n    <a class="box-title-button left no-drag-area" ng-if="hwFiltersEnabled && isMacApp" ng-click="hwListControl.toggleFilters($event)"><span class="icon filter" tooltip-placement="bottom" tooltip="Filter by"></span></a>\n    <div class="empty-box-content" ng-if="(!userHomeworks || userHomeworks.length == 0) || !hwFiltersEnabled && userSettings.hideCompletedHomework">\n      <span class="m-icon blue homework"></span>\n      <div class="empty-content" ng-if="!userHomeworks || userHomeworks.length == 0">\n        <p>This is where your assignments, tests and projects will be displayed. You\'ll be able to view them by class, type and priority.</p>\n        <p>Add your first homework using the + button up above.</p>\n      </div>\n      <div class="empty-content" ng-if="(userHomeworks && userHomeworks.length > 0) && !hwFiltersEnabled && userSettings.hideCompletedHomework">\n        <div>All of your homework is complete!</div>\n        <div>Add another using the + button above.</div>\n      </div>\n    </div>\n    <homework-list ng-if="userHomeworks && userHomeworks.length > 0" list-control="hwListControl" show-complete-checkbox="true" homework-items="filteredHomeworks" hw-filters-enabled="hwFiltersEnabled" hw-filters="hwFilters"></homework-list>\n  </div>\n</div>'),a.put("templates/homework/add-edit.html",'<div class="lightbox-header">\n  <h2>{{ formTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n<div ng-if="!isEditForm && homeworkAdded" class="alert-message success" ng-class="{\'hiding\': alertHiding }">{{ homeworkAdded }} Added Successfully!<a class="close-button" ng-click="closeAlert()"></a></div>\n<form name="form" class="inline tidy" novalidate ng-show="!showCustomReminderForm">\n<div class="required" ng-show="!showFileUpload"><span>*</span>Required Fields</div>\n<fieldset ng-show="!showFileUpload">\n  <div class="field" ng-class="{error: form.title.$error.required && form.$submitted}" ng-if="isManualHomework">\n    <label>Description <span class="required">*</span></label>\n    <div class="input">\n      <input autocomplete="off" type="text" name="title" maxlength="1024" ng-model="homework.title" autofocus required>\n      <span class="error-msg" ng-show="form.title.$error.required && form.$submitted">This field is required.</span>\n    </div>\n  </div>\n  <div class="field" ng-if="isManualHomework">\n    <label>Class</label>\n    <div class="input" ng-class="{\'focus\': clsFocus}">\n      <div class="selector"><span>{{ homework.cls.name }}</span>\n        <select name="class" ng-model="homework.cls" ng-change="checkClassSelection(homework)" ng-options="cls.name for cls in classOptions" ng-focus="clsFocus=true" ng-blur="clsFocus=false">\n          <option value=""></option>\n        </select>\n      </div> \n    </div>\n  </div>\n  <div class="field" ng-if="isManualHomework">\n    <label>Type</label>\n    <div class="input" ng-class="{\'focus\': typeFocus}">\n      <div class="selector"><span>{{ homework.type.display }}</span>\n        <select name="type" ng-model="homework.type" ng-options="typ.display for typ in typeOptions track by typ.id" ng-focus="typeFocus=true" ng-blur="typeFocus=false">\n          <option value=""></option>\n        </select>\n      </div>\n    </div>\n  </div>\n  <div class="field" ng-class="{error: (form.dueDate.$error.required || form.dueDate.$error.date || form.dueDate.$error.daterange) && form.$submitted}" ng-if="isManualHomework">\n    <label>{{ dueDateTitle }} <span class="required">*</span></label>\n    <div class="input" ng-class="{\'focus\': datepicker.opened}">\n      <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'dueDate\')"></span>\n      <input type="text" name="dueDate" class="datepicker" ng-model="homework.dueDate" datepicker-popup="M/d/yyyy" is-open="datepicker.opened" no-school-days="userNoSchoolDays" ng-required="true" ng-focus="openDatePicker($event, \'dueDate\')" ng-click="openDatePicker($event, \'dueDate\')" validate-date-range />\n      <span class="error-msg" ng-show="form.dueDate.$error.required && form.$submitted">This field is required.</span>\n      <span class="error-msg" ng-show="(form.dueDate.$error.date || form.dueDate.$error.daterange) && !form.dueDate.$error.required && form.$submitted">Please enter a valid date.</span>\n    </div>\n  </div>\n  <div class="field" ng-class="{error: form.dueTime.$error.validatetime && form.dueTime.$touched}" ng-if="isManualHomework">\n    <label>{{ dueTimeTitle }}</label>\n    <div class="input">\n      <input type="text" name="dueTime" ng-model="homework.dueTime" validatetime>\n      <span class="error-msg" ng-show="form.dueTime.$error.validatetime && form.dueTime.$touched">Enter a valid time.</span>\n    </div>\n  </div>\n  <div class="field" ng-if="isManualHomework && repeatEnabled">\n    <label>Repeats</label>\n    <div class="input" ng-class="{\'focus\': repeatFocus}">\n      <div class="selector"><span>{{ homework.repeats.display }}</span>\n        <select name="repeats" ng-model="homework.repeats" ng-options="r.display for r in repeatOptions track by r.id" ng-focus="repeatFocus=true" ng-blur="repeatFocus=false" ng-change="repeatChanged()">\n          <option value=""></option>\n        </select>\n      </div> \n    </div>\n  </div>\n  <div class="field" ng-class="{error: (form.repeatEnds.$error.required || form.repeatEnds.$error.date || form.repeatEnds.$error.daterange || form.repeatEnds.$error.endDateBeforeDueDate || form.repeatEnds.$error.endDateWithinOneYear) && form.$submitted}" ng-if="isManualHomework && homework.repeats && repeatEnabled">\n    <label>Repeat Ends <span class="required">*</span></label>\n    <div class="input" ng-class="{\'focus\': repeatEndsDatepicker.opened}">\n      <span class="ui-datepicker-trigger" ng-click="openDatePicker($event, \'repeatEnds\')"></span>\n      <input type="text" name="repeatEnds" class="datepicker" ng-model="homework.repeatEnds" datepicker-popup="M/d/yyyy" is-open="repeatEndsDatepicker.opened" no-school-days="userNoSchoolDays" ng-required="homework.repeats" ng-focus="openDatePicker($event, \'repeatEnds\')" ng-click="openDatePicker($event, \'repeatEnds\')" validate-date-range validate-repeat-end-date />\n      <span class="error-msg" ng-show="form.repeatEnds.$error.required && form.$submitted">This field is required.</span>\n      <span class="error-msg" ng-show="(form.repeatEnds.$error.date || form.repeatEnds.$error.daterange) && !form.repeatEnds.$error.required && form.$submitted">Please enter a valid date.</span>\n      <span class="error-msg" ng-show="form.repeatEnds.$error.endDateBeforeDueDate && form.$submitted">Repeat end date must be after the begin date.</span>\n      <span class="error-msg" ng-show="form.repeatEnds.$error.endDateWithinOneYear && form.$submitted">End date needs to be within a year of the begin date.</span>\n    </div>\n  </div>\n  <div class="field">\n    <label>Priority</label>\n    <div class="input" ng-class="{\'focus\': priorityFocus}">\n      <div class="selector"><span>{{ homework.priority.display }}</span>\n        <select name="priority" ng-model="homework.priority" ng-options="p.display for p in priorityOptions track by p.id" ng-focus="priorityFocus=true" ng-blur="priorityFocus=false">\n          <option value=""></option>\n        </select>\n      </div> \n    </div>\n  </div>\n  <div class="field">\n    <label>Reminder</label>\n    <div class="input" ng-class="{\'focus\': reminderFocus}" ng-click="alertReminder()">\n      <div class="selector"><span>{{ homework.reminder.display }}</span>\n        <select name="reminder" ng-if="user" ng-model="homework.reminder" ng-options="rm.display for rm in hwReminderOptions track by rm.id" ng-focus="reminderFocus=true" ng-blur="reminderFocus=false" ng-change="reminderChanged()">\n          <option value="">No Reminder</option>\n        </select>\n      </div>\n    </div>\n  </div>\n  <div class="field">\n    <label>Other Info</label>\n    <div class="input">\n      <textarea rows="5" cols="25" name="additional_info" ng-model="homework.additionalInfo" maxlength="4096"></textarea>\n    </div>\n  </div>\n  <div class="field boolean-field" ng-if="isEditForm && (homework.isCompleteable || homework.isUncompleteable) && !completeDisabled">\n    <div class="checker" ng-class="{checked: homework.complete}">\n      <label><span class="fld"></span><input type="checkbox" name="complete" ng-model="homework.complete">Complete</label>\n    </div>\n  </div>\n</fieldset> \n<fieldset ng-show="showFileUpload" ng-if="user.isPremiumOrSchoolAccount && isManualHomework" ng-model="homework.uploadedFile" file-upload show-title="true"></fieldset>\n<fieldset class="hw-form-attach" style="display: block;" ng-if="isManualHomework" ng-show="!showFileUpload">\n  <div class="field">\n    <label>File Attachments</label>\n    <div class="input">\n      <ul class="resources-list" style="margin-bottom: 10px;" ng-if="homework.files">\n        <li ng-repeat="file in homework.files track by $index" resource-item="file" delete-enabled="true"></li>\n      </ul>\n      <a class="alt-button" ng-click="showAddAttachment()" ng-if="user.isPremiumOrSchoolAccount && isManualHomework && (!homework.files || homework.files.length < 5)"><span class="icon add"></span><span ng-if="homework.files">Attach another file</span><span ng-if="!homework.files">Attach a file</span></a>\n      <span class="form-info" ng-if="isManualHomework && !user.isPremiumOrSchoolAccount && !homework.files">\n        Available on premium accounts, <a ng-if="user" ng-click="attachmentsUpgradeOrSignUp()">upgrade your account</a><a ng-if="!user" ng-click="attachmentsUpgradeOrSignUp()">sign up</a>.\n      </span>\n    </div>\n  </div>\n </fieldset>\n <fieldset class="cage" ng-show="!showFileUpload">\n  <input type="submit" class="button" name="save" value="Save" ng-click="save(form, homework)">\n  <input type="submit" class="alt-button" name="save_and_homework" value="Save &amp; Add Another" ng-click="save(form, homework, true)" ng-if="!isEditForm">\n  <a class="close" ng-click="cancel()">Cancel</a>\n </fieldset>\n</form>\n<form name="reminderForm" class="inline tidy custom-reminder-form" novalidate ng-if="showCustomReminderForm">\n  <fieldset>\n    <legend>Custom Reminder</legend>\n    <div class="field reminder-date">\n      <label>Reminder Date</label>\n      <div class="input">\n        <datepicker ng-model="customReminder.date"></datepicker>\n      </div>\n    </div>\n    <div class="field" ng-class="{error: reminderForm.time.$error && reminderForm.$submitted}">\n      <label>Reminder Time</label>\n      <div class="input">\n        <input type="text" name="time" ng-model="customReminder.time" validatetime required>\n        <span class="error-msg" ng-show="reminderForm.time.$error && reminderForm.$submitted">Enter a valid time.</span>\n      </div>\n    </div>\n    <fieldset class="cage" ng-show="!showFileUpload">\n      <input type="submit" class="button" name="save" value="Done" ng-click="selectCustomReminder(reminderForm)">\n      <a class="close" ng-click="cancelCustomReminder(reminderForm)">Cancel</a>\n     </fieldset>\n  </fieldset>\n</div>\n</div>'),a.put("templates/homework/homework-list.html",'<div sticky-headers="{{ !groupingDisabled && !stickyHeadersDisabled }}" ng-class="{\'box-scroll\': !boxAlreadyScrolls, \'hide-completed\': settings.hideCompleted, \'groups-disabled\': groupingDisabled}">\n  <div ng-if="hwFiltersEnabled" class="box-filters filters-row" id="hw-filter-options">\n    <ul class="filters {{ hwFilters.active }}" ng-class="{\'three\': hwFilters.noClass}">\n      <li>\n        <div class="radio all">\n          <label><span class="fld"></span><input type="radio" ng-model="hwFilters.active" value="all"><span class="txt">All</span></label>\n        </div>\n      </li>\n      <li ng-if="!hwFilters.noClass">\n        <div class="radio class">\n          <label><span class="fld"></span><input type="radio" ng-model="hwFilters.active" value="class"><span class="txt">Class</span></label>\n        </div>\n      </li>\n      <li>\n        <div class="radio priority">\n          <label><span class="fld"></span><input type="radio" ng-model="hwFilters.active" value="priority"><span class="txt">Priority</span></label>\n        </div>\n      </li>\n      <li>\n        <div class="radio type">\n          <label><span class="fld"></span><input type="radio" ng-model="hwFilters.active" value="type"><span class="txt">Type</span></label>\n        </div>\n      </li>\n    </ul>\n    <div ng-if="completeCheckboxEnabled" class="checker show-completed" ng-class="{\'checked\': !settings.hideCompleted}">\n      <label><span class="fld"></span><input type="checkbox" name="show-completed" ng-model="settings.hideCompleted" ng-change="changeShowCompleted()"><span class="txt">Show Completed</span></label>\n    </div>\n  </div>\n  <ul ng-repeat="group in homeworkItems.groups track by group.id" class="box-content homework-list">\n    <li id="group-{{ ::group.id }}" class="group-row group-{{ ::group.id }}" ng-class="{\'closed\': group.closed}" ng-click="toggleGroup(group)"> \n      <span class="group-title">{{ group.title }}</span>\n      <span class="icon"></span>\n    </li>\n    <li ng-repeat="homework in group.items track by homework.id" class="hw-row group-{{ ::group.id }} {{ homework.displayClasses }}" ng-click="openHomework(homework)" class-color>\n      <div class="line">\n        <div class="h-name"><a>{{ homework.title }}</a></div>\n        <div class="h-date" ng-if="!homework.isEvent"> \n          <span class="hw-icon repeats" tooltip="Repeats"></span>\n          <span class="long">{{ homework.longDateFormat }}</span>\n          <span class="short">{{ homework.shortDateFormat }}</span>\n        </div>\n      </div>\n      <div class="line">\n        <div class="h-class">\n          <span class="hw-icon rimportant" tooltip="Really Important"></span>\n          <span class="hw-icon important" tooltip="Important"></span>\n          <span class="hw-icon reminder" tooltip="Reminder"></span>\n          <span class="hw-icon attachment" tooltip="Attachment"></span>\n          <span ng-if="!homework.isEvent">{{ homework.className }}</span>\n          <span ng-if="homework.isEvent" class="hw-icon repeats" tooltip="Repeats"></span>\n          <span ng-if="homework.isEvent">{{ homework.longDateFormat }}</span>\n          <span ng-if="!homework.ss && !homework.schoolSlug" class="h-actions">\n            <span class="icon edit g" tooltip="Edit" ng-click="editHomework(homework, $event)"></span>\n            <span class="icon delete g" tooltip="Delete" ng-click="deleteHomework(homework, $event)"></span>\n            <span class="icon g unchecked" tooltip="Complete" ng-click="completeHomework(homework, $event)"></span>\n          </span>\n        </div>\n        <div class="h-type">{{ homework.type.display }}</div>\n      </div>\n    </li>\n  </ul>\n</div>'),a.put("templates/homework/homeworks.html",'<three-cols></three-cols>\n<div class="left-col" ng-if="!showFull && macOnlyColumn != \'left\'">\n  <div class="box">\n    <h2 class="box-title">Complete</h2>\n    <div class="empty-box-content no-icon" ng-if="!completedHomework || !userHomeworks || userHomeworks.length == 0">\n      <div class="empty-content">\n       <p>Nothing completed.</p>\n      </div>\n    </div>\n    <homework-list ng-if="completedHomework" list-control="completeListControl" homework-items="completedHomework" grouping-disabled="true" show-complete-checkbox="false" reload-on-complete-repeating="true"></homework-list>\n  </div>\n</div>\n<div class="middle-col" ng-if="!showFull && macOnlyColumn != \'left\'">\n  <div class="box">\n    <h2 class="box-title">Late</h2>\n    <a class="box-title-button no-drag-area" ng-click="completeAllLate()" ng-if="lateHomework"><span class="icon checkmark" tooltip-placement="bottom" tooltip="Mark All Complete"></span></a>        \n    <div class="empty-box-content no-icon" ng-if="!lateHomework || !userHomeworks || userHomeworks.length == 0">\n      <div class="empty-content">\n       <p>Nothing is late!</p>\n      </div>\n    </div>\n    <homework-list ng-if="lateHomework" list-control="lateListControl" homework-items="lateHomework" grouping-disabled="true" show-complete-checkbox="false" reload-on-complete-repeating="true"></homework-list>\n  </div>\n</div>\n<div class="right-col" ng-if="!showFull && macOnlyColumn != \'left\'">\n  <div class="box">\n    <h2 class="box-title">Upcoming</h2>\n    <a class="box-title-button no-drag-area" ng-click="addHomework()"><span class="icon add" tooltip-placement="left" tooltip="Add Homework"></span></a>    \n    <div class="empty-box-content no-icon" ng-if="!upcomingHomework || !userHomeworks || userHomeworks.length == 0">\n      <div class="empty-content">\n       <p>Nothing upcoming.</p>\n      </div>\n    </div>\n    <homework-list ng-if="upcomingHomework" list-control="upcomingListControl" homework-items="upcomingHomework" grouping-disabled="true" show-complete-checkbox="false" reload-on-complete-repeating="true"></homework-list>\n  </div>\n</div>\n<div class="full-col" ng-if="showFull || macOnlyColumn == \'left\'">\n  <div class="box" ng-class="{\'has-filters\': hwFiltersEnabled && !isMacApp}">\n    <h2 class="box-title">Homework</h2>\n    <a class="box-title-button no-drag-area" ng-click="addHomework()"><span class="icon add" tooltip-placement="left" tooltip="Add Homework"></span></a>\n    <a class="box-title-button left no-drag-area" ng-if="hwFiltersEnabled && isMacApp" ng-click="hwListControl.toggleFilters($event)"><span class="icon filter" tooltip-placement="bottom" tooltip="Filter by"></span></a>\n    <div class="empty-box-content" ng-if="!userHomeworks || userHomeworks.length == 0 || !hwFiltersEnabled && userSettings.hideCompletedHomework">\n      <span class="m-icon blue homework"></span>\n      <div class="empty-content" ng-if="!userHomeworks || userHomeworks.length == 0">\n        <p>This is where your assignments, tests and projects will be displayed. You\'ll be able to view them by class, type and priority.</p>\n        <p>Add your first homework using the + button up above.</p>\n      </div>\n      <div class="empty-content" ng-if="userHomeworks && userHomeworks.length > 0 && !hwFiltersEnabled && userSettings.hideCompletedHomework">\n        <div>All of your homework is complete!</div>\n        <div>Add another using the + button above.</div>\n      </div>\n    </div>\n    <homework-list ng-if="userHomeworks && userHomeworks.length > 0" list-control="hwListControl" homework-items="filteredHomeworks" hw-filters-enabled="hwFiltersEnabled" hw-filters="hwFilters"></homework-list>\n  </div>\n</div>'),a.put("templates/homework/view-homework.html",'<div class="lightbox-header">\n  <h2>{{ viewTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content">\n  <dl class="inline">\n    <dt>Description</dt><dd>{{ homework.title }}</dd>\n    <dt ng-if="homework.className">Class</dt><dd ng-if="homework.className"><a ng-click="openClass(homework.classId)"><span ng-if="homework.classColor" class="class-color" ng-style="{\'background-color\': \'#\' + homework.classColor.h }"></span>{{ homework.className }}</a></dd>\n    <dt ng-if="homework.type">Type</dt><dd ng-if="homework.type">{{ homework.type.display }}</dd>\n    <dt ng-if="homework.repeatBegins && homework.dueDate.toISOString() != homework.repeatBegins.toISOString()">Date</dt>\n      <dd ng-if="homework.repeatBegins && homework.dueDate.toISOString() != homework.repeatBegins.toISOString() && homework.hasTime">{{ homework.dueDate | date:\'EEEE, MMM d y - h:mm a\' }}</dd>\n      <dd ng-if="homework.repeatBegins && homework.dueDate.toISOString() != homework.repeatBegins.toISOString() && !homework.hasTime">{{ homework.dueDate | date:\'EEEE, MMM d y\' }}</dd>\n    <dt>{{ dueDateTitle }}</dt>\n      <dd ng-if="homework.hasTime && !homework.repeatBegins">{{ homework.dueDate | date:\'EEEE, MMM d y - h:mm a\' }}</dd>\n      <dd ng-if="!homework.hasTime && !homework.repeatBegins">{{ homework.dueDate | date:\'EEEE, MMM d y\' }}</dd>\n      <dd ng-if="homework.hasTime && homework.repeatBegins">{{ homework.repeatBegins | date:\'EEEE, MMM d y - h:mm a\' }}</dd>\n      <dd ng-if="!homework.hasTime && homework.repeatBegins">{{ homework.repeatBegins | date:\'EEEE, MMM d y\' }}</dd>\n    <dt ng-if="homework.repeats">Repeats</dt><dd ng-if="homework.repeats"><span class="hw-icon repeats"></span>{{ homework.repeats.display }}<span ng-if="homework.repeatEnds"> until {{ homework.repeatEnds | date:\'MMMM d\' }}</span></dd>\n    <dt ng-if="homework.priority">Priority</dt><dd ng-if="homework.priority"><span ng-if="homework.priority.id == \'1\' || homework.priority.id == \'2\'" class="hw-icon" ng-class="{rimportant: homework.priority.id == \'1\', important: homework.priority.id == \'2\' }"></span>{{ homework.priority.display }}</dd>\n    <dt ng-if="homework.reminder">Reminder</dt><dd ng-if="homework.reminder"><span class="hw-icon reminder"></span>{{ homework.reminder.display }}</dd>    \n    <dt ng-if="!homework.isManual && homework.teacherNotes">Additional Info</dt><dd ng-if="!homework.isManual && homework.teacherNotes" ng-bind-html="homework.teacherNotes"></dd>    \n    <dt ng-if="homework.additionalInfo">Other Info</dt><dd ng-if="homework.additionalInfo" class="additional-info" ng-bind-html="homework.additionalInfo | linky:\'_blank\'"></dd>\n    <dt>Status</dt>\n    <dd ng-if="homework.isComplete && !homework.isUncompleteable">Complete!</dd>\n    <dd class="field boolean-field" ng-if="homework.isCompleteable || homework.isUncompleteable">\n      <div class="checker" ng-class="{checked: homework.complete}">\n        <label><span class="fld"></span><input type="checkbox" name="complete" ng-model="homework.complete" ng-change="statusChanged()">Complete</label>\n      </div>\n    </dd>\n  </dl>\n  <div ng-if="homework.files">\n    <h4 class="h5">Attachments</h4>\n    <ul class="resources-list">\n      <li ng-repeat="file in homework.files track by file.id" resource-item="file" delete-enabled="false"></li>\n    </ul>\n  </div>\n  <div ng-if="!homework.ss">\n  <div class="alt-button" ng-click="editHomework(homework)"><span class="icon edit"></span>Edit</div>\n  <div class="delete-button" ng-if="homework.isDeletable" ng-click="deleteHomework(homework)"><span class="icon delete"></span>Delete</div>\n  </div>\n</div>'),a.put("templates/iframe-view.html",'<div class="lightbox-header">\n  <h2>{{ viewtitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content frame-content">\n	<iframe style="width: 100%; height: 100%;" ng-src="{{ frameUrl }}"></iframe>\n</div>  \n'),a.put("templates/libs/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()">\n  <div class="carousel-inner" ng-transclude></div>\n  <a class="left carousel-control" ng-click="prev()" ng-show="slides.length > 1"><span class="icon prev"></span></a>\n  <a class="right carousel-control" ng-click="next()" ng-show="slides.length > 1"><span class="icon next"></span></a>\n</div>\n'),a.put("templates/libs/carousel/slide.html",'<div ng-class="{\'active\': active }" class="item text-center" ng-transclude></div>\n'),a.put("templates/libs/datepicker/datepicker.html",'<div ng-switch="datepickerMode" role="application" ng-keydown="keydown($event)" class="ui-datepicker-inline">\n  <daypicker ng-switch-when="day" tabindex="0"></daypicker>\n</div>'),a.put("templates/libs/datepicker/day.html",'<div aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <div class="ui-datepicker-header">\n    <a class="ui-datepicker-prev" ng-click="move(-1)" tabindex="-1"></a>\n    <a class="ui-datepicker-next" ng-click="move(1)" tabindex="-1"></a>\n    <div class="ui-datepicker-title" id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" tabindex="-1">\n      <span class="ui-datepicker-month">{{title}}</span>\n    </div>\n  </div>\n  <table class="ui-datepicker-calendar">\n    <thead>\n      <tr>\n        <th ng-repeat="label in labels track by $index"><span aria-label="{{label.full}}" tooltip="{{ label.full }}">{{label.abbr | limitTo: 1}}</span></th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr ng-repeat="row in rows track by $index">\n        <td ng-repeat="dt in row track by dt.date" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}" ng-class="{\'ui-datepicker-other-month\': dt.secondary, \'ui-datepicker-today\': dt.current, \'ui-datepicker-weekend\': dt.weekend, \'ui-datepicker-noschool\': dt.isNoSchoolDay}">\n          <a ng-class="{\'ui-state-active\': dt.selected}" class="ui-state-default" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1">{{dt.label}}<span class="busy-day" ng-if="dt.busyCount">{{dt.busyCount}}</span><span class="day-color" ng-if="dt.color" ng-style="{\'background-color\': \'#\' + dt.color}"></span></a>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</div>'),
a.put("templates/libs/datepicker/month.html","<div><!-- not used --></div>"),a.put("templates/libs/datepicker/popup.html","<div class=\"ui-datepicker\" ng-style=\"{display: (isOpen && 'block') || 'none', top: position.top+'px', left: position.left+'px'}\" ng-keydown=\"keydown($event)\" ng-transclude></div>"),a.put("templates/libs/datepicker/year.html","<div><!-- not used --></div>"),a.put("templates/libs/modal/window.html",'<div tabindex="-1" role="dialog" class="modal fade" ng-class="{in: animate}">\n  <div class="modal-window">\n    <div class="modal-content">\n      <div class="lightbox" ng-class="size" modal-transclude></div>\n    </div>\n  </div>\n</div>'),a.put("templates/libs/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n'),a.put("templates/libs/tooltip/tooltip-popup.html",'<div class="tooltip {{placement}} {{popupClass}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n'),a.put("templates/orientation/welcome.html",'<div class="lightbox-content welcome-content">\n  <span class="logo"><span class="ico"></span>myHomework</span>\n  <h2 class="h4">Welcome to myHomework for {{ platform }}!</h2>\n  <ul class="features">\n    <li><span class="icon homework"></span><span class="txt">Keep track of your homework</span></li>\n    <li><span class="icon classes"></span><span class="txt">Keep track of your classes</span></li>\n    <li><span class="icon announcement"></span><span class="txt">Get reminded of what\'s due</span></li>\n    <li><span class="icon teacher"></span><span class="txt">Join Teachers.io classes</span></li>\n    <li><span class="icon sync"></span><span class="txt">Works offline and syncs</span></li>\n    <li><span class="icon accounts"></span><span class="txt">Multiple accounts (for parents)</span></li>\n    <li><span class="icon themes"></span><span class="txt">Over 60 themes</span></li>\n    <li><span class="icon devices"></span><span class="txt">Available for iOS and Android</span></li>\n  </ul>\n  <div class="opts" ng-if="!user">\n    <button class="button" ng-click="openSignup()">Sign up</button>\n    <span>or</span>\n    <button class="alt-button" ng-click="openSignin()">Sign in</button>\n  </div>\n</div>\n'),a.put("templates/schools/find-schools.html",'<div class="lightbox-header">\n  <h2>Find Your School</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content find-class">\n  <form name="form" class="search-form" novalidate>\n    <fieldset>\n      <div class="field" ng-class="{error: form.query.$error.required && form.$submitted}">\n        <div class="input">\n          <input autocomplete="off" type="text" name="query" maxlength="512" placeholder="School Name" ng-model="searchQuery" required>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset class="cage">\n      <input type="submit" class="button" value="Search" ng-click="searchSchools(form)">\n      <span class="error-msg" ng-show="form.query.$error.required && form.$submitted">Please enter a search term.</span>\n    </fieldset>\n  </form>\n  <div class="geo-schools" ng-if="geoSchools">\n    <div ng-if="geoSchools.facebookSchools && geoSchools.facebookSchools.length">\n      <h3 class="h5">Facebook Schools</h3>\n      <schools-list schools="geoSchools.facebookSchools" add-button-enabled="true" find-button-disabled="true"></schools-list>\n    </div>\n    <div ng-if="geoSchools.possibleSchools && geoSchools.possibleSchools.length">\n      <h3 class="h5">Possible Schools</h3>\n      <schools-list schools="geoSchools.possibleSchools" add-button-enabled="true" find-button-disabled="true"></schools-list>\n    </div>\n    <div ng-if="geoSchools.nearbySchools && geoSchools.nearbySchools.length">\n      <h3 class="h5">Nearby Schools</h3>\n      <schools-list schools="geoSchools.nearbySchools" add-button-enabled="true" find-button-disabled="true"></schools-list>\n    </div>\n    <h3 class="h5">Can\'t find your school?</h3>\n    <p>Our schools database is still growing. <a href="https://myhomeworkapp.com/contact" target="_blank">Let us know</a> if your school is missing.</p>\n  </div>\n  <div class="search-results" ng-if="searchResult">\n    <div class="search-result-schools" ng-class="{\'has-schools\': searchResult.schools && searchResult.schools.length}">\n      <schools-list ng-if="searchResult.schools && searchResult.schools.length" schools="searchResult.schools" add-button-enabled="true" find-button-disabled="true"></schools-list>\n      <p ng-if="!searchResult.schools || searchResult.schools.length == 0">We couldn\'t find any schools. Try a different search.</p>\n      <p ng-if="searchResult.schools && searchResult.schools.length">Didn\'t find your school? You might try a different search.</p>\n      <p>Our schools database is still growing. <a href="https://myhomeworkapp.com/contact" target="_blank">Let us know</a> if your school is missing.</p>\n    </div>\n  </div>\n  <spinner ng-if="fetchSpinner.show" spinner-text="{{ fetchSpinner.text }}"></spinner>\n</div>'),a.put("templates/schools/map-sandbox.html",'<!DOCTYPE html>\n<html>\n  <head>\n    <title>Loading Map</title>\n    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">\n    <meta charset="utf-8">\n    <style>\n      html, body, #map-canvas {\n        height: 100%;\n        margin: 0px;\n        padding: 0px\n      }\n    </style>\n    <script>\n      function getParameterByName(name) {\n        name = name.replace(/[\\[]/, "\\\\[").replace(/[\\]]/, "\\\\]");\n        var regex = new RegExp("[\\\\?&]" + name + "=([^&#]*)"),\n          results = regex.exec(location.search);\n        return results === null ? "" : decodeURIComponent(results[1].replace(/\\+/g, " "));\n      }\n\n      function initialize() {\n        var latitude = getParameterByName(\'lat\');\n        var longitude = getParameterByName(\'lon\');\n        if (latitude && longitude) {\n          var geo = new google.maps.LatLng(parseFloat(latitude), parseFloat(longitude));\n          var map = new google.maps.Map(document.getElementById(\'map-canvas\'), {\n            zoom: 16,\n            center: geo,\n            mapTypeId: google.maps.MapTypeId.SATELLITE,\n            disableDefaultUI: true\n          });\n          var marker = new google.maps.Marker({ \n            position: geo,\n            map: map\n          });\n        }\n      }\n\n      function loadScript() {\n        var script = document.createElement(\'script\');\n        script.type = \'text/javascript\';\n        script.src = \'https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&callback=initialize\';\n        document.body.appendChild(script);\n      }\n\n      window.onload = loadScript;\n    </script>\n  </head>\n  <body>\n    <div id="map-canvas"></div>\n  </body>\n</html>'),a.put("templates/schools/schools-list.html",'<ul class="schools-list"> \n  <li ng-repeat="school in schools" ng-click="openSchool(school)">\n    <div class="school-snippet">\n      <span>\n        <img ng-src="{{ school.localAvatar }}" alt="School Logo" ng-if="school.localAvatar" />\n        <span class="s-icon schools" ng-if="!school.localAvatar && !school.avatar"></span>\n        <span class="school-pic-icon" ng-if="school.avatar && !school.localAvatar">\n          <lazy-image lazy-src="{{ school.avatar }}"></lazy-image>\n        </span>\n      </span>\n      <div class="school-details">\n        <p class="school-name"><span>{{ school.name }}</span></p>\n        <p class="school-addr"><span ng-if="school.location">{{ school.location }}</span></p>\n      </div>\n      <button class="alt-button" ng-hide="findButtonDisabled">Find Your Teacher<span class="icon next"></span></button>\n      <button class="alt-button" ng-show="addButtonEnabled" ng-click="addSchool($event, school)"><span class="icon add"></span>Add to My Schools</button>\n    </div>\n  </li>\n</ul>'),a.put("templates/schools/view-announcements.html",'<div class="box">\n  <h2 class="box-title">School Announcements</h2>\n  <div class="empty-box-content no-icon" ng-if="!school.announcements">\n    <div class="empty-content">\n      <p>This school hasn\'t made any announcements yet.</p>\n      <p>To learn more about how schools can send announcements via myHomework, go to <a href="https://myhomeworkapp.com/for-schools" target="_blank">myhomeworkapp.com/for-schools</a>.</p>\n    </div>\n  </div>\n  <div class="box-scroll" ng-if="school.announcements">\n    <ul class="box-content announcements-list">\n      <li ng-repeat="announcement in school.announcements track by announcement.id" class="ann">\n        <div class="ann-text">\n          <span class="unread" ng-if="!announcement.isRead && school.attending">Unread:</span>\n          <span ng-bind-html="announcement.textHTML" ng-if="announcement.textHTML"></span>\n          <span ng-if="!announcement.textHTML">{{ announcement.text }}</span>\n        </div>\n        <div class="ann-date">{{ announcement.created | date:\'MMMM d - h:mm a\' }}</div>\n      </li>\n    </ul>\n  </div>\n</div>'),a.put("templates/schools/view-details.html",'<div class="box school-profile">\n  <div ng-if="premiumSchool && premiumSchool.slug == school.slug">\n	  <h2 class="box-title"><img class="school-avatar" ng-src="{{ premiumSchool.localAvatar }}" alt="School Logo" ng-if="premiumSchool.localAvatar" /><span class="txt" ng-if="premiumSchool.short_name">{{ premiumSchool.short_name }}</span><span class="txt" ng-if="!premiumSchool.short_name">{{ premiumSchool.name }}</span></h2>\n      <a class="box-title-button no-drag-area"><span class="icon add" ng-click="toggleHomeworkAddOptions($event)" tooltip-placement="left" tooltip="Add ..."></span></a>\n      <div class="box-options" ng-class="{\'show\': showHomemeworkAddOptions}">\n        <ul class="box-options-content">\n          <li><a ng-click="addHomework()">Add Homework</a></li>\n          <li ng-if="premiumSchool.hall_passes_on"><a ng-click="openNewHallPass()">Add Hall Pass</a></li>\n          <li><a ng-click="addEvent()">Add Event</a></li>\n        </ul>      \n      </div>	  \n	  <div ng-if="school" class="premium-school-content">\n	    <div ng-if="classOptions">\n	       <div class="box-content">\n	         <div ng-if="tooLongSinceSync">\n	            <p>Too long since last sync.  Do you have a strong internet connection?  <a ng-click="manualSync()"><span class="txt">Sync Now</span></a></p>\n	         </div>\n	         <div ng-if="lateHomeworkCount"><button class="late" ng-click="openHomeworks()" ng-if="lateHomeworkCount">{{ lateHomeworkCount }} Late Homework</button></div>	       \n	         <div ng-if="upcomingHallPasses">\n	            <ul class="no-list-style">\n	              <li class="hpassli" ng-repeat="hpass in upcomingHallPasses" ng-click="openHomework(hpass)">\n	                <span class="hpass" >\n      				  <span class="passtag" style="background-color: {{ hpass.hallPassInfo.clr }}" ></span>	                  \n	                    <span class="ptxt" ng-if="hpass.hallPassInfo.stat == \'p\'">Pending:</span>\n	                    <span class="ptxt" ng-if="hpass.hallPassInfo.stat == \'a\' || hpass.hallPassInfo.stat == \'aa\'">Active:</span>	                    \n   	                    <span class="ptxt">\n	                    {{ hpass.title }}\n	                    </span>	                  \n	                </span>\n	              </li>\n	            </ul>\n	         </div>\n	       </div>\n	      \n	    <h2 class="box-title">Upcoming</h2>\n	    <div class="empty-box-content no-icon" ng-if="!upcomingHomework">\n	      <div class="empty-content">\n	       <p>No incomplete homework due today or tomorrow.<br/>\n			  Add new tasks and plan ahead now.</p>\n	      </div>\n	    </div>\n	    <homework-list ng-if="upcomingHomework" list-control="upcomingListControl" homework-items="upcomingHomework" grouping-disabled="true" show-complete-checkbox="false" reload-on-complete-repeating="true"></homework-list>\n\n	    <h2 class="box-title">Important</h2>\n	    <div class="empty-box-content no-icon" ng-if="!importantHomework">\n	      <div class="empty-content">\n	       <p>No tests, projects or papers in the next week.<br/>\n              Specify the type while adding homework.</p>\n	      </div>\n	    </div>\n	    <homework-list ng-if="importantHomework" list-control="importantListControl" homework-items="importantHomework" grouping-disabled="true" show-complete-checkbox="false" reload-on-complete-repeating="true"></homework-list>\n\n		<h2 ng-if="upcomingEvents" class="box-title">Upcoming Events</h2>\n	    <homework-list ng-if="upcomingEvents" list-control="upcomingEventsListControl" homework-items="upcomingEvents" grouping-disabled="true" show-complete-checkbox="false" reload-on-complete-repeating="true"></homework-list>\n	      \n	    </div>\n	    <div ng-if="!classOptions">\n	      Add your classes from the home page or calendar using the left navigation.\n	    </div>\n	  </div>\n  </div>\n  <div ng-if="!premiumSchool || premiumSchool.slug != school.slug">\n	  <h2 class="box-title">School Details</h2>\n	  <div class="box-content" ng-if="school">\n	    <div class="school-snippet">\n	      <span>\n	        <img ng-src="{{ school.localAvatar }}" alt="School Logo" ng-if="school.localAvatar" />\n	        <span class="s-icon schools" ng-if="!school.localAvatar"></span>\n	      </span>\n	      <div class="school-details">\n	        <p class="school-name"><span>{{ school.name }}</span></p>\n	        <p class="school-addr"><span ng-if="school.location">{{ school.location }}</span></p>\n	      </div>\n	    </div>\n	    <div class="checker attend-school" ng-class="{\'checked\': school.attending}">\n	      <label><span class="fld"></span><input type="checkbox" name="attend-school" ng-model="school.attending" ng-change="changeAttendSchool(school)"><span class="txt">I attend this school</span></label>\n	    </div>\n	    <p ng-if="school.website"><a href="{{ school.website }}" target="_blank">{{ school.website }}</a></p>\n	    <div class="school-social" ng-if="school.facebookURL || school.twitterHandle">\n	      <a ng-if="school.facebookURL" href="{{ school.facebookURL }}" target="_blank" class="facebook-link">Facebook Page</a>\n	      <a ng-if="school.twitterHandle" href="https://twitter.com/{{ school.twitterHandle }}" target="_blank" class="twitter-link">@{{ school.twitterHandle }}</a>\n	    </div>\n	  </div>\n	  <div ng-if="!isChromeApp && school.geo" class="map"></div>\n	  <iframe ng-if="isChromeApp && school.geo" ng-src="{{ mapSandbox }}" class="map"></iframe>\n	  <p class="report"><a href="https://myhomeworkapp.com/contact" target="_blank">Report a problem</a> with this school\'s information.</p>  \n  </div>\n</div>'),a.put("templates/schools/view-files.html",'<div class="box">\n  <h2 class="box-title">School Files</h2>\n  <div class="empty-box-content no-icon" ng-if="!school.files">\n    <div class="empty-content">\n      <p>This school hasn\'t shared any files yet.</p>\n      <p>To learn more about how schools can share files via myHomework, go to <a href="https://myhomeworkapp.com/for-schools" target="_blank">myhomeworkapp.com/for-schools</a>.</p>\n    </div>\n  </div>\n  <div class="box-scroll" ng-if="school.files">\n    <ul class="box-content resources-list">\n      <li ng-repeat="file in school.files track by file.id" resource-item="file" class="r-row"></li>\n    </ul>\n  </div>\n</div>'),a.put("templates/schools/view-links.html",'<div class="box">\n  <h2 class="box-title">School Resources</h2>\n  <div class="empty-box-content no-icon" ng-if="!school.resources">\n    <div class="empty-content">\n      <p>This school hasn\'t shared any resources yet.</p>\n      <p>To learn more about how schools can share files and links via myHomework, go to <a href="https://myhomeworkapp.com/for-schools" target="_blank">myhomeworkapp.com/for-schools</a>.</p>\n    </div>\n  </div>\n  <div class="box-scroll" ng-if="school.resources">\n    <ul class="box-content resources-list">    \n      <li ng-repeat="link in school.resources track by link.id" resource-item="link" class="r-row"></li>\n    </ul>\n  </div>\n</div>'),a.put("templates/schools/view-school.html",'<div class="left-col">\n  <school-details></school-details>\n</div>\n<draggable-cols></draggable-cols>\n<div class="right-col school-sec has-toolbar mac-always-right {{activeTab}}" ng-switch="activeTab">\n  <ul class="toolbar" ng-class="{\'four\': !isMacApp}">\n    <li class="toolbar-school-info"><a class="info" ng-class="{\'sel\': activeTab == \'info\'}" ng-click="changeTab(\'info\')" tooltip="About" tooltip-enable="isMacApp"><span class="i"></span><span>About</span></a></li>\n    <li><a class="links" ng-class="{\'sel\': activeTab == \'links\' || activeTab == \'details\'}" ng-click="changeTab(\'links\')" tooltip="Resources" tooltip-enable="isMacApp"><span class="i"></span><span>Resources</span></a></li>\n    <li><a class="teachers" ng-class="{\'sel\': activeTab == \'teachers\' }" ng-click="changeTab(\'teachers\')" tooltip="Teachers" tooltip-enable="isMacApp"><span class="i"></span><span>Teachers</span></a></li>\n    <li><a class="announcements" ng-class="{\'sel\': activeTab == \'announcements\'}" ng-click="changeTab(\'announcements\')" tooltip="Announcements" tooltip-enable="isMacApp"><span class="i"></span><span>Announcements</span></a></li>\n  </ul>\n  <school-details class="school-info-page"></school-details>\n  <school-links ng-switch-default></school-links>\n  <school-teachers class="school-teachers-page" ng-switch-when="teachers"></school-teachers>\n  <school-announcements ng-switch-when="announcements"></school-announcements>\n  <spinner ng-if="fetchSpinner.show && fetchSpinner.type == \'teachers\'" spinner-text="{{ fetchSpinner.text }}"></spinner>\n</div>\n<spinner ng-if="fetchSpinner.show && fetchSpinner.type == \'school\'" spinner-text="{{ fetchSpinner.text }}"></spinner>'),a.put("templates/schools/view-teachers.html",'<div class="box">\n  <h2 class="box-title">School Teachers</h2>\n  <div class="empty-box-content no-icon" ng-if="!school.teachers">\n    <div class="empty-content">\n      <p>It doesn\'t look like any teachers at this school are using Teachers.io yet.</p>\n      <p><a href="https://teachers.io" target="_blank">Teachers.io</a> is a free app where teachers can share everything about their classes with myHomework users. If your teachers use Teachers.io, you can easily join their class and get all of the due dates, files, links and announcements right in your myHomework planner!</p>\n      <p>Tell your teachers they can go to <a href="https://teachers.io" target="_blank">https://teachers.io</a> to get started.</p>\n    </div>\n  </div>\n  <div class="box-scroll" ng-if="school.teachers">\n    <ul class="box-content teachers-list">\n      <li ng-repeat="teacher in school.teachers track by teacher.id" class="teacher-row teacher-snippet" ng-click="openTeacher(teacher)">\n        <img ng-src="{{ teacher.localAvatar }}" alt="Teacher Picture" ng-if="teacher.localAvatar" />\n        <span class="teacher-pic-icon" ng-if="teacher.avatar">\n          <lazy-image lazy-src="{{ teacher.avatar }}"></lazy-image>\n        </span>\n        <span class="s-icon account" ng-if="!teacher.avatar"></span>\n        <div class="teacher-details">\n          <div class="teacher-name">{{ teacher.name }}</div>\n          <div class="teacher-info" ng-if="teacher.title"><span>{{ teacher.title }}</span></div>\n        </div>\n      </li>\n    </ul>\n    <div class="box-content no-scroll" ng-if="school.teachers">\n      <h5>Can\'t find your teacher at this school?</h5>\n      <p><a href="https://teachers.io" target="_blank">Teachers.io</a> is a free app where teachers can share everything about their classes with myHomework users. If your teachers use Teachers.io, you can easily join their class and get all of the due dates, files, links and announcements right in your myHomework planner! Tell your teachers they can go to <a href="https://teachers.io" target="_blank">https://teachers.io</a> to get started.</p>\n    </div>\n  </div>\n</div>'),a.put("templates/settings/about-settings.html",'<div class="about-settings">\n  <div class="about-logo">\n    <span class="logo"><span class="ico"></span>myHomework</span>\n    <span class="version">Version {{ appVersion }}</span>\n    <span class="copy">&copy; {{ today | date: \'yyyy\' }} Instin, LLC</span>\n  </div>\n  <ul class="about-links">\n    <li><a href="https://facebook.com/myhomeworkapp" target="_blank" class="facebook-btn">Like us on Facebook</a></li>\n    <li><a href="https://twitter.com/myhomeworkapp" target="_blank" class="twitter-btn">Follow us on Twitter</a></li>\n    <li><a href="https://myhomeworkapp.com/help" target="_blank" class="about-link"><span class="icon contact"></span>Need Help?</a></li>\n    <li ng-if="!isWebApp"><a ng-click="openRatemyHomework()" class="about-link"><span class="icon star"></span>Rate myHomework</a></li>\n    <li><a href="https://myhomeworkapp.com/terms" target="_blank" class="about-link"><span class="icon terms"></span>Terms of Service</a></li>\n    <li><a href="https://myhomeworkapp.com/privacy" target="_blank" class="about-link"><span class="icon privacy"></span>Privacy Policy</a></li>\n  </ul>\n</div>'),a.put("templates/settings/about.html",'<div class="lightbox-header">\n  <h2>About</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content about-content">\n  <about-settings></about-settings>\n</div>'),a.put("templates/settings/account-settings.html",'<div class="account-settings">\n  <div ng-if="user && user.isSchoolAccount && premiumSchool">\n      <h3><span ng-if="!premiumSchool.ptinfo.ttl">Parent Access</span><span ng-if="premiumSchool.ptinfo.ttl">{{ premiumSchool.ptinfo.ttl }} Access</span>: {{ user.username }}</h3>  \n      <ul class="accounts-list" ng-if="user.grds">\n        <li ng-repeat="grd in user.grds">\n        <div class="user-details">{{ grd.usr.e }}</div>\n        <div class="user-actions" style="margin: -2px 0 0 0;">\n          <button class="alt-button" ng-click="removeGuardian(user, grd.usr );">Remove</button>\n        </div>\n        </li>\n      </ul>      \n	  <div ng-if="user.grds.length < 7" class="clearfix" style="margin-bottom: 10px;">\n	    <button class="alt-button" ng-click="addGuardian(user);" ng-if="user.grds.length < 7"><span class="icon add"></span>Add a <span ng-if="!premiumSchool.ptinfo.ttl">Parent</span><span ng-if="premiumSchool.ptinfo.ttl">{{ premiumSchool.ptinfo.ttl }}</span></button>\n	  </div>      \n  </div>\n  <h3 ng-if="user && user.isSchoolAccount">Login to multiple students at once</h3>  \n  <ul class="accounts-list" ng-if="users">\n    <li ng-repeat="usr in users track by usr.id">\n      <a ng-click="openAccount(usr)">\n        <img ng-src="{{ usr.localAvatar }}" alt="Account Picture" ng-if="usr.localAvatar" />\n        <span class="s-icon account" ng-if="!usr.localAvatar"></span>\n      </a>\n      <div class="user-details" ng-class="{\'one\': !usr.name || !usr.username }">\n        <div class="user-name" ng-if="usr.name"><a ng-click="openAccount(usr)">{{ usr.name }}</a></div>\n        <div class="user-info" ng-if="usr.username"><span>{{ usr.username }}</span></div>\n      </div>\n      <div class="user-actions">\n        <span class="active" ng-if="usr.id == user.id && users.length > 1">Active</span>\n        <span class="active premium" ng-if="usr.isPremiumAccount && !usr.shouldRenew">Premium</span>\n        <button ng-if="!usr.isPremiumOrSchoolAccount" ng-click="upgradeUser(usr)">Upgrade</button>\n        <button ng-if="usr.shouldRenew" ng-click="renewUser(usr)">Renew</button>\n        <button class="alt-button signout" ng-click="signOutUser(usr)">Sign out</button>\n      </div>\n    </li>\n  </ul>\n  <div ng-if="users" class="clearfix">\n    <button class="alt-button" ng-click="addAccount()" ng-if="users.length < 7"><span class="icon add"></span>Add Another Account</button>\n    <span ng-if="lastSyncDate" class="sync-info">Last Sync: {{ lastSyncDate | relativeDate }}</span>\n  </div>\n  <p ng-if="!user"><button ng-click="signin()">Sign in</button><button class="alt-button" ng-click="signup()">Sign up</button></p>\n</div>'),a.put("templates/settings/calendar-settings.html",'<div>\n  <form name="form" novalidate>\n    <fieldset>\n      <div class="field boolean-field">\n        <div class="checker" ng-class="{checked: settings.showCalendarOnStart}">\n          <label><span class="fld"></span><input type="checkbox" name="complete" ng-model="settings.showCalendarOnStart" ng-change="saveChange()">Show calendar when app starts</label>\n        </div>\n      </div>\n    </fieldset>\n  </form>\n</div>'),a.put("templates/settings/class-settings.html",'<div>\n  <form name="form" class="inline tidy sectioned" novalidate>\n    <fieldset class="period-fieldset">\n      <legend>Period Schedule</legend>\n      <div class="field">\n        <label>Periods Per Day</label>\n        <div class="input" ng-class="{\'focus\': periodFocus}">\n          <div class="selector"><span>{{ settings.periodsPerDay }}</span>\n            <select name="periods" ng-model="settings.periodsPerDay" ng-options="n for n in [] | range:1:13" ng-focus="periodFocus=true" ng-blur="periodFocus=false">\n              <option value=""></option>\n            </select>\n          </div> \n        </div>\n      </div>\n      <div class="field boolean-field">\n        <div class="checker" ng-class="{checked: settings.showZeroPeriod}">\n          <label><span class="fld"></span><input type="checkbox" name="complete" ng-model="settings.showZeroPeriod" ng-change="saveChange()">Periods start with 0 instead of 1</label>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset class="block-schedule-fieldset">\n      <legend class="default-legend">{{ settings.blockDayName | titleCapitalize }} Schedule</legend>\n      <legend class="alt-legend">{{ settings.blockDayName | titleCapitalize }} Options</legend>\n      <div class="field">\n        <label>{{ settings.blockDayPeriodName | titleCapitalize }}s Per Day</label>\n        <div class="input" ng-class="{\'focus\': blockFocus}">\n          <div class="selector"><span>{{ settings.blocksPerDay }}</span>\n            <select name="blocks" ng-model="settings.blocksPerDay" ng-options="n for n in [] | range:1:13" ng-focus="blockFocus=true" ng-blur="blockFocus=false">\n              <option value=""></option>\n            </select>\n          </div> \n        </div>\n      </div>\n      <div ng-if="!settings.hasSchoolBlockSchedule" class="field boolean-field">\n        <div class="checker" ng-class="{checked: settings.showZeroBlock }">\n          <label><span class="fld"></span><input type="checkbox" name="complete" ng-model="settings.showZeroBlock" ng-change="saveChange()">Blocks start with 0 instead of 1</label>\n        </div>\n      </div>\n      <div class="field block-setting" ng-repeat="blockOption in blockOptions track by blockOption.id"> \n        <label>{{ blockOption.label }}</label>\n        <div class="input">\n          <input autocomplete="off" type="text" maxlength="100" placeholder="{{ blockOption.placeholder }}" ng-model="blockOption.text" ng-blur="applyDayLabelChanges()">\n          <div class="selector mini" ng-click="openColorPicker($event, blockOption.id )">\n            <span><span class="color" ng-style="{\'background-color\': \'#\' + blockOption.color.h }" ng-show="blockOption.color.h"></span><span class="placeholder" ng-show="!blockOption.color.h">Color</span></span>\n            <color-picker is-open="blockOption.opened" ng-model="blockOption.color" class="right-color-picker"></color-picker>\n          </div>\n          <a class="remove-block" ng-click="removeBlockDay($event, blockOption.id)"><span class="icon delete g"></span></a>\n        </div>\n      </div>\n      <div class="field" ng-hide="hideAddMoreDays">\n        <div class="input">\n          <a class="image-link" ng-click="addBlockDay()"><span class="icon add"></span>Add more days</span></a>\n        </div>\n      </div>\n      <div class="field">\n        <label ng-if="blockOptions.length && blockOptions[0].text">Select when<br> <strong>{{ blockOptions[0].text }}</strong> starts:</label>\n        <label ng-if="!blockOptions.length || !blockOptions[0].text">Select when<br> <strong>Day A</strong> starts:</label>\n        <div class="input">\n          <div class="calendar-block-settings">\n            <datepicker ng-model="settings.dayAStartDate" block-settings="blockOptions" no-school-days="userNoSchoolDays" explicit-block-days="settings.explicitBlockDates"></datepicker>\n          </div>\n        </div>\n      </div>\n      <div class="field continue-field">\n        <div class="input">\n          <button class="continue" ng-click="continue()">Continue<span class="icon next"></span></button>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset class="cage remove-fieldset" ng-if="userClasses">\n      <div class="field">\n        <button class="delete-button" ng-click="removeAllClasses()"><span class="icon delete"></span>Remove all classes</button>\n      </div>\n    </fieldset>\n  </form>\n</div>'),a.put("templates/settings/homework-settings.html",'<div>\n  <form name="form" class="inline tidy sectioned" novalidate>\n    <fieldset>\n      <div class="field">\n        <label>Default Priority</label>\n        <div class="input" ng-class="{\'focus\': priorityFocus}">\n          <div class="selector"><span>{{ settings.defaultPriority.display }}</span>\n            <select name="priority" ng-model="settings.defaultPriority" ng-options="p.display for p in priorityOptions track by p.id" ng-focus="priorityFocus=true" ng-blur="priorityFocus=false" ng-change="saveChange()">\n              <option value=""></option>\n            </select>\n          </div> \n        </div>\n      </div>\n      <div class="field" ng-if="user">\n        <label>Default Reminder</label>\n        <div class="input" ng-class="{\'focus\': reminderFocus}">\n          <div class="selector"><span>{{ settings.defaultReminder.display }}</span>\n            <select name="reminder" ng-model="settings.defaultReminder" ng-options="rm.display for rm in reminderOptions track by rm.id" ng-focus="reminderFocus=true" ng-blur="reminderFocus=false" ng-change="saveChange()">\n              <option value="">No Reminder</option>\n            </select>\n          </div>\n        </div>\n      </div>\n      <div class="field boolean-field">\n        <div class="checker" ng-class="{checked: !settings.hideCompletedHomework}">\n          <label><span class="fld"></span><input type="checkbox" name="complete" ng-model="settings.hideCompletedHomework" ng-change="saveChange()">Show completed items on home</label>\n        </div>\n      </div>\n      <div class="field boolean-field">\n        <div class="checker" ng-class="{checked: !settings.dontPromptDelete}">\n          <label><span class="fld"></span><input type="checkbox" name="complete" ng-model="settings.dontPromptDelete" ng-change="saveChange()">Prompt to confirm when deleting assignments</label>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset class="cage" ng-if="userHomeworks">\n      <div class="field">\n        <button class="delete-button" ng-click="removeAll()"><span class="icon delete"></span>Remove all assignments</button>\n        <button class="delete-button" ng-click="removeCompleted()" ng-if="hasCompletedHomework"><span class="icon delete"></span>Remove completed assignments</button>\n      </div>\n    </fieldset>\n  </form>\n</div>'),a.put("templates/settings/school-settings.html",'<div class="school-settings">\n  <h3 class="h5" ng-if="userSchools">Attending Schools</h3>\n  <ul class="schools-list" ng-if="userSchools"> \n    <li ng-repeat="school in userSchools">\n      <div class="school-snippet">\n        <a ng-click="openSchool(school)">\n          <img ng-src="{{ school.localAvatar }}" alt="School Logo" ng-if="school.localAvatar" />\n          <span class="s-icon schools" ng-if="!school.localAvatar"></span>\n        </a>\n        <div class="school-details">\n          <p class="school-name"><a ng-click="openSchool(school)">{{ school.name }}</a></p>\n          <p class="school-addr"><span ng-if="school.location">{{ school.location }}</span></p>\n        </div>\n        <button class="alt-button" ng-click="removeSchool(school)"><span class="icon delete"></span>Remove School</button>\n      </div>\n    </li>\n  </ul>\n  <p ng-if="!userSchools && users">What school do you go to?</p>\n  <form name="form" class="search-form" novalidate ng-if="user">\n    <fieldset>\n      <div class="field" ng-class="{error: form.query.$error.required && form.$submitted}">\n        <div class="input">\n          <input autocomplete="off" type="text" name="query" maxlength="512" placeholder="School Name" ng-model="queries.search" required>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset class="cage">\n      <input type="submit" class="button" value="Search" ng-click="searchSchools(form)">\n      <span class="error-msg" ng-show="form.query.$error.required && form.$submitted">Please enter a search term.</span>\n    </fieldset>\n  </form>\n  <div class="search-results" ng-if="searchResult">\n    <div class="search-result-schools" ng-class="{\'has-schools\': searchResult && searchResult.length}">\n      <schools-list ng-if="searchResult && searchResult.length" schools="searchResult" add-button-enabled="true" find-button-disabled="true"></schools-list>\n      <p ng-if="!searchResult || searchResult.length == 0">We couldn\'t find any schools. Try a different search.</p>\n      <p ng-if="searchResult && searchResult.length">Didn\'t find your school? You might try a different search.</p>\n      <p>Our schools database is still growing. <a href="https://myhomeworkapp.com/contact" target="_blank">Let us know</a> if your school is missing.</p>\n    </div>\n  </div>\n  <p ng-if="!user"><button ng-click="signin()">Sign in</button><button class="alt-button" ng-click="signup()">Sign up</button></p>\n</div>'),
a.put("templates/settings/view-settings.html",'<div class="lightbox-header no-border" ng-switch="activeTab">\n  <h2 ng-switch-default>Homework Settings</h2>\n  <h2 ng-switch-when="classes">Classes Settings</h2>\n  <h2 ng-switch-when="calendar">Calendar Settings</h2>\n  <h2 ng-switch-when="accounts">Account Settings</h2>\n  <h2 ng-switch-when="schools">Schools Settings</h2>\n  <h2 ng-switch-when="about">About</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<ul class="settings-tabs">\n  <li><a class="homework" ng-class="{\'sel\': activeTab == \'homework\'}" ng-click="changeTab(\'homework\')"><span class="i"></span><span class="txt">Homework</span></a></li>\n  <li><a class="classes" ng-class="{\'sel\': activeTab == \'classes\'}" ng-click="changeTab(\'classes\')"><span class="i"></span><span class="txt">Classes</span></a></li>\n  <li><a class="calendar" ng-class="{\'sel\': activeTab == \'calendar\'}" ng-click="changeTab(\'calendar\')"><span class="i"></span><span class="txt">Calendar</span></a></li>\n  <li><a class="schools" ng-class="{\'sel\': activeTab == \'schools\'}" ng-click="changeTab(\'schools\')"><span class="i"></span><span class="txt">Schools</span></a></li>\n  <li><a class="accounts" ng-class="{\'sel\': activeTab == \'accounts\'}" ng-click="changeTab(\'accounts\')"><span class="i"></span><span class="txt">Accounts</span></a></li>  \n  <li ng-if="!isMacApp"><a class="about" ng-class="{\'sel\': activeTab == \'about\'}" ng-click="changeTab(\'about\')"><span class="i"></span><span class="txt">About</span></a></li>\n</ul>\n<div class="lightbox-content settings-content" ng-switch="activeTab">\n  <homework-settings ng-switch-default></homework-settings>\n  <class-settings ng-switch-when="classes"></class-settings>\n  <calendar-settings ng-switch-when="calendar"></calendar-settings>\n  <school-settings ng-switch-when="schools"></school-settings>\n  <account-settings ng-switch-when="accounts"></account-settings>\n  <about-settings ng-switch-when="about"></about-settings>\n</div>\n<spinner ng-if="saveSpinner.show" spinner-text="{{ saveSpinner.text }}"></spinner>'),a.put("templates/teachers/teacher-info.html",'<div class="box-content teacher-info">\n  <div class="teacher-snippet" ng-class="{\'has-img\': activeTeacher.localAvatar}">\n    <img ng-src="{{ activeTeacher.localAvatar }}" alt="Teacher Picture" ng-if="activeTeacher.localAvatar" />\n    <span class="s-icon account" ng-if="!activeTeacher.localAvatar"></span>\n    <div class="teacher-details">\n      <div class="teacher-name">{{ activeTeacher.name }}</div>\n      <div class="teacher-info" ng-if="activeTeacher.title"><span>{{ activeTeacher.title }}</span></div>\n    </div>\n  </div>\n  <a href="https://teachers.io/{{ ::activeTeacher.username }}" target="_blank" class="image-link">View Teachers.io Profile<span class="icon next"></span></a>\n</div>'),a.put("templates/teachers/teachers-list.html",'<ul class="teachers-list">\n  <li ng-repeat="teacher in teachers track by teacher.id" class="teacher-row teacher-snippet" ng-click="openTeacher(teacher)">\n    <img ng-src="{{ teacher.localAvatar }}" alt="Teacher Picture" ng-if="teacher.localAvatar" />\n    <span class="teacher-pic-icon" ng-if="teacher.avatar && !teacher.localAvatar">\n      <lazy-image lazy-src="{{ teacher.avatar }}"></lazy-image>\n    </span>\n    <span class="s-icon account" ng-if="!teacher.avatar"></span>\n    <div class="teacher-details" ng-class="{\'no-title\': !teacher.title }">\n      <div class="teacher-name">{{ teacher.name }}</div>\n      <div class="teacher-info" ng-if="teacher.title"><span>{{ teacher.title }}</span></div>\n    </div>\n    <button class="alt-button" ng-hide="findButtonDisabled">Find Your Class<span class="icon next"></span></button>\n  </li>\n</ul>'),a.put("templates/teachers/teachers.html",'<div ng-class="{\'left-col\': activeTeacher || (!isMacApp && !isSmallSize), \'full-col\': (isMacApp || isSmallSize) && !activeTeacher }" ng-if="userTeachers">\n  <div class="box overflow">\n    <h2 class="box-title">Teachers</h2>\n    <a class="box-title-button no-drag-area" ng-if="user" ng-click="addTeacher()"><span class="icon add" tooltip-placement="left" tooltip="Find Teacher"></span></a>\n    <div class="empty-box-content" ng-if="!userTeachers || userTeachers.length == 0">\n      <span class="m-icon blue teachers"></span>\n      <div class="empty-content">\n        <p>Teachers.io allows teachers to enter class info and assignments so you don\'t have to! Your teachers will display here.</p>\n        <p ng-if="user">Start by searching for your teacher and joining their class.</p>\n        <button ng-click="addTeacher()" ng-if="user">Find my teacher</button>\n        <p ng-if="!user"><a href="#/signup">Sign up</a> now to join your teacher\'s class.</p>\n      </div>\n    </div>\n    <ul class="box-content teachers-list" ng-if="userTeachers && userTeachers.length > 0">\n      <li ng-repeat="teacher in userTeachers track by teacher.id" class="teacher-row teacher-snippet" ng-click="openTeacher(teacher)" ng-class="{\'active\': activeTeacher && teacher.id == activeTeacher.id }">\n        <img ng-src="{{ teacher.localAvatar }}" alt="Teacher Picture" ng-if="teacher.localAvatar" />\n        <span class="s-icon account" ng-if="!teacher.localAvatar"></span>\n        <div class="teacher-details">\n          <div class="teacher-name">{{ teacher.name }}</div>\n          <div class="teacher-info" ng-if="teacher.title"><span>{{ teacher.title }}</span></div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n<one-col ng-if="!activeTeacher"></one-col>\n<draggable-cols ng-if="activeTeacher && userTeachers"></draggable-cols>\n<div ng-if="activeTeacher" class="teacher-sec has-toolbar {{activeTab}}" ng-switch="activeTab" ng-class="{\'right-col\': (userTeachers && activeTeacher) || (!userTeachers && !activeTeacher), \'full-col\': !((userTeachers && activeTeacher) || (!userTeachers && !activeTeacher))}">\n  <ul class="toolbar" ng-class="{\'four\': !isMacApp }">\n    <li><a class="contact" ng-class="{\'sel\': activeTab == \'contact\'}" ng-click="changeTab(\'contact\')" tooltip="Contact" tooltip-enable="isMacApp"><span class="i"></span><span><span>Contact</span></a></li>\n    <li><a class="about" ng-class="{\'sel\': activeTab == \'about\'}" ng-click="changeTab(\'about\')" tooltip="About" tooltip-enable="isMacApp"><span class="i"></span><span><span>About</span></a></li>\n    <li><a class="classes" ng-class="{\'sel\': activeTab == \'classes\'}" ng-click="changeTab(\'classes\')" tooltip="Classes" tooltip-enable="isMacApp"><span class="i"></span><span>Classes</span></a></li>\n    <li><a class="announcements" ng-class="{\'sel\': activeTab == \'announcements\'}" ng-click="changeTab(\'announcements\')" tooltip="Announcements" tooltip-enable="isMacApp"><span class="i"></span><span>Announcements</span></a></li>\n  </ul>\n  <teacher-contact ng-switch-default></teacher-contact>\n  <teacher-about ng-switch-when="about"></teacher-about>\n  <teacher-classes ng-switch-when="classes"></teacher-classes>\n  <teacher-announcements ng-switch-when="announcements"></teacher-announcements>\n  <spinner ng-if="fetchSpinner.show" spinner-text="{{ fetchSpinner.text }}"></spinner>\n</div>'),a.put("templates/teachers/view-about.html",'<div class="box">\n  <h2 class="box-title">Teacher About</h2>\n  <div class="box-scroll">\n    <teacher-info></teacher-info>\n    <div class="box-content" ng-if="activeTeacher.about || activeTeacher.education || activeTeacher.awards || activeTeacher.publications">\n      <div ng-if="activeTeacher.about" class="rich-text-editor-content" ng-bind-html="activeTeacher.about"></div>\n      <div ng-if="activeTeacher.education">\n        <h3 class="h5">Education</h3>\n        <ul>\n          <li ng-repeat="education in activeTeacher.education track by $index">\n            <span ng-if="education.typeTitleYear">{{ education.typeTitleYear }}</span>\n            <a ng-if-"education.schoolSlug && education.schoolName" href="#/schools/{{ education.schoolSlug }}">{{ education.schoolName }}</a>\n          </li>\n        </ul>\n      </div>\n      <div ng-if="activeTeacher.awards">\n        <h3 class="h5">Awards</h3>\n        <ul>\n          <li ng-repeat="award in activeTeacher.awards track by $index">\n            <span ng-if="award.titleYear">{{ award.titleYear }}</span><br>\n            <a ng-if="award.url" href="{{ award.url }}" target="_blank">{{ award.url }}</a>\n          </li>\n        </ul>\n      </div>\n      <div ng-if="activeTeacher.publications">\n        <h3 class="h5">Publications</h3>\n        <ul>\n          <li ng-repeat="publication in activeTeacher.publications track by $index">\n            <span ng-if="publication.title">{{ publication.title }}</span><br>\n            <a ng-if="publication.url" href="{{ publication.url }}" target="_blank">{{ publication.url }}</a>\n          </li>\n        </ul>\n      </div>\n    </div>\n    <div class="empty-box-content no-icon" ng-if="!activeTeacher.about && !activeTeacher.education && !activeTeacher.awards && activeTeacher.publications">\n      <div class="empty-content">\n       <p>This teacher hasn\'t shared any about information.</p>\n      </div>\n    </div>   \n  </div>\n</div>'),a.put("templates/teachers/view-announcements.html",'<div class="box">\n  <h2 class="box-title">Teacher Announcements</h2>\n  <div class="box-scroll">\n    <teacher-info></teacher-info>\n    <div class="empty-box-content no-icon" ng-if="!announcements">\n      <div class="empty-content" ng-if="isUserTeacher">This teacher hasn\'t shared any announcements for the classes you\'ve joined.</div>\n      <div class="empty-content" ng-if="!isUserTeacher">Join one of this teacher\'s classes to see any announcements.</div>\n    </div>\n    <ul class="box-content announcements-list" ng-if="announcements">\n      <li ng-repeat="announcement in announcements track by announcement.id" class="ann">\n        <div class="ann-text">\n          <span class="unread" ng-if="!announcement.isRead">Unread:</span>\n          <span ng-bind-html="announcement.textHTML" ng-if="announcement.textHTML"></span>\n          <span ng-if="!announcement.textHTML">{{ announcement.text }}</span>\n        </div>\n        <div class="ann-date">{{ announcement.created | date:\'MMMM d - h:mm a\' }}</div>\n        <ul class="ann-classes inline" ng-if="announcement.classes">\n          <li ng-repeat="cls in announcement.classes track by cls.id">\n            <a href="#/classes/{{cls.id}}">{{ cls.name }}</a>\n          </li>\n        </ul>\n      </li>\n    </ul>\n  </div>\n</div>'),a.put("templates/teachers/view-classes.html",'<div class="box">\n  <h2 class="box-title">Teacher Classes</h2>\n  <div class="box-scroll">\n    <teacher-info></teacher-info>\n    <div class="empty-box-content no-icon" ng-if="!teacherTerms">\n      <div class="empty-content">This teacher doesn\'t have any joinable classes.</div>\n    </div>\n    <ul ng-repeat="term in teacherTerms track by $index" class="box-content terms-list">\n      <li id="group-{{ ::term.id }}" class="group-row group-{{ ::term.id }}" ng-click="toggleGroup(term)">\n        <span class="group-title">{{ term.title }}</span>\n        <span class="icon"></span>\n      </li>\n      <li ng-repeat="class in term.classes track by $index" class="class-row group-{{ ::term.id }}">\n        <a href="#/teachers/id/{{ activeTeacher.id }}/classes/{{ class.id }}" ng-if="!class.isLeaveable">{{ class.name }}</h3>\n        <a href="#/classes/{{ class.id }}" ng-if="class.isLeaveable">{{ class.name }}</a>\n        <p class="class-dates">{{ class.dates }}</p>\n        <p ng-if="class.cnj">Contact the teacher to join or leave this class.</p>\n        <button class="alt-button join-button" ng-if="!class.cnj && class.isLeaveable && !class.hideJoinOption" ng-click="leaveClass(class)">Leave Class</button>\n        <button class="button join-button" ng-if="!class.cnj && !class.isLeaveable && class.isJoinable && !hideJoinOption" ng-click="joinClass(class)">Join Class</button>\n      </li>\n    </ul>\n  </div>\n</div>'),a.put("templates/teachers/view-contact.html",'<div class="box">\n  <h2 class="box-title">Teacher Contact</h2>\n  <div class="box-scroll">\n    <teacher-info></teacher-info>\n    <div class="box-content" ng-if="activeTeacher.schools">\n      <div ng-repeat="school in activeTeacher.schools track by school.schoolSlug" class="teacher-schools">\n        <h4 class="h5"><a href="#/schools/{{ school.schoolSlug }}">{{ school.schoolName }}</a></h4>\n        <p ng-if="school.title">{{ school.title }}</p>\n        <p ng-if="school.website"><a href="{{ school.website.u }}" target="_blank"><span ng-if="school.website.d">{{ school.website.d }}</span><span ng-if="!school.website.d">{{ school.website.u }}</span></a></p>\n        <dl class="inline medium">\n          <dt ng-if="school.email">Email</dt><dd ng-if="school.email"><a class="email" href="mailto:{{ school.email}}" target="_blank">{{ school.email }}</a></dd>\n          <dt ng-if="school.phone">Phone Number</dt><dd ng-if="school.phone">{{ school.phone }}</dd>\n          <dt ng-if="school.altPhone">Alternate Number</dt><dd ng-if="school.altPhone">{{ school.altPhone }}</dd>\n          <dt ng-if="school.officeLocation">Office Location</dt><dd ng-if="school.officeLocation">{{ school.officeLocation }}</dd>\n          <dt ng-if="school.officeHours">Office officeHours</dt><dd ng-if="school.officeHours" class="pre">{{ school.officeHours }}</dd>\n        </dl>\n      </div>\n    </div>\n    <div class="box-content" ng-if="activeTeacher.contactInfo">\n      <p>{{ activeTeacher.contactInfo.title }}</p>\n      <p ng-if="activeTeacher.contactInfo.website"><a href="{{ activeTeacher.contactInfo.website.u }}" target="_blank"><span ng-if="activeTeacher.contactInfo.website.d">{{ activeTeacher.contactInfo.website.d }}</span><span ng-if="!activeTeacher.contactInfo.website.d">{ activeTeacher.contactInfo.website.u }}</span></a></p>\n      <p ng-if="activeTeacher.contactInfo.location">{{ activeTeacher.contactInfo.location }}</p>\n      <p ng-if="activeTeacher.contactInfo.email"><a class="email" href="mailto:{{ activeTeacher.contactInfo.email}}" target="_blank">{{ activeTeacher.contactInfo.email }}</a></p>\n    </div>\n  </div>\n</div>'),a.put("templates/themes/custom-theme.html",'<style type="text/css" ng-if="hasCustomTheme">\n  body, body.is-latest-mac {\n    background-image: url(\'{{ bgImage }}\');\n  }\n\n  a {\n    color: #{{ primaryColor }};\n  }\n\n  blockquote {\n    border-color: #{{ primaryColor }};\n  }\n\n  .main-nav .logo, .main-nav .sign-link, .main-nav .themes-link, .main-nav ul a, .toolbar li a, .main-nav .sync-btn, .main-nav .sync-btn .icon {\n    color: #{{ menuTextColor }};\n  }\n\n  .icon {\n    color: #{{ primaryColor }};\n  }\n\n  .m-icon {\n    color: #{{ menuTextColor }};\n  }\n\n  .s-icon {\n    color: #{{ primaryColor }};\n    border-color: #{{ primaryColor }};\n  }\n\n  .nav-btn-bar {\n    background-color: #{{ menuTextColor }};\n  }\n\n  .m-icon.blue {\n    color: #{{ primaryColor }};\n  }\n\n  input:focus, textarea:focus, select:focus, .file-picker.drag-over, .input.focus .selector, .input.focus input[type=text]{\n    border-color: #{{ primaryColor }};\n  }\n\n  .file-picker-progress span {\n    background-color: #{{ primaryColor }};\n  }\n\n  .box .box-title a {\n    color: #{{ primaryColor }};\n  }\n\n  .button, button {\n    background-color: #{{ primaryColor }};\n  }\n\n  .alt-button, button.alt-button,  button.alt-button .icon, .alt-button .icon, .link, .tpp .tpp-cancel, .tpp .tpp-retake {\n    color: #{{ primaryColor }};\n  }\n\n  .resources-list .resource a.image-link:hover .icon {\n    color: #{{ primaryColor }} !important; \n  }\n\n  .tabs li.sel, .vertical-tabs li.sel {\n    border-bottom-color: #{{ primaryColor }};\n  }\n\n  .filters li.sel a , .filters .radio.checked label, .filter-button.sel {\n    background-color: #{{ primaryColor }};\n  }\n\n  .spinner-bar {\n    border-left-color: #{{ primaryColor }};\n  }\n\n  .week-calendar .box-content.homework-list li.group-row.today {\n    color: #{{ primaryColor }};\n  }\n\n  .ui-datepicker-calendar th, .ui-datepicker-today .ui-state-default {\n    color: #{{ primaryColor }};\n  }\n\n  .ui-state-default.ui-state-active, .ui-datepicker-today .ui-state-default.ui-state-active, .ui-state-default.ui-state-highlight {\n    background-color: #{{ primaryColor }};\n  }\n\n  .homework-list .h-actions .icon:hover {\n    color: #{{ primaryColor }};\n  }\n\n  .class-schedule .days.d1 span.d1,\n  .class-schedule .days.d2 span.d2,\n  .class-schedule .days.d3 span.d3,\n  .class-schedule .days.d4 span.d4, \n  .class-schedule .days.d5 span.d5, \n  .class-schedule .days.d6 span.d6, \n  .class-schedule .days.d7 span.d7 {\n    background-color: #{{ primaryColor }};\n  }\n\n  .delete-class-time .del-btn {\n    color: #{{ primaryColor }};\n  }\n\n  .announcements-list .unread {\n    background-color: #{{ primaryColor }};\n  }\n\n  .teacher-profile .image-link {\n    color: #{{ primaryColor }};\n  }\n\n  .accounts-list .active.premium {\n    background-color: #{{ primaryColor }};\n  }\n\n  .settings-tabs li a.sel, .block-setting a.remove-block:hover .icon {\n    color: #{{ primaryColor }};\n  }\n\n  .mac-app .calendar-filters .filters.month .radio.month .icon,\n  .mac-app .calendar-filters .filters.week .radio.week .icon,\n  .mac-app .calendar-filters .filter-button.sel .icon {\n    color: #{{ primaryColor }};\n  }\n\n  .mac-app .instinad.themead {\n    background-color: #{{ primaryColor }};\n  }\n\n  .update-message a {\n    color: #{{ primaryColorLight }};\n  }\n\n  @media (max-width: 768px) {\n    .nav-btn-bar { \n      background-color: #{{ menuTextColor }};\n    }\n  }\n\n  @media (max-width: 600px) {\n    .nav-btn.alt .nav-btn-bar {\n      background-color: #{{ primaryColor }};\n    }\n  }\n</style>\n<style type="text/css" ng-if="hasCustomTheme && !isMacApp">\n  .filters.all .radio.all label,  \n  .filters.class .radio.class label, \n  .filters.priority .radio.priority label,\n  .filters.type .radio.type label,\n  .filters.month .radio.month label, \n  .filters.week .radio.week label,\n  .filters.today .radio.today label,\n  .filters.tomorrow .radio.tomorrow label {\n     background-color: #{{ primaryColor }};\n  }\n\n  .filters .radio .txt {\n    color: #{{ primaryColor}};\n  }\n\n  @media (max-width: 1050px) {\n    body {\n      background-image: url(\'{{ bgImageMedium }}\');\n    }\n  }\n\n  @media (max-width: 600px) {\n    body {\n      background-image: url(\'{{ bgImageSmall }}\');\n    }\n  }\n</style>\n<style type="text/css" ng-if="hasCustomTheme && isMacApp && hasSmallBg">    \n  body, body.is-latest-mac {\n    background-position: 0;\n    background-size: contain;\n  }\n\n  .left-col .instinad, .full-col .instinad {\n    background-color: #{{ primaryColor }};\n  }\n</style>'),a.put("templates/themes/preview.html",'<div class="lightbox-header alt-header theme">\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content theme">\n  <div class="theme-preview">\n'+"    <span ng-style=\"{'background-image': 'url(' + previewURL + ')'}\"></span>\n  </div>\n</div>"),a.put("templates/themes/theme.html",'<div class="lightbox-header alt-header theme">\n  <h2 ng-style="{\'color\': \'#\' + theme.thx }">{{ theme.sd }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()" ng-style="{\'color\': \'#\' + theme.thx }">Close</a>\n</div>\n<div class="lightbox-content theme">\n  <div class="theme-details">\n    <lazy-image class="theme-bg" lazy-src="{{ theme.lbg }}" lazy-bg-img="true" spinner-color="{{ theme.phx }}"></lazy-image>\n    <div class="theme-info">\n      <span class="alt-button" ng-if="user.theme && user.theme.i == theme.i" ng-style="{\'color\': \'#\' + theme.phx }">Current</span>\n      <span class="button" ng-if="theme.priceDisplay && !theme.purchased && !(user.theme && user.theme.i == theme.i)" ng-click="purchaseTheme(theme)" ng-style="{\'background-color\': \'#\' + theme.phx }">Upgrade</span>\n      <span class="button" ng-if="!user.norwds && user.upts && !theme.purchased && !(user.theme && user.theme.i == theme.i)" ng-click="usePoints(theme)" ng-style="{\'background-color\': \'#\' + theme.phx }">Use {{ user.upts.ppthm }} Points</span>\n      <span class="button" ng-if="!theme.priceDisplay && (user.isPremiumOrSchoolAccount || theme.purchased || !theme.iap) && !(user.theme && user.theme.i == theme.i)" ng-click="applyTheme(theme)" ng-style="{\'background-color\': \'#\' + theme.phx }">Apply</span>\n    </div>\n    <div class="theme-extra" ng-style="{\'background-color\': \'#\' + theme.phx, \'color\': \'#\' + theme.thx, \'border-bottom\': \'1px solid #\' + theme.phx }">\n      <p ng-if="theme.ld">{{ theme.ld }}</p>\n      <button ng-if="theme.tpv" ng-click="openPreview(theme.tpv)" class="button">Preview</button>\n      <a ng-if="theme.crdu && theme.crdb" href="{{ theme.crdu }}" target="_blank" class="credit" ng-style="{\'color\': \'#\' + theme.thx }">{{ theme.crdb }}</a>\n      <span ng-if="!theme.crdu && theme.crdb" class="credit" ng-style="{\'color\': \'#\' + theme.thx }">{{ theme.crdb }}</span>\n    </div>\n  </div>\n</div>\n<spinner ng-if="applyingTheme"></spinner>'),a.put("templates/themes/themes.html",'<div class="lightbox-header themes" ng-class="{\'center-title\': themeLevel != 0}">\n  <a class="lightbox-back no-drag-area" ng-if="themeLevel != 0" ng-click="goBack()"><span class="icon prev"></span>Back</a>\n  <h2>{{ themeLevelTitle }}</h2>\n  <a class="lightbox-close close" ng-click="cancel()">Close</a>\n</div>\n<div class="lightbox-content themes" ng-class="{\'has-back\': themeLevel != 0}">\n  <carousel class="featured-themes" ng-if="loadingThemes || featuredThemes && themeLevel == 0" interval="5000">\n    <slide ng-repeat="featured in featuredThemes track by $index">\n      <span ng-if="featured.i != \'upgrade\' && featured.tft" ng-click="openTheme(featured)" class="featured-theme">\n        <lazy-image lazy-src="{{ featured.tft }}"></lazy-image>\n      </span>\n      <span ng-if="featured.i != \'upgrade\' && !featured.tft && featured.mft" ng-click="openTheme(featured)" class="featured-theme">\n        <lazy-image lazy-src="{{ featured.mft }}"></lazy-image>\n      </span>\n      <span ng-if="featured.i == \'upgrade\'" ng-click="openTheme(featured)" class="featured-theme">\n        <img src="imgs/themes-upgrade.jpg"/>\n      </span>\n    </slide>\n  </carousel>\n  <ul class="themes-list" ng-repeat="themesLevel in availableThemes track by $index" ng-if="$index == themeLevel">    \n    <li ng-repeat="theme in themesLevel track by theme.i">\n      <span ng-if="theme.typ == 1 && theme.l && theme.l.length > 0" class="theme-row" ng-class="{\'has-img\': theme.typ == 1 && theme.img}" ng-click="openFolder(theme)">\n        <span class="theme-icon" ng-if="theme.img">\n          <lazy-image lazy-src="{{theme.img}}"></lazy-image>\n        </span>\n        <span class="theme-title">{{ theme.d }}</span>\n        <span class="icon next b"></span>\n      </span>\n      <span ng-if="theme.typ == 2" class="theme-row" ng-class="{\'has-img\': theme.typ == 2 && theme.li}" ng-click="openTheme(theme)">\n        <span class="theme-icon" ng-if="theme.li">\n          <lazy-image lazy-src="{{theme.li}}"></lazy-image>\n        </span>\n        <span class="theme-title">{{ theme.sd }}</span>\n      </span>\n      <span class="alt-button" ng-if="theme.typ == 2 && user.theme && user.theme.i == theme.i" ng-class="{\'has-img\': theme.li}">Current</span>\n      <span class="button" ng-if="theme.typ == 2 && theme.priceDisplay && !theme.purchased && !(user.theme && user.theme.i == theme.i)" ng-class="{\'has-img\': theme.li}" ng-click="purchaseTheme(theme)">Upgrade</span>\n      <span class="button" ng-if="theme.typ == 2 && !theme.priceDisplay && (user.isPremiumOrSchoolAccount || theme.purchased || !theme.iap) && !(user.theme && user.theme.i == theme.i)" ng-class="{\'has-img\': theme.li}" ng-click="applyTheme(theme)">Apply</span>\n    </li>\n  </ul>\n  <a class="restore-link" ng-if="canRestoreThemes && themeLevel == 0" ng-click="restoreThemes()">Restore Purchases</a>\n  <spinner ng-if="loadingThemes" spinner-text="{{ loadingThemesText }}"></spinner>\n</div>\n<spinner ng-if="applyingTheme"></spinner>')}]);var sa={templateUrl:"templates/home.html",controller:"HomeCtrl",title:"Home"};U.isMacModalWindow()&&U.updateMainRouteToModal(sa),ra.config(["$routeProvider",function(a){a.when("/",sa).when("/account",sa).when("/settings",sa).when("/about",sa).when("/login",{templateUrl:"templates/account/login.html",controller:"LoginCtrl",title:"Login"}).when("/signup",{templateUrl:"templates/account/signup.html",controller:"SignupCtrl",title:"Sign up"}).when("/signup/account-choice",{templateUrl:"templates/account/account-choice.html",controller:"AccountChoiceCtrl",title:"Account Choice"}).when("/signup/myHomework",{templateUrl:"templates/account/create-account.html",controller:"CreateAccountCtrl",title:"Create Account"}).when("/classes/:classId/:tab?",{templateUrl:"templates/classes/view-class.html",controller:"ViewClassCtrl",title:"View Class"}).when("/classes",{templateUrl:"templates/classes/classes.html",controller:"ClassesCtrl",title:"Classes"}).when("/homework",{templateUrl:"templates/homework/homeworks.html",controller:"HomeworksCtrl",title:"Homeworks"}).when("/calendar/week/:date?",{templateUrl:"templates/calendar/week-calendar.html",controller:"WeekCalendarCtrl",title:"Week Calendar"}).when("/calendar/:date?",{templateUrl:"templates/calendar/calendar.html",controller:"CalendarCtrl",title:"Calendar"}).when("/teachers/id/:teacherId/classes/:classId/:tab?",{templateUrl:"templates/classes/view-class.html",controller:"TeacherClassCtrl",title:"Teacher Class (Before Joining)"}).when("/teachers/id/:teacherId?/:tab?",{templateUrl:"templates/teachers/teachers.html",controller:"TeachersCtrl",title:"Teachers"}).when("/teachers/:username?/:tab?",{templateUrl:"templates/teachers/teachers.html",controller:"TeachersCtrl",title:"Teachers"}).when("/schools/:slug?/:tab?",{templateUrl:"templates/schools/view-school.html",controller:"SchoolCtrl",skipAnalytics:!0}).when("/announcements",{templateUrl:"templates/announcements/announcements.html",controller:"AnnouncementsCtrl",title:"Announcements"}).when("/iframe",{templateUrl:"templates/iframe-view.html",controller:"FrameCtrl",title:"WebView"}).otherwise({redirectTo:"/"})}]);var ta,ua;e(),ra.run(["$rootScope","$injector",function(a,b){b.invoke(function(){b.has("$route")&&a.$on("$routeChangeSuccess",function(a,b){b&&(b.$$route||b).redirectTo||b.$$route.skipAnalytics||(b.$$route&&b.$$route.title&&b.$$route.title.length>0?ua.sendAppView(b.$$route.title):b.$$route&&b.$$route.controller&&ua.sendAppView(b.$$route.controller))})})}]),ra.directive("autofocus",["$timeout",function(a){return{restrict:"A",link:function(b,c){a(function(){c[0].focus()})}}}]),ra.directive("validatetime",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.validatetime=function(a,b){return d.$isEmpty(a)||d.$isEmpty(b)?!0:K.isDateValid(J.parseTimeStr(b))?!0:!1}}}}),ra.directive("reallyRequired",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.reallyRequired=function(a,b){return d.$isEmpty(b)?!1:0==b.replace(/\s/g,"").length?!1:!0}}}}),ra.directive("validateage",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.validateage=function(a,b){if(d.$isEmpty(a)||d.$isEmpty(b))return!0;var c=0;if(a instanceof Date){var e=new Date,f=a,c=e.getFullYear()-f.getFullYear(),g=e.getMonth()-f.getMonth();(0>g||0===g&&e.getDate()<f.getDate())&&c--}else if(c=parseInt(a),NaN==c)return!1;return c>=13&&120>c?!0:!1}}}}),ra.directive("validateDateRange",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.daterange=function(a,b){return d.$isEmpty(a)||d.$isEmpty(b)?!0:K.isDateValid(a)&&a.getUTCFullYear()&&a.getUTCFullYear()>=2e3&&a.getUTCFullYear()<2050?!0:!1}}}}),ra.directive("scopeElement",function(){return{restrict:"A",replace:!1,link:function(a,b,c){a[c.scopeElement]=b[0]}}}),ra.directive("whenReady",["$interpolate",function(a){return{restrict:"A",priority:Number.MIN_SAFE_INTEGER,link:function(b,c,d){function e(a){a.forEach(function(a){b.$eval(a)})}var f=d.whenReady.split(";"),g=!1,h=!1;0!==d.whenReady.trim().length&&(d.waitForInterpolation&&b.$eval(d.waitForInterpolation)&&(g=!0),d.readyCheck&&(h=!0),g||h?requestAnimationFrame(function i(){var j=!1,k=!1;j=g&&c.text().indexOf(a.startSymbol())>=0?!1:!0,k=h&&!b.$eval(d.readyCheck)?!1:!0,j&&k?e(f):requestAnimationFrame(i)}):e(f))}}}]),ra.directive("spinner",function(){return{restrict:"E",templateUrl:"templates/components/spinner.html",link:function(a,b,c){a.spinnerText=c.spinnerText,a.spinnerBarColor=c.spinnerColor&&c.spinnerColor.length>0?c.spinnerColor:null}}}),ra.directive("colorPicker",["$document",function(a){return{restrict:"EA",require:"ngModel",templateUrl:"templates/components/color-picker.html",scope:{isOpen:"=?"},link:function(b,c,d,e){b.colors=va;var f=function(a){b.isOpen&&a.target!==c[0]&&b.$apply(function(){b.isOpen=!1})},g=b.$watch("isOpen",function(b){b?a.bind("click",f):a.unbind("click",f)});b.selectColor=function(a,c){a.preventDefault(),a.stopPropagation(),b.selectedColor=c,b.isOpen=!1,e.$setViewValue(b.selectedColor),e.$render()},b.clearColor=function(a){a.preventDefault(),a.stopPropagation(),b.selectedColor=null,b.isOpen=!1,e.$setViewValue(b.selectedColor),e.$render()},c.on("$destroy",function(){g(),a.unbind("click",f)})}}}]),ra.directive("classColor",function(){return{restrict:"A",scope:!0,link:function(a,b,c){a.homework&&a.homework.classColor&&a.homework.classColor.h?b.css("border-left","5px solid #"+a.homework.classColor.h):a.cls&&a.cls.color&&a.cls.color.h&&b.css("border-left","5px solid #"+a.cls.color.h)}}});var va=[{h:"ffffff",c:"White"},{h:"cccccc",c:"Light Gray"},{h:"999999",c:"Gray"},{h:"666666",c:"Dark Gray"},{h:"333333",c:"Black"},{h:"99cc99",c:"Light Green"},{h:"669966",c:"Green"},{h:"336633",c:"Dark Green"},{h:"00ccff",c:"Aqua Blue"},{h:"66ccff",c:"Light Blue"},{h:"0099cc",c:"Blue"},{h:"006699",c:"Dark Blue"},{h:"003399",c:"Darker Blue"},{h:"9966cc",c:"Light Purple"},{h:"663399",c:"Purple"},{h:"330066",c:"Dark Purple"},{h:"ff66ff",c:"Bright Pink"},{h:"cc66cc",c:"Pink"},{h:"993399",c:"Dark Pink"},{h:"660066",c:"Darker Pink"},{h:"ff9999",c:"Lighter Red"},{h:"cc6666",c:"Light Red"},{h:"cc3333",c:"Red"},{h:"990000",c:"Dark Red"},{h:"f8ee32",c:"Yellow"},{h:"ffd700",c:"Dark Yellow"},{h:"f8941d",c:"Light Orange"},{h:"ff6600",c:"Orange"},{h:"c69c6d",c:"Light Brown"},{h:"8c6239",c:"Brown"},{h:"754c24",c:"Dark Brown"},{h:"603913",c:"Darker Brown"}];ra.directive("resourceItem",["$window",function(a){return{restrict:"A",templateUrl:function(){return j.isWindowsApp?"templates/components/resource-windows.html":"templates/components/resource.html"},require:"?ngModel",scope:{file:"=resourceItem",deleteEnabled:"=?"},link:function(b,c,d,e){b.isSyllabus=d&&"true"==d.isSyllabus?!0:!1,b.deleteAttachment=function(a,c){a.preventDefault(),a.stopPropagation(),b.$parent&&("function"==typeof b.$parent.deleteAttachment?b.$parent.deleteAttachment(c):"function"==typeof b.$parent.deleteSyllabus?b.$parent.deleteSyllabus(c):"function"==typeof b.$parent.deleteFile&&b.$parent.deleteFile(c))},b.openAttachment=function(b,c){b.preventDefault(),b.stopPropagation(),J.openURL(a,c.url)}}}}]),ra.filter("bytes",function(){return function(a,b){if(0===a)return"0 bytes";if(isNaN(parseFloat(a))||!isFinite(a))return"-";"undefined"==typeof b&&(b=1);var c=["bytes","kB","MB","GB","TB","PB"],d=Math.floor(Math.log(a)/Math.log(1024)),e=(a/Math.pow(1024,Math.floor(d))).toFixed(b);return(e.match(/\.0*$/)?e.substr(0,e.indexOf(".")):e)+" "+c[d]}}),ra.directive("fileUpload",["$window","$http","$rootScope","$timeout","$location","$modal","camera","filesAPI",function(a,b,c,d,e,f,h,i){return{restrict:"A",require:"ngModel",templateUrl:"templates/components/file-upload.html",
link:function(b,j,k,l){function m(b){for(var c="",d=new Uint8Array(b),e=d.byteLength,f=0;e>f;f++)c+=String.fromCharCode(d[f]);return a.btoa(c)}var n,o=angular.element("#file");b.fileDropAvailable=k&&"true"==k.fileDropDisabled?!1:g(),b.takePictureAvailable=!1,b.autoUpload=k&&"true"==k.autoUpload?!0:!1,b.showTitle=k&&"true"==k.showTitle?!0:!1,b.fileUpload={},d(function(){b.takePictureAvailable=k&&"true"==k.takePicDisabled?!1:h.isAvailable(),b.$$phase||b.$apply()},400),b.openFilePicker=function(){o.trigger("click")},b.openTakePicture=function(){b.takePictureAvailable&&h.takePicture().then(function(a){b.selectedFile.type=a.type,b.selectedFile.name=a.name,b.selectedFile.size=a.size,b.selectedFile.base64=a.base64,b.$apply()},function(){})},b.resetFilePicker=function(){n=null,n=new FileReader,n.onload=function(a){b.selectedFile.base64=m(a.target.result),b.$apply(),b.autoUpload&&b.uploadFile()},b.fileUpload={fileUploading:!1,uploadProgress:0,fileDescription:null,fileDescriptionError:null,filePickerError:null},b.selectedFile={},b.droppedFile=null,b.$$phase||b.$apply()},k&&k.defaultFileDescription&&(b.defaultFileDescription=k.defaultFileDescription,b.fileUpload.fileDescription=k.defaultFileDescription),b.resetFilePicker(),o.on("change",function(){var a=o[0].files[0],c=a.type&&a.type.length?a.type:null;if(a.name&&!c&&(a.name.indexOf(".gslides")>0?c="application/vnd.google-apps.presentation":a.name.indexOf(".gdoc")>0?c="application/vnd.google-apps.document":a.name.indexOf(".gsheet")>0?c="application/vnd.google-apps.spreadsheet":a.name.indexOf(".gform")>0?c="application/vnd.google-apps.document":a.name.indexOf(".gdraw")>0&&(c="application/vnd.google-apps.document")),a.name&&c){if(a.size&&a.size>6e6)return b.fileUpload.filePickerError="That file is too big. Uploads are limited to 6MB. You can try zipping it before uploading.",void b.$apply();b.selectedFile.type=c,b.selectedFile.name=a.name,b.selectedFile.size=a.size,n.readAsArrayBuffer(a),b.fileUpload.filePickerError=null}else c||(b.fileUpload.filePickerError="Sorry, we don't support that file type. You can try zipping it before uploading.",b.$apply())});var p=b.$watch("fileUpload.uploadProgress",function(a){b.progressWidth=function(){return{width:(b.fileUpload.uploadProgress||0)+"%"}}});b.uploadFile=function(){if(!c.user||!c.user.isPremiumOrSchoolAccount)return void nAlert({title:b.showTitle?"File Attachments":"File Uploads",text:b.showTitle?"You must have a premium myHomework account to attach files.":"You must have a premium myHomework account to upload files.",confirmButtonText:c.user?"Upgrade to Premium":"Sign up",showCancelButton:!0},function(a){a&&(c.user?(f.close(),f.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"})):J.openAppURL(e,"/signup"))});if(!b.selectedFile||!b.selectedFile.base64)return void(b.fileUpload.filePickerError="Please select a file.");if(!Y.supportedType(b.selectedFile.type))return void(b.fileUpload.filePickerError="Sorry, we don't support that file type. You can try zipping it before uploading.");if(b.selectedFile.size&&b.selectedFile.size>6e6)return void(b.fileUpload.filePickerError="That file is too big. Uploads are limited to 6MB. You can try zipping it before uploading.");if(b.fileUpload.filePickerError=null,b.fileUpload.fileDescription){if(b.fileUpload.fileDescription.length<3)return void(b.fileUpload.fileDescriptionError="File description must be at least 3 characters.");if(b.fileUpload.fileDescription.length>128)return void(b.fileUpload.fileDescriptionError="File description must be shorter than 128 characters.")}b.fileUpload.fileDescriptionError=null,i.uploadFile(b,l)};var q=b.$watch("droppedFile",function(a){a&&a.name&&a.type?(b.selectedFile.type=a.type,b.selectedFile.name=a.name,b.selectedFile.size=a.size,n.readAsArrayBuffer(a)):a&&(b.droppedFile=null)});b.closeFileUpload=function(){b.resetFilePicker(),b.$parent&&("function"==typeof b.$parent.hideAddAttachment?b.$parent.hideAddAttachment():"function"==typeof b.$parent.cancel?b.$parent.cancel():"function"==typeof b.cancel&&b.cancel())},b.$on("$destroy",function(){p(),q()})}}}]),ra.directive("pictureUpload",["$window","$http","$rootScope","$timeout","camera","filesAPI",function(a,b,c,d,e,f){return{restrict:"A",require:"ngModel",templateUrl:"templates/components/picture-upload.html",link:function(b,c,h,i){function j(){b.selectedFile&&b.selectedFile.base64?Y.supportedPictureType(b.selectedFile.type)?(b.fileUpload.filePickerError=null,i.$setViewValue(b.selectedFile)):(b.resetFilePicker(),b.fileUpload.filePickerError="Pictures must be in .png, .gif, or .jpeg format."):(b.resetFilePicker(),b.fileUpload.filePickerError="Please select a picture."),b.$$phase||b.$apply()}function k(b){for(var c="",d=new Uint8Array(b),e=d.byteLength,f=0;e>f;f++)c+=String.fromCharCode(d[f]);return a.btoa(c)}var l,m=angular.element("#file");b.fileDropAvailable=h&&"true"==h.fileDropDisabled?!1:g(),b.takePictureAvailable=!1,b.fileUpload={},d(function(){b.takePictureAvailable=h&&"true"==h.takePicDisabled?!1:e.isAvailable(),b.$$phase||b.$apply()},400),b.openFilePicker=function(){m.trigger("click")},b.openTakePicture=function(){b.takePictureAvailable&&e.takePicture().then(function(a){b.selectedFile.type=a.type,b.selectedFile.name=a.name,b.selectedFile.size=a.size,b.selectedFile.base64=a.base64,b.selectedFile.base64Image="data:"+a.type+";base64,"+a.base64,j()},function(){})},b.resetFilePicker=function(){l=null,l=new FileReader,l.onload=function(a){var c=k(a.target.result);b.selectedFile.base64=c,b.selectedFile.base64Image="data:"+b.selectedFile.type+";base64,"+c,j()},b.fileUpload={fileUploading:!1,uploadProgress:0,fileDescription:null,filePickerError:null},b.selectedFile={base64Image:"",croppedImage:""},b.droppedFile=null,b.$$phase||b.$apply()},b.resetFilePicker(),m.on("change",function(){var a=m[0].files[0];a.name&&a.type&&a.type.length?(b.selectedFile.type=a.type,b.selectedFile.name=a.name,b.selectedFile.size=a.size,l.readAsArrayBuffer(a)):a.type&&0!=a.type.length||(b.fileUpload.filePickerError="Pictures must be in .png, .gif, or .jpeg format",b.$apply())});var n=b.$watch("droppedFile",function(a){a&&a.name&&a.type?(b.selectedFile.type=a.type,b.selectedFile.name=a.name,b.selectedFile.size=a.size,l.readAsArrayBuffer(a)):a&&(b.droppedFile=null)}),o=b.$watch("fileUpload.uploadProgress",function(a){b.progress=function(){var a=b.fileUpload.uploadProgress||0;if(a>0){var c="";if(50>a){var d=90+3.6*a;c="linear-gradient(90deg, #fff 50%, transparent 50%, transparent), linear-gradient("+d+"deg, #555 50%, #fff 50%, #fff)"}else{var d=-90+3.6*(a-50);c="linear-gradient("+d+"deg, #555 50%, transparent 50%, transparent), linear-gradient(270deg, #555 50%, #fff 50%, #fff)"}}return{"background-image":c}}});b.uploadFile=function(){if(b.fileUpload.fileUploading=!0,b.selectedFile.croppedImage){var a=b.selectedFile.croppedImage.substring(22);b.selectedFile.base64=a,b.selectedFile.size=Math.round(.75*a.length)}d(function(){f.uploadFile(b,i)},1e3)},b.cancelPictureUpload=function(){b.resetFilePicker(),i.$setViewValue({})},b.$on("$destroy",function(){o(),n()})}}}]),ra.directive("fileDrop",["$parse","$timeout","$location",function(a,b,c){return{restrict:"A",require:"?ngModel",link:function(d,e,f,h){function i(a,d){var e=null,f=a.dataTransfer.items,g=0;if(f&&f.length>0&&"file"!=c.protocol())e=f[0].getAsFile();else{var h=a.dataTransfer.files;null!=h&&h.length>0&&(e=h[0])}var i=0;!function j(a){b(function(){g?10*i++<2e4&&j(10):d(e)},a||0)}()}if(g()){var j=null,k=a(f.stopPropagation)(d);e[0].addEventListener("dragover",function(a){a.preventDefault(),k&&a.stopPropagation();var c=a.dataTransfer.effectAllowed;a.dataTransfer.dropEffect="move"===c||"linkMove"===c?"move":"copy",b.cancel(j),e.addClass("drag-over")},!1),e[0].addEventListener("dragenter",function(a){a.preventDefault(),k&&a.stopPropagation()},!1),e[0].addEventListener("dragleave",function(a){j=b(function(){e.removeClass("drag-over")},1)},!1),e[0].addEventListener("drop",function(a){a.preventDefault(),k&&a.stopPropagation(),e.removeClass("drag-over"),i(a,function(a){b(function(){h&&h.$setViewValue(a)})})},!1)}}}}]),ra.factory("filesAPI",["$rootScope","$http","$timeout",function(a,b,c){return{uploadFile:function(d,e){var f={method:"POST",url:j.aurl+"private-files",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:{av:j.av,p:d.selectedFile.base64,c:d.selectedFile.type,n:d.selectedFile.name,t:d.fileUpload.fileDescription||d.selectedFile.name}};f.transformRequest=f.transformRequest||function(a,c){return window.ArrayBuffer&&a instanceof window.ArrayBuffer?a:b.defaults.transformRequest[0](a,c)},f.headers.__setXHR_=function(){return function(a){a&&(f.__XHR=a,f.xhrFn&&f.xhrFn(a),a.upload.addEventListener("progress",function(a){if(a.config=f,a.lengthComputable){var b=(a.loaded/a.total*100).toFixed(2);d.fileUpload.uploadProgress=b,d.$apply()}},!1))}},d.fileUpload.fileUploading=!0,b(f).success(function(a,b,f,g){200==b&&(d.selectedFile.croppedImage?c(function(){e.$setViewValue(Y.toUIFile(a)),d.resetFilePicker(),d.$$phase||d.$apply()},1e3):(e.$setViewValue(Y.toUIFile(a)),d.resetFilePicker(),d.$$phase||d.$apply()))}).error(function(a,b,c,e){if(d.resetFilePicker(),d.$$phase||d.$apply(),400==b){if(a.error_description)return void nAlert({title:"File upload failed",text:a.error_description})}else if(413==b&&a.msg)return void nAlert({title:"File upload failed",text:a.msg});navigator.onLine?nAlert({html:"We couldn't upload your file at this time.<br>Please try again in a few minutes."}):nAlert({html:"We couldn't upload your file at this time.<br>Please make sure you have internet connection and try again."})})}}}]),window.XMLHttpRequest&&!window.XMLHttpRequest.__isFileAPIShim&&f("setRequestHeader",function(a){return function(b,c){if("__setXHR_"===b){var d=c(this);d instanceof Function&&d(this)}else a.apply(this,arguments)}}),ra.factory("camera",function(){function a(){return new Promise(function(a,b){var c=new Windows.Media.Capture.CameraCaptureUI;c.captureFileAsync(Windows.Media.Capture.CameraCaptureUIMode.photo).then(function(c){c?c.getBasicPropertiesAsync().then(function(d){Windows.Storage.FileIO.readBufferAsync(c).then(function(b){a({type:c.contentType,name:c.name,size:d.size,base64:Windows.Security.Cryptography.CryptographicBuffer.encodeToBase64String(b)})},function(){b()})},function(){b()}):b()},function(){b()})})}function b(){return new Promise(function(a,b){MacApp.Window.takePicture(function(c){c&&c.detail&&c.detail.length>0?a({type:"image/png",name:"picture.png",size:Math.round(3*c.detail.length/4),base64:c.detail}):b()})})}function c(){return new Promise(function(a,b){function c(){i.pause(),navigator.mozGetUserMedia?i.mozSrcObject=null:i.src="",r.stop(),r=null}function e(a,b){if(+a.style.opacity<1){b=b||16,a.style.opacity=0,a.style.display="block";var c=+new Date,d=function(){a.style.opacity=+a.style.opacity+(new Date-c)/100,c=+new Date,+a.style.opacity<1&&setTimeout(d,b)};d()}a.style.display="block"}d();var f=document.createElement("div");f.id="take-picture-popup",f.innerHTML='<div class="tpp-overlay"></div><div class="tpp"><video class="tpp-video"></video><canvas class="tpp-canvas"></canvas><div class="tpp-buttons take"><button class="tpp-take">Take Picture</button><button class="tpp-cancel">Cancel</button></div><div class="tpp-buttons confirm"><button class="tpp-use">Use This Picture</button><button class="tpp-retake">Retake</button></div></div>',document.body.appendChild(f);var g=document.querySelector(".tpp-overlay"),h=document.querySelector(".tpp"),i=document.querySelector(".tpp-video"),j=document.querySelector(".tpp-canvas"),k=document.querySelector(".tpp-buttons.take"),l=document.querySelector(".tpp-buttons.confirm"),m=document.querySelector(".tpp-take"),n=document.querySelector(".tpp-cancel"),o=document.querySelector(".tpp-use"),p=document.querySelector(".tpp-retake"),q=!1,r=null,s=500,t=0;navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia({video:!0,audio:!1},function(a){if(navigator.mozGetUserMedia)i.mozSrcObject=a;else{var b=window.URL||window.webkitURL;i.src=b.createObjectURL(a)}r=a,i.play()},function(a){J.logError(a),b()}),i.addEventListener("canplay",function(a){q||(t=i.videoHeight/(i.videoWidth/s),i.setAttribute("width",s),i.setAttribute("height",t),j.setAttribute("width",s),j.setAttribute("height",t),h.style.height=t+"px",h.style.marginTop=0-t/2+"px",q=!0,setTimeout(function(){e(g,5),h.style.display="block"},100))},!1),m.addEventListener("click",function(a){j.getContext("2d").drawImage(i,0,0,s,t);j.toDataURL("image/png");k.style.display="none",l.style.display="block"}),p.addEventListener("click",function(a){j.getContext("2d").clearRect(0,0,s,t),k.style.display="block",l.style.display="none"}),o.addEventListener("click",function(e){var f=j.toDataURL("image/png");f?a({type:"image/png",name:"picture.png",size:Math.round(3*(f.length-22)/4),base64:f.substring(22)}):b(),c(),d()}),n.addEventListener("click",function(a){c(),d(),b()})})}function d(){var a=document.getElementById("take-picture-popup");a&&a.parentNode.removeChild(a)}var e=!1;return!navigator.getMediaDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.getMediaDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.getMediaDevices&&navigator.enumerateDevices&&(navigator.getMediaDevices=navigator.enumerateDevices.bind(navigator)),navigator.getMediaDevices&&navigator.getMediaDevices(function(a){for(var b in a){var c=a[b];if("videoinput"==c.kind||"video"==c.kind){e=!0;break}}}),{takePicture:function(){return j.isWindowsApp?a():j.isMacApp?b():c()},isAvailable:function(){return j.isWindowsApp||j.isMacApp?!0:j.isChromeApp?!1:e}}}),ra.factory("imageCache",["$window","$http",function(a,b){function c(a){return new Promise(function(b,c){j.isWebApp?b(a):j.isChromeApp?g(a).then(function(a){b(a)},function(){b(a)}):j.isMacApp?i(a).then(function(a){b(a)},function(){b(a)}):j.isWindowsApp?l(a).then(function(a){b(a)},function(){b(a)}):d(a).then(function(a){b(a)},function(){b(a)})})}function d(a){return new Promise(function(c,d){var g=f(a);return g?void b.get(a,{responseType:"arraybuffer"}).success(function(a,b,f,h){if(a){var i=e(a);if(i.length)return void c("data:"+g+";base64,"+i)}d()}).error(function(a,b,c,e){d()}):void d()})}function e(b){for(var c="",d=new Uint8Array(b),e=d.byteLength,f=0;e>f;f++)c+=String.fromCharCode(d[f]);return a.btoa(c)}function f(a){var b=URI(a),c=b.suffix();return"jpg"==c||"jpeg"==c?"image/jpeg":"png"==c?"image/png":"gif"==c?"image/gif":"tiff"==c||"tif"==c?"image/tiff":a.indexOf("graph.facebook")>0?"image/jpeg":null}function g(a){return new Promise(function(b,c){var d=encodeURIComponent(a);if(!o[d])return void h(a).then(function(a){b(a)},c);var e=o[d];filesystem.root.getFile(e,{},function(a){a.file(function(a){var c=new FileReader;c.onload=function(){b(this.result)},c.readAsText(a)},c)},function(d){h(a).then(function(a){b(a)},c)})})}function h(a){return new Promise(function(b,c){d(a).then(function(c){var d=J.simpleID(32)+".txt";filesystem.root.getFile(d,{create:!0,exclusive:!0},function(a){a.createWriter(function(a){a.onerror=J.logError,a.write(new Blob([c],{type:"text/plain"}))},J.logError)},J.logError),o[encodeURIComponent(a)]=d,D.setLocalItem("imgMap",o),b(c)},c)})}function i(a){return new Promise(function(b,c){var d=encodeURIComponent(a);if(!o[d])return void k(a).then(function(a){b(a)},c);var e=o[d],f=MacApp.ImagesCache.getImage(e);f?b(f):k(a).then(function(a){b(a)},c)})}function k(a){return new Promise(function(b,c){d(a).then(function(c){var d=URI(a),e=d.suffix(),f=J.simpleID(32)+"."+e;MacApp.ImagesCache.saveImage(c,f),o[encodeURIComponent(a)]=f,D.setLocalItem("imgMap",o),b(c)},c)})}function l(a){return new Promise(function(b,c){var d=encodeURIComponent(a);if(!o[d])return void m(a).then(function(a){b(a)},c);var e=o[d];filesystem.getFileAsync(e).then(function(a){return Windows.Storage.FileIO.readTextAsync(a)}).done(function(d){d&&d.length>0?b(d):m(a).then(function(a){b(a)},c)},function(){m(a).then(function(a){b(a)},c)})})}function m(a){return new Promise(function(b,c){d(a).then(function(c){var d=J.simpleID(32)+".txt";filesystem.createFileAsync(d,Windows.Storage.CreationCollisionOption.replaceExisting).then(function(a){Windows.Storage.FileIO.writeTextAsync(a,c)}),o[encodeURIComponent(a)]=d,D.setLocalItem("imgMap",o),b(c)},c)})}function n(){D.getLocalItem("imgMap").then(function(a){return a?void(o=a):(o={},void D.setLocalItem("imgMap",o))}),j.isChromeApp?window.webkitRequestFileSystem(window.PERSISTENT,10485760,function(a){filesystem=a},J.logError):j.isWindowsApp&&(filesystem=Windows.Storage.ApplicationData.current.localFolder)}var o={};return n(),{getImage:function(a){return c(a)}}}]);var wa=angular.s("imageCache");ra.directive("lazyImage",["imageCache",function(a){return{restrict:"E",templateUrl:"templates/components/lazy-image.html",link:function(b,c,d){var e=d.lazySrc;e&&(b.loadedImageUrl=null,b.loadingImage=!0,b.lazyBgImage=d.lazyBgImg?!0:!1,b.spinnerColor=d.spinnerColor||null,a.getImage(e).then(function(a){b.loadedImageUrl=a,b.loadingImage=!1,b.$apply()},function(){b.loadingImage=!1,b.$apply()}))}}}]),ra.controller("ThemesCtrl",["$rootScope","$scope","$modal","$onready","themesAPI",function(a,b,c,d,e){function f(){ua.sendEvent("Fetch","Themes","Start"),e.fetchThemes().then(function(c){return b.loadingThemes=!1,ua.sendEvent("Fetch","Themes","Success"),c&&0!=c[1].length?(b.availableThemes.push(c[1]),a.user.purchasedThemes=c[0],b.canRestoreThemes=j.isMacApp&&!a.user.isPremiumAccount?!0:!1,g(),void U.adjustModalHeight()):void h("We were unable to get the list of themes at this time. Try again later.")},function(a){ua.sendEvent("Fetch","Themes","Failed"),b.loadingThemes=!1,h(500==a?"Oops! An error occurred when trying to get the list of themes. Please try again later.":503==a?"Oops! Our server is unavailable right now. Please try again later.":403==a?"Something went wrong. Please sign out and sign back in.":"We were unable to get the list of themes at this time. Please try again later.")})}function g(){function c(b){var c=b.i;if(c&&(b.tft||b.mft)){if(a.user.purchasedThemes.indexOf(c)>=0||g==c)return;f.indexOf(c)<0&&(f.push(c),e.push(b))}}function d(a){for(var b in a){var e=a[b];if(1==e.typ){var f=e.l;f&&f.length>0&&d(f)}else c(e)}}if(0!=b.themeLevel)return void(b.featuredThemes=null);var e=[],f=[],g=a.user.theme?a.user.theme.i:null;a.user.isPremiumOrSchoolAccount||e.push({i:"upgrade"}),d(b.availableThemes[0]),e.length>0&&(b.featuredThemes=e,b.$apply())}function h(a){nAlert({text:a,closeOnConfirm:!1},function(){nAlert.close(),c.close()})}b.loadingThemes=!0,b.loadingThemesText="Loading Themes",b.availableThemes=[],b.themeLevelTitle="Themes",b.themeLevel=0;var i=["Themes"];b.openTheme=function(a){return"upgrade"==a.i?(c.close(),void c.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"})):void c.open({templateUrl:"templates/themes/theme.html",controller:"ThemeCtrl",title:"View Theme - "+a.sd,params:{theme:a}})},b.openFolder=function(a){ua.sendAppView("Themes - Folder - "+a.d),b.availableThemes.push(a.l),b.themeLevelTitle=a.d,i.push(a.d),b.themeLevel+=1,U.adjustModalHeight()},b.goBack=function(){b.themeLevelTitle=i[i.length-2],b.availableThemes.pop(),i.pop(),b.themeLevel-=1,U.adjustModalHeight()},b.purchaseTheme=function(a){c.close(),c.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"})},b.applyTheme=function(d){ua.sendEvent("Themes","Apply","True"),b.applyingTheme=!0,e.applyTheme(d).then(function(){b.applyingTheme=!1,j.isMacApp||(a.reloadTheme(),c.close())},function(){b.applyingTheme=!1,b.$apply()})},b.restoreThemes=function(){b.applyingTheme=!0,ua.sendEvent("Themes","Restore","Start"),e.restoreThemes().then(function(){ua.sendEvent("Themes","Restore","Success"),b.applyingTheme=!1,b.$apply(),nAlert({text:"In-App Purchases Restored.",closeOnConfirm:!1},function(){nAlert.close(),b.loadingThemes=!0,b.loadingThemesText="Reloading Themes",b.availableThemes=[],b.featuredThemes=null,b.themeLevelTitle="Themes",b.themeLevel=0,b.canRestoreThemes=!1,i=["Themes"],b.$apply(),U.adjustModalHeight(),f()})},function(a){b.applyingTheme=!1,b.$apply(),ua.sendEvent("Themes","Restore",a&&"cancel"==a?"Cancel":"Failed"),"cancel"!=a&&nAlert("We couldn't restore your purchases at this time. Please try again later.")})},b.cancel=function(){c.close()},d(f)}]),ra.controller("ThemeCtrl",["$rootScope","$scope","$modal","$modalParams","$window","$location","$http","themesAPI","accountAPI",function(a,b,c,d,e,f,g,h,i){b.theme=d.theme,b.cancel=function(){c.close()},b.purchaseTheme=function(){c.close(),c.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"})},b.applyTheme=function(){ua.sendEvent("Theme","Apply","True"),b.applyingTheme=!0,h.applyTheme(b.theme).then(function(){b.applyingTheme=!1,j.isMacApp||(a.reloadTheme(),c.close())},function(){b.applyingTheme=!1,b.$apply()})},b.usePoints=function(d){if(!a.user.upts||!a.user.upts.p||a.user.upts.p<a.user.upts.ppthm){ua.sendEvent("Themes","UsePoints","NotEnough");var e=a.user.upts.p||0;nAlert({html:"<p>You have "+e+" points but need "+a.user.upts.ppthm+"</p><p>Earn points now from the account page.</p>",confirmButtonText:"Go to Account",cancelButtonText:"Close",closeOnConfirm:!1,showCancelButton:!0},function(a){a&&(nAlert.close(),f.url("/account"),b.$apply())})}else h.exchangePointsForTheme(b.theme,a.user.upts.ppthm).then(function(){i.getUserInfo().then(function(){F.loadUser(a,a.user.id,!0).then(function(){b.applyingTheme=!0,h.applyTheme(b.theme).then(function(){b.applyingTheme=!1,j.isMacApp||(a.reloadTheme(),c.close()),ua.sendEvent("Themes","UsePoints","Exchanged");var d=a.user.upts.p||0;nAlert("Good job! You have the "+b.theme.sd+" now & "+d+" points.")},function(){b.applyingTheme=!1,b.$apply()})})})})},b.openPreview=function(a){if(j.isChromeApp){var b={hidden:!0,width:900,height:608};chrome.app.window.create("myHomework Chrome/webview.html",b,function(b){b.contentWindow.addEventListener("DOMContentLoaded",function(c){var d=b.contentWindow.document.querySelector("webview");d.src=a,d.title="Preview",d.addEventListener("close",function(){b.contentWindow.close()}),b.show()})})}else c.open({templateUrl:"templates/themes/preview.html",controller:"ThemePreviewCtrl",title:"Preview Theme",size:j.isMacApp?"preview":"large",params:{previewURL:a}})}}]),ra.controller("ThemePreviewCtrl",["$rootScope","$scope","$modal","$modalParams",function(a,b,c,d){b.previewURL=d.previewURL,b.cancel=function(){c.close()}}]),ra.factory("themesAPI",["$rootScope","$window","$http",function(a,b,c){function d(){return new Promise(function(b,d){c({method:"GET",url:j.aurl+"themes?av="+j.av,headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"}}).success(function(c,i,k,l){var m=c.pur||[],n=c.ti||[];return a.user.isPremiumAccount?void b([m,n]):0==n.length?void d():void(j.isChromeApp?e(m,n).then(function(a){b([m,a])},function(a){h(n,m,null,!0),b([m,n])}):j.isWindowsApp?f(m,n).then(function(a){b([m,a])},function(){d(0)}):j.isMacApp?g(m,n).then(function(a){b([m,a])},function(){d(0)}):(h(n,m,null,!0),b([m,n])))}).error(function(a,b,c,e){d(b)})})}function e(a,b){return new Promise(function(c,d){google.payments.inapp.getSkuDetails({parameters:{env:"prod"},success:function(d){var e=d.response.details.inAppProducts,f={};for(var g in e){var i=e[g];f[i.sku]="$"+parseInt(i.prices[0].valueMicros,10)/1e6}h(b,a,f),c(b)},failure:d})})}function f(a,b){return new Promise(function(c,d){var e=Windows.ApplicationModel.Store.CurrentApp;e.loadListingInformationAsync().done(function(d){var e=d.productListings,f={};for(var g in e)if(g.indexOf("theme")>=0){var i=e[g];f[g]=i.formattedPrice}h(b,a,f),c(b)},function(a){J.logError(a),d()})})}function g(a,b){return new Promise(function(c,d){var e=[];return i(b,e),0==e.length&&b?void c(b):void MacApp.Store.getProducts(e,function(d){h(b,a,d),c(b)},d)})}function h(a,b,c,d){for(var e in a){var f=a[e];if(1==f.typ){var g=f.l;h(g,b,c,d)}else if(2==f.typ){var i=f.iap;b.indexOf(f.i)>=0?f.purchased=!0:i&&d?f.priceDisplay="$0.99":i&&c[i]&&(f.priceDisplay=c[i])}}}function i(a,b){for(var c in a){var d=a[c];if(1==d.typ){var e=d.l;i(e,b)}else if(2==d.typ){var f=d.iap;f&&b.indexOf(f)<0&&b.push(f)}}}function k(a,c){return new Promise(function(d,e){j.isChromeApp?l(a).then(function(){c.applyingTheme=!0,c.$$phase||c.$apply(),o(a,"/purchase").then(d,function(){e("cancel")})},e):j.isWindowsApp?m(a).then(function(){o(a,"/purchase").then(d,function(){e("cancel")})},e):j.isMacApp?n(a).then(d,e):(J.openURL(b,j.wurl+"settings/themes/"+a.i+"/purchase"),e("close"))})}function l(a){return new Promise(function(b,c){google.payments.inapp.buy({parameters:{env:"prod"},sku:a.iap,success:function(d){return d&&d.response&&d.response.orderId?void google.payments.inapp.getPurchases({parameters:{env:"prod"},success:function(d){if(d&&d.response&&d.response.details){var e=d.response.details;for(var f in e){var g=e[f];if(g.sku&&g.sku==a.iap){b();break}}}c("validate")},failure:c}):void c("purchase")},failure:function(a){c(a.response&&"PURCHASE_CANCELED"==a.response.errorType?"cancel":"purchase")}})})}function m(a){return new Promise(function(b,c){var d=Windows.ApplicationModel.Store.CurrentApp,e=d.licenseInformation;return e.productLicenses.lookup(a.iap).isActive?void b():void d.requestProductPurchaseAsync(a.iap).done(function(d){return d.status==Windows.ApplicationModel.Store.ProductPurchaseStatus.succeeded||d.status==Windows.ApplicationModel.Store.ProductPurchaseStatus.alreadyPurchased?e.productLicenses.lookup(a.iap).isActive?void b():void c("validate"):d.status==Windows.ApplicationModel.Store.ProductPurchaseStatus.notPurchased?void c("cancel"):void c("purchase")},function(){c("purchase")})})}function n(b){return new Promise(function(c,d){MacApp.Store.buyProduct(b.iap,a.user.username,function(a){o(b,"/purchase",a).then(c,function(){d("cancel")})},function(a,b){b&&nAlert(b),d(a)})})}function o(b,d,e){return new Promise(function(f,g){D.getLocalItem("dvid").then(function(h){var i={av:j.av,di:h};e&&j.isMacApp&&(i.rcpt=e,j.isDebug&&(i.rcpt_t=!0)),c({method:"POST",url:j.aurl+"themes/"+b.i+d,headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:i}).success(function(c,d,e,h){return 200==d?void w.setUserActiveTheme(a.user.id,{pur:c.pur||[],cur:angular.copy(b)}).then(f,g):(nAlert("We were unable to apply your theme at this time. Please try again later."),void g())}).error(function(a,b,c,d){500==b?nAlert("Oops! An error occurred when trying to get apply your theme. Please try again later."):503==b?nAlert("Oops! Our server is unavailable right now. Please try again later."):403==b?nAlert("Something went wrong. Please sign out and sign back in."):400==b&&a.error_description?nAlert(a.error_description):navigator.onLine?nAlert("We were unable to apply your theme at this time. Please try again later."):nAlert("We were unable to apply your theme at this time. Please make sure you have internet connection and try again."),g()})})})}function p(b,d){return new Promise(function(e,f){D.getLocalItem("dvid").then(function(g){var h={av:j.av,di:g,numpts:d};c({method:"POST",url:j.aurl+"themes/"+b.i+"/purchase",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:h}).success(function(c,d,g,h){return 200==d?void w.setUserActiveTheme(a.user.id,{pur:c.pur||[],cur:angular.copy(b)}).then(e,f):(nAlert("We were unable to apply your theme at this time. Please try again later."),void f())}).error(function(a,b,c,d){500==b?nAlert("Oops! An error occurred when trying to get apply your theme. Please try again later."):503==b?nAlert("Oops! Our server is unavailable right now. Please try again later."):403==b?nAlert("Something went wrong. Please sign out and sign back in."):400==b&&a.error_description?nAlert(a.error_description):navigator.onLine?nAlert("We were unable to apply your theme at this time. Please try again later."):nAlert("We were unable to apply your theme at this time. Please make sure you have internet connection and try again."),f()})})})}function q(){return new Promise(function(b,c){return j.isMacApp?void MacApp.Store.restorePurchases(a.user.username,function(a){function d(){r(a[e]).then(function(){e++,e>a.length-1?b():d()},function(){c()})}if(0==a.length)return void b();var e=0;d()},function(a,b){b&&nAlert(b),c(a)}):void c()})}function r(b){return new Promise(function(d,e){var f=b.iap.replace("theme.","");return a.user.purchasedThemes.indexOf(f)>=0?void d():void D.getLocalItem("dvid").then(function(g){var h={av:j.av,di:g,sc:!1,rcpt:b.rcpt,rcpt_t:j.isDebug?!0:!1};c({method:"POST",url:j.aurl+"themes/"+f+"/purchase",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:h}).success(function(a,b,c,f){return 200==b?void d():void e()}).error(function(a,b,c,d){e()})})})}return{exchangePointsForTheme:function(a,b){return p(a,b)},fetchThemes:function(){return d()},purchaseTheme:function(a,b){return k(a,b)},applyTheme:function(a){return o(a,"/current")},restoreThemes:function(){return q()}}}]),ra.directive("customTheme",["$rootScope","$onready","$timeout","imageCache",function(a,b,c,d){return{restrict:"E",templateUrl:"templates/themes/custom-theme.html",link:function(e,f,g){function h(){e.hasCustomTheme=!0,a.mainSpinner={type:"themes",text:"Applying Theme",show:!0},a.$apply(),c(function(){o.thx&&(e.menuTextColor=o.thx),o.phx&&(e.primaryColor=o.phx),o.shx&&(e.primaryColorLight=o.shx),j.isMacApp&&o.sbg?l():i()},300)}function i(){e.hasSmallBg=!1,o.lbg&&d.getImage(o.lbg).then(function(a){return e.bgImage=a,j.isMacApp?void(o.adi&&o.adi.i?m():n()):void(o.mbg?k():n())},n)}function k(){d.getImage(o.mbg).then(function(a){e.bgImageMedium=a,o.sbg?l():n()},n)}function l(){d.getImage(o.sbg).then(function(b){e.bgImageSmall=b,j.isMacApp&&(e.bgImage=b,e.hasSmallBg=!0),o.adi&&o.adi.i?m():(a.themeBanner=null,n())},n)}function m(){d.getImage(o.adi.i).then(function(b){var c=angular.copy(o.adi);c.i=b,a.themeBanner=c,ua.sendEvent("Theme Ad",c.ss,"Viewed"),n()},n)}function n(){a.mainSpinner=null,a.$$phase||a.$apply()}if(e.primaryColor="1e82b4",e.primaryColorLight="38b0ec",e.menuTextColor="ffffff",e.bgImage="imgs/auth-bg.jpg",e.bgImageMedium="imgs/auth-bg.jpg",e.bgImageSmall="imgs/auth-bg.jpg",e.themeID="default",!a.user||!a.user.theme||a.user.theme.i==e.themeID)return e.hasCustomTheme=!1,a.showTheme=!1,a.themeBanner=null,void(a.mainSpinner&&"login-sync"!=a.mainSpinner.type&&(a.mainSpinner=null));var o=a.user.theme;return e.themeID=o.i,j.isMacApp&&U.isMacModalWindow()?(e.hasCustomTheme=!0,o.thx&&(e.menuTextColor=o.thx),o.phx&&(e.primaryColor=o.phx),o.shx&&(e.primaryColorLight=o.shx),void n()):void b(h)}}}]),ra.directive("draggableCols",["$window","$document","$onready","$rootScope",function(a,b,c,d){return{restrict:"E",replace:!0,template:'<div class="drag-handler"></div>',link:function(e,f,g){function h(){s=angular.element(f[0].parentElement),t=angular.element(f[0].previousElementSibling),u=angular.element(f[0].nextElementSibling),u&&t&&(z=u.hasClass("has-toolbar"),A=u.hasClass("mac-always-right"),z&&B&&"macAlwaysRight"in B&&(A=B.macAlwaysRight),x=!1,y=!1,f.bind("mousedown",function(a){startX=f.prop("offsetLeft"),initialMouseX=a.clientX,b.bind("mousemove",i),b.bind("mouseup",k)}),document.addEventListener("mainNavResize",m),angular.element(a).bind("resize",m),j.leftColWidth?j.forceClosedLeftCol||z&&j.forceClosedRightCol&&A?(z&&(B.forceActiveTab="info"),o(),y=!0,u.css({"float":"left",width:"100%"}),f.css({left:"auto",right:2,cursor:"w-resize"})):j.forceClosedRightCol?(p(),x=!0,t.css({"float":"none",
width:"100%"})):(t.css({"float":"left",width:j.leftColWidth}),u.css({"float":"left",width:j.righColWidth}),m()):(u.css({"float":"none",width:"auto"}),m()),e.$on("$destroy",function(){z&&A&&y?(j.forceClosedRightCol=!0,j.forceClosedLeftCol=!1):(j.forceClosedRightCol=x,j.forceClosedLeftCol=y),j.forceClosedRightCol||j.forceClosedLeftCol?(j.leftColWidth=null,j.righColWidth=null):(j.leftColWidth=t.width(),j.righColWidth=u.width()),document.removeEventListener("mainNavResize",m),angular.element(a).unbind("resize",m),t=null,u=null,s=null}))}function i(a){return l(startX+(a.clientX-initialMouseX)),!1}function k(a){n(t)?z&&A&&y?f.css({left:"auto",right:2,cursor:"w-resize"}):f.css({left:2,cursor:"e-resize"}):n(u)?f.css({left:"auto",right:2,cursor:"w-resize"}):f.css({left:t.width(),cursor:"col-resize"}),U.setNoDragAreas(),b.unbind("mousemove",i),b.unbind("mouseup",k)}function l(a){var b=s.width()-a;v>a?(f.css({left:a,cursor:"e-resize"}),.5*v>a&&(B.forceActiveTab=null,o(),x=!1,y=!1,u.css({"float":"left",width:"100%"}))):w>b?(f.css({left:a,cursor:"w-resize"}),.5*w>b&&(z&&A?(B.forceActiveTab="info",o(),y=!0,u.css({"float":"left",width:"100%"})):(B.forceActiveTab=null,p(),y=!1,x=!0,t.css({"float":"none",width:"100%"})))):(B.forceActiveTab=null,f.css({left:a,cursor:"col-resize"}),q(),x=!1,y=!1,t.css({"float":"left",width:a}),u.css({"float":"left",width:b}))}function m(){if(t&&u&&s){var a=t.width();v>a&&(a=v);var b=s.width()-a-1,c=n(u),d=n(t);if(.75*w>b&&!c&&!d)z&&A?(B.forceActiveTab="info",o(),y=!0,u.css({"float":"left",width:"100%"}),f.css({left:"auto",right:2,cursor:"w-resize"})):(p(),t.css({"float":"none",width:"100%"}),f.css({left:"auto",right:2,cursor:"w-resize"}));else if(b>=w&&!c&&!d)u.css({"float":"left",width:b}),f.css({left:a,cursor:"col-resize"});else if(a>=v&&!c&&!d){var e=s.width()-w;t.css({"float":"left",width:e}),u.css({"float":"left",width:b}),f.css({left:a,cursor:"col-resize"})}else z&&y&&b+a>v+.75*w&&d?(B.forceActiveTab=null,y=!1,f.css({left:v}),t.css({"float":"left",width:v}),u.css({"float":"none",width:"auto"}),q()):c&&a>v+.75*w&&!x&&!d?(f.css({left:v}),t.css({"float":"left",width:v}),u.css({"float":"none",width:"auto"}),q()):w>b&&!c&&!d?(t.css({"float":"left",width:v}),f.css({left:v-1,cursor:"col-resize"}),u.css({"float":"none",width:"auto"})):u.css({"float":"none",width:"auto"});U.setNoDragAreas()}}function n(b){return"none"===a.getComputedStyle(b[0]).display}function o(){t.hide(),u.show(),d.macOnlyColumn="right",d.$apply(),r()}function p(){u.hide(),t.show(),d.macOnlyColumn="left",d.$apply(),r()}function q(){t.show(),u.show(),null!=d.macOnlyColumn&&(d.macOnlyColumn=null,d.$apply(),r())}function r(){try{var a=MacApp.Menu.getItem("View").submenu,b=d.macOnlyColumn&&"middle-right"!=d.macOnlyColumn?!1:!0;b&&a.getItem("Classes")?a.getItem("Classes").setLabel("Home"):!b&&a.getItem("Home")&&a.getItem("Home").setLabel("Classes"),U.setNoDragAreas()}catch(c){Canadarm.error("Failed to load Menu on Mac",c)}}if(j.isMacApp){var s,t,u,v,w,x,y,z,A,B=e.$parent,v=320,w=320;c(h)}}}}]),ra.directive("draggableNav",["$window","$document","$onready","$rootScope",function(a,b,c,d){return{restrict:"EA",replace:!0,template:'<div class="drag-handler"></div>',link:function(a,e,f){function g(){m=angular.element(e[0].previousElementSibling),n=angular.element(document.getElementsByClassName("main-content")),o=200,p=300,e.css({left:m.width()-2}),U.getNavLayoutSetting().then(function(a){a&&(a.open?a.width>200&&(a.width>=p?e.css({left:p-2+"px",cursor:"w-resize"}):e.css({left:a.width-2+"px"})):(q=!0,d.navOpened=!1,e.css({left:"78px",cursor:"e-resize"})),m.css({width:a.width}),n.css({"margin-left":a.width}),document.dispatchEvent(new CustomEvent("mainNavResize",{})))}),e.bind("mousedown",function(a){startX=e.prop("offsetLeft"),initialMouseX=a.clientX,b.bind("mousemove",i),b.bind("mouseup",k)}),d.$on("$routeChangeSuccess",function(a,b){c(function(){n=angular.element(document.getElementsByClassName("main-content")),n.css({"margin-left":m.width()})})}),d.$watch("navOpened",function(a){try{var b=MacApp.Menu.getItem("View").submenu.getItem("Narrow Menu");b&&(b.setState(a?"off":"on"),b.setKey(a?"cmd+[":"cmd+]"))}catch(c){Canadarm.error("Failed to load Menu on Mac",c)}q||(a?(e.css({left:"198px"}),m.css({width:"200px"}),n.css({"margin-left":"200px"})):(e.css({left:"78px"}),m.css({width:"80px"}),n.css({"margin-left":"80px"})),document.dispatchEvent(new CustomEvent("mainNavResize",{})),D.setLocalItem("navLayout",{open:a,width:a?200:80})),q=!1})}function h(a){var b=a;if(o>=a){if(b=o,o/2>=a)return l(),void e.css({left:a,cursor:"e-resize"});e.css({left:a,cursor:"col-resize"})}else a>=p?(b=p,e.css({left:a,cursor:"w-resize"})):e.css({left:a,cursor:"col-resize"});0==d.navOpened&&(q=!0,d.navOpened=!0,d.$apply(),U.setNoDragAreas()),m.css({width:b}),n.css({"margin-left":b}),document.dispatchEvent(new CustomEvent("mainNavResize",{}))}function i(a){return h(startX+(a.clientX-initialMouseX)),!1}function k(a){e.css({left:m.width()}),U.saveNavLayoutSetting(m),b.unbind("mousemove",i),b.unbind("mouseup",k),U.setNoDragAreas()}function l(){m.css({width:"80px"}),n.css({"margin-left":"80px"}),document.dispatchEvent(new CustomEvent("mainNavResize",{})),1==d.navOpened&&(q=!0,d.navOpened=!1,d.$apply(),U.setNoDragAreas())}if(j.isMacApp){var m,n,o,p,q=!1;c(g)}}}}]),ra.directive("oneCol",["$window","$rootScope","$onready",function(a,b,c){return{restrict:"EA",link:function(d,e,f){function g(){k=angular.element(".main-content"),angular.element(a).bind("resize",h),h(),d.$on("$destroy",function(){angular.element(a).unbind("resize",h)})}function h(){if(k){var a=k.width();560>a?"left"!=b.macOnlyColumn&&(b.macOnlyColumn="left",b.$apply(),i()):null!=b.macOnlyColumn&&(b.macOnlyColumn=null,b.$apply(),i())}}function i(){try{var a=MacApp.Menu.getItem("View").submenu,c=b.macOnlyColumn&&"middle-right"!=b.macOnlyColumn?!1:!0;c&&a.getItem("Classes")?a.getItem("Classes").setLabel("Home"):!c&&a.getItem("Home")&&a.getItem("Home").setLabel("Classes"),U.setNoDragAreas()}catch(d){Canadarm.error("Failed to load Menu on Mac",d)}}if(j.isMacApp&&f.oneCol){var k;c(g)}}}}]),ra.directive("threeCols",["$window","$document","$onready","$rootScope",function(a,b,c,d){return{restrict:"E",replace:!0,template:"<span></span>",link:function(b,e,f){function g(){k=angular.element(".main-content"),l=angular.element(".left-col"),m=angular.element(".middle-col"),n=angular.element(".right-col"),n&&l&&m&&(document.addEventListener("mainNavResize",h),angular.element(a).bind("resize",h),c(h),b.$on("$destroy",function(){d.macOnlyColumn=null,i(),document.removeEventListener("mainNavResize",h),angular.element(a).unbind("resize",h)}))}function h(){if(k){var a=k.width();560>a?"left"!=d.macOnlyColumn&&(d.macOnlyColumn="left",d.$apply(),i()):800>a?"middle-right"!=d.macOnlyColumn&&(d.macOnlyColumn="middle-right",d.$apply(),i()):null!=d.macOnlyColumn&&(d.macOnlyColumn=null,d.$apply(),i())}}function i(){try{var a=MacApp.Menu.getItem("View").submenu,b=d.macOnlyColumn&&"middle-right"!=d.macOnlyColumn?!1:!0;b&&a.getItem("Classes")?a.getItem("Classes").setLabel("Home"):!b&&a.getItem("Home")&&a.getItem("Home").setLabel("Classes"),U.setNoDragAreas()}catch(c){Canadarm.error("Failed to load Menu on Mac",c)}}if(j.isMacApp){var k,l,m,n;b.$parent;c(g)}}}}]),ra.directive("stickyHeaders",function(){return{restrict:"A",link:function(a,b,c){function d(a){if(!e){var b=$(this);e=!0,requestAnimationFrame(function(){var a=b.offset().top-b.parent().offset().top;b.scrollTop();b.find("> ul").each(function(){if(!$(this).hasClass("force-hidden")&&!$(this).hasClass("hidden")){var b=$(this).position().top-a,c=$(this).height();b>=0?$(this).removeClass("sticky out"):($(this).addClass("sticky"),0>=b+c?$(this).addClass("out"):$(this).removeClass("out"))}}),e=!1})}}var e=!1;("true"==c.stickyHeaders||1==c.stickyHeaders)&&(b.bind("scroll",d),a.$on("$destroy",function(){b.unbind("scroll",d)}))}}}),ra.factory("kiipUtils",["$rootScope","$http","$window","$location","$locale","$modal",function(a,b,c,d,e,f){function g(){return new Promise(function(a,c){D.getLocalItem("ipdata").then(function(d){!d||!d.tmstp||15<K.minutesInBetween(new Date(d.tmstp),new Date)?b.get("https://freegeoip.net/json/").then(function(b){d=b.data,d.tmstp=new Date,D.setLocalItem("ipdata",b.data),a(d)},function(){c("failed calling freegeoip")}):a(d)},function(){c("couldnt get ipdata")})})}function h(){return new Promise(function(a,b){D.getLocalItem("dvid").then(function(b){b&&0!=b.length||(b=J.simpleID(32),D.setLocalItem("dvid",b)),a(b)},function(){b("couldnt get deviceId")})})}function i(){return new Promise(function(b,d){a.user&&a.user.id?g().then(function(f){h().then(function(d){var g="google",h=platform.os.family+" "+platform.os.version,i=!0,k="15126a6511a7a3aebd96ad5ec1eef0c3";j.isChromeApp?(g="google",i=!1,k="568c516db6dae0fa5cba86f98fafa035"):j.isMacApp?(g="apple",i=!1,k="099c0549ed23a6fd05ca8345df0e4e94"):j.isWindowsApp&&(g="microsoft",i=!1,k="eeb5c3f4a05b2479fa0b62e0a8cb6600"),basickiipobj={app:{app_key:k,version:"1.4.0"},connection:{ip:f.ip,type:"WIFI"},device:{id:d,lang:"en",locale:e.id,manufacturer:g,os:h,resolution:Math.floor(.8*c.innerWidth)+"x"+Math.floor(.8*c.innerHeight)},location:{lat:f.latitude,lng:f.longitude},test:i,sdk_version:"1.0",user:{userid:a.user.id}},j.isWebApp&&(basickiipobj.close_button=!1),b(basickiipobj)},function(){d("failed to get deviceID")})},function(){d("failed to get ipdata")}):d()})}function k(){return new Promise(function(c,d){a.kiipsessionuser&&a.kiipsessionuser.id==a.kiipsessionuser&&a.kiipsessiondt&&15>K.minutesInBetween(a.kiipsessiondt,new Date)&&c(),i().then(function(e){e.events=[{id:"session_start",start:J.formatISO8601(new Date,3)}],b({method:"POST",url:"https://api.kiip.me/2.0/server/moment",headers:{"Content-Type":"application/json; charset=utf-8"},data:e}).success(function(b,e,f,g){200==e?(a.kiipsessionuser=a.user.id,a.kiipsessiondt=new Date,c()):d()}).error(function(a,b,c,e){d(a)})},function(){d("Error getting kiipinfo")})})}function l(){return new Promise(function(c,d){(!a.user||a.user.norwds)&&d(),k().then(function(){i().then(function(a){var e="earn_points_w_videos",f="trying_out_reward_ads",g=[f,e];1==J.getRandomInt(1,2)&&(g=[e,f]),a.moment={id:g[0]},b({method:"POST",url:"https://api.kiip.me/2.0/server/moment",headers:{"Content-Type":"application/json; charset=utf-8"},data:a}).success(function(e,f,h,i){200==f&&e&&e.view&&e.view.modal&&e.view.modal.body_url?c(e):(a.moment={id:g[1]},b({method:"POST",url:"https://api.kiip.me/2.0/server/moment",headers:{"Content-Type":"application/json; charset=utf-8"},data:a}).success(function(a,b,e,f){200==b&&a&&a.view&&a.view.modal&&a.view.modal.body_url?c(a):d(a)}).error(function(a,b,c,e){d(a)}))}).error(function(a,b,c,e){d(a)})},function(){d("Error getting kiipinfo")})}),function(){}})}function m(){return a.user?a.user.norwds?!1:a.userSettings.disableRewards?!1:!0:!1}function n(){return new Promise(function(b,c){m()||c(a.user?"Rewards are not enabled.  norwds="+a.user.norwds:"No user in scope.");var d=45;D.getLocalItem("rwdstuff").then(function(a){if(a)if(a.dtlstearned&&0==Object.keys(a.dtlstearned).length)a.ptsearned>4?(l().then(function(a){a.myhw_is_reward=!0,p(),b(a)}),function(){c("Failed to get moment")}):c("Never earned reward and hasnt earned enough points yet");else if(a.dtlstearned&&d<K.minutesInBetween(J.parseISO8601(a.dtlstearned),new Date)){var e=J.getRandomInt(1,3);a.ptsearned>10||a.ptsearned%e==1?(l().then(function(a){a.myhw_is_reward=!0,p(),b(a)}),function(){c("Failed to get moment")}):c("Not enough points and missed random check")}else c("Last reward less than "+d+" ago");else c("No rewardstuff info stored yet")},function(){c("Storage lookup failed")})})}function o(a){return new Promise(function(a,b){m()&&D.getLocalItem("rwdstuff").then(function(a){if(!a){var b=6e4,c=new Date((new Date).getTime()-60*b);a={ptsearned:0,dtlstearned:J.formatISO8601(c)}}a.ptsearned+=1,D.setLocalItem("rwdstuff",a)},function(){})})}function p(){var a={ptsearned:0,dtlstearned:J.formatISO8601(new Date)};D.setLocalItem("rwdstuff",a)}function q(a,b){return new Promise(function(a,c){m()||c("user doesnt have rewards"),j.isMacApp?MacApp.Kiip.rewardKiip(b.view.modal.body_url,function(b){J.debugLog("Kiip resp:"+b),a()},function(a){c("Kiip error:"+a)}):j.isChromeApp?chrome.app.window.create("myHomework Chrome/webview.html",{hidden:!0,width:500,height:608},function(c){c.contentWindow.addEventListener("DOMContentLoaded",function(d){var e=c.contentWindow.document.querySelector("webview");e.src=b.view.modal.body_url,e.autosize="on",e.addEventListener("close",function(){c.contentWindow.close(),a()}),e.addEventListener("loadabort",function(b){var d=b.url.split("did_dismiss");d&&d.length>1&&(c.contentWindow.close(),a())}),e.addEventListener("loadredirect",function(b){var d=b.newUrl.split("did_dismiss");d&&d.length>1&&(c.contentWindow.close(),a())}),c.show()})}):(f.close(),f.open({templateUrl:"templates/components/kiip-reward.html",controller:"KiipViewCtrl",title:"View Reward",size:"eighty",params:{kiipData:b}}),a())})}return{getBaseKiipInfo:function(){return i()},startSession:function(){return k()},fetchMoment:function(){return l()},fetchRewardeMoment:function(){return n()},rewardableMomentOccurred:function(a){o(a)},rewardShown:function(){p()},showMomentWindow:function(a,b){return q(a,b)}}}]),ra.factory("hwSync",["$http",function(a){function b(a,b){return{data:a,status:b}}function c(){return new Promise(function(c,d){D.getLocalItem("dvtkn").then(function(e){return e&&e.length>0?void c(e):void D.getLocalItem("dvid").then(function(e){e&&0!=e.length||(e=J.simpleID(32),D.setLocalItem("dvid",e)),a.post(j.aurl+"dt",{i:j.i,x:j.x,av:j.av,z:e}).success(function(a,e,f,g){return 200!=e&&201!=e||!a.t?void d(b(null,null)):(D.setLocalItem("dvtkn",a.t),void c(a.t))}).error(function(a,c,e,f){d(b(a,c))})})})})}function d(d){return new Promise(function(e,f){c().then(function(c){function g(a,c,d,g){if(200==c||402==c){var h=a.u;return h||f(b(null,404)),void w.hasUserWithUsername(h).then(function(d){return d?void f({userExists:!0}):void w.ensureUser(a).then(function(b){q.setClassUserID(b).then(function(){o.setHomeworkUserID(b).then(function(){C.setEventsUserID(b).then(function(){D.setLocalItem("nousersettings",{}),e({data:a,status:c,usrID:b})})})})},function(a){f(b(a,null))})})}f(b(a,c))}d.av=j.av,a({method:"POST",url:j.aurl+"user-auths",headers:{Authorization:"OAuth "+c,"Content-Type":"application/json; charset=utf-8"},data:d}).success(g).error(g)},function(a){f(a)})})}function e(d){return new Promise(function(e,f){c().then(function(c){D.getLocalItem("nousersettings").then(function(g){function h(a,c,d,g){if(201==c){var h=a.u;return h||f(b(null,404)),void w.ensureUser(a).then(function(b){q.setClassUserID(b).then(function(){o.setHomeworkUserID(b).then(function(){C.setEventsUserID(b).then(function(){D.setLocalItem("nousersettings",{}),e({data:a,status:c,usrID:b})})})})},function(a){f(b(a,null))})}f(b(a,c))}d.v=j.av;var i=jstz.determine(),k=i?i.name():null;g?(k&&(g.t=k),d.s=g):k&&(d.s={t:k}),a({method:"POST",url:j.aurl+"users",headers:{Authorization:"OAuth "+c,"Content-Type":"application/json; charset=utf-8"},data:d}).success(h).error(h)})},function(a){f(a)})})}function f(c,d){return new Promise(function(e,f){function g(a,c,d,g){return 200==c&&a?void w.setUserInfo(h.user.id,a).then(function(b){e({data:a,status:c,usrID:b})},function(a){f(b(a,null))}):void f(b(a,c))}c.av=j.av;var h=angular.rootScope(),i=d?"users/fb":"users/google";a({method:"POST",url:j.aurl+i,headers:{Authorization:"OAuth "+h.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:c}).success(g).error(g)})}function g(a){return j.isChromeApp?k():j.isMacApp?l():j.isWindowsApp?n():p(a)}function h(a){return j.isChromeApp?k(!1,!0):j.isMacApp?l(!1,!0):j.isWindowsApp?n(!1,!0):p(a,!1,!0)}function i(a){return j.isChromeApp?k(!0):j.isMacApp?l(!0):j.isWindowsApp?n(!0):p(a,!0)}function k(a,b){return new Promise(function(c,g){var h=angular.rootScope();if(h.isKioskApp){var i="130187703785-6ghpt6denrer07v8vfan58i5n6euhaee.apps.googleusercontent.com",k="https://accounts.google.com/o/oauth2/auth",l=j.wurl+"chromium-auth-callback",m={client_id:i,redirect_uri:l,response_type:"token",approval_prompt:"force",max_auth_age:0,max_age:0,scope:"profile email"};k+="?"+$.param(m),chrome.identity.launchWebAuthFlow({url:k,interactive:!0},function(h){if(chrome.runtime.lastError&&"The user did not approve access."==chrome.runtime.lastError.message)return void g({cancel:!0});for(var i,j={},k=h.split("#")[1],l=/([^&=]+)=([^&]*)/g;i=l.exec(k);)j[decodeURIComponent(i[1])]=decodeURIComponent(i[2]);return j.access_token?(chrome.storage.local.set({kiosk_goog_t:j.access_token}),void(a?f({goog:j.access_token,goog_t:"access"}).then(c,g):b?e({goog:j.access_token,goog_t:"access"}).then(c,g):d({goog:j.access_token,goog_t:"access"}).then(c,g))):(chrome.runtime.lastError&&nAlert({title:"Failed to Sign in",text:chrome.runtime.lastError.message}),void g())})}else chrome.identity.getAuthToken({interactive:!0,scopes:["profile","email"]},function(h){return h?void(a?f({goog:h,goog_t:"access"}).then(c,g):b?e({goog:h,goog_t:"access"}).then(c,g):d({goog:h,goog_t:"access"}).then(c,g)):chrome.runtime.lastError&&"The user did not approve access."==chrome.runtime.lastError.message?void g({cancel:!0}):(chrome.runtime.lastError&&nAlert({title:"Failed to Sign in",text:chrome.runtime.lastError.message}),void g())})})}function l(a,b){return new Promise(function(c,g){MacApp.Auth.signInWithGoogle(function(h){if(h.length>0){var i=h.split("code=");if(i&&i.length>1){var j=i[1].split("&")[0];return void(a?f({goog:j}).then(c,g):b?e({goog:j}).then(c,g):d({goog:j}).then(c,g))}}g()},function(a){"cancel"==a?g({cancel:!0}):g()})})}function n(a,b){return new Promise(function(c,g){var h=new Windows.Foundation.Uri("https://accounts.google.com/o/oauth2/auth?client_id=130187703785-e1vq8jvs45ghsiajmbsk8n3a4rlo47to.apps.googleusercontent.com&redirect_uri=https%3A%2F%2Fmyhomeworkapp.com/login/google/authenticated&response_type=code&scope=profile%20email"),i=new Windows.Foundation.Uri("https://myhomeworkapp.com/login/google/authenticated");Windows.Security.Authentication.Web.WebAuthenticationBroker.authenticateAsync(Windows.Security.Authentication.Web.WebAuthenticationOptions.none,h,i).done(function(h){if(h.responseData){var i=h.responseData.split("code=");if(i&&i.length>1){var j=i[1].split("&")[0];return j=unescape(j),void(a?f({goog:j}).then(c,g):b?e({goog:j}).then(c,g):d({goog:j}).then(c,g))}}h.responseStatus==Windows.Security.Authentication.Web.WebAuthenticationStatus.userCancel?g({cancel:!0}):g()},g)})}function p(a,b,c){return new Promise(function(g,h){var i=!1;gapi.auth.signIn({clientid:"130187703785-mf8flp11vudfg4mbev9ovmhk5bm5urlj.apps.googleusercontent.com",cookiepolicy:"none",scope:"profile email",callback:function(j){return j.status&&j.status.signed_in&&j.access_token?(a.spinnerText="Signing in with Google",a.showSpinner=!0,a.$apply(),void(i||(i=!0,b?f({goog:j.access_token,goog_t:"access"}).then(function(a){g(a)},function(a){i=!1,h(a)}):c?e({goog:j.access_token,goog_t:"access"}).then(function(a){g(a)},function(a){i=!1,h(a)}):d({goog:j.access_token,goog_t:"access"}).then(function(a){g(a)},function(a){i=!1,h(a)})))):void("access_denied"==j.error?h({cancel:!0}):"immediate_failed"!=j.error&&h())}})})}function r(a){return j.isChromeApp?v(a):j.isMacApp?x():j.isWindowsApp?z():B()}function s(a){return j.isChromeApp?v(a,!1,!0):j.isMacApp?x(!1,!0):j.isWindowsApp?z(!1,!0):B(!1,!0)}function t(a){return j.isChromeApp?v(a,!0):j.isMacApp?x(!0):j.isWindowsApp?z(!0):B(!0)}function v(a,b,c){return new Promise(function(g,h){chrome.app.window.create("myHomework Chrome/webview.html",{hidden:!0},function(i){i.contentWindow.addEventListener("DOMContentLoaded",function(j){var k=i.contentWindow.document.querySelector("webview");k.src="https://www.facebook.com/dialog/oauth?client_id=283058048395364&redirect_uri=https://myhomeworkapp.com/login/facebook/authenticated&scope=user_education_history&display=popup&response_type=token&auth_type=reauthenticate",k.addEventListener("close",function(){i.contentWindow.close(),h({cancel:!0})}),k.addEventListener("loadredirect",function(j){var l=j.newUrl.split("access_token=");if(l&&l.length>1){a.spinnerText="Signing in with Facebook",a.showSpinner=!0,a.$apply();var m=l[1].split("&")[0];b?f({f:m},!0).then(g,h):c?e({f:m}).then(g,h):d({f:m}).then(g,h),j.preventDefault(),k.clearData({},{cookies:!0}),i.contentWindow.close()}else("http://myhomeworkapp.com/#_=_"==j.newUrl||"https://myhomeworkapp.com/#_=_"==j.newUrl)&&(i.contentWindow.close(),h({cancel:!0}))}),i.show()})})})}function x(a,b){return new Promise(function(c,g){MacApp.Auth.signInWithFacebook(function(h){if(h.length>0){var i=h.split("access_token=");if(i&&i.length>1){var j=i[1].split("&")[0];return void(a?f({f:j},!0).then(c,g):b?e({f:j}).then(c,g):d({f:j}).then(c,g))}}g()},function(a){"cancel"==a?g({cancel:!0}):g()})})}function z(a,b){return new Promise(function(c,g){var h=new Windows.Foundation.Uri("https://www.facebook.com/dialog/oauth?client_id=283058048395364&redirect_uri=https%3A%2F%2Fmyhomeworkapp.com/login/facebook/authenticated&scope=user_education_history&display=popup&response_type=token"),i=new Windows.Foundation.Uri("https://myhomeworkapp.com/login/facebook/authenticated");Windows.Security.Authentication.Web.WebAuthenticationBroker.authenticateAsync(Windows.Security.Authentication.Web.WebAuthenticationOptions.none,h,i).done(function(h){if(h.responseData){var i=h.responseData.split("access_token=");if(i&&i.length>1){var j=i[1].split("&")[0];return void(a?f({f:j},!0).then(c,g):b?e({f:j}).then(c,g):d({f:j}).then(c,g))}}h.responseStatus==Windows.Security.Authentication.Web.WebAuthenticationStatus.userCancel?g({cancel:!0}):g()},g)})}function B(a,b){return new Promise(function(c,g){FB.init({appId:j.isDebug?"930177847016711":"283058048395364",xfbml:!0,version:"v2.2"}),FB.login(function(h){"connected"===h.status&&h.authResponse.accessToken?a?f({f:h.authResponse.accessToken},!0).then(c,g):b?e({f:h.authResponse.accessToken}).then(c,g):d({f:h.authResponse.accessToken}).then(c,g):"not_authorized"!==h.status&&h.status?g():g({cancel:!0})},{scope:"user_education_history"})})}function F(d){return new Promise(function(e,f){c().then(function(c){function f(a,c,d,f){e(b(a,c))}a({method:"GET",url:j.aurl+"user-emails/"+d,headers:{Authorization:"OAuth "+c,"Content-Type":"application/json; charset=utf-8"}}).success(f).error(f)},function(a){f(a)})})}function G(a){return new Promise(function(b,c){e({e:a.newAccount.email,p:a.newAccount.password,a:13}).then(function(a){b(a)},function(a){c(a)})})}function H(c,d,e,f){return new Promise(function(g,h){D.getLocalItem("dvid").then(function(i){D.getLocalItem("usrgeo").then(function(k){var l=d?"Login Sync":e?"Logout Sync":"Sync",n=f?"Visible":"Auto";ua.sendEvent(l,n,"Start");var o="sync",p={av:j.av,di:i,dvt:3};if(navigator&&navigator.userAgent&&(p.dua=navigator.userAgent),k)try{var q=k.split(",");2==q.length&&(q[0]=parseFloat(q[0]),q[1]=parseFloat(q[1]),p.l=q)}catch(r){J.logError(r)}m.getChanges(c.id).then(function(f){var i=[],k=[];if(E(f,function(a){i.push({t:a.t,o:a.o}),k.push(a._id)}),d&&0==i.length)o="login-sync";else{if(i.length)p.c=i;else if(e)return ua.sendEvent(l,n,"No Need"),void g();e&&(p.noresp=!0),c.lastSyncId&&(p.lsi=c.lastSyncId),d&&i.length&&(p.fs=!0)}J.debugLog("Sync Request:",p),a({method:"POST",url:j.aurl+o,headers:{Authorization:"OAuth "+c.accessToken,"Content-Type":"application/json; charset=utf-8"},data:p}).success(function(a,f,i,j){if(200==f||204==f){if(J.debugLog("Sync Response:",f,a),ua.sendEvent(l,n,"Success"),!a||e)return m.clearChanges(k),void g(b(a,f));var o={ss:a.ss||null,rdt:a.rdt||null,gpi:a.gpi||null,syi:a.syi||null};a.pfs&&(o.pfs=a.pfs),a.jcc&&(o.jcc=a.jcc),w.setUserInfo(c.id,o);var p=a.c;if(p)return void I(c,p,d?!0:!1).then(function(b){m.clearChanges(k);var d=new Date;D.setLocalItem("lsyncdt",J.formatISO8601(d));var e=angular.rootScope();e.lastSyncDate=d,g({data:a,status:f,hadChanges:!0,userid:c.id,themeChanged:b.themeChanged,unreadAnnouncements:b.unreadAnnouncements})});g(b(a,f))}else ua.sendEvent(l,n,"Failed"),J.logError(b(a,f)),h(b(a,f))}).error(function(a,c,d,e){ua.sendEvent(l,n,"Failed"),J.logError(b(a,c)),h(b(a,c))})},h)})})})}function I(a,b,c){return new Promise(function(d,e){var f=new Array,g=!1,h=0;E(b,function(b){var d=b.t,e=b.o;if(3==d){var i=e.i;i&&f.push(function(){return q.deleteClass(i,a.id)})}else if(4==d||15==d){var j=e.i;j&&f.push(function(){return o.deleteHw(j,a.id)})}else if(1==d||6==d)f.push(function(){return q.ensureClass(e,a.id)});else if(13==d){if(e.tchr){var k=e.tchr;f.push(function(){return A.ensureTeacher(k)})}if(e.schl){var l=e.schl;f.push(function(){return y.ensureSchool(l)})}f.push(function(){return q.ensureClass(e,a.id)})}else if(2==d||7==d||14==d)f.push(function(){return o.ensureHw(e,a.id)});else if(8==d)f.push(function(){return w.setUserSettings(a.id,e)});else if(12==d)e.r||c||(h+=1),f.push(function(){return u.ensureAnnouncement(e,a.id)});else if(9==d){var i=e.i;i&&(f.push(function(){return o.deleteClassHws(i,a.id)}),f.push(function(){return u.deleteClassAnnouncements(i,a.id)}),f.push(function(){return q.deleteClass(i,a.id)}))}else if(10==d){var j=e.i;j&&(delete e.i,f.push(function(){return o.setTeacherHomeworkChanges(j,a.id,e)}))}else if(11==d){var m=e.i;m&&f.push(function(){return u.markAnnouncementsAsRead([m],a.id)})}else if(16==d){var m=e.i;m&&f.push(function(){return u.deleteAnnouncement(m,a.id)})}else if(18!=d||c){if(19==d)f.push(function(){return C.ensureEvent(e,a.id)});else if(20==d){var n=e.i;n&&f.push(function(){return C.deleteEvent(n,a.id)})}}else{var p=null,r=a.purchasedThemes?a.purchasedThemes:[];e&&e.ispur&&r.indexOf(e.i)<0&&r.push(e.i);var p=p={pur:r,cur:e||null};f.push(function(){return w.setUserActiveTheme(a.id,p)}),g=!0}}),Promise.loop(f).then(function(){d({themeChanged:g,unreadAnnouncements:h})},function(a){J.logError(a),e(a)})})}function K(){return new Promise(function(b,d){c().then(function(c){a({method:"GET",url:j.aurl+"app-v/"+j.z,headers:{Authorization:"OAuth "+c,"Content-Type":"application/json; charset=utf-8"}}).success(function(a,c,e,f){200==c?b(a):d()}).error(function(a,b,c,e){d()})},function(a){d()})})}function L(b){return new Promise(function(c,d){a({method:"GET",url:j.aurl+"app-v/"+j.z,headers:{Authorization:"OAuth "+b.accessToken,"Content-Type":"application/json; charset=utf-8"}}).success(function(a,b,e,f){200==b?c(a):d()}).error(function(a,b,c,e){d()})},function(a){reject()})}function M(a){return new Promise(function(b,c){return j.isMacApp?void O(a,"css").then(function(){O(a,"js").then(function(){MacApp.Versions.setActiveVersion(a)?b():c()},c)},c):void c()})}function N(c,d,e,f){return new Promise(function(g,h){datadict={extt:d,av:j.av},void 0!=e&&(datadict.id=e),void 0!=f&&(datadict.iw=f),a({method:"POST",url:j.aurl+"temp-auth-tokens",headers:{Authorization:"OAuth "+c.accessToken,"Content-Type":"application/json; charset=utf-8"},data:datadict}).success(function(a,c,d,e){return 200!=c&&201!=c||!a.t?void h(b(null,null)):void g(a)}).error(function(a,c,d,e){h(b(a,c))})})}function O(b,c){return new Promise(function(d,e){var f=j.platform.toLowerCase()+"-build-"+b+".min."+c,g="text/css";"css"!=c&&(g="application/x-javascript"),a({method:"GET",url:j.cloudfrontURL+f,headers:{"Content-Type":g+"; charset=utf-8"}}).success(function(a,b,g,h){200==b&&a&&a.length&&MacApp.Versions.saveVersion(a,f,c)?d():e()}).error(function(a,b,c,d){e()})})}return{getDeviceToken:function(){return c()},signin:function(a,b){return d({u:a,p:b})},signupWithmyHomework:function(a){return G(a)},signinWithGoogle:function(a){return g(a)},signupWithGoogle:function(a){return h(a)},connectinWithGoogle:function(a){return i(a)},signinWithFacebook:function(a){return r(a)},signupWithFacebook:function(a){return s(a)},connectWithFacebook:function(a){return t(a)},validateEmail:function(a){return F(a)},sync:function(a,b,c){return H(a,b,!1,c)},loginSync:function(a){return H(a,!0,!1,!0)},logoutSync:function(a){return H(a,!1,!0,!0)},getLatestAppVersion:function(){return K()},getLatestAppVersionWithUser:function(a){return L(a)},downloadAppVersion:function(a){return M(a)},openMyHwFromToken:function(a,b,c,d){return N(a,b,c,d)}}}]);var xa=function(){function a(){J.debugLog("Cleared All Reminders"),j.isChromeApp?chrome.alarms.clearAll():j.isWindowsApp?d():j.isMacApp&&MacApp.Notifications.unscheduleNotifications()}function b(){var a=angular.f("date"),b=new Date,d=a(b,"yyyyMMdd");o.getHwsWithReminders().then(function(a){var e=[];E(a,function(a){if(!L.isHwHidden(a)){var c=L.toUIHomework(a);if(c)if(c.repeats&&c.repeatDates.length>0){var f=c.repeatCompleted?c.repeatCompleted:[],g=[];if(E(c.repeatDates,function(a){f.indexOf(a)<0&&g.push(a)}),g.length>0){var h=0;E(g,function(a){if(10>h&&(a>d||a==d&&c.hasTime&&(c.dueDate.getHours()>b.getHours()||c.dueDate.getHours()==b.getHours()&&c.dueDate.getMinutes()>b.getMinutes()))){var f=angular.copy(c),g=K.dateFromDateFormat(a),i="REPEAT-"+a+"-"+c.dbID;f.dbID=i,L.updateRepeatHomeworkStatus(f,g),e.push(f),h++}})}}else e.push(c)}}),e.length&&c(e)}),C.getEventsWithReminders().then(function(a){var e=[];E(a,function(a){var c=R.toUIEvent(a);if(c&&c.isEvent)if(c.repeats&&c.repeatDates.length>0){var f=0;E(c.repeatDates,function(a){if(10>f&&(a>d||a==d&&c.hasTime&&(c.dueDate.getHours()>b.getHours()||c.dueDate.getHours()==b.getHours()&&c.dueDate.getMinutes()>b.getMinutes()))){var g=angular.copy(c),h=K.dateFromDateFormat(a),i="REPEAT-"+a+"-"+c.dbID;g.dbID=i,L.updateRepeatHomeworkStatus(g,h),e.push(g),f++}})}else e.push(c)}),e.length&&c(e)})}function c(a){var b=new Date;for(var c in a){var d=a[c];if(d.reminder&&(!d.isComplete&&!d.isLate||d.isEvent)){var f=d.dueDate;d.hasTime||(f=J.addHoursToDate(f,8));var g="'"+d.title+"' ",h=g+"now.";d.isDueType&&(h=g+"is due now.");var i=d.rm.n;i&&(h=g+"tomorrow.",d.isDueType&&(h=g+"is due tomorrow."),f=J.addDaysToDate(f,-1),f.setHours(19),f.setMinutes(0));var j=d.rm.c;j&&!d.repeats&&(f=J.parseISO8601(j),h=d.title);var k=d.rm.a;switch(k){case 1:f=J.addHoursToDate(f,-1),h=g+"in an hour.",d.isDueType&&(h=g+"is due in an hour.");break;case 2:f=J.addHoursToDate(f,-2),h=g+"in 2 hours.",d.isDueType&&(h=g+"is due in 2 hours.")}var l=d.rm.d;switch(l){case 1:f=J.addDaysToDate(f,-1),h=g+"tomorrow.",d.isDueType&&(h=g+"is due tomorrow.");break;case 2:f=J.addDaysToDate(f,-2),h=g+"in 2 days.",d.isDueType&&(h=g+"is due in 2 days.");break;case 3:f=J.addDaysToDate(f,-3),h=g+"in 3 days.",d.isDueType&&(h=g+"is due in 3 days.");break;case 4:f=J.addDaysToDate(f,-4),h=g+"in 4 days.",d.isDueType&&(h=g+"is due in 4 days.");break;case 5:f=J.addDaysToDate(f,-5),h=g+"in 5 days.",d.isDueType&&(h=g+"in due in 5 days.");break;case 6:f=J.addDaysToDate(f,-6),h=g+"in 6 days.",d.isDueType&&(h=g+"is due in 6 days.")}var m=d.rm.w;switch(m){case 1:f=J.addDaysToDate(f,-7),h=g+"in a week.",d.isDueType&&(h=g+"is due in a week.");break;case 2:f=J.addDaysToDate(f,-14),h=g+"in 2 weeks.",d.isDueType&&(h=g+"is due in 2 weeks.");break;case 3:f=J.addDaysToDate(f,-21),h=g+"in 3 weeks.",d.isDueType&&(h=g+"is due in 3 weeks.")}f>b&&e(d.dbID,h,f)}}}function d(){var a=Windows.UI.Notifications.ToastNotificationManager.createToastNotifier(),b=a.getScheduledToastNotifications();E(b,function(b){a.removeFromSchedule(b)})}function e(a,b,c){if(J.debugLog("Scheduled Reminder:",a,b,c),j.isChromeApp)chrome.notifications.getPermissionLevel(function(d){"granted"==d&&chrome.alarms.create(a+":"+b,{when:c.getTime()})});else if(j.isWindowsApp){var d=Windows.UI.Notifications.ToastNotificationManager.getTemplateContent(Windows.UI.Notifications.ToastTemplateType.toastText01),e=d.getElementsByTagName("text");e[0].appendChild(d.createTextNode(b));var f=d.selectSingleNode("/toast");f.setAttribute("launch",'{"type":"toast","hw":"'+a+'"}');var g=new Windows.UI.Notifications.ScheduledToastNotification(d,c),h=Windows.UI.Notifications.ToastNotificationManager.createToastNotifier();h.addToSchedule(g)}else j.isMacApp&&MacApp.Notifications.notify({
id:a,title:"myHomework",content:b,when:J.formatISO8601(c,2)})}function f(a){if("announcement"==a)return void g();var b=angular.rootScope();b&&b.openHomeworkFromNotification(a)}function g(){J.openAppURL(angular.l(),"/announcements");var a=angular.rootScope();a.$$phase||a.$apply()}return j.isChromeApp&&chrome.runtime.onMessage.addListener(function(a,b,c){if(0==a.indexOf("hw://")){c("OK"),f(a.substring(5));var d=chrome.app.window.current();d&&d.focus()}}),{rescheduleReminders:function(){a(),b()},openHwReminderWithID:function(a){f(a)}}}();ra.controller("HomeCtrl",["$rootScope","$scope","$modal","$filter","$timeout","$location","$window","$document","kiipUtils",function(a,b,c,d,e,f,g,h,i){function k(){var a=null,c=null;b.filteredClasses.length&&b.filteredClasses[0].items&&E(b.filteredClasses[0].items,function(d){d.dateClassTimes&&E(d.dateClassTimes,function(d){"block"==d.type&&(c={label:d.label,color:d.color||null},"today"==b.clsFilters.active&&(a=d.label))})}),b.blockScheduleChangeLabel=a,b.blockDayInfo=c}function l(){if(b.blockScheduleChangeLabel)return void(b.alternateWeekSwitcherWeek=null);if("today"==b.clsFilters.active&&b.filteredClasses.length){var a=0,c=0,d=0;if(b.filteredClasses[0].items&&E(b.filteredClasses[0].items,function(b){b.classTimesAlternate&&(a+=1,b.classTimesIsWeek1?c+=1:d+=1)}),b.filteredClasses[0].altItems&&E(b.filteredClasses[0].altItems,function(b){b.classTimesAlternate&&(a+=1,b.classTimesIsWeek1?c+=1:d+=1)}),a>0)return void(a==c?b.alternateWeekSwitcherWeek="1":a==d?b.alternateWeekSwitcherWeek="2":b.alternateWeekSwitcherWeek=null)}b.alternateWeekSwitcherWeek=null}function m(){var a=!1;if("all"==b.clsFilters.active&&b.filteredClasses.length&&b.filteredClasses[0].items){var c=!1;E(b.filteredClasses[0].items,function(a){(a.isCurrent||a.isFuture)&&a.classTimes&&(c=!0)}),c||(a=!0)}b.showAddClassTimes=a}function n(){if(j.isMacApp)try{var a=MacApp.Menu.getItem("Filter").submenu.getItem("Homework").submenu;a.getItem("By Status").setState("all"==b.hwFilters.active?"on":"off"),a.getItem("By Class").setState("class"==b.hwFilters.active?"on":"off"),a.getItem("By Priority").setState("priority"==b.hwFilters.active?"on":"off"),a.getItem("By Type").setState("type"==b.hwFilters.active?"on":"off")}catch(c){Canadarm.error("Failed to load Menu on Mac",c)}}function o(){if(j.isMacApp)try{var a=MacApp.Menu.getItem("Filter").submenu.getItem("Classes").submenu;a.getItem("All").setState("all"==b.clsFilters.active?"on":"off"),a.getItem("Today").setState("today"==b.clsFilters.active?"on":"off"),a.getItem("Tomorrow").setState("tomorrow"==b.clsFilters.active?"on":"off")}catch(c){Canadarm.error("Failed to load Menu on Mac",c)}}a.bodyClass=null,a.nav="home",a.syncIfTooLong(),b.hwFiltersEnabled=!1,b.hwFilters={active:null},b.hwListControl={visibleSize:20,pageSize:15,closedGroups:[]},b.addHomework=function(){c.open({templateUrl:"templates/homework/add-edit.html",controller:"AddHomeworkCtrl",title:"Add Homework",size:"medium"})};var p=a.$watch("userHomeworks",function(c){if("undefined"!=typeof c){var d=F.showCompletedHomework(a);return b.hwFilters.active?void b.hwListControl.reloadFilteredHomeworks(c,d):void D.getLocalItem("defaultHwFilter").then(function(a){b.hwFilters.active=a||"all",ua.sendEvent("Homework","Filter",b.hwFilters.active),b.hwListControl.reloadFilteredHomeworks(c,d),n(),U.setMenuItemState("Filter","Show Completed",d?"on":"off")})}}),q=b.$watch("hwFilters.active",function(c,d){if(c&&d){b.hwListControl.visibleSize=20,b.hwListControl.closedGroups=[],ua.sendEvent("Homework","Filter",c);var e=F.showCompletedHomework(a);b.filteredHomeworks=L.filterHomeworksBy(a.userHomeworks,c,e,b.hwListControl.visibleSize,b.hwListControl.closedGroups),D.setLocalItem("defaultHwFilter",c),angular.element(".box-scroll").scrollTop(0),n()}});b.hwListControl.reloadFilteredHomeworks=function(a,c){b.filteredHomeworks=L.filterHomeworksBy(a,b.hwFilters.active,c,b.hwListControl.visibleSize,b.hwListControl.closedGroups),b.filteredHomeworks&&b.filteredHomeworks.groups.length>0?b.hwFiltersEnabled=!0:b.hwFiltersEnabled=!1,b.$$phase||b.$apply()},b.showClassesAddOptions=!1,b.toggleClassesAddOptions=function(c){c&&(c.preventDefault(),c.stopPropagation()),b.showClassesAddOptions?(b.showClassesAddOptions=!1,h.unbind("click",r)):"all"!=b.clsFilters.active&&(b.showClassesAddOptions=!0,h.bind("click",r)),"all"==b.clsFilters.active&&b.addClass(),b.$$phase||a.$$phase||b.$apply()};var r=function(c){c&&(c.preventDefault(),c.stopPropagation()),b.showClassesAddOptions=!1,h.unbind("click",r),b.$$phase||a.$$phase||b.$apply()};b.addNoSchoolDay=function(){var a=new Date;"tomorrow"==b.clsFilters.active&&a.setDate(a.getDate()+1),c.open({templateUrl:"templates/events/add-edit-no-school.html",controller:"AddNoSchoolDayCtrl",title:"Add No School Day",size:"medium",params:{initDate:a}})},b.addLateStart=function(){var a=new Date;"tomorrow"==b.clsFilters.active&&a.setDate(a.getDate()+1),c.open({templateUrl:"templates/events/add-edit-late-start.html",controller:"AddLateStartCtrl",title:"Add Late Start",size:"medium",params:{initDate:a}})},b.addEarlyRelease=function(){var a=new Date;"tomorrow"==b.clsFilters.active&&a.setDate(a.getDate()+1),c.open({templateUrl:"templates/events/add-edit-early-release.html",controller:"AddEarlyReleaseCtrl",title:"Add Early Release",size:"medium",params:{initDate:a}})},b.addClass=function(){if(b.user&&"teachers"==b.user.jcc){var d=!0;if(a.userClasses){var e=0;E(a.userClasses,function(a){a.isCurrent&&(e+=1)}),e>=2&&(d=!1)}d?c.open({templateUrl:"templates/classes/add-classes.html",controller:"AddClassesCtrl",title:"Add Classes",size:"medium"}):c.open({templateUrl:"templates/classes/add-edit.html",controller:"AddManualClassCtrl",title:"Add Class",size:"medium"})}else c.open({templateUrl:"templates/classes/add-or-join.html",controller:"AddOrJoinClassCtrl",title:"Add or Join Class",size:a.userSchools?"medium":"medium-large"})},b.clsFiltersEnabled=!1,b.clsFilters={active:null},b.clsListControl={};var s=new Date,t=a.$watch("userClasses",function(a){return b.clsFilters.active?void b.clsListControl.reloadFilteredClasses(a):void D.getLocalItem("defaultClsFilter").then(function(c){b.clsFilters.active=c||"all",s=new Date,"tomorrow"==b.clsFilters.active&&s.setDate(s.getDate()+1),ua.sendEvent("Classes","Filter",b.hwFilters.active),b.clsListControl.reloadFilteredClasses(a),o()})}),u=b.$watch("clsFilters.active",function(c,d){c&&d&&(ua.sendEvent("Classes","Filter",c),s=new Date,"tomorrow"==c&&s.setDate(s.getDate()+1),b.filteredClasses=Q.filterClassesBy(a.userClasses,c,s),b.groupingDisabled=b.filteredClasses.length>1?!1:!0,D.setLocalItem("defaultClsFilter",c),angular.element(".box-scroll").scrollTop(0),o(),k(),l(),m(),"all"==c&&(b.blockDayInfo=null))});b.clsListControl.reloadFilteredClasses=function(a,c){b.filteredClasses=Q.filterClassesBy(a,b.clsFilters.active,s),b.clsFiltersEnabled=a&&a.length>0?!0:!1,b.groupingDisabled=b.filteredClasses.length>1?!1:!0,k(),l(),m(),b.$$phase||b.$apply()},i.fetchRewardeMoment().then(function(a){i.showMomentWindow(b,a).then(function(){J.debugLog("Show moment success!")}),function(){J.debugLog("Show moment fail!")}},function(a){console.log(a)}),b.openThemeBanner=function(a){ua.sendEvent("Theme Ad",a.ss,"Clicked"),a.sp&&a.ss?f.url("/schools/"+a.ss):a.u&&J.openURL(g,a.u)},b.openmyHomeworkAd=function(a){ua.sendEvent("Ads",a.adID,"Clicked"),a.openSchoolPage&&a.schoolSlug?f.url("/schools/"+a.schoolSlug):a.adURL&&J.openURL(g,a.adURL)},b.openTip=function(a){ua.sendEvent("Tips",a.id,"Clicked"),"upgrade"==a.url?c.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"}):"signup"==a.url?(f.url("/signup/"),b.$$phase||b.$$apply()):"email"==a.url?c.open({templateUrl:"templates/account/edit-account.html",controller:"EditAccountCtrl",title:"Edit Account",size:"medium"}):"picture"==a.url?c.open({templateUrl:"templates/account/edit-picture.html",controller:"EditPictureCtrl",title:"Edit Picture",size:"medium"}):J.openURL(g,a.url)},b.openRenew=function(){c.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Renew Account",size:"small",params:{isRenew:!0}})};var v=a.$watch("user",function(b){b&&(f.path().indexOf("/account")>=0?a.openAccount():f.path().indexOf("/settings")>=0?a.openSettings():f.path().indexOf("/about")>=0&&a.openAbout(),v())});if(b.$on("$destroy",function(){if(p(),t(),q(),u(),v(),j.isMacApp){A();try{U.setMenuItemState("View","Home","off"),MacApp.Menu.getItem("Filter")&&MacApp.Menu.getItem("Filter").remove()}catch(a){Canadarm.error("Failed to load Menu on Mac",a)}}}),j.isMacApp){try{U.setMenuItemState("View","Home","on"),MacApp.Menu.addItem({label:"Filter",index:3});var w=MacApp.Menu.getItem("Filter").submenu;w.addItem({label:"Homework"}),w.addItem({label:"Classes"}),w.addSeparator(),w.addItem({label:"Show Completed"},function(){b.hwListControl.toggleShowCompleted()});var x=w.getItem("Homework").addSubmenu("Homework");x.addItem({label:"By Status"},function(){b.hwFilters.active="all",b.$$phase||b.$apply()}),x.addItem({label:"By Class"},function(){b.hwFilters.active="class",b.$$phase||b.$apply()}),x.addItem({label:"By Priority"},function(){b.hwFilters.active="priority",b.$$phase||b.$apply()}),x.addItem({label:"By Type"},function(){b.hwFilters.active="type",b.$$phase||b.$apply()});var y=w.getItem("Classes").addSubmenu("Classes");y.addItem({label:"All"},function(){b.clsFilters.active="all",b.$$phase||b.$apply()}),y.addItem({label:"Today"},function(){b.clsFilters.active="today",b.$$phase||b.$apply()}),y.addItem({label:"Tomorrow"},function(){b.clsFilters.active="tomorrow",b.$$phase||b.$apply()})}catch(z){Canadarm.error("Failed to load Menu on Mac",z)}var A=a.$watch("macOnlyColumn",function(a){"undefined"!=typeof a&&(a?"left"==a?(U.setMenuItemEnabled("Filter","Homework",!1),U.setMenuItemEnabled("Filter","Classes",!0),U.setMenuItemEnabled("Filter","Show Completed",!1)):"right"==a&&(U.setMenuItemEnabled("Filter","Homework",!0),U.setMenuItemEnabled("Filter","Classes",!1),U.setMenuItemEnabled("Filter","Show Completed",!0)):(U.setMenuItemEnabled("Filter","Homework",!0),U.setMenuItemEnabled("Filter","Classes",!0),U.setMenuItemEnabled("Filter","Show Completed",!0)))})}}]),ra.controller("AddHomeworkCtrl",["$rootScope","$scope","$filter","dateFilter","$modal","$modalParams","$timeout","$location","$document","kiipUtils",function(a,b,c,d,e,f,g,h,i,l){function m(){if(a.userSettings.defaultPriority&&(b.homework.priority=a.userSettings.defaultPriority),a.user&&a.userSettings.defaultReminder&&(b.homework.reminder=a.userSettings.defaultReminder),f.classId)for(k in s){var c=s[k];if(c.id==f.classId){b.homework.cls=c;break}}f.initDate&&(b.homework.dueDate=f.initDate),b.homework.cls&&f.classId&&p(b.homework)}function n(a){delete a.repeats,delete a.repeatEnds,delete a.repeatCompleted,delete a.repeatExcept,delete a.repeatBegins,delete a.repeatDates}function p(c){if(!b.isEditForm&&!f.initDate){var e=null;if(E(a.userClasses,function(a){a&&c&&c.cls&&a.id==c.cls.id&&(e=a)}),e&&e.classTimes){var g=S.getNextClassDate(e,a);g&&(b.homework.dueDate=g.date,g.hasTime&&(b.homework.dueTime=d(g.date,"shortTime")),b.$$phase||b.$apply())}}}var q=!1;b.isManualHomework=!0,b.homework={},b.customReminder={},b.repeatEnabled=!0;var r=angular.copy(a.reminderOptions);r.push({id:"c",display:"Custom Reminder..."}),b.hwReminderOptions=r;var s=new Array;if(a.userClassOptions&&E(a.userClassOptions,function(a){(a.isCurrent||a.isFuture)&&s.push(angular.copy(a))}),s.push({id:"new-class",name:"Add New Class"}),b.classOptions=s,f.homework){if(b.homework=angular.copy(f.homework),b.isEditForm=!0,b.isManualHomework=b.homework.isManual,q=b.homework.type?!0:!1,b.homework.repeats&&(b.editType=f.editType?f.editType:"edit-all","edit-one"==b.editType?(b.homework.id=J.simpleID(15),b.repeatEnabled=!1,n(b.homework),b.$$phase||b.$apply()):(b.homework.dueDate=b.homework.repeatBegins,b.isManualHomework||(b.completeDisabled=!0))),b.homework.classId){var t=!1;for(k in s){var u=s[k];if(u.id==b.homework.classId){b.homework.cls=u,t=!0;break}}!t&&a.userClassOptions&&E(a.userClassOptions,function(a){if(a.id==b.homework.classId){var c=angular.copy(a);s.unshift(c),b.homework.cls=c}})}b.homework.hasTime&&(b.homework.dueTime=d(b.homework.dueDate,"shortTime")),b.homework.reminder&&"c"==b.homework.reminder.id.charAt(0)&&b.hwReminderOptions.push(b.homework.reminder)}else m();var v=function(){b.$watchCollection("homework",function(a,c){if(a.type&&c.type?a.type!=c.type&&(w(),q=!0):a.type&&(w(),q=!0),!q){var d=!1;if(a.title&&c.title?a.title!=c.title&&(d=!0):a.title&&(d=!0),d){var e=L.guessHomeworkType(a.title);if(e){var f=L.homeworkTypeForID(e);b.homework.type&&b.homework.type.id==f.id||(b.homework.type=f,w())}else b.homework.type?(b.homework.type=null,w()):b.homework.type=null}}})},w=function(){var a=!0;if(b.homework&&b.homework.type){if(b.formTitle=b.isEditForm?"Edit "+b.homework.type.display:"Add "+b.homework.type.display,"13"!=b.homework.type.id&&(a=!1),a&&(b.formTitle=b.isEditForm?"Edit Homework":"Add Homework"),b.homework.repeats)return b.dueDateTitle="Begins",void(b.dueTimeTitle="Time");if(L.notHomeworkDueTypes.indexOf(b.homework.type.id)>=0)return b.dueDateTitle="Date",void(b.dueTimeTitle="Time")}a&&(b.formTitle=b.isEditForm?"Edit Homework":"Add Homework"),b.dueDateTitle="Due Date",b.dueTimeTitle="Due Time"};b.isManualHomework&&v(),w(),b.openDatePicker=function(a,c){a.preventDefault(),a.stopPropagation(),"dueDate"==c?(b.homework.dueDate||(b.homework.dueDate=new Date),b.datepicker={opened:!0},b.repeatEndsDatepicker={opened:!1}):"repeatEnds"==c&&(b.datepicker={opened:!1},b.repeatEndsDatepicker={opened:!0})},b.repeatChanged=function(){!b.homework.repeats&&b.homework.repeatEnds?delete b.homework.repeatEnds:b.homework.repeats&&!b.homework.repeatEnds&&b.homework.dueDate&&("1"==b.homework.repeats.id?b.homework.repeatEnds=J.addDaysToDate(b.homework.dueDate,1):"2"==b.homework.repeats.id?5==b.homework.dueDate.getDay()?b.homework.repeatEnds=J.addDaysToDate(b.homework.dueDate,3):6==b.homework.dueDate.getDay()?b.homework.repeatEnds=J.addDaysToDate(b.homework.dueDate,2):0==b.homework.dueDate.getDay()&&(b.homework.repeatEnds=J.addDaysToDate(b.homework.dueDate,1)):"3"==b.homework.repeats.id?b.homework.repeatEnds=J.addDaysToDate(b.homework.dueDate,7):"4"==b.homework.repeats.id?b.homework.repeatEnds=J.addDaysToDate(b.homework.dueDate,14):"5"==b.homework.repeats.id&&(b.homework.repeatEnds=J.addDaysToDate(b.homework.dueDate,30))),w()},b.reminderChanged=function(){if(b.homework.reminder&&"c"==b.homework.reminder.id){if(b.homework.repeats)return b.homework.reminder=null,void nAlert({html:"Sorry, can't set a custom reminder for an item that repeats.<br>Please choose a different reminder option."});b.showCustomReminderForm=!0,b.homework.reminder.date?b.customReminder={date:b.homework.reminder.date,time:d(b.homework.reminder.date,"shortTime")}:b.customReminder={date:new Date},U.adjustModalHeight()}else b.showCustomReminderForm=!1},b.selectCustomReminder=function(a){if(a.$valid){var c=J.parseTimeStr(b.customReminder.time,b.customReminder.date),e={id:"c:"+J.formatISO8601(c),display:d(c,"MMMM d - h:mm a")};b.homework.reminder=e,b.hwReminderOptions.push(e),b.showCustomReminderForm=!1,U.adjustModalHeight()}},b.cancelCustomReminder=function(c){a.user&&a.user.isPremiumOrSchoolAccount&&a.userSettings.defaultReminder?b.homework.reminder=a.userSettings.defaultReminder:b.homework.reminder="",b.showCustomReminderForm=!1,U.adjustModalHeight()},b.showAddAttachment=function(){return a.user&&a.user.isPremiumOrSchoolAccount?void((!b.homework.files||b.homework.files.length<5)&&(ua.sendAppView("Homework Attachment Form"),b.showFileUpload=!0,U.adjustModalHeight())):a.user&&a.user.mustRenew?void e.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Renew Account",size:"small",params:{isRenew:!0}}):(a.user?ua.sendAppView("Homework Attachment Popup (No Premium)"):ua.sendAppView("Homework Attachment Popup (No User)"),void nAlert({title:"File Attachments",text:"You need a premium myHomework account to attach files.",confirmButtonText:a.user?"Upgrade to Premium":"Sign up",showCancelButton:!0},function(b){b&&(a.user?(ua.sendAppView("Homework Attachment Popup - Upgrade"),e.close(),e.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"})):(ua.sendAppView("Homework Attachment Popup - Signup"),J.openAppURL(h,"/signup"),e.close()))}))},b.attachmentsUpgradeOrSignUp=function(){return a.user&&a.user.isPremiumOrSchoolAccount?void b.showAddAttachment():void(a.user?(ua.sendAppView("Homework Attachment - Upgrade"),e.close(),e.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"})):(ua.sendAppView("Homework Attachment - Signup"),J.openAppURL(h,"/signup"),e.close()))};var x=b.$watch("homework.uploadedFile",function(c){if(c){var d=angular.copy(c);b.homework.files&&0!=b.homework.files.length||(b.homework.files=new Array),b.homework.files.push(d),b.homework.dbID&&o.updateHomeworkFiles(b.homework.dbID,b.homework.files,!0).then(function(){L.loadHomeworks(a,!0)}),b.homework.uploadedFile=null,b.showFileUpload=!1,U.adjustModalHeight()}});b.deleteAttachment=function(a){if(ua.sendAppView("Delete Homework Attachment"),a){a.id;if(b.homework.files&&b.homework.files.length>0){var c=new Array;for(var d in b.homework.files){var e=b.homework.files[d];e.id!=a.id&&c.push(e)}c.length>0?b.homework.files=c:b.homework.files=null}}},b.hideAddAttachment=function(){b.showFileUpload=!1,U.adjustModalHeight()},b.alertReminder=function(){return ua.sendAppView("Homework Reminder Popup (No User)"),a.user?void 0:void nAlert({title:"Reminders",text:"You need a myHomework account to setup reminders.",confirmButtonText:"Sign up",showCancelButton:!0},function(a){a&&(ua.sendAppView("Homework Reminder Popup - Signup"),J.openAppURL(h,"/signup"),e.close())})},b.checkClassSelection=function(c){if(!c.cls||"new-class"!=c.cls.id)return void p(c);if(ua.sendAppView("Add Class from Add Homework"),e.close(),b.user&&"teachers"==b.user.jcc){var d=!0;if(a.userClasses){var f=0;E(a.userClasses,function(a){a.isCurrent&&(f+=1)}),f>=2&&(d=!1)}d?e.open({templateUrl:"templates/classes/add-classes.html",controller:"AddClassesCtrl",title:"Add Classes",size:"medium"}):e.open({templateUrl:"templates/classes/add-edit.html",controller:"AddManualClassCtrl",title:"Add Class",size:"medium"})}else e.open({templateUrl:"templates/classes/add-or-join.html",controller:"AddOrJoinClassCtrl",title:"Add or Join Class",size:a.userSchools?"medium":"medium-large"})},b.closeAlert=function(){b.alertHiding=!0,g(function(){b.homeworkAdded=null},200)},b.save=function(c,h,i){if(c.$valid){var k=h.dueDate;if(h.dueTime&&(k=J.parseTimeStr(h.dueTime,k)),!K.isDateValid(k))return void nAlert("Please enter a valid date.");b.isEditForm&&b.editType&&"edit-one"==b.editType&&(o.deleteRepeatingHomeworkDates(f.homework.dbID,[d(f.homework.dueDate,"yyyyMMdd")],!0),n(h));var p=L.toDBHomework(h),r=F.getUserID(a);o.ensureHw(p,r,!0).then(function(d){ua.sendAppView(b.isEditForm?"Edit Homework Success":"Add Homework Success"),l.rewardableMomentOccurred(3),a.silentSync(),L.loadHomeworks(a,!0).then(function(){i?(b.homework={},b.isManualHomework=!0,b.alertHiding=!0,b.homeworkAdded=h.type&&"13"!=h.type.id?h.type.display:"Homework",q=!1,w(),c.$setPristine(),c.$setUntouched(),m(),b.$$phase||b.$apply(),g(function(){b.alertHiding=!1,j.isMacApp&&g(function(){U.adjustModalHeight()},150)},150)):(l.fetchRewardeMoment().then(function(a){l.showMomentWindow(b,a).then(function(){J.debugLog("Show moment success!")}),function(){J.debugLog("Show moment fail!")}},function(a){console.log(a)}),e.close())})},function(a){ua.sendAppView(b.isEditForm?"Edit Homework Failed":"Add Homework Failed"),J.logError(a)})}},b.cancel=function(){l.fetchRewardeMoment().then(function(a){l.showMomentWindow(b,a).then(function(){J.debugLog("Show moment success!")}),function(){J.debugLog("Show moment fail!")}},function(a){console.log(a)}),e.close()};var y=function(a){9===a.which&&(b.datepicker&&b.datepicker.opened?(b.datepicker={opened:!1},b.$$phase||b.$apply()):b.repeatEndsDatepicker&&b.repeatEndsDatepicker.opened&&(b.repeatEndsDatepicker={opened:!1},b.$$phase||b.$apply()))};i.bind("keydown",y),b.$on("$destroy",function(){x(),i.unbind("keydown",y)})}]),ra.controller("ViewHomeworkCtrl",["$rootScope","$scope","$modal","$modalParams","$location","$filter","dateFilter","kiipUtils",function(a,b,c,d,e,f,g,h){function i(a,b){var d=a.type&&"13"!=a.type.id?"Edit "+a.type.display:"Edit Homework";c.close(),c.open({templateUrl:"templates/homework/add-edit.html",controller:"AddHomeworkCtrl",title:d,analyticsTitle:"Edit Homework",size:"medium",params:{homework:a,editType:b}})}function k(b,c,d){o.setRepeatHomeworkStatus(b.dbID,c,d,!0).then(function(){ua.sendAppView("View Homework Complete Status Changed"),a.silentSync(),j.isMacApp||L.loadHomeworks(a,!0)},function(a){J.logError(a)})}b.homework=angular.copy(d.homework),b.viewTitle=b.homework.type&&"13"!=b.homework.type.id?b.homework.type.display+" Details":"Homework Details",b.homework.repeats?b.dueDateTitle="Begins":b.dueDateTitle=b.homework.type&&"13"!=b.homework.type.id&&L.notHomeworkDueTypes.indexOf(b.homework.type.id)>=0?"Date":"Due Date",b.editHomework=function(a){a.repeats&&a.isManual?nAlert({title:"This repeats",html:"<p>Which occurrence do you want to edit?</p>",confirmButtonText:"Only "+g(a.dueDate,"MMMM d"),altButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0},function(b,c){b?i(a,"edit-one"):c&&i(a,"edit-all")}):i(a,null)},b.deleteHomework=function(b){function d(){o.deleteHw(b.id,F.getUserID(a),!0).then(function(b){ua.sendAppView("Delete Homework Success"),j.isMacApp||L.loadHomeworks(a,!0),c.close()},function(a){ua.sendAppView("Delete Homework Failed"),J.logError(a)})}function e(d){"undefined"==typeof d&&(d=[g(b.dueDate,"yyyyMMdd")]),o.deleteRepeatingHomeworkDates(b.dbID,d,!0).then(function(b){ua.sendAppView("Delete Homework Success"),j.isMacApp||L.loadHomeworks(a,!0),c.close()},function(a){ua.sendAppView("Delete Homework Failed"),J.logError(a)})}if(!b.isDeletable)return void L.loadHomeworks(a,!0);var f="Homework";b.type&&"13"!=b.type.id&&(f=b.type.display),ua.sendAppView("Delete Homework"),b.repeats&&b.isManual?nAlert({title:"This repeats",html:"<p>Which occurrence do you want to remove?</p>",confirmButtonText:"Only "+g(b.dueDate,"MMMM d"),altButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0},function(a,b){a?e():b&&d()}):a.userSettings.dontPromptDelete?d():nAlert({title:"Delete "+f,html:"<p>Are you sure you want to delete <strong>"+b.title+"</strong>?</p>",confirmButtonText:"Delete",closeOnConfirm:!1,showCancelButton:!0},function(a){a&&(d(),nAlert.close())})},b.cancel=function(){c.close()},b.statusChanged=function(){if(b.homework.repeats){var c=b.homework.complete?!0:!1;if(c){var d=f("filter")(a.userHomeworks,{id:b.homework.id},!0),e=d&&d.length?d[0]:null,i=L.getLateRepeatHomeworkDates(e);if(i.length>1)nAlert({title:"This repeats",html:"<p>Which occurrence do you want to mark complete?</p>",confirmButtonText:"Only "+g(b.homework.dueDate,"MMMM d"),altButtonText:"All late",secondAltButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0,showSecondAltButton:!0,width:520},function(a,d,f){if(a){var h=[g(b.homework.dueDate,"yyyyMMdd")];k(b.homework,h,c)}else d?k(b.homework,i,c):f?k(b.homework,e.repeatDates,c):(b.homework.complete=c?!1:!0,b.$$phase||b.$apply())});else{var l=[g(b.homework.dueDate,"yyyyMMdd")];k(b.homework,l,c)}}else{var l=[g(b.homework.dueDate,"yyyyMMdd")];k(b.homework,l,c)}}else{var m=L.toDBHomework(b.homework),n=F.getUserID(a);o.ensureHw(m,n,!0).then(function(b){ua.sendAppView("View Homework Complete Status Changed"),a.silentSync(),h.rewardableMomentOccurred(1),j.isMacApp||L.loadHomeworks(a,!0)},function(a){J.logError(a)})}},b.openClass=function(a){ua.sendAppView("View Class (From Homework)"),J.openAppURL(e,"/classes/"+a),c.close()}}]),ra.controller("HomeworksCtrl",["$rootScope","$scope","$window","$modal","$location","kiipUtils",function(a,b,c,d,e,f){function g(){if(j.isMacApp)try{var a=MacApp.Menu.getItem("Filter").submenu;a.getItem("By Status").setState("all"==b.hwFilters.active?"on":"off"),a.getItem("By Class").setState("class"==b.hwFilters.active?"on":"off"),a.getItem("By Priority").setState("priority"==b.hwFilters.active?"on":"off"),a.getItem("By Type").setState("type"==b.hwFilters.active?"on":"off")}catch(c){Canadarm.error("Failed to load Menu on Mac",c)}}a.bodyClass="homework-sec three-cols",a.nav="homework",b.showFull=!1,b.hwFiltersEnabled=!0,b.hwFilters={active:null},b.hwListControl={visibleSize:20,pageSize:15,closedGroups:[]},b.completeListControl={visibleSize:20,pageSize:15,closedGroups:[]},b.lateListControl={visibleSize:20,pageSize:15,closedGroups:[]},b.upcomingListControl={visibleSize:20,pageSize:15,closedGroups:[]},b.addHomework=function(){d.open({templateUrl:"templates/homework/add-edit.html",controller:"AddHomeworkCtrl",title:"Add Homework",size:"medium"})},b.completeAllLate=function(){ua.sendAppView("Complete All Late Poup"),nAlert({title:"Complete Late",html:"<p>Are you sure you want to mark everything late as complete?</p>",confirmButtonText:"Complete All Late",closeOnConfirm:!1,showCancelButton:!0},function(c){if(c){if(b.lateHomework&&b.lateHomework.groups&&b.lateHomework.groups[0]&&"undefined"!=typeof b.lateHomework.groups[0].items){var d=[];if(E(b.lateHomework.groups[0].items,function(a){a.isCompleteable&&d.push(a.id)}),d.length){var e=F.getUserID(a);o.markHomeworksAsComplete(d,e,!0).then(function(){a.silentSync(),ua.sendAppView("Complete All Late Poup - Success"),L.loadHomeworks(a,!0)})}}nAlert.close()}})},b.$watch("hwFilters.active",function(c,d){c&&d&&(b.hwListControl.visibleSize=20,b.hwListControl.closedGroups=[],ua.sendEvent("Homework","Filter",c),b.filteredHomeworks=L.filterHomeworksBy(a.userHomeworks,c,!0,b.hwListControl.visibleSize,b.hwListControl.closedGroups),angular.element(".box-scroll").scrollTop(0),g())});var h=a.$watch("userHomeworks",function(a){return b.hwFilters.active?(b.hwListControl.reloadFilteredHomeworks(a),b.completeListControl.reloadFilteredHomeworks(a),b.lateListControl.reloadFilteredHomeworks(a),void b.upcomingListControl.reloadFilteredHomeworks(a)):void D.getLocalItem("defaultHwFilter").then(function(c){b.hwFilters.active=c||"all",ua.sendEvent("Homework","Filter",b.hwFilters.active),b.hwListControl.reloadFilteredHomeworks(a),b.completeListControl.reloadFilteredHomeworks(a),b.lateListControl.reloadFilteredHomeworks(a),b.upcomingListControl.reloadFilteredHomeworks(a),g()})});if(b.hwListControl.reloadFilteredHomeworks=function(a){b.filteredHomeworks=L.filterHomeworksBy(a,b.hwFilters.active,!0,b.hwListControl.visibleSize,b.hwListControl.closedGroups),b.filteredHomeworks.groups.length>0&&(1==b.filteredHomeworks.groups.length&&1==b.filteredHomeworks.groups[0].items.length?b.hwFiltersEnabled=!1:b.hwFiltersEnabled=!0,b.$$phase||b.$apply())},f.fetchRewardeMoment().then(function(a){f.showMomentWindow(b,a).then(function(){J.debugLog("Show moment success!")}),function(){J.debugLog("Show moment fail!")}},function(a){console.log(a)}),b.completeListControl.reloadFilteredHomeworks=function(a){b.completedHomework=L.filterHomeworksBy(a,"complete",!0,b.completeListControl.visibleSize),b.$$phase||b.$apply()},b.lateListControl.reloadFilteredHomeworks=function(a){b.lateHomework=L.filterHomeworksBy(a,"late",!0,b.lateListControl.visibleSize),b.$$phase||b.$apply()},b.upcomingListControl.reloadFilteredHomeworks=function(a){b.upcomingHomework=L.filterHomeworksBy(a,"upcoming",!0,b.upcomingListControl.visibleSize),b.$$phase||b.$apply()},j.isMacApp){try{U.setMenuItemState("View","Homework","on"),MacApp.Menu.addItem({label:"Filter",index:3});var i=a.macOnlyColumn?!0:!1,k=MacApp.Menu.getItem("Filter").submenu;k.addItem({label:"By Status",state:"on",enabled:i},function(){b.hwFilters.active="all",b.$$phase||b.$apply()}),k.addItem({label:"By Class",enabled:i},function(){b.hwFilters.active="class",b.$$phase||b.$apply()}),k.addItem({label:"By Priority",enabled:i},function(){b.hwFilters.active="priority",b.$$phase||b.$apply()}),k.addItem({label:"By Type",enabled:i},function(){b.hwFilters.active="type",b.$$phase||b.$apply()})}catch(l){Canadarm.error("Failed to load Menu on Mac",l)}var m=a.$watch("macOnlyColumn",function(a){if("undefined"!=typeof a)try{var b=a&&"left"==a||"right"==a?!0:!1;U.setMenuItemEnabled("Filter","By Status",b),U.setMenuItemEnabled("Filter","By Class",b),U.setMenuItemEnabled("Filter","By Priority",b),U.setMenuItemEnabled("Filter","By Type",b)}catch(c){Canadarm.error("Failed to load Menu on Mac",c)}});b.$on("$destroy",function(){h(),m();try{U.setMenuItemState("View","Homework","off"),MacApp.Menu.getItem("Filter")&&MacApp.Menu.getItem("Filter").remove()}catch(a){Canadarm.error("Failed to load Menu on Mac",a)}})}else{var n=angular.element(c),p=function(){n.width()<=685&&!b.showFull?(b.showFull=!0,b.$$phase||b.$apply()):n.width()>685&&b.showFull&&(b.showFull=!1,b.$$phase||b.$apply())};p(),n.bind("resize",p),b.$on("$destroy",function(){n.unbind("resize",p),h()})}}]),ra.directive("homeworkList",["$rootScope","$document","$modal","$timeout","$filter","dateFilter","kiipUtils",function(a,b,c,d,e,f,g){return{restrict:"E",replace:!0,templateUrl:"templates/homework/homework-list.html",scope:{homeworkItems:"=homeworkItems",hwFiltersEnabled:"=?hwFiltersEnabled",hwFilters:"=hwFilters",completeCheckboxEnabled:"=?showCompleteCheckbox",groupingDisabled:"=?groupingDisabled",stickyHeadersDisabled:"=?stickyHeadersDisabled",alwaysShowGroupHeaders:"=?alwaysShowGroupHeaders",boxAlreadyScrolls:"=?boxAlreadyScrolls",isCalendar:"=?isCalendar",reloadOnCompleteRepeating:"=?reloadOnCompleteRepeating",listControl:"="},link:function(h,i,k){function l(){if(!q){var b=$(this);q=!0,requestAnimationFrame(function(){var c=b.scrollTop(),d=b[0].scrollHeight,e=b.parent().height();if(d>e){var f=d-e-100;if(c>f)return q=!0,h.internalListControl.visibleSize+=h.internalListControl.pageSize,void h.internalListControl.reloadFilteredHomeworks(a.userHomeworks,!h.settings.hideCompleted)}q=!1})}}function m(a,b){if(a.isEvent)return void c.open({templateUrl:"templates/events/add-edit.html",controller:"AddEventCtrl",title:"Edit Event",analyticsTitle:"Edit Event",size:"medium",params:{regularEvent:a,editType:b}});var d=a.type&&"13"!=a.type.id?"Edit "+a.type.display:"Edit Homework";c.open({templateUrl:"templates/homework/add-edit.html",controller:"AddHomeworkCtrl",title:d,analyticsTitle:"Edit Homework",size:"medium",params:{homework:a,editType:b}})}function n(b,c){function e(){C.deleteEvent(b.id,F.getUserID(a),!0).then(function(b){ua.sendAppView("Delete Event Success"),angular.element(c.target).closest("li").addClass("closed"),d(function(){R.loadEvents(a,!0)},600)},function(a){ua.sendAppView("Delete Event Failed"),J.logError(a)})}function g(e){"undefined"==typeof e&&(e=[f(b.eventDate,"yyyyMMdd")]),C.deleteRepeatingEventDates(b.dbID,e,!0).then(function(b){ua.sendAppView("Delete Event Success"),h.isCalendar&&angular.element(c.target).closest("li").addClass("closed"),d(function(){R.loadEvents(a,!0)},600)},function(a){ua.sendAppView("Delete Event Failed"),J.logError(a)})}ua.sendAppView("Delete Event"),b.repeats&&b.isManual?nAlert({title:"This repeats",html:"<p>Which occurrence do you want to remove?</p>",confirmButtonText:"Only "+f(b.eventDate,"MMMM d"),altButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0},function(a,b){a?g():b&&e()}):a.userSettings.dontPromptDelete?e():nAlert({title:"Delete Event",html:"<p>Are you sure you want to delete <strong>"+b.title+"</strong>?</p>",confirmButtonText:"Delete",closeOnConfirm:!1,showCancelButton:!0},function(a){a&&(e(),nAlert.close())})}function p(){if(h.completeCheckboxEnabled){var a=!h.settings.hideCompleted,b=[],c=angular.element(".hw-row.complete");
E(c,function(c){var d=angular.element(c),e=angular.element(d[0].parentElement.firstElementChild);!e.hasClass("closed")&&a?d.removeClass("closed").addClass("opened"):d.removeClass("opened").addClass("closed"),e[0].id&&b.indexOf(e[0].id)<0&&b.push(e[0].id)}),b.length&&E(b,function(b){var c=angular.element("#"+b);if(a&&c.hasClass("hidden"))c.removeClass("hidden").addClass("visible").delay(400).removeClass("visible"),c.parent().removeClass("hidden");else{var d=angular.element(".hw-row."+b),e=0;E(d,function(a){var b=angular.element(a);b.hasClass("complete")&&b.hasClass("closed")&&(e+=1)}),d.length==e?(c.removeClass("visible").addClass("hidden"),c.parent().addClass("hidden")):c.hasClass("hidden")&&(c.removeClass("hidden").addClass("visible").delay(400).removeClass("visible"),c.parent().removeClass("hidden"))}})}}h.internalListControl=h.listControl||{},h.settings={hideCompleted:h.completeCheckboxEnabled?!F.showCompletedHomework(a):!1},a.syncIfTooLong();var q=!1;i.bind("scroll",l);var r=h.$watch("homeworkItems",function(a,b){a&&q&&a.hasmore&&(q=!1)});if(h.openHomework=function(b){if(b.isHallPass)return void a.openViewHallPass(b.id);if(b.isEvent)return void c.open({templateUrl:"templates/events/view-event.html",controller:"ViewEventCtrl",title:"View Event",analyticsTitle:"View Event",size:"medium",params:{regularEvent:b}});var d=b.type&&"13"!=b.type.id?b.type.display+" Details":"Homework Details";c.open({templateUrl:"templates/homework/view-homework.html",controller:"ViewHomeworkCtrl",title:d,analyticsTitle:"View Homework",size:"medium",params:{homework:b}})},h.editHomework=function(a,b){b.preventDefault(),b.stopPropagation(),a.repeats&&a.isManual?nAlert({title:"This repeats",html:"<p>Which occurrence do you want to edit?</p>",confirmButtonText:"Only "+f(a.dueDate,"MMMM d"),altButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0},function(b,c){b?m(a,"edit-one"):c&&m(a,"edit-all")}):m(a,null)},h.deleteHomework=function(b,c){function e(){o.deleteHw(b.id,F.getUserID(a),!0).then(function(b){ua.sendAppView("Delete Homework Success"),angular.element(c.target).closest("li").addClass("closed"),d(function(){L.loadHomeworks(a,!0)},600)},function(a){ua.sendAppView("Delete Homework Failed"),J.logError(a)})}function g(e){"undefined"!=typeof e&&e||(e=[f(b.dueDate,"yyyyMMdd")]),o.deleteRepeatingHomeworkDates(b.dbID,e,!0).then(function(b){ua.sendAppView("Delete Homework Success"),h.isCalendar&&angular.element(c.target).closest("li").addClass("closed"),d(function(){L.loadHomeworks(a,!0)},600)},function(a){ua.sendAppView("Delete Homework Failed"),J.logError(a)})}if(c.preventDefault(),c.stopPropagation(),!b.isDeletable)return void L.loadHomeworks(a);if(b.isEvent)return void n(b,c);var i="Homework";if(b.type&&"13"!=b.type.id&&(i=b.type.display),ua.sendAppView("Delete Homework"),b.repeats&&b.isManual){var j=!1,k=null;b.isLate&&!h.isCalendar&&(k=L.getLateRepeatHomeworkDates(b),k.length>1&&(j=!0)),j?nAlert({title:"This repeats",html:"<p>Which occurrence do you want to remove?</p>",confirmButtonText:"Only "+f(b.dueDate,"MMMM d"),altButtonText:"All late",secondAltButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0,showSecondAltButton:!0,width:520},function(a,b,c){a?g():b?g(k):c&&e()}):nAlert({title:"This repeats",html:"<p>Which occurrence do you want to remove?</p>",confirmButtonText:"Only "+f(b.dueDate,"MMMM d"),altButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0},function(a,b){a?g():b&&e()})}else a.userSettings.dontPromptDelete?e():nAlert({title:"Delete "+i,html:"<p>Are you sure you want to delete <strong>"+b.title+"</strong>?</p>",confirmButtonText:"Delete",closeOnConfirm:!1,showCancelButton:!0},function(a){a&&(e(),nAlert.close())})},h.completeHomework=function(b,c){function i(){if(b.isComplete&&b.isUncompleteable)b.complete=!1,b.isComplete=!1,b.isCompleteable=!0,b.isUncompleteable=!1,L.updateHomeworkLateUpcomingStatus(b),ua.sendEvent("Homework","Quick Link","Uncomplete");else if(b.isCompleteable){if(b.complete=!0,b.isComplete=!0,b.isCompleteable=!1,b.isUncompleteable=b.isNeverLateType?!b.isPastHwDueDate:!0,h.completeCheckboxEnabled){var e=!h.settings.hideCompleted;e||(b.isCompleting=!0,d(function(){angular.element(c.target).closest("li").addClass("closed"),b.isCompleting=!1,b.displayClasses=L.homeworkDisplayClasses(b),d(function(){h.internalListControl.reloadFilteredHomeworks(a.userHomeworks,!1)},600)},600))}ua.sendEvent("Homework","Quick Link","Complete")}b.displayClasses=L.homeworkDisplayClasses(b),o.setHomeworkStatus(b.dbID,b.complete,!0)}function j(c,d){var e=!1;c.isComplete&&c.isUncompleteable?(ua.sendEvent("Homework","Quick Link","Uncomplete"),h.isCalendar&&(c.complete=!1,c.isComplete=!1,c.isCompleteable=!0,c.isUncompleteable=!1,L.updateHomeworkLateUpcomingStatus(c),c.displayClasses=L.homeworkDisplayClasses(c))):c.isCompleteable&&(e=!0,ua.sendEvent("Homework","Quick Link","Complete"),h.isCalendar&&(c.complete=!0,c.isComplete=!0,c.isCompleteable=!1,c.isUncompleteable=b.isNeverLateType?!b.isPastHwDueDate:!0,c.displayClasses=L.homeworkDisplayClasses(c))),"undefined"==typeof d&&(d=[f(c.dueDate,"yyyyMMdd")]),o.setRepeatHomeworkStatus(c.dbID,d,e,!0).then(function(){h.reloadOnCompleteRepeating&&L.loadHomeworks(a,!0)})}function k(c,e){if(c&&c.repeats){var g=c.repeatCompleted?c.repeatCompleted:[];"undefined"==typeof e&&(e=[f(b.dueDate,"yyyyMMdd")]),E(e,function(a){b.isComplete&&b.isUncompleteable&&g.indexOf(a)>=0?g.splice(g.indexOf(a),1):b.isCompleteable&&g.indexOf(a)<0&&g.push(a)}),c.repeatCompleted=g,L.updateRepeatHomeworkDate(c),a.$$phase||a.$apply(),L.resortUIHomework(a,h.isCalendar),h.reloadOnCompleteRepeating||d(function(){h.internalListControl.reloadFilteredHomeworks(a.userHomeworks,!h.settings.hideCompleted)},500)}}if(c.preventDefault(),c.stopPropagation(),g.rewardableMomentOccurred(1),b.repeats){var l=e("filter")(a.userHomeworks,{id:b.id},!0),m=l&&l.length?l[0]:null;if(h.isCalendar)m&&k(m),j(b);else if(m)if(b.isComplete&&b.isUncompleteable)j(angular.copy(b)),b.repeatDates&&b.repeatCompleted&&b.repeatDates.length==b.repeatCompleted.length&&(b.complete=!1),k(b);else if(b.isCompleteable){var n=L.getLateRepeatHomeworkDates(m);n.length>1?nAlert({title:"This repeats",html:"<p>Which occurrence do you want to mark complete?</p>",confirmButtonText:"Only "+f(b.dueDate,"MMMM d"),altButtonText:"All late",secondAltButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0,showSecondAltButton:!0,width:520},function(a,c,d){a?(j(angular.copy(b)),k(b)):c?(j(angular.copy(b),n),k(b,n)):d&&(j(angular.copy(b),m.repeatDates),k(b,m.repeatDates))}):(j(angular.copy(b)),k(b))}}else i()},j.isMacApp){var s=h.$watch("hwFilters.active",function(a,b){a&&b&&h.hwFiltersEnabled&&h.hideFilters()}),t=angular.element("#hw-filter-options"),u=function(a){t.hasClass("show")&&"hw-filter-options"!=a.target.id&&0==$(a.target).parents("#hw-filter-options").size()&&h.hideFilters()};h.internalListControl.toggleFilters=function(c){c&&(c.preventDefault(),c.stopPropagation()),t=angular.element("#hw-filter-options"),t.hasClass("show")?(b.unbind("click",u),t.removeClass("show")):(b.bind("click",u),t.addClass("show")),h.$$phase||a.$$phase||h.$apply()},h.hideFilters=function(c){c&&(c.preventDefault(),c.stopPropagation()),t.hasClass("show")&&(b.unbind("click",u),t.removeClass("show"),h.$$phase||a.$$phase||h.$apply())},h.internalListControl.toggleShowCompleted=function(){h.settings.hideCompleted=!h.settings.hideCompleted,h.changeShowCompleted()};var v=a.$watch("userSettings.hideCompletedHomework",function(a){h.completeCheckboxEnabled&&h.settings.hideCompleted!=a&&(h.settings.hideCompleted=a,ua.sendEvent("Homework","Hide Completed",a?"True":"False"),p(),U.setMenuItemState("Filter","Show Completed",a?"off":"on"))});h.$on("$destroy",function(){s(),v(),r(),i.unbind("scroll",l)})}else if(h.completeCheckboxEnabled){var v=a.$watch("userSettings.hideCompletedHomework",function(a){h.settings.hideCompleted!=a&&(h.settings.hideCompleted=a,ua.sendEvent("Homework","Hide Completed",a?"True":"False"),p())});h.$on("$destroy",function(){v(),r(),i.unbind("scroll",l)})}h.toggleGroup=function(b){var c=angular.element(".group-row.group-"+b.id),e=c.hasClass("closed");c.toggleClass("closed"),c.parent().hasClass("sticky")&&angular.element(".box-scroll").animate({scrollTop:0},"slow");var f=angular.element(".hw-row.group-"+b.id);if(E(f,function(a){var b=angular.element(a);b.hasClass("closed")?b.removeClass("closed").addClass("opened"):b.removeClass("opened").addClass("closed")}),e&&h.internalListControl.closedGroups.indexOf(b.id)>=0){var g=[];E(h.internalListControl.closedGroups,function(a){a!=b.id&&g.push(a)}),h.internalListControl.closedGroups=g}else!e&&h.internalListControl.closedGroups.indexOf(b.id)<0&&h.internalListControl.closedGroups.push(b.id);d(function(){h.internalListControl.reloadFilteredHomeworks(a.userHomeworks,!h.settings.hideCompleted)},e?0:400)},h.changeShowCompleted=function(){a.userSettings.hideCompletedHomework=h.settings.hideCompleted;var b=F.toDBSettings(a.userSettings),c=a.user?a.user.id:null;w.setUserSettings(c,b,!0),p(),U.setMenuItemState("Filter","Show Completed",a.userSettings.hideCompletedHomework?"off":"on"),j.isMacApp&&h.hwFiltersEnabled&&angular.element("#hw-filter-options").hasClass("show")&&h.internalListControl.toggleFilters(),d(function(){h.internalListControl.reloadFilteredHomeworks(a.userHomeworks,!h.settings.hideCompleted)},500)}}}}]),ra.directive("validateRepeatEndDate",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.endDateBeforeDueDate=function(b,c){return a.homework&&a.homework.dueDate&&c?a.homework.dueDate&&c&&a.homework.dueDate<c?!0:!1:!0},d.$validators.endDateWithinOneYear=function(b,c){return a.homework&&a.homework.dueDate&&c?a.homework.dueDate&&c&&a.homework.dueDate>=c?!0:K.daysInBetween(a.homework.dueDate,c)<=365?!0:!1:!0}}}}),ra.controller("AddNoSchoolDayCtrl",["$rootScope","$scope","$filter","dateFilter","$modal","$modalParams","$document",function(a,b,c,d,e,f,g){b.schoolEvent={},f.schoolEvent?(b.isEditForm=!0,b.schoolEvent=f.schoolEvent):f.initDate&&(b.schoolEvent.eventDate=f.initDate),b.formTitle=b.isEditForm?"Edit No School Day":"Add No School Day",ua.sendAppView(b.isEditForm?"Edit No School Day":"Add No School Day"),b.openDatePicker=function(a,c){a.preventDefault(),a.stopPropagation(),"eventDate"==c?(b.schoolEvent.eventDate||(b.schoolEvent.eventDate=new Date),b.datepicker={opened:!0},b.eventEndsDatepicker={opened:!1}):"eventEnds"==c&&(b.datepicker={opened:!1},b.eventEndsDatepicker={opened:!0})},b.save=function(c,d){if(c.$valid){d.isAllDayEvent=!0,d.isNoSchoolEvent=!0,d.description||(d.description="No School"),d.eventEnds?(E(P,function(a){"1"==a.id&&(d.repeats=a)}),d.repeatEnds=d.eventEnds):d.repeatEnds&&(d.repeats["null"],d.repeatEnds=null);var f=R.toDBEvent(d),g=F.getUserID(a);C.ensureEvent(f,g,!0).then(function(c){ua.sendAppView(b.isEditForm?"Edit No School Day Success":"Add No School Day Success"),a.silentSync(),j.isMacApp?e.close():D.reloadStorage(a,!0).then(function(){e.close()})})}},b.deleteEvent=function(b){ua.sendAppView("Delete No School"),nAlert({title:"Delete No School Day?",html:"<p>Are you sure you want to delete?</p>",confirmButtonText:"Delete",closeOnConfirm:!1,showCancelButton:!0},function(c){c&&(nAlert.close(),C.deleteEvent(b.id,F.getUserID(a),!0).then(function(b){ua.sendAppView("Delete No School Success"),D.reloadStorage(a,!0).then(function(){e.close()})},function(a){ua.sendAppView("Delete No School Failed"),J.logError(a)}))})},b.cancel=function(){e.close()};var h=function(a){9===a.which&&(b.datepicker&&b.datepicker.opened?(b.datepicker={opened:!1},b.$$phase||b.$apply()):b.eventEndsDatepicker&&b.eventEndsDatepicker.opened&&(b.eventEndsDatepicker={opened:!1},b.$$phase||b.$apply()))};g.bind("keydown",h),b.$on("$destroy",function(){g.unbind("keydown",h)})}]),ra.directive("validateNoSchoolDates",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.endDateBeforeStartDate=function(b,c){return a.schoolEvent&&a.schoolEvent.eventDate&&b?a.schoolEvent.eventDate&&K.isDateValid(a.schoolEvent.eventDate)&&b&&K.isDateValid(b)&&a.schoolEvent.eventDate<b?!0:!1:!0}}}}),ra.controller("AddLateStartCtrl",["$rootScope","$scope","$filter","dateFilter","$modal","$modalParams","$document",function(a,b,c,d,e,f,g){b.schoolEvent={},f.schoolEvent?(b.isEditForm=!0,b.schoolEvent=f.schoolEvent,b.schoolEvent.endTime&&(b.schoolEvent.eventEndsTime=d(b.schoolEvent.endTime,"shortTime"))):f.initDate&&(b.schoolEvent.eventDate=f.initDate),b.formTitle=b.isEditForm?"Edit Late Start":"Add Late Start",ua.sendAppView(b.isEditForm?"Edit Late Start":"Add Late Start"),b.openDatePicker=function(a,c){a.preventDefault(),a.stopPropagation(),"eventDate"==c?(b.schoolEvent.eventDate||(b.schoolEvent.eventDate=new Date),b.datepicker={opened:!0},b.repeatEndsDatepicker={opened:!1}):"repeatEnds"==c&&(b.datepicker={opened:!1},b.repeatEndsDatepicker={opened:!0})},b.repeatChanged=function(){!b.schoolEvent.repeats&&b.schoolEvent.repeatEnds?delete b.schoolEvent.repeatEnds:b.schoolEvent.repeats&&!b.schoolEvent.repeatEnds&&b.schoolEvent.eventDate&&("1"==b.schoolEvent.repeats.id?b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,1):"2"==b.schoolEvent.repeats.id?5==b.schoolEvent.eventDate.getDay()?b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,3):6==b.schoolEvent.eventDate.getDay()?b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,2):0==b.schoolEvent.eventDate.getDay()&&(b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,1)):"3"==b.schoolEvent.repeats.id?b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,7):"4"==b.schoolEvent.repeats.id?b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,14):"5"==b.schoolEvent.repeats.id&&(b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,30)))},b.save=function(c,d){if(c.$valid){d.isAllDayEvent=!1,d.isNoSchoolEvent=!0,d.description||(d.description="Late Start");var f=R.toDBEvent(d),g=F.getUserID(a);C.ensureEvent(f,g,!0).then(function(c){ua.sendAppView(b.isEditForm?"Edit Late Start Success":"Add Late Start Success"),a.silentSync(),j.isMacApp?e.close():D.reloadStorage(a,!0).then(function(){e.close()})})}},b.deleteEvent=function(b){ua.sendAppView("Delete Late Start"),nAlert({title:"Delete Late Start?",html:"<p>Are you sure you want to delete?</p>",confirmButtonText:"Delete",closeOnConfirm:!1,showCancelButton:!0},function(c){c&&(nAlert.close(),C.deleteEvent(b.id,F.getUserID(a),!0).then(function(b){ua.sendAppView("Delete Late Start Success"),D.reloadStorage(a,!0).then(function(){e.close()})},function(a){ua.sendAppView("Delete Late Start Failed"),J.logError(a)}))})},b.cancel=function(){e.close()};var h=function(a){9===a.which&&(b.datepicker&&b.datepicker.opened?(b.datepicker={opened:!1},b.$$phase||b.$apply()):b.eventEndsDatepicker&&b.eventEndsDatepicker.opened&&(b.eventEndsDatepicker={opened:!1},b.$$phase||b.$apply()))};g.bind("keydown",h),b.$on("$destroy",function(){g.unbind("keydown",h)})}]),ra.controller("AddEarlyReleaseCtrl",["$rootScope","$scope","$filter","dateFilter","$modal","$modalParams","$document",function(a,b,c,d,e,f,g){b.schoolEvent={},f.schoolEvent?(b.isEditForm=!0,b.schoolEvent=f.schoolEvent,b.schoolEvent.hasTime&&(b.schoolEvent.eventTime=d(b.schoolEvent.eventDate,"shortTime"))):f.initDate&&(b.schoolEvent.eventDate=f.initDate),b.formTitle=b.isEditForm?"Edit Early Release":"Add Early Release",ua.sendAppView(b.isEditForm?"Edit Early Release":"Add Early Release"),b.openDatePicker=function(a,c){a.preventDefault(),a.stopPropagation(),"eventDate"==c?(b.schoolEvent.eventDate||(b.schoolEvent.eventDate=new Date),b.datepicker={opened:!0},b.repeatEndsDatepicker={opened:!1}):"repeatEnds"==c&&(b.datepicker={opened:!1},b.repeatEndsDatepicker={opened:!0})},b.repeatChanged=function(){!b.schoolEvent.repeats&&b.schoolEvent.repeatEnds?delete b.schoolEvent.repeatEnds:b.schoolEvent.repeats&&!b.schoolEvent.repeatEnds&&b.schoolEvent.eventDate&&("1"==b.schoolEvent.repeats.id?b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,1):"2"==b.schoolEvent.repeats.id?5==b.schoolEvent.eventDate.getDay()?b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,3):6==b.schoolEvent.eventDate.getDay()?b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,2):0==b.schoolEvent.eventDate.getDay()&&(b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,1)):"3"==b.schoolEvent.repeats.id?b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,7):"4"==b.schoolEvent.repeats.id?b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,14):"5"==b.schoolEvent.repeats.id&&(b.schoolEvent.repeatEnds=J.addDaysToDate(b.schoolEvent.eventDate,30)))},b.save=function(c,d){if(c.$valid){d.isAllDayEvent=!1,d.isNoSchoolEvent=!0,d.description||(d.description="Early Release");var f=R.toDBEvent(d),g=F.getUserID(a);C.ensureEvent(f,g,!0).then(function(c){ua.sendAppView(b.isEditForm?"Edit Early Release Success":"Add Early Release Success"),a.silentSync(),j.isMacApp?e.close():D.reloadStorage(a,!0).then(function(){e.close()})})}},b.deleteEvent=function(b){ua.sendAppView("Delete Early Release"),nAlert({title:"Delete Early Release Day?",html:"<p>Are you sure you want to delete?</p>",confirmButtonText:"Delete",closeOnConfirm:!1,showCancelButton:!0},function(c){c&&(nAlert.close(),C.deleteEvent(b.id,F.getUserID(a),!0).then(function(b){ua.sendAppView("Delete Early Release Success"),D.reloadStorage(a,!0).then(function(){e.close()})},function(a){ua.sendAppView("Delete Early Release Failed"),J.logError(a)}))})},b.cancel=function(){e.close()};var h=function(a){9===a.which&&(b.datepicker&&b.datepicker.opened?(b.datepicker={opened:!1},b.$$phase||b.$apply()):b.eventEndsDatepicker&&b.eventEndsDatepicker.opened&&(b.eventEndsDatepicker={opened:!1},b.$$phase||b.$apply()))};g.bind("keydown",h),b.$on("$destroy",function(){g.unbind("keydown",h)})}]),ra.controller("AddEventCtrl",["$rootScope","$scope","$filter","dateFilter","$modal","$modalParams","$timeout","$location","$document",function(a,b,c,d,e,f,g,h,i){function k(a){delete a.repeats,delete a.repeatEnds,delete a.repeatCompleted,delete a.repeatExcept,delete a.repeatBegins,delete a.repeatDates}b.regularEvent={},b.repeatEnabled=!0;var l=angular.copy(a.reminderOptions);l.push({id:"c",display:"Custom Reminder..."}),b.eventReminderOptions=l,f.regularEvent?(b.regularEvent=angular.copy(f.regularEvent),b.isEditForm=!0,b.regularEvent.repeats&&(b.editType=f.editType?f.editType:"edit-all","edit-one"==b.editType?(b.regularEvent.id=J.simpleID(15),b.repeatEnabled=!1,k(b.regularEvent),b.$$phase||b.$apply()):(b.regularEvent.eventDate=b.regularEvent.repeatBegins,b.isManualHomework||(b.completeDisabled=!0))),b.regularEvent.hasTime&&(b.regularEvent.eventTime=d(b.regularEvent.eventDate,"shortTime")),b.regularEvent.endTime&&(b.regularEvent.eventEndsTime=d(b.regularEvent.endTime,"shortTime")),b.regularEvent.reminder&&"c"==b.regularEvent.reminder.id.charAt(0)&&b.eventReminderOptions.push(b.regularEvent.reminder)):(f.initDate&&(b.regularEvent.eventDate=f.initDate),a.user&&a.userSettings.defaultReminder&&(b.regularEvent.reminder=a.userSettings.defaultReminder)),b.eventDateTitle="Date",b.formTitle=b.isEditForm?"Edit Event":"Add Event",ua.sendAppView(b.isEditForm?"Edit Event":"Add Event"),b.openDatePicker=function(a,c){a.preventDefault(),a.stopPropagation(),"eventDate"==c?(b.regularEvent.eventDate||(b.regularEvent.eventDate=new Date),b.datepicker={opened:!0},b.repeatEndsDatepicker={opened:!1}):"repeatEnds"==c&&(b.datepicker={opened:!1},b.repeatEndsDatepicker={opened:!0})},b.repeatChanged=function(){!b.regularEvent.repeats&&b.regularEvent.repeatEnds?delete b.regularEvent.repeatEnds:b.regularEvent.repeats&&!b.regularEvent.repeatEnds&&b.regularEvent.eventDate&&("1"==b.regularEvent.repeats.id?b.regularEvent.repeatEnds=J.addDaysToDate(b.regularEvent.eventDate,1):"2"==b.regularEvent.repeats.id?5==b.regularEvent.eventDate.getDay()?b.regularEvent.repeatEnds=J.addDaysToDate(b.regularEvent.eventDate,3):6==b.regularEvent.eventDate.getDay()?b.regularEvent.repeatEnds=J.addDaysToDate(b.regularEvent.eventDate,2):0==b.regularEvent.eventDate.getDay()&&(b.regularEvent.repeatEnds=J.addDaysToDate(b.regularEvent.eventDate,1)):"3"==b.regularEvent.repeats.id?b.regularEvent.repeatEnds=J.addDaysToDate(b.regularEvent.eventDate,7):"4"==b.regularEvent.repeats.id?b.regularEvent.repeatEnds=J.addDaysToDate(b.regularEvent.eventDate,14):"5"==b.regularEvent.repeats.id&&(b.regularEvent.repeatEnds=J.addDaysToDate(b.regularEvent.eventDate,30))),b.regularEvent&&b.regularEvent.repeats?b.eventDateTitle="Begins":b.eventDateTitle="Date"},b.reminderChanged=function(){if(b.regularEvent.reminder&&"c"==b.regularEvent.reminder.id){if(b.regularEvent.repeats)return b.regularEvent.reminder=null,void nAlert({html:"Sorry, can't set a custom reminder for an item that repeats.<br>Please choose a different reminder option."});b.showCustomReminderForm=!0,b.regularEvent.reminder.date?b.customReminder={date:b.regularEvent.reminder.date,time:d(b.regularEvent.reminder.date,"shortTime")}:b.customReminder={date:new Date},U.adjustModalHeight()}else b.showCustomReminderForm=!1},b.selectCustomReminder=function(a){if(a.$valid){var c=J.parseTimeStr(b.customReminder.time,b.customReminder.date),e={id:"c:"+J.formatISO8601(c),display:d(c,"MMMM d - h:mm a")};b.regularEvent.reminder=e,b.eventReminderOptions.push(e),b.showCustomReminderForm=!1,U.adjustModalHeight()}},b.cancelCustomReminder=function(c){a.user&&a.user.isPremiumOrSchoolAccount&&a.userSettings.defaultReminder?b.regularEvent.reminder=a.userSettings.defaultReminder:b.regularEvent.reminder="",b.showCustomReminderForm=!1,U.adjustModalHeight()},b.alertReminder=function(){return ua.sendAppView("Event Reminder Popup (No User)"),a.user?void 0:void nAlert({title:"Reminders",text:"You need a myHomework account to setup reminders.",confirmButtonText:"Sign up",showCancelButton:!0},function(a){a&&(ua.sendAppView("Event Reminder Popup - Signup"),J.openAppURL(h,"/signup"),e.close())})},b.showAddAttachment=function(){return a.user&&a.user.isPremiumOrSchoolAccount?void((!b.regularEvent.files||b.regularEvent.files.length<5)&&(ua.sendAppView("Event Attachment Form"),b.showFileUpload=!0,U.adjustModalHeight())):a.user&&a.user.mustRenew?void e.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Renew Account",size:"small",params:{isRenew:!0}}):(a.user?ua.sendAppView("Event Attachment Popup (No Premium)"):ua.sendAppView("Event Attachment Popup (No User)"),void nAlert({title:"File Attachments",text:"You need a premium myHomework account to attach files.",confirmButtonText:a.user?"Upgrade to Premium":"Sign up",showCancelButton:!0},function(b){b&&(a.user?(ua.sendAppView("Event Attachment Popup - Upgrade"),e.close(),e.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"})):(ua.sendAppView("Event Attachment Popup - Signup"),J.openAppURL(h,"/signup"),e.close()))}))},b.attachmentsUpgradeOrSignUp=function(){return a.user&&a.user.isPremiumOrSchoolAccount?void b.showAddAttachment():void(a.user?(ua.sendAppView("Event Attachment - Upgrade"),e.close(),e.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"})):(ua.sendAppView("Event Attachment - Signup"),J.openAppURL(h,"/signup"),e.close()))};b.$watch("regularEvent.uploadedFile",function(c){if(c){var d=angular.copy(c);b.regularEvent.files&&0!=b.regularEvent.files.length||(b.regularEvent.files=new Array),b.regularEvent.files.push(d),b.regularEvent.dbID&&C.updateEventFiles(b.regularEvent.dbID,b.regularEvent.files,!0).then(function(){R.loadEvents(a,!0)}),b.regularEvent.uploadedFile=null,b.showFileUpload=!1,U.adjustModalHeight()}});b.deleteAttachment=function(a){if(ua.sendAppView("Delete Event Attachment"),a){a.id;if(b.regularEvent.files&&b.regularEvent.files.length>0){var c=new Array;for(var d in b.regularEvent.files){var e=b.regularEvent.files[d];e.id!=a.id&&c.push(e)}c.length>0?b.regularEvent.files=c:b.regularEvent.files=null}}},b.hideAddAttachment=function(){b.showFileUpload=!1,U.adjustModalHeight()},b.save=function(c,g){if(c.$valid){var h=g.eventDate;if(g.eventTime&&(h=J.parseTimeStr(g.eventTime,h)),!K.isDateValid(h))return void nAlert("Please enter a valid date.");if(g.eventEndsTime){var i=J.parseTimeStr(g.eventEndsTime,angular.copy(g.eventDate));if(!i||!K.isDateValid(i))return void nAlert("Please enter a valid end time.");if(!g.eventTime)return void nAlert("Please enter a start time.");if(h>=i)return console.log("endTime",i),console.log("eventDate",h),void nAlert("End time must be after start time.")}b.isEditForm&&b.editType&&"edit-one"==b.editType&&(C.deleteRepeatingEventDates(f.regularEvent.dbID,[d(f.regularEvent.eventDate,"yyyyMMdd")],!0),k(g));var l=R.toDBEvent(g),m=F.getUserID(a);C.ensureEvent(l,m,!0).then(function(c){ua.sendAppView(b.isEditForm?"Edit Event Success":"Add Event Success"),a.silentSync(),j.isMacApp?e.close():g.reminder?D.reloadStorage(a,!0).then(function(){e.close()}):R.loadEvents(a,!0).then(function(){e.close()})},function(a){ua.sendAppView(b.isEditForm?"Edit Event Failed":"Add Event Failed"),J.logError(a)})}},b.cancel=function(){e.close()};var m=function(a){9===a.which&&(b.datepicker&&b.datepicker.opened?(b.datepicker={opened:!1},b.$$phase||b.$apply()):b.repeatEndsDatepicker&&b.repeatEndsDatepicker.opened&&(b.repeatEndsDatepicker={opened:!1},b.$$phase||b.$apply()))};i.bind("keydown",m),b.$on("$destroy",function(){i.unbind("keydown",m)})}]),ra.controller("ViewEventCtrl",["$rootScope","$scope","$modal","$modalParams","$location","$filter","dateFilter",function(a,b,c,d,e,f,g){function h(a,b){c.close(),c.open({templateUrl:"templates/events/add-edit.html",controller:"AddEventCtrl",title:"Edit Event",analyticsTitle:"Edit Event",size:"medium",params:{regularEvent:a,editType:b}})}b.regularEvent=angular.copy(d.regularEvent),b.eventDateTitle=b.regularEvent.repeats?"Begins":"Date",b.editEvent=function(a){a.repeats&&a.isManual?nAlert({title:"This repeats",html:"<p>Which occurrence do you want to edit?</p>",confirmButtonText:"Only "+g(a.eventDate,"MMMM d"),altButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0},function(b,c){b?h(a,"edit-one"):c&&h(a,"edit-all")}):h(a,null)},b.deleteEvent=function(b){function d(){C.deleteEvent(b.id,F.getUserID(a),!0).then(function(b){ua.sendAppView("Delete Event Success"),j.isMacApp||R.loadEvents(a,!0),c.close()},function(a){ua.sendAppView("Delete Event Failed"),J.logError(a)})}function e(d){"undefined"==typeof d&&(d=[g(b.eventDate,"yyyyMMdd")]),C.deleteRepeatingEventDates(b.dbID,d,!0).then(function(b){ua.sendAppView("Delete Event Success"),j.isMacApp||R.loadEvents(a,!0),c.close()},function(a){ua.sendAppView("Delete Event Failed"),J.logError(a)})}return b.isDeletable?(ua.sendAppView("Delete Event"),void(b.repeats&&b.isManual?nAlert({title:"This repeats",html:"<p>Which occurrence do you want to remove?</p>",confirmButtonText:"Only "+g(b.eventDate,"MMMM d"),altButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0},function(a,b){a?e():b&&d()}):a.userSettings.dontPromptDelete?d():nAlert({title:"Delete Event",html:"<p>Are you sure you want to delete <strong>"+b.title+"</strong>?</p>",confirmButtonText:"Delete",closeOnConfirm:!1,showCancelButton:!0},function(a){a&&(d(),nAlert.close())}))):void R.loadEvents(a,!0)},b.cancel=function(){c.close()}}]),ra.controller("AddManualClassCtrl",["$rootScope","$scope","$modal","$modalParams","$document","$timeout",function(a,b,c,d,e,f){b.formTitle="Add Class",b.cls={},d.cls&&(b.formTitle="Edit Class",b.isEditForm=!0,b.cls=angular.copy(d.cls)),b.openDatePicker=function(a,c){a.preventDefault(),a.stopPropagation(),"starts"==c?(b.startDatePicker={opened:!0},b.endDatePicker={opened:!1}):"ends"==c&&(b.endDatePicker={opened:!0},b.startDatePicker={opened:!1})},b.openColorPicker=function(a){a.preventDefault(),a.stopPropagation(),b.colorPicker={opened:!0}},b.save=function(d,e,g){if(d.$valid){var h=Q.toDBClass(e),i=F.getUserID(a);q.ensureClass(h,i,!0).then(function(e){ua.sendAppView(b.isEditForm?"Edit Class Success":"Add Class Success"),a.silentSync(),D.reloadStorage(a,!0).then(function(){if(!b.isEditForm&&g&&"another"==g)b.cls={},b.alertHiding=!0,b.classAdded=!0,d.$setPristine(),d.$setUntouched(),b.$apply(),f(function(){b.alertHiding=!1,j.isMacApp&&f(function(){U.adjustModalHeight()},150)},150);else if(!b.isEditForm&&g&&"times"==g){var e=null;if(E(a.userClasses,function(a){a.id==h.i&&(e=a)}),c.close(),e){var i="Add Class Times";e.name&&(i="Add Class Times: "+e.name),c.open({templateUrl:"templates/classtimes/add-class-times.html",controller:"AddClassTimeCtrl",title:i,analyticsTitle:"Add Class Times",size:"medium",params:{cls:e}})}}else c.close()})},function(a){ua.sendAppView(b.isEditForm?"Edit Class Failed":"Add Class Failed"),nAlert("An error occurred when trying to save this class. Please try again later."),J.logError(a)})}},b.cancel=function(){c.close()},b.closeAlert=function(){b.alertHiding=!0,f(function(){b.classAdded=!1},200)};var g=function(a){9===a.which&&b.endDatePicker&&b.endDatePicker.opened&&(b.endDatePicker={opened:!1},b.$$phase||b.$apply())};e.bind("keydown",g),b.$on("$destroy",function(){e.unbind("keydown",g)})}]),ra.directive("validateClassDates",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.endDateBeforeStartDate=function(b,c){return a.cls&&a.cls.starts&&b?a.cls.starts&&K.isDateValid(a.cls.starts)&&b&&K.isDateValid(b)&&a.cls.starts<b?!0:!1:!0}}}}),ra.directive("validateClassesDates",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.endDateBeforeStartDate=function(b,c){return a.clss&&a.clss.starts&&b?a.clss.starts&&K.isDateValid(a.clss.starts)&&b&&K.isDateValid(b)&&a.clss.starts<b?!0:!1:!0}}}}),ra.controller("EditClassColorCtrl",["$rootScope","$scope","$modal","$modalParams",function(a,b,c,d){b.cls=angular.copy(d.cls),b.color=b.cls.color||null,b.isEditForm=b.cls.color?!0:!1,b.openColorPicker=function(a){a.preventDefault(),a.stopPropagation(),b.colorPicker={opened:!0}},b.save=function(d){if(d.$valid){b.cls.color=b.color;var e=Q.toDBClass(b.cls),f=F.getUserID(a);q.ensureClass(e,f,!0).then(function(d){ua.sendAppView(b.isEditForm?"Edit Class Color Success":"Add Class Color Success"),j.isMacApp||D.reloadStorage(a,!0),c.close()},function(a){ua.sendAppView(b.isEditForm?"Edit Class Color Failed":"Add Class Color Failed"),J.logError(a)})}},b.cancel=function(){c.close()}}]),ra.controller("AddClassesCtrl",["$rootScope","$scope","$modal","$modalParams","$document","$timeout",function(a,b,c,d,e,f){b.showingClassNames=5,b.clss={},b.addMoreClassNames=function(){b.showingClassNames>=10||(b.showingClassNames+=1,b.$$phase||b.$apply(),j.isMacApp&&f(function(){U.adjustModalHeight()},150))},b.openDatePicker=function(a,c){a.preventDefault(),a.stopPropagation(),"starts"==c?(b.startDatePicker={opened:!0},b.endDatePicker={opened:!1}):"ends"==c&&(b.endDatePicker={opened:!0},b.startDatePicker={opened:!1})},b.save=function(b,d){if(b.$valid){for(var e=[],f=1;10>=f;f++){var g=d["class"+f];g&&g.length&&e.push(Q.toDBClass({name:g,starts:d.starts,ends:d.ends}))}var h=new Array,i=F.getUserID(a);E(e,function(a){h.push(function(){return q.ensureClass(a,i,!0)})}),Promise.loop(h).then(function(b){D.reloadStorage(a,!0).then(function(){var b=[];if(a.userClasses&&E(a.userClasses,function(a){a.isCurrent&&!a.classTimes&&b.push(a)}),c.close(),b.length){var d="Add Class Times";b[0]&&b[0].name&&(d="Add Class Times: "+b[0].name),c.open({templateUrl:"templates/classtimes/add-class-times.html",controller:"AddClassTimeCtrl",title:d,analyticsTitle:"Add Class Times",size:"medium",params:{clss:b,clssI:0,cls:b[0]}})}})},function(a){nAlert({html:"An error occurred when trying to add your classes.<br>Please try again later."}),c.close()})}},b.cancel=function(){c.close();
};var g=function(a){9===a.which&&b.endDatePicker&&b.endDatePicker.opened&&(b.endDatePicker={opened:!1},b.$$phase||b.$apply())};e.bind("keydown",g),b.$on("$destroy",function(){e.unbind("keydown",g)})}]),ra.controller("AddOrJoinClassCtrl",["$rootScope","$scope","$modal","$location",function(a,b,c,d){var e=!0;if(a.userClasses){var f=0;E(a.userClasses,function(a){a.isCurrent&&(f+=1)}),f>=2&&(e=!1)}b.showAddClasses=e,b.openSchool=function(a){c.close(),c.open({templateUrl:"templates/classes/find-school-teachers.html",controller:"FindSchoolTeachersCtrl",title:"Find School Teachers",size:"medium",params:{school:a}})},b.openFindClass=function(){c.close(),c.open({templateUrl:"templates/classes/find-class.html",controller:"FindClassCtrl",title:"Find Class",size:"medium"})},b.openAddManualClass=function(){c.close(),c.open({templateUrl:"templates/classes/add-edit.html",controller:"AddManualClassCtrl",title:"Add Class",size:"medium"})},b.openAddClasses=function(){c.close(),c.open({templateUrl:"templates/classes/add-classes.html",controller:"AddClassesCtrl",title:"Add Classes",size:"medium"})},b.openSignup=function(){ua.sendAppView("Open Signup from Add or Join Class"),J.openAppURL(d,"/signup"),c.close()},b.cancel=function(){c.close()}}]),ra.controller("FindSchoolTeachersCtrl",["$rootScope","$scope","$modal","$modalParams","$location","$timeout","schoolsAPI",function(a,b,c,d,e,f,g){function h(){ua.sendEvent("Fetch","School Teachers","Start"),g.fetchSchoolDetails(b.school.slug).then(function(a){ua.sendEvent("Fetch","School Teachers","Success"),b.fetchSpinner.show=!1,b.school=a,b.$$phase||b.$apply(),U.adjustModalHeight()},function(a){ua.sendEvent("Fetch","School Teachers","Failed"),b.fetchSpinner.show&&(b.fetchSpinner.show=!1,b.$$phase||b.$apply(),i(404==a?"School not found.":500==a?"Oops! An error occurred when trying to get this school's teachers. Please try again later.":503==a?"Oops! Our server is unavailable right now. Please try again later.":403==a?"Something went wrong. Please sign out and sign back in.":navigator.onLine?"We were unable to get this school's teachers at this time.<br>Please try again later.":"We were unable to get this school's teachers at this time.<br>Please make sure you have internet connection and try again."))})}function i(a){nAlert({title:a.length<25?a:null,html:a.length>=25?a:null,closeOnConfirm:!1},function(){nAlert.close(),c.close()})}b.school=d.school,b.fetchSpinner={show:!0,text:"Loading Teachers"},b.openTeacher=function(a){ua.sendAppView("Open Teacher from Find School Teachers"),J.openAppURL(e,"/teachers/id/"+a.id+"/classes"),c.close()},b.openAddManualClass=function(){ua.sendAppView("Open Add Class from Find School Teachers"),c.close(),c.open({templateUrl:"templates/classes/add-edit.html",controller:"AddManualClassCtrl",title:"Add Class",size:"medium"})},f(h,100),b.cancel=function(){c.close()}}]),ra.controller("FindClassCtrl",["$rootScope","$scope","$modal","$timeout","$location","schoolsAPI",function(a,b,c,d,e,f){function g(){J.getGeolocation().then(function(a){b.fetchSpinner.show=!1,b.$$phase||b.$apply(),a&&h()})}function h(){b.fetchSpinner={show:!0,text:"Fetching Nearby Schools"},b.$$phase||b.$apply(),ua.sendEvent("Fetch","Neaby Schools","Start"),f.fetchNearbySchools().then(function(a){ua.sendEvent("Fetch","Neaby Schools","Success"),b.geoSchools=a,b.fetchSpinner.show=!1,b.$$phase||b.$apply(),U.adjustModalHeight()},function(a){ua.sendEvent("Fetch","Neaby Schools","Failed"),b.fetchSpinner.show=!1,b.$$phase||b.$apply(),500==a?i("Oops! An error occurred when trying to get nearby schools. Please try again later."):503==a?i("Oops! Our server is unavailable right now. Please try again later."):403==a?i("Something went wrong. Please sign out and sign back in."):j("We were unable to get nearby schools.<br>Please try searching.")})}function i(a){nAlert({html:a,closeOnConfirm:!1},function(){nAlert.close(),c.close()})}function j(a){nAlert({html:a,closeOnConfirm:!1},function(){nAlert.close()})}b.searchQuery=null,b.fetchSpinner={show:!0,text:"Determining Location"},d(g,100),b.searchSchoolsAndTeachers=function(a){a.$valid&&(b.fetchSpinner={show:!0,text:"Searching Schools and Teachers"},b.$$phase||b.$apply(),ua.sendEvent("Search","Schools And teachers","Start"),f.searchSchoolsAndTeachers(b.searchQuery).then(function(a){ua.sendEvent("Search","Schools And teachers","Success"),b.defaultResult=a["default"],b.geoSchools=null,b.searchResult=a,b.fetchSpinner.show=!1,b.$$phase||b.$apply(),U.adjustModalHeight()},function(a){ua.sendEvent("Search","Schools And teachers","Failed"),b.fetchSpinner.show=!1,b.$$phase||b.$apply(),i(500==a?"Oops! An error occurred when trying find schools or teachers. Please try again later.":503==a?"Oops! Our server is unavailable right now. Please try again later.":403==a?"Something went wrong. Please sign out and sign back in.":navigator.onLine?"We were unable to find schools or teachers.<br>Please try again later.":"We were unable to find schools or teachers.<br>Please make sure you have internet connection and try again.")}))},b.changeDefaultResult=function(a){a!=b.defaultResult&&(b.defaultResult=a,U.adjustModalHeight())},b.openSchool=function(a){ua.sendAppView("Open School from Find Class"),c.close(),c.open({templateUrl:"templates/classes/find-school-teachers.html",controller:"FindSchoolTeachersCtrl",title:"Find School Teachers",size:"medium",params:{school:a}})},b.openTeacher=function(a){ua.sendAppView("Open Teacher from Find Class"),J.openAppURL(e,"/teachers/id/"+a.id+"/classes"),c.close()},b.cancel=function(){c.close()}}]),ra.controller("ClassesCtrl",["$rootScope","$scope","$modal","$location","$window",function(a,b,c,d,e){function f(){var a=null;"today"==b.clsFilters.active&&b.filteredClasses.length&&b.filteredClasses[0].items&&E(b.filteredClasses[0].items,function(b){b.dateClassTimes&&E(b.dateClassTimes,function(b){"block"==b.type&&(a=b.label)})}),b.blockScheduleChangeLabel=a}function g(){if(b.blockScheduleChangeLabel)return void(b.alternateWeekSwitcherWeek=null);if("today"==b.clsFilters.active&&b.filteredClasses.length){var a=0,c=0,d=0;if(b.filteredClasses[0].items&&E(b.filteredClasses[0].items,function(b){b.classTimesAlternate&&(a+=1,b.classTimesIsWeek1?c+=1:d+=1)}),b.filteredClasses[0].altItems&&E(b.filteredClasses[0].altItems,function(b){b.classTimesAlternate&&(a+=1,b.classTimesIsWeek1?c+=1:d+=1)}),a>0)return void(a==c?b.alternateWeekSwitcherWeek="1":a==d?b.alternateWeekSwitcherWeek="2":b.alternateWeekSwitcherWeek=null)}b.alternateWeekSwitcherWeek=null}function h(){var a=!1;if("all"==b.clsFilters.active&&b.filteredClasses.length&&b.filteredClasses[0].items){var c=!1;E(b.filteredClasses[0].items,function(a){a.isCurrent&&a.classTimes&&(c=!0)}),c||(a=!0)}b.showAddClassTimes=a}function i(){if(j.isMacApp)try{var a=MacApp.Menu.getItem("Filter").submenu;a.getItem("All").setState("all"==b.clsFilters.active?"on":"off"),a.getItem("Today").setState("today"==b.clsFilters.active?"on":"off"),a.getItem("Tomorrow").setState("tomorrow"==b.clsFilters.active?"on":"off")}catch(c){Canadarm.error("Failed to load Menu on Mac",c)}}a.bodyClass=null,a.nav="classes",b.clsFiltersEnabled=!1,b.clsFilters={active:null},b.clsListControl={},b.addClass=function(){c.open({templateUrl:"templates/classes/add-or-join.html",controller:"AddOrJoinClassCtrl",title:"Add or Join Class",size:a.userSchools?"medium":"medium-large"})};var k=a.$watch("userClasses",function(a){return b.clsFilters.active?void b.clsListControl.reloadFilteredClasses(a):void D.getLocalItem("defaultClsFilter").then(function(c){b.clsFilters.active=c||"all",ua.sendEvent("Classes","Filter",b.clsFilters.active),b.clsListControl.reloadFilteredClasses(a),i()})}),l=new Date,m=b.$watch("clsFilters.active",function(c,d){c&&d&&(l=new Date,"tomorrow"==c&&l.setDate(l.getDate()+1),ua.sendEvent("Classes","Filter",c),b.filteredClasses=Q.filterClassesBy(a.userClasses,c,l),b.groupingDisabled=b.filteredClasses.length>1?!1:!0,D.setLocalItem("defaultClsFilter",c),angular.element(".box-scroll").scrollTop(0),i(),f(),g(),h())});if(b.clsListControl.reloadFilteredClasses=function(a,c){b.filteredClasses=Q.filterClassesBy(a,b.clsFilters.active,l),b.clsFiltersEnabled=a&&a.length>0?!0:!1,b.groupingDisabled=b.filteredClasses.length>1?!1:!0,f(),g(),h(),b.$$phase||b.$apply()},b.$on("$destroy",function(){if(k(),m(),j.isMacApp)try{U.setMenuItemState("View","Classes","off"),MacApp.Menu.getItem("Filter")&&MacApp.Menu.getItem("Filter").remove()}catch(a){Canadarm.error("Failed to load Menu on Mac",a)}}),j.isMacApp)try{U.setMenuItemState("View","Classes","on"),MacApp.Menu.addItem({label:"Filter",index:3});var n=MacApp.Menu.getItem("Filter").submenu;n.addItem({label:"All"},function(){b.clsFilters.active="all",b.$$phase||b.$apply()}),n.addItem({label:"Today"},function(){b.clsFilters.active="today",b.$$phase||b.$apply()}),n.addItem({label:"Tomorrow"},function(){b.clsFilters.active="tomorrow",b.$$phase||b.$apply()})}catch(o){Canadarm.error("Failed to load Menu on Mac",o)}b.openThemeBanner=function(a){ua.sendEvent("Theme Ad",a.ss,"Clicked"),a.sp&&a.ss?d.url("/schools/"+a.ss):a.u&&J.openURL(e,a.u)},b.openmyHomeworkAd=function(a){ua.sendEvent("Ads",a.adID,"Clicked"),a.openSchoolPage&&a.schoolSlug?d.url("/schools/"+a.schoolSlug):a.adURL&&J.openURL(e,a.adURL)},b.openTip=function(a){ua.sendEvent("Tips",a.id,"Clicked"),"upgrade"==a.url?c.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"}):"signup"==a.url?(d.url("/signup/"),b.$$phase||b.$$apply()):"email"==a.url?c.open({templateUrl:"templates/account/edit-account.html",controller:"EditAccountCtrl",title:"Edit Account",size:"medium"}):"picture"==a.url?c.open({templateUrl:"templates/account/edit-picture.html",controller:"EditPictureCtrl",title:"Edit Picture",size:"medium"}):J.openURL(e,a.url)},b.openRenew=function(){c.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Renew Account",size:"small",params:{isRenew:!0}})}}]),ra.directive("classesList",["$rootScope","$document","$location","$modal","$timeout",function(a,b,c,d,e){return{restrict:"E",replace:!0,templateUrl:"templates/classes/classes-list.html",scope:{classItems:"=classItems",clsFiltersEnabled:"=?clsFiltersEnabled",clsFilters:"=clsFilters",groupingDisabled:"=?groupingDisabled",stickyHeadersDisabled:"=?stickyHeadersDisabled",alwaysShowGroupHeaders:"=?alwaysShowGroupHeaders",boxAlreadyScrolls:"=?boxAlreadyScrolls",listControl:"=",blockScheduleChangeLabel:"=blockScheduleChangeLabel",showAddClassTimes:"=?showAddClassTimes",alternateWeekSwitcherWeek:"=alternateWeekSwitcherWeek",blockDayInfo:"=blockDayInfo"},link:function(e,f,g){if(e.internalListControl=e.listControl||{},e.settings=angular.copy(a.userSettings),e.openClass=function(a){a.isNoSchoolEvent?a.isAllDayEvent?d.open({templateUrl:"templates/events/add-edit-no-school.html",controller:"AddNoSchoolDayCtrl",title:"Edit No School Day",size:"medium",params:{schoolEvent:a}}):a.isLateStart?d.open({templateUrl:"templates/events/add-edit-late-start.html",controller:"AddLateStartCtrl",title:"Edit Late Start",size:"medium",params:{schoolEvent:a}}):a.isEarlyRelease&&d.open({templateUrl:"templates/events/add-edit-early-release.html",controller:"AddEarlyReleaseCtrl",title:"Edit Early Release",size:"medium",params:{schoolEvent:a}}):c.url("/classes/"+a.id)},j.isMacApp){var h=e.$watch("clsFilters.active",function(a,b){a&&b&&e.clsFiltersEnabled&&e.hideFilters()}),i=angular.element("#cls-filter-options"),k=function(a){i.hasClass("show")&&"cls-filter-options"!=a.target.id&&0==$(a.target).parents("#cls-filter-options").size()&&e.hideFilters()};e.internalListControl.toggleFilters=function(c){c&&(c.preventDefault(),c.stopPropagation()),i=angular.element("#cls-filter-options"),i.hasClass("show")?(b.unbind("click",k),i.removeClass("show")):(b.bind("click",k),i.addClass("show")),e.$$phase||a.$$phase||e.$apply()},e.hideFilters=function(c){c&&(c.preventDefault(),c.stopPropagation()),i.hasClass("show")&&(b.unbind("click",k),i.removeClass("show"),e.$$phase||a.$$phase||e.$apply())},e.$on("$destroy",function(){h()})}e.toggleGroup=function(a){var b=angular.element(".group-row.group-"+a.id);b.toggleClass("closed"),b.parent().hasClass("sticky")&&angular.element(".box-scroll").animate({scrollTop:0},"slow");var c=angular.element(".class-row.group-"+a.id);E(c,function(a){var b=angular.element(a);b.hasClass("closed")?b.removeClass("closed").addClass("opened"):b.removeClass("opened").addClass("closed")})},e.changeBlockDay=function(){d.open({templateUrl:"templates/classtimes/change-block-day.html",controller:"ChangeBlockDayCtrl",title:"Change Block Day",size:"small"})},e.changeAltWeek=function(){d.open({templateUrl:"templates/classtimes/change-alternate-week.html",controller:"ChangeAltWeekCtrl",title:"Alternate Week",size:"small"})},e.addClassTimes=function(){var b=[];if(a.userClasses&&E(a.userClasses,function(a){!a.isCurrent&&!a.isFuture||a.classTimes||b.push(a)}),b.length){var c="Add Class Times";b[0]&&b[0].name&&(c="Add Class Times: "+b[0].name),d.open({templateUrl:"templates/classtimes/add-class-times.html",controller:"AddClassTimeCtrl",title:c,analyticsTitle:"Add Class Times",size:"medium",params:{clss:b,clssI:0,cls:b[0]}})}}}}}]),ra.controller("ViewClassCtrl",["$rootScope","$scope","$routeParams","$modal","$http","$location","$filter",function(a,b,c,d,e,f,g){function h(b){if(!a.userHomeworks)return!1;var c=g("filter")(a.userHomeworks,{classId:b.id},!0);return c&&c.length?!0:!1}a.bodyClass=null,a.nav="classes",b.activeTab=c.tab||"details",b.fetchSpinner={show:!1};var i=a.$watch("userClasses",function(a){a||"undefined"==typeof a?a&&(E(a,function(a){a.id==c.classId&&(b.cls=a,b.$$phase||b.$apply())}),b.cls||f.url("/")):f.url("/")});if(b.$on("$destroy",function(){i()}),j.isMacApp){var k=b.activeTab;b.$watch("activeTab",function(a){a&&"info"!=a&&(k=a)}),b.$watch("forceActiveTab",function(a){a?(k=b.activeTab,b.activeTab=a):b.activeTab=k})}b.addClassTime=function(a){var b="Add Class Times";a&&a.name&&(b="Add Class Times: "+a.name),d.open({templateUrl:"templates/classtimes/add-class-times.html",controller:"AddClassTimeCtrl",title:b,analyticsTitle:"Add Class Times",size:"medium",params:{cls:a}})},b.editClass=function(a){a.isTeachersIOClass||d.open({templateUrl:"templates/classes/add-edit.html",controller:"AddManualClassCtrl",title:"Edit Class",size:"medium",params:{cls:a}})},b.editClassColor=function(a){d.open({templateUrl:"templates/classes/edit-class-color.html",controller:"EditClassColorCtrl",title:a.color?"Add Class Color":"Edit Class Color",size:"medium",params:{cls:a}})},b.deleteClass=function(b){ua.sendAppView("Delete Class"),h(b)?nAlert({title:"Delete Class",html:"<p>Do you really want to remove <strong>"+b.name+"</strong> (and its homework)?</p>",confirmButtonText:"Remove Class & Homework",altButtonText:"Remove Class Only",closeOnConfirm:!1,showCancelButton:!0,showAltButton:!0,width:570},function(c,d){var e=F.getUserID(a);c?o.deleteClassHws(b.id,e,!0).then(function(){q.deleteClass(b.id,e,!0,!0).then(function(){ua.sendAppView("Delete Class and Homework Success"),nAlert.close(),D.loadStorageForUser(a,e,!1).then(function(){f.url("/"),a.$apply()})})}):d&&q.deleteClass(b.id,e,!0,!0).then(function(){ua.sendAppView("Delete Class Success"),nAlert.close(),D.loadStorageForUser(a,e,!1).then(function(){f.url("/"),a.$apply()})})}):nAlert({title:"Delete Class",html:"<p>Do you really want to remove <strong>"+b.name+"</strong>?</p>",confirmButtonText:"Remove Class",closeOnConfirm:!1,showCancelButton:!0},function(c){var d=F.getUserID(a);c&&o.deleteClassHws(b.id,d,!0).then(function(){q.deleteClass(b.id,d,!0,!0).then(function(){ua.sendAppView("Delete Class and Homework Success"),nAlert.close(),D.loadStorageForUser(a,d,!1).then(function(){f.url("/"),a.$apply()})})})})},b.leaveClass=function(b){ua.sendAppView("Leave Class"),nAlert({title:"Leave Class",html:"<p>Do you really want to leave <strong>"+b.name+"</strong>?</p>",confirmButtonText:"Leave Class",closeOnConfirm:!1,showCancelButton:!0},function(c){var d=F.getUserID(a);c&&u.deleteClassAnnouncements(b.id,d).then(function(){o.deleteClassHws(b.id,d,!1).then(function(){q.deleteClass(b.id,d,!0,!1).then(function(){ua.sendAppView("Leave Class Success"),nAlert.close(),D.loadStorageForUser(a,d,!1).then(function(){f.url("/"),a.$apply()})})})})})},b.updateFromImport=function(c,d){a.mainSpinner={type:"sync",text:"Updating from "+c.disp,show:!0},a.$$phase||a.$apply();var f={av:j.av,i:c.i,ci:c.ci,t:c.t};e({method:"POST",url:j.aurl+"update-imported-class",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:f}).success(function(c,e,f,g){var h=F.getUserID(a);q.updateImport(h,Q.toDBClass(d),c.imp).then(function(c){ua.sendEvent("import-manual","page-view","page-view-google"),a.mainSpinner.show=!1,b.cls=Q.toUIClass(c),a.manualSync(),a.$$phase||a.$apply()})}).error(function(b,c,d,e){ua.sendEvent("import-manual-error","page-view","page-view-google"),a.mainSpinner.show=!1,a.$$phase||a.$apply()})},b.changeTab=function(a){j.isWebApp?f.url("/classes/"+c.classId+"/"+a):b.activeTab=a},b.openUpgradeAccount=function(){ua.sendAppView("Open Upgrade from View Class"),d.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"})},b.openSignup=function(){J.openAppURL(f,"/signup")}}]),ra.controller("TeacherClassCtrl",["$rootScope","$scope","$routeParams","$location","teachersAPI","schoolsAPI",function(a,b,c,d,e,f){function g(){ua.sendEvent("Fetch","Teacher Class","Start"),e.fetchTeacherClass(c.teacherId,c.classId).then(function(a){ua.sendEvent("Fetch","Teacher Class","Success"),b.cls=a,b.fetchSpinner.show=!1,b.$$phase||b.$apply()},function(a){ua.sendEvent("Fetch","Teacher Class","Failed"),b.fetchSpinner.show=!1,404==a?k("Class not found.","/teachers/id/"+c.teacherId):500==a?k("Oops! An error occurred when trying to get this class's information. Please try again later.","/teachers/id/"+c.teacherId):503==a?k("Oops! Our server is unavailable right now. Please try again later.","/teachers/id/"+c.teacherId):403==a?k("Something went wrong. Please sign out and sign back in.","/"):navigator.onLine?k("We were unable to get this class's information at this time.<br>Please try again later.","/teachers/id/"+c.teacherId):k("We were unable to get this class's information at this time.<br>Please make sure you have internet connection and try again.","/teachers/id/"+c.teacherId)})}function h(b,c){D.reloadStorage(a,!1).then(function(){a.mainSpinner.show=!1,a.$$phase||a.$apply(),c&&a.manualSync(),k("Class Joined Successfully!","/classes/"+b)})}function i(b){a.mainSpinner.show=!1,404==b?k("Class not found.","/teachers/id/"+c.teacherId):500==b?k("Oops! An error occurred when trying to join this class. Please try again later.","/teachers/id/"+c.teacherId):503==b?k("Oops! Our server is unavailable right now. Please try again later.","/teachers/id/"+c.teacherId):403==b?k("Something went wrong. Please sign out and sign back in.","/"):navigator.onLine?k("We were unable to join this class at this time.<br>Please try again later.","/teachers/id/"+c.teacherId):k("We were unable to join this class at this time.<br>Please make sure you have internet connection and try again.","/teachers/id/"+c.teacherId)}function k(c,e){nAlert({title:c.length<25?c:null,html:c.length>=25?c:null,closeOnConfirm:!1},function(){nAlert.close(),e==d.path()?(b.activeTab="contact",b.$apply()):(d.url(e),a.$apply())})}a.bodyClass=null,a.nav="teachers",b.activeTab=c.tab||"details",b.fetchSpinner={show:!0,text:"Loading Class"};var l=a.$watch("user",function(a){a&&(g(),l())});a.user&&g(),b.changeTab=function(a){j.isWebApp?d.url("/teachers/id/"+c.teacherId+"/classes/"+c.classId+"/"+a):b.activeTab=a},b.joinClass=function(b){a.mainSpinner={type:"classes",text:"Joining Class",show:!0},ua.sendEvent("Classes","Join","Start"),e.joinTeacherClass(b.teacherId,b).then(function(){if(ua.sendEvent("Classes","Join","Success"),b.schoolSlug&&(!a.user.schoolSlugs||a.user.schoolSlugs.indexOf(b.schoolSlug)<0)){var c=a.user.schoolSlugs?a.user.schoolSlugs:[];c.push(b.schoolSlug),f.fetchSchoolDetails(b.schoolSlug).then(function(d){w.setUserSchools(a.user.id,c).then(function(){h(b.id,!0)})},function(){h(b.id,!1)})}else h(b.id,!1)},function(a){ua.sendEvent("Classes","Join","Failed"),i(a)})},b.$on("$destroy",function(){l()})}]),ra.directive("classDetails",function(){return{restrict:"E",replace:!0,templateUrl:"templates/classes/view-details.html",link:function(a,b,c){ua.sendAppView("Class Details")}}}),ra.directive("classImportDetails",function(){return{restrict:"E",replace:!0,templateUrl:"templates/classes/view-import-details.html",link:function(a,b,c){ua.sendAppView("Class Import Details")}}}),ra.directive("classSchedule",["$rootScope","$modal",function(a,b){return{restrict:"E",replace:!0,templateUrl:"templates/classes/view-schedule.html",link:function(c,d,e){ua.sendAppView("Class Schedule"),c.hwFiltersEnabled=!1,c.hasHomework=!1,c.hwFilters={noClass:!0,active:"all"},c.hwListControl={visibleSize:20,pageSize:15,closedGroups:[]},c.addHomework=function(){var a=c.$parent.cls;b.open({templateUrl:"templates/homework/add-edit.html",controller:"AddHomeworkCtrl",title:"Add Homework",size:"medium",params:{classId:a?a.id:null}})};var f=a.$watch("userHomeworks",function(a){c.hwListControl.reloadFilteredHomeworks(a)});c.$on("$destroy",function(){f()}),c.$watch("hwFilters.active",function(b,d){var e=c.$parent.cls;e&&b&&d&&(c.hwListControl.visibleSize=20,c.hwListControl.closedGroups=[],c.filteredHomeworks=L.filterClassHomeworksBy(e.id,a.userHomeworks,b,!0,c.hwListControl.visibleSize,c.hwListControl.closedGroups),angular.element(".box-scroll").scrollTop(0))}),c.hwListControl.reloadFilteredHomeworks=function(a){if(c.$parent&&c.$parent.cls){var b=c.$parent.cls;b.isJoinable?(c.hasHomework=!1,c.filteredHomeworks=[],c.hwFiltersEnabled=!1,c.$$phase||c.$apply()):(c.filteredHomeworks=L.filterClassHomeworksBy(b.id,a,c.hwFilters.active,!0,c.hwListControl.visibleSize,c.hwListControl.closedGroups),c.filteredHomeworks.groups.length>0&&(1==c.filteredHomeworks.groups.length&&1==c.filteredHomeworks.groups[0].items.length?c.hwFiltersEnabled=!1:c.hwFiltersEnabled=!0,c.hasHomework=c.filteredHomeworks&&0!=c.filteredHomeworks.groups.length?!0:!1,c.$$phase||c.$apply()))}}}}}]),ra.directive("classSyllabus",["$rootScope","$modal",function(a,b){return{restrict:"E",replace:!0,templateUrl:"templates/classes/view-syllabus.html",link:function(c,d,e){ua.sendAppView("Class Syllabus"),c.addSyllabus=function(a){a.isTeachersIOClass||b.open({templateUrl:"templates/classes/add-syllabus.html",controller:"AddSyllabusCtrl",title:a.syllabusFile?"Add Syllabus":"Replace Syllabus",size:"medium",params:{classObj:a}})},c.deleteSyllabus=function(d){var e=c.$parent.cls;e&&!e.isTeachersIOClass&&(ua.sendAppView("Delete Syllabus"),nAlert({title:"Delete Syllabus",html:"<p>Are you sure you want to delete this syllabus?</p>",confirmButtonText:"Delete",closeOnConfirm:!1,showCancelButton:!0},function(c){if(c){e.syllabusFile=null;var d=Q.toDBClass(e),f=F.getUserID(a);q.ensureClass(d,f,!0).then(function(c){ua.sendAppView("Delete Success"),b.close(),nAlert.close(),j.isMacApp||D.reloadStorage(a,!0)},function(a){J.logError(a)})}}))}}}}]),ra.controller("AddSyllabusCtrl",["$rootScope","$scope","$modal","$modalParams",function(a,b,c,d){b.cls=d.classObj;var e=b.$watch("syllabus.uploadedFile",function(d){if(d){b.cls.syllabusFile=angular.copy(d);var e=Q.toDBClass(b.cls),f=F.getUserID(a);q.ensureClass(e,f,!0).then(function(b){c.close(),j.isMacApp||D.reloadStorage(a,!0)},function(a){J.logError(a)})}});b.$on("$destroy",function(){e()}),b.cancel=function(){c.close()}}]),ra.directive("classResources",["$rootScope","$modal","$timeout",function(a,b,c){return{restrict:"E",replace:!0,templateUrl:"templates/classes/view-resources.html",link:function(d,e,f){function g(){var a=0,b=[],c=[],e=!1,f=!1,g=!1;i.cls.classFiles&&(n?i.cls.classFiles.length>0&&(e=!0):E(i.cls.classFiles,function(c){e=!0,l>a?(b.push(c),a++):g=!0})),i.cls.classLinks&&(!o&&l>a?E(i.cls.classLinks,function(b){f=!0,l>a?(c.push(b),a++):g=!0}):l>a?f=!0:i.cls.classLinks.length&&(g=!0));var h=[];e&&h.push({title:"Files",id:"files",items:b,closed:n}),f&&h.push({title:"Links",id:"links",items:c,closed:o}),d.filteredResources=h,d.isTeachersIOClass=i.cls.isTeachersIOClass,p=g,d.$$phase||d.$apply()}function h(){if(!r){var a=$(this);r=!0,requestAnimationFrame(function(){var b=a.scrollTop(),c=a[0].scrollHeight,d=a.parent().height();if(c>d){var e=c-d-100;if(b>e)return r=!0,l+=m,void g()}r=!1})}}ua.sendAppView("Class Resources");var i=d.$parent,k=i.$watch("cls",function(a){"undefined"!=typeof a&&g()}),l=20,m=15,n=!1,o=!1,p=!1,r=!1;e.find(".box-scroll").bind("scroll",h);var s=d.$watch("filteredResources",function(a,b){a&&r&&p&&(r=!1)});d.addFile=function(a){a.isTeachersIOClass||b.open({templateUrl:"templates/classes/add-file.html",controller:"AddClassFileCtrl",title:"Add File",size:"medium",params:{classObj:a}})},d.deleteFile=function(c){var e=d.$parent.cls;e&&!e.isTeachersIOClass&&(ua.sendAppView("Delete File"),nAlert({title:"Delete File",html:"<p>Are you sure you want to delete <strong>"+c.displayText+"</strong>?</p>",confirmButtonText:"Delete",closeOnConfirm:!1,showCancelButton:!0},function(d){if(d){if(!e.classFiles)return b.close(),nAlert.close(),void(j.isMacApp?MacApp.reloadStorage():D.reloadStorage(a,!0));var f=new Array;E(e.classFiles,function(a){a.id!=c.id&&f.push(a)}),e.classFiles=f;var g=Q.toDBClass(e),h=F.getUserID(a);q.ensureClass(g,h,!0).then(function(c){ua.sendAppView("Delete File Success"),b.close(),nAlert.close(),j.isMacApp||D.reloadStorage(a,!0)},function(a){ua.sendAppView("Delete File Failed"),J.logError(a)})}}))},d.toggleGroup=function(a){var b=angular.element(".group-row.group-"+a.id),d=b.hasClass("closed");b.toggleClass("closed"),b.parent().hasClass("sticky")&&angular.element(".box-scroll").animate({scrollTop:0},"slow");var e=angular.element(".r-row.group-"+a.id);E(e,function(a){var b=angular.element(a);b.hasClass("closed")?b.removeClass("closed").addClass("opened"):b.removeClass("opened").addClass("closed")}),"files"==a.id?(n=d?!1:!0,d&&(l=20)):"links"==a.id&&(o=d?!1:!0),c(function(){g()},d?0:400)},d.$on("$destroy",function(){k(),s(),e.find(".box-scroll").unbind("scroll",h)})}}}]),ra.controller("AddClassFileCtrl",["$rootScope","$scope","$modal","$modalParams",function(a,b,c,d){b.cls=d.classObj;var e=b.$watch("files.uploadedFile",function(d){if(d){var e=angular.copy(d);b.cls.classFiles?b.cls.classFiles.push(e):b.cls.classFiles=[e];var f=Q.toDBClass(b.cls),g=F.getUserID(a);q.ensureClass(f,g,!0).then(function(b){c.close(),j.isMacApp||D.reloadStorage(a,!0)},function(a){J.logError(a)})}});b.$on("$destroy",function(){e()}),b.cancel=function(){c.close()}}]),ra.directive("classAnnouncements",["$rootScope","$filter",function(a,b){return{restrict:"E",replace:!0,templateUrl:"templates/classes/view-announcements.html",link:function(c,d,e){function f(){var d=b("filter")(a.userAnnouncements,{classIds:{$:g.id}},!0);c.announcements=d&&d.length?d:null;var e=b("filter")(d,{isRead:!1},!0);if(e.length){var f=a.unreadAnnouncements||0;f>0&&(f-=e.length,a.unreadAnnouncements=f,a.$$phase||a.$apply());var h=[];E(e,function(a){h.push(a.id)});var i=F.getUserID(a);u.markAnnouncementsAsRead(h,i)}}ua.sendAppView("Class Announcements");var g=c.$parent.cls;if(g&&g.isTeachersIOClass&&!g.isJoinable){var h=a.$watch("userAnnouncements",function(a){"undefined"!=typeof a&&f()});c.$on("$destroy",function(){h(),T.loadAnnouncements(a,!0)})}}}}]),ra.directive("classTimes",["$rootScope","$modal",function(a,b){return{restrict:"E",templateUrl:"templates/classtimes/class-times.html",scope:{classItem:"=classItem",editEnabled:"=?editEnabled"},link:function(a,c,d){a.editClassTime=function(c){a.editEnabled&&("time"==c.type?b.open({templateUrl:"templates/classtimes/add-time-based.html",controller:"AddTimeBasedCtrl",title:"Edit Time Schedule",size:"medium",params:{cls:a.classItem,id:c.id}}):"period"==c.type?b.open({templateUrl:"templates/classtimes/add-period-based.html",controller:"AddPeriodBasedCtrl",title:"Edit Period Schedule",size:c.periodsPerDay&&c.periodsPerDay>6?"large":"medium",params:{cls:a.classItem,id:c.id}}):"block"==c.type?b.open({templateUrl:"templates/classtimes/add-block-based.html",controller:"AddBlockBasedCtrl",title:"Edit Block Schedule",size:"medium",params:{cls:a.classItem,id:c.id}}):"other"==c.type&&b.open({templateUrl:"templates/classtimes/add-freetext-based.html",controller:"AddFreetextBasedCtrl",title:"Edit Free Text",size:"medium",params:{cls:a.classItem,id:c.id}}))}}}}]),ra.directive("dayClassTimes",["$rootScope",function(a){return{restrict:"E",templateUrl:"templates/classtimes/day-class-times.html",scope:{classItem:"=classItem",blockDayInfo:"=blockDayInfo"}}}]),ra.controller("AddClassTimeCtrl",["$rootScope","$scope","$modal","$modalParams",function(a,b,c,d){function e(){var a="Add Class Times";return d.cls&&d.cls.name&&(a="Add Class Times: "+d.cls.name),{cls:d.cls,clss:d.clss?d.clss:null,clssI:"undefined"!=typeof d.clssI?d.clssI:null,modalTitle:a}}b.settings=angular.copy(a.userSettings),b.types={active:null},b.weekType={active:null},b.otherTypeEnabled=!0,b.formTitle="Add Class Times",d.clss?b.otherTypeEnabled=!1:d.cls&&(b.formTitle="Add Class Times: "+d.cls.name),b.blockSelected=function(){var a=e();c.close(),c.open({templateUrl:"templates/classtimes/add-block-based.html",controller:"AddBlockBasedCtrl",title:a.modalTitle,analyticsTitle:"Add Block Based Class Times",size:"medium",params:a})},b.typeSelected=function(){var a=e();"block"==b.types.active&&b.settings.blocksPerDay?(c.close(),c.open({templateUrl:"templates/classtimes/add-block-based.html",controller:"AddBlockBasedCtrl",title:a.modalTitle,analyticsTitle:"Add Block Based Class Times",size:"medium",params:a})):"other"==b.types.active?(c.close(),c.open({templateUrl:"templates/classtimes/add-freetext-based.html",controller:"AddFreetextBasedCtrl",title:a.modalTitle,analyticsTitle:"Add Other Based Class Times",size:"medium",params:a})):(U.adjustModalHeight(),b.weekType.active=null)},b.weekTypeSelected=function(){var d=e();d.type=b.weekType.active,"time"==b.types.active?(c.close(),c.open({templateUrl:"templates/classtimes/add-time-based.html",controller:"AddTimeBasedCtrl",title:d.modalTitle,analyticsTitle:"Add Time Based Class Times",size:"medium",params:d})):"period"==b.types.active&&(a.userSettings.periodsPerDay||(a.userSettings.periodsPerDay=9),c.close(),c.open({templateUrl:"templates/classtimes/add-period-based.html",controller:"AddPeriodBasedCtrl",title:d.modalTitle,analyticsTitle:"Add Period Based Class Times",size:a.userSettings.periodsPerDay>6?"large":"medium",params:d}))},b["continue"]=function(){var d=e();"block"==b.types.active&&(a.userSettings.blocksPerDay?(c.close(),c.open({templateUrl:"templates/classtimes/add-block-based.html",controller:"AddBlockBasedCtrl",title:d.modalTitle,analyticsTitle:"Add Block Based Class Times",size:"medium",params:d})):nAlert("Please select how many blocks you have per day at your school."))},b.cancel=function(){c.close()}}]),ra.controller("AddTimeBasedCtrl",["$rootScope","$scope","$modal","$modalParams",function(a,b,c,d){function e(e){var f=d.cls;if(f.classTimes&&f.classTimes.length>0)if(d.id){var g=[];E(f.classTimes,function(a){a.id==e.id?g.push(e):g.push(a)}),f.classTimes=g}else f.classTimes.push(e);else f.classTimes=[e];f.isTeachersIOClass&&(f.isCustomSchedules=!0),b.needsClassDate&&(f.starts=b.cls.starts,f.ends=b.cls.ends);var h=Q.toDBClass(f),i=F.getUserID(a);q.ensureClass(h,i,!0).then(function(e){j.isMacApp?d.clss?b.skip():c.close():D.reloadStorage(a,!0).then(function(){d.clss?b.skip():c.close()})},function(a){nAlert("An error occurred when trying to save this class time. Please try again later."),J.logError(a)})}function f(a){var c=!0;if(0==a.length&&(b.week1DaysError="Choose the day(s) this class meets.",c=!1),b.week1Times.start){
if(b.week1Times.start){var d=J.parseTimeStr(b.week1Times.start);d?b.week1Times.startTime=d:(b.week1StartError="Enter a valid start time",c=!1)}}else b.week1StartError="Enter a start time",c=!1;if(b.week1Times.end){if(b.week1Times.end){var e=J.parseTimeStr(b.week1Times.end);e?b.week1Times.endTime=e:(b.week1EndError="Enter a valid end time",c=!1)}}else b.week1EndError="Enter an end time",c=!1;return c}function g(a){var c=!0;if(0==a.length&&(b.week2DaysError="Choose the day(s) this class meets.",c=!1),b.week2Times.start){if(b.week2Times.start){var d=J.parseTimeStr(b.week2Times.start);d?b.week2Times.startTime=d:(b.week2StartError="Enter a valid start time",c=!1)}}else b.week2StartError="Enter a start time",c=!1;if(b.week2Times.end){if(b.week2Times.end){var e=J.parseTimeStr(b.week2Times.end);e?b.week2Times.endTime=e:(b.week2EndError="Enter a valid end time",c=!1)}}else b.week2EndError="Enter an end time",c=!1;return c}if(b.weekType={active:d.type},b.formTitle="Add Class Times",b.week1Days={d1:!1,d2:!1,d3:!1,d4:!1,d5:!1,d6:!1,d7:!1},b.week1Times={start:null,end:null},b.week2Days={d1:!1,d2:!1,d3:!1,d4:!1,d5:!1,d6:!1,d7:!1},b.week2Times={start:null,end:null},d.id){b.isEdit=!0,b.formTitle="Edit Class Times";var h=null;if(E(d.cls.classTimes,function(a){a.id==d.id&&(h=a)}),h){b.weekType.active=2==h.numberOfWeeks?"alternate":"same";var i=h.week1?h.week1[0]:null;i&&(b.week1Times={start:i.startTimeFormat,startTime:i.startTime,end:i.endTimeFormat,endTime:i.endTime},E(i.days,function(a){b.week1Days["d"+a]=!0}));var k=h.week2?h.week2[0]:null;k&&(b.week2Times={start:k.startTimeFormat,startTime:k.startTime,end:k.endTimeFormat,endTime:k.endTime},E(k.days,function(a){b.week2Days["d"+a]=!0}))}}else d.cls&&(b.formTitle="Add Class Times: "+d.cls.name);d.cls&&(b.cls={starts:d.cls.starts,ends:d.cls.ends},d.cls.starts||"alternate"!=b.weekType.active||(b.needsClassDate=!0)),d.clss&&"undefined"!=typeof d.clssI&&(d.clss.length-1>=d.clssI+1&&(b.hasMoreClasses=!0),d.clssI>0&&(b.showTypePicker=!0)),b.openDatePicker=function(a,c){a.preventDefault(),a.stopPropagation(),"starts"==c?(b.startDatePicker={opened:!0},b.endDatePicker={opened:!1}):"ends"==c&&(b.endDatePicker={opened:!0},b.startDatePicker={opened:!1})},b.weekTypeChanged=function(){d.cls.starts||"alternate"!=b.weekType.active?b.needsClassDate=!1:b.needsClassDate=!0},b.cancel=function(){c.close()},b.save=function(a){if(a.$valid){b.week1DaysError=null,b.week1StartError=null,b.week1EndError=null,b.week2DaysError=null,b.week2StartError=null,b.week2EndError=null;var c=[];if(E(b.week1Days,function(a,b){a&&c.push(parseInt(b.substring(1)))}),"same"==b.weekType.active){if(f(c)){var h={id:d.id?d.id:J.simpleID(4),type:"time",numberOfWeeks:1,week1:[{startTime:b.week1Times.startTime,endTime:b.week1Times.endTime,days:c}],week2:null};e(h)}}else if("alternate"==b.weekType.active){var i=[];if(E(b.week2Days,function(a,b){a&&i.push(parseInt(b.substring(1)))}),0==c.length&&0==i.length)return void(b.week1DaysError="Choose the day(s) and times for at least one of the weeks");var j=!0;if(c.length&&(j=f(c)),i.length&&(j=g(i)),j){var h={id:d.id?d.id:J.simpleID(4),type:"time",numberOfWeeks:2,week1:0==c.length?null:[{startTime:b.week1Times.startTime,endTime:b.week1Times.endTime,days:c}],week2:0==i.length?null:[{startTime:b.week2Times.startTime,endTime:b.week2Times.endTime,days:i}]};e(h)}}}},b.skip=function(){if(d.clss.length-1<d.clssI+1)return void c.close();var a=d.clssI+1,e={cls:d.clss[a],clss:d.clss,clssI:a,type:b.weekType.active},f="Add Class Times";d.clss[a]&&d.clss[a].name&&(f="Add Class Times: "+d.clss[a].name),c.close(),c.open({templateUrl:"templates/classtimes/add-time-based.html",controller:"AddTimeBasedCtrl",title:f,analyticsTitle:"Add Time Based Class Times",size:"medium",params:e})},b.deleteClassTime=function(){ua.sendAppView("Delete Class Time");var b=d.cls;if(b.classTimes&&b.classTimes.length>0){var e=[];E(b.classTimes,function(a){a.id!=d.id&&e.push(a)}),b.classTimes=e}var f=Q.toDBClass(b),g=F.getUserID(a);q.ensureClass(f,g,!0).then(function(b){j.isMacApp?c.close():D.reloadStorage(a,!0).then(function(){c.close()})},function(a){nAlert("An error occurred when trying to save this class time. Please try again later."),J.logError(a)})}}]),ra.controller("AddPeriodBasedCtrl",["$rootScope","$scope","$modal","$modalParams",function(a,b,c,d){function e(a){var c=0,d={};E(a,function(a){var e=b.showZeroPeriod?0:1,f=0==c?7:c,g="";E(a.periods,function(a){a.active&&(g+="p"+e),e++}),g.length&&(d[g]?d[g].push(f):d[g]=[f]),c++});var e=[];return E(d,function(a,b){var c=[];E(b.split("p"),function(a){a.length&&c.push(parseInt(a))}),e.push({days:a,periods:c})}),e}b.weekType={active:d.type},b.formTitle="Add Class Periods",b.periodsPerDay=a.userSettings.periodsPerDay,b.showZeroPeriod=a.userSettings.showZeroPeriod;var f=null;d.id?(b.isEdit=!0,b.formTitle="Edit Class Periods",E(d.cls.classTimes,function(a){a.id==d.id&&(f=a,b.weekType.active=2==f.numberOfWeeks?"alternate":"same")}),f&&f.periodsPerDay&&(b.periodsPerDay=f.periodsPerDay)):d.cls&&(b.formTitle="Add Class Periods: "+d.cls.name),d.cls&&(b.cls={starts:d.cls.starts,ends:d.cls.ends},d.cls.starts||"alternate"!=b.weekType.active||(b.needsClassDate=!0)),d.clss&&"undefined"!=typeof d.clssI&&(d.clss.length-1>=d.clssI+1&&(b.hasMoreClasses=!0),d.clssI>0&&(b.showTypePicker=!0)),b.openDatePicker=function(a,c){a.preventDefault(),a.stopPropagation(),"starts"==c?(b.startDatePicker={opened:!0},b.endDatePicker={opened:!1}):"ends"==c&&(b.endDatePicker={opened:!0},b.startDatePicker={opened:!1})},b.weekTypeChanged=function(){d.cls.starts||"alternate"!=b.weekType.active?b.needsClassDate=!1:b.needsClassDate=!0};for(var g=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],h=[],i=[],k=1;7>=k;k++){for(var l={label:g[k-1],periods:[]},m=b.showZeroPeriod?0:1;m<=b.periodsPerDay;m++)l.periods.push({active:!1}),1==k&&i.push(m);h.push(l)}if(b.periodsRange=i,b.week1Periods=h,b.week2Periods=angular.copy(h),f){var n=f.week1||null;n&&E(n,function(a){E(a.days,function(c){var d=7==c?0:c;E(a.periods,function(a){var c=b.showZeroPeriod?a:a-1;b.week1Periods[d].periods[c].active=!0})})});var o=f.week2||null;o&&E(o,function(a){E(a.days,function(c){var d=7==c?0:c;E(a.periods,function(a){var c=b.showZeroPeriod?a:a-1;b.week2Periods[d].periods[c].active=!0})})})}b.save=function(f){if(f.$valid){var g=e(b.week1Periods),h="alternate"==b.weekType.active?e(b.week2Periods):[];if("same"==b.weekType.active&&0==g.length)return void nAlert("Choose the day(s) and periods this class meets.");if("alternate"==b.weekType.active&&0==g.length&&0==h.length)return void nAlert("Choose the day(s) and periods this class meets.");var i={id:d.id?d.id:J.simpleID(4),type:"period",numberOfWeeks:"alternate"==b.weekType.active?2:1,periodsPerDay:b.periodsPerDay,week1:g.length?g:null,week2:h.length?h:null},k=d.cls;if(k.classTimes&&k.classTimes.length>0)if(d.id){var l=[];E(k.classTimes,function(a){a.id==i.id?l.push(i):l.push(a)}),k.classTimes=l}else k.classTimes.push(i);else k.classTimes=[i];k.isTeachersIOClass&&(k.isCustomSchedules=!0),b.needsClassDate&&(k.starts=b.cls.starts,k.ends=b.cls.ends);var m=Q.toDBClass(k),n=F.getUserID(a);q.ensureClass(m,n,!0).then(function(e){j.isMacApp?d.clss?b.skip():c.close():D.reloadStorage(a,!0).then(function(){d.clss?b.skip():c.close()})},function(a){nAlert("An error occurred when trying to save this class time. Please try again later."),J.logError(a)})}},b.skip=function(){if(d.clss.length-1<d.clssI+1)return void c.close();var e=d.clssI+1,f={cls:d.clss[e],clss:d.clss,clssI:e,type:b.weekType.active},g="Add Class Times";d.clss[e]&&d.clss[e].name&&(g="Add Class Times: "+d.clss[e].name),c.close(),c.open({templateUrl:"templates/classtimes/add-period-based.html",controller:"AddPeriodBasedCtrl",title:g,analyticsTitle:"Add Period Based Class Times",size:a.userSettings.periodsPerDay>6?"large":"medium",params:f})},b.deleteClassTime=function(){ua.sendAppView("Delete Class Time");var b=d.cls;if(b.classTimes&&b.classTimes.length>0){var e=[];E(b.classTimes,function(a){a.id!=d.id&&e.push(a)}),b.classTimes=e}var f=Q.toDBClass(b),g=F.getUserID(a);q.ensureClass(f,g,!0).then(function(b){j.isMacApp?c.close():D.reloadStorage(a,!0).then(function(){c.close()})},function(a){nAlert("An error occurred when trying to delete this class time. Please try again later."),J.logError(a)})},b.cancel=function(){c.close()}}]),ra.controller("AddBlockBasedCtrl",["$rootScope","$scope","$modal","$modalParams",function(a,b,c,d){function e(){var c=1;if(E(BLOCK_OPTIONS,function(d){var e=null;if((1==c||2==c)&&(e=angular.copy(d)),a.userSettings.blocks&&E(a.userSettings.blocks,function(a){a.day==c.toString()&&(1==c||2==c?$.extend(e,a):(e=angular.copy(d),$.extend(e,a)))}),e){e.blocks=[];for(var h=b.showZeroBlock?0:1;h<=b.blocksPerDay;h++)e.blocks.push({active:!1}),1==c&&g.push(h);f.push(e)}c++}),d.id){b.isEdit=!0;var e=null;if(E(d.cls.classTimes,function(a){a.id==d.id&&(e=a)}),e){var h=1;E(e.blocks,function(a){var d=a.day||h,e=!1;if(E(f,function(c){c.day==d&&(E(a.blocks,function(a){var d=b.showZeroBlock?a:a-1;c.blocks[d].active=!0}),e=!0)}),!e){var i={id:a.day?a.day.toString():null,label:a.label?a.label:"Day",day:a.day?a.day:0};i.blocks=[];for(var j=1;j<=b.blocksPerDay;j++)i.blocks.push({active:!1}),1==c&&g.push(j);a.blocks&&E(a.blocks,function(a){var c=b.showZeroBlock?a:a-1;i.blocks[c].active=!0}),f.push(i)}h++})}}b.blocksRange=g,b.blockOptions=f}b.blocksPerDay=a.userSettings.blocksPerDay,b.showZeroBlock=a.userSettings.showZeroBlock,b.formTitle="Add Block Schedule",b.settings=angular.copy(a.userSettings);var f=[],g=[];b.blocksPerDay?e():d.id&&(b.isEdit=!0,b.formTitle="Edit Block Schedule"),d.cls&&!d.id&&(b.formTitle="Add Block Schedule: "+d.cls.name),d.clss&&"undefined"!=typeof d.clssI&&d.clss.length-1>=d.clssI+1&&(b.hasMoreClasses=!0),b.skip=function(){if(d.clss.length-1<d.clssI+1)return void c.close();var a=d.clssI+1,b={cls:d.clss[a],clss:d.clss,clssI:a},e="Add Class Times";d.clss[a]&&d.clss[a].name&&(e="Add Class Times: "+d.clss[a].name),c.close(),c.open({templateUrl:"templates/classtimes/add-block-based.html",controller:"AddBlockBasedCtrl",title:e,analyticsTitle:"Add Block Based Class Times",size:"medium",params:b})},b["continue"]=function(){a.userSettings.blocksPerDay?(b.blocksPerDay=a.userSettings.blocksPerDay,e()):nAlert("Please select how many blocks you have per day at your school.")},b.save=function(){var e=[];E(b.blockOptions,function(a){var c=b.showZeroBlock?0:1,d=[];E(a.blocks,function(a){a.active&&d.push(c),c++}),d.length&&e.push({day:a.day,blocks:d})});var f={id:d.id?d.id:J.simpleID(4),type:"block",blocks:e},g=d.cls;if(g.classTimes&&g.classTimes.length>0)if(d.id){var h=[];E(g.classTimes,function(a){a.id==f.id?h.push(f):h.push(a)}),g.classTimes=h}else g.classTimes.push(f);else g.classTimes=[f];g.isTeachersIOClass&&(g.isCustomSchedules=!0);var i=Q.toDBClass(g),k=F.getUserID(a);q.ensureClass(i,k,!0).then(function(e){j.isMacApp?d.clss?b.skip():c.close():D.reloadStorage(a,!0).then(function(){d.clss?b.skip():c.close()})},function(a){nAlert("An error occurred when trying to save this class time. Please try again later."),J.logError(a)})},b.deleteClassTime=function(){ua.sendAppView("Delete Class Time");var b=d.cls;if(b.classTimes&&b.classTimes.length>0){var e=[];E(b.classTimes,function(a){a.id!=d.id&&e.push(a)}),b.classTimes=e}var f=Q.toDBClass(b),g=F.getUserID(a);q.ensureClass(f,g,!0).then(function(b){j.isMacApp?c.close():D.reloadStorage(a,!0).then(function(){c.close()})},function(a){nAlert("An error occurred when trying to save this class time. Please try again later."),J.logError(a)})},b.cancel=function(){c.close()}}]),ra.controller("AddFreetextBasedCtrl",["$rootScope","$scope","$modal","$modalParams",function(a,b,c,d){if(b.otherContent=null,d.id){b.isEdit=!0;var e=null;E(d.cls.classTimes,function(a){a.id==d.id&&(e=a)}),e&&(b.otherContent=e.freeText||null)}b.save=function(e){if(e.$valid){var f={id:d.id?d.id:J.simpleID(4),type:"other",freeText:b.otherContent},g=d.cls;if(g.classTimes&&g.classTimes.length>0)if(d.id){var h=[];E(g.classTimes,function(a){a.id==f.id?h.push(f):h.push(a)}),g.classTimes=h}else g.classTimes.push(f);else g.classTimes=[f];g.isTeachersIOClass&&(g.isCustomSchedules=!0);var i=Q.toDBClass(g),k=F.getUserID(a);q.ensureClass(i,k,!0).then(function(b){j.isMacApp?c.close():D.reloadStorage(a,!0).then(function(){c.close()})},function(a){nAlert("An error occurred when trying to save this class time. Please try again later."),J.logError(a)})}},b.deleteClassTime=function(){ua.sendAppView("Delete Class Time");var b=d.cls;if(b.classTimes&&b.classTimes.length>0){var e=[];E(b.classTimes,function(a){a.id!=d.id&&e.push(a)}),b.classTimes=e}var f=Q.toDBClass(b),g=F.getUserID(a);q.ensureClass(f,g,!0).then(function(b){j.isMacApp?c.close():D.reloadStorage(a,!0).then(function(){c.close()})},function(a){nAlert("An error occurred when trying to save this class time. Please try again later."),J.logError(a)})},b.cancel=function(){c.close()}}]),ra.controller("ChangeBlockDayCtrl",["$rootScope","$scope","$modal","$timeout","dateFilter",function(a,b,c,d,e){b.todayBlockDay={id:null},b.settings=angular.copy(a.userSettings);var f=[],g=1;E(BLOCK_OPTIONS,function(a){var c=null;(1==g||2==g)&&(c=angular.copy(a)),b.settings.blocks&&E(b.settings.blocks,function(b){b.day==g.toString()&&(1==g||2==g?$.extend(c,b):(c=angular.copy(a),$.extend(c,b)))}),c&&f.push(c),g++}),b.blockOptions=f;var h=a.user?a.user.id:null,i=J.formatISO8601(new Date,1),k=J.parseISO8601(i,1),l=a.userSettings.blocks?a.userSettings.blocks.length:null,m=a.userSettings.dayAStartDate?a.userSettings.dayAStartDate:null;if(m&&l){var n=S.getActiveBlockDay(m,k,l);n>=0&&(b.todayBlockDay.id=n.toString())}U.adjustModalHeight(),b.saveBlockDay=function(){var f=parseInt(b.todayBlockDay.id);if(1==f)b.settings.dayAStartDate=k;else{do if(k.setDate(k.getDate()-1),0!=k.getDay()&&6!=k.getDay()){var g=e(k,"yyyyMMdd");a.userNoSchoolDays&&a.userNoSchoolDays[g]||(f-=1)}while(1!=f);b.settings.dayAStartDate=k}var i=F.toDBSettings(b.settings);j.isMacApp?w.setUserSettings(h,i,!0).then(function(){d(function(){MacApp.reloadStorage(),c.close()},1200)}):(w.setUserSettings(h,i,!0),D.reloadStorage(a,!0),c.close())},b.cancel=function(){c.close()}}]),ra.controller("ChangeAltWeekCtrl",["$rootScope","$scope","$modal","$timeout",function(a,b,c,d){function e(){var b=new Array,d=F.getUserID(a);E(a.userClasses,function(a){if(a.isCurrent&&a.classTimes&&a.starts){var c=!1;if(E(a.classTimes,function(a){"time"!=a.type&&"period"!=a.type||2!=a.numberOfWeeks||(c=!0)}),c){a.starts=J.addDaysToDate(a.starts,-7);var e=Q.toDBClass(a);b.push(function(){return q.ensureClass(e,d,!0)})}}}),b.length?Promise.loop(b).then(function(){j.isMacApp||D.reloadStorage(a,!0),c.close()},function(a){c.close()}):c.close()}b.todayWeek={id:null},U.adjustModalHeight(),b.saveAlternateWeek=function(){var d="1"==b.todayWeek.id?!0:!1;if(a.userClasses){var f=Q.filterClassesBy(a.userClasses,"date",new Date),g=0,h=0,i=0;if(f[0].items&&E(f[0].items,function(a){a.classTimesAlternate&&(g+=1,a.classTimesIsWeek1?h+=1:i+=1)}),f[0].altItems&&E(f[0].altItems,function(a){a.classTimesAlternate&&(g+=1,a.classTimesIsWeek1?h+=1:i+=1)}),g>0&&(g==h&&!d||g==i&&d))return void e()}c.close()},b.cancel=function(){c.close()}}]),ra.controller("CalendarCtrl",["$rootScope","$scope","$routeParams","$filter","dateFilter","$location","$window","$document","$modal","hwSync","kiipUtils",function(a,b,c,d,e,f,g,h,i,k,l){function m(a,c){var d={};E(a,function(a){a.repeats&&a.repeatDates?E(a.repeatDates,function(a){d[a]||(d[a]=0),d[a]<6&&(d[a]=d[a]+1)}):a.calendarDayFormat&&(d[a.calendarDayFormat]||(d[a.calendarDayFormat]=0),d[a.calendarDayFormat]<6&&(d[a.calendarDayFormat]=d[a.calendarDayFormat]+1))}),E(c,function(a){a.repeats&&a.repeatDates?E(a.repeatDates,function(a){d[a]||(d[a]=0),d[a]<6&&(d[a]=d[a]+1)}):a.calendarDayFormat&&(d[a.calendarDayFormat]||(d[a.calendarDayFormat]=0),d[a.calendarDayFormat]<6&&(d[a.calendarDayFormat]=d[a.calendarDayFormat]+1))}),b.busyDays=d}function n(){var c=null,d=null;if(b.dayClasses.length&&b.dayClasses[0].items&&E(b.dayClasses[0].items,function(a){a.dateClassTimes&&E(a.dateClassTimes,function(a){"block"==a.type&&(d={label:a.label,color:a.color||null},c=a.label)})}),!d){var e=J.formatISO8601(b.seletedDate,1),f=J.parseISO8601(e,1);d=S.getUserBlockDayInfoForDate(f,a.userSettings,a.userNoSchoolDays),d&&(d.label=d.text)}b.blockScheduleChangeLabel=c,b.blockDayInfo=d}function o(){if(b.blockScheduleChangeLabel)return void(b.alternateWeekSwitcherWeek=null);if(b.isToday&&b.dayClasses.length){var a=0,c=0,d=0;if(b.dayClasses[0].items&&E(b.dayClasses[0].items,function(b){b.classTimesAlternate&&(a+=1,b.classTimesIsWeek1?c+=1:d+=1)}),b.dayClasses[0].altItems&&E(b.dayClasses[0].altItems,function(b){b.classTimesAlternate&&(a+=1,b.classTimesIsWeek1?c+=1:d+=1)}),a>0)return void(a==c?b.alternateWeekSwitcherWeek="1":a==d?b.alternateWeekSwitcherWeek="2":b.alternateWeekSwitcherWeek=null)}b.alternateWeekSwitcherWeek=null}a.bodyClass=null,a.nav="calendar",a.syncIfTooLong(),G.loadSchools(a,!0).then(function(){a.$apply()}),b.seletedDate=new Date,b.isToday=!0,b.hwListControl={visibleSize:20,pageSize:15,closedGroups:[]},b.clsListControl={},b.busyIndicators={},b.showFull=!1;var p=e(new Date,"yyyyMMdd"),q=e(b.seletedDate,"yyyyMMdd"),r=!0,s=!0,t=!0;if(c.date){var u=J.parseISO8601(c.date);u&&(b.seletedDate=u,q=e(u,"yyyyMMdd"),b.isToday=q==p)}var v=b.$watch("seletedDate",function(c){q=e(c,"yyyyMMdd"),b.isToday=q==p,r||b.hwListControl.reloadFilteredHomeworks(a.userHomeworks),s||b.clsListControl.reloadFilteredClasses(a.userClasses)});b.setToday=function(){b.isToday||(ua.sendAppView("Calendar - Today Selected"),b.seletedDate=new Date,p=e(b.seletedDate,"yyyyMMdd"),b.$$phase||b.$apply())},b.addHomework=function(){i.open({templateUrl:"templates/homework/add-edit.html",controller:"AddHomeworkCtrl",title:"Add Homework",size:"medium",params:{initDate:b.seletedDate}})};var w=a.$watch("userHomeworks",function(a){a&&(r=!1,b.hwListControl.reloadFilteredHomeworks(a))});b.hwListControl.reloadFilteredHomeworks=function(c){m(c,a.userRegularEvents);var e=!1,f=d("filter")(c,function(a){return a.repeats&&a.repeatDates&&a.repeatDates.indexOf(q)>=0?(e=!0,!0):a.repeats?!1:a.calendarDayFormat==q?!0:!1}),g=d("filter")(a.userRegularEvents,function(a){return a.repeats&&a.repeatDates&&a.repeatDates.indexOf(q)>=0?(e=!0,!0):a.repeats?!1:a.calendarDayFormat==q?!0:!1});if(g.length&&E(g,function(a){f.push(a)}),f.length){if(e){var h=0;E(f,function(a){if(a.repeats){var c=angular.copy(a);L.updateRepeatHomeworkStatus(c,b.seletedDate),f[h]=c}h++}),L.sortUIHomeworks(f,!0)}b.dayHomeworks={hasmore:!1,groups:[{title:"Homework",id:"cal-hws",items:f,closed:b.hwListControl.closedGroups.indexOf("cal-hws")>=0?!0:!1}]}}else b.dayHomeworks=null};var x=function(c){c&&(c.preventDefault(),c.stopPropagation()),b.showHomemeworkAddOptions=!1,h.unbind("click",x),b.$$phase||a.$$phase||b.$apply()};b.showHomemeworkAddOptions=!1,b.toggleHomeworkAddOptions=function(c){c&&(c.preventDefault(),c.stopPropagation()),b.showHomemeworkAddOptions?(b.showHomemeworkAddOptions=!1,h.unbind("click",x)):(b.showHomemeworkAddOptions=!0,h.bind("click",x)),b.$$phase||a.$$phase||b.$apply()},b.addClass=function(){if(b.user&&"teachers"==b.user.jcc){var c=!0;if(a.userClasses){var d=0;E(a.userClasses,function(a){a.isCurrent&&(d+=1)}),d>=2&&(c=!1)}c?i.open({templateUrl:"templates/classes/add-classes.html",controller:"AddClassesCtrl",title:"Add Classes",size:"medium"}):i.open({templateUrl:"templates/classes/add-edit.html",controller:"AddManualClassCtrl",title:"Add Class",size:"medium"})}else i.open({templateUrl:"templates/classes/add-or-join.html",controller:"AddOrJoinClassCtrl",title:"Add or Join Class",size:a.userSchools?"medium":"medium-large"})};var y=a.$watch("userClasses",function(a){a&&(s=!1,b.clsListControl.reloadFilteredClasses(a))});b.clsListControl.reloadFilteredClasses=function(a,c){b.dayClasses=Q.filterClassesBy(a,"date",b.seletedDate),n(),o(),b.$$phase||b.$apply()};var z=function(c){c&&(c.preventDefault(),c.stopPropagation()),b.showClassesAddOptions=!1,h.unbind("click",z),b.$$phase||a.$$phase||b.$apply()};b.showClassesAddOptions=!1,b.toggleClassesAddOptions=function(c){c&&(c.preventDefault(),c.stopPropagation()),b.showClassesAddOptions?(b.showClassesAddOptions=!1,h.unbind("click",z)):(b.showClassesAddOptions=!0,h.bind("click",z)),b.$$phase||a.$$phase||b.$apply()};var A=a.$watch("userRegularEvents",function(c){if(c){if(t)return void(t=!1);b.hwListControl.reloadFilteredHomeworks(a.userHomeworks)}});if(b.addEvent=function(){i.open({templateUrl:"templates/events/add-edit.html",controller:"AddEventCtrl",title:"Add Event",size:"medium",params:{initDate:b.seletedDate}})},b.addNoSchoolDay=function(){i.open({templateUrl:"templates/events/add-edit-no-school.html",controller:"AddNoSchoolDayCtrl",title:"Add No School Day",size:"medium",params:{initDate:b.seletedDate}})},b.addLateStart=function(){i.open({templateUrl:"templates/events/add-edit-late-start.html",controller:"AddLateStartCtrl",title:"Add Late Start",size:"medium",params:{initDate:b.seletedDate}})},b.addEarlyRelease=function(){i.open({templateUrl:"templates/events/add-edit-early-release.html",controller:"AddEarlyReleaseCtrl",title:"Add Early Release",size:"medium",params:{initDate:b.seletedDate}})},b.openWeekView=function(){D.setLocalItem("defaultCalFilter","week"),f.url("/calendar/week/"+J.formatISO8601(b.seletedDate,1)),b.$$phase||b.$apply()},j.isMacApp){b.$on("$destroy",function(){w(),y(),A(),v();try{U.setMenuItemState("View","Calendar","off"),MacApp.Menu.getItem("Calendar")&&MacApp.Menu.getItem("Calendar").remove()}catch(a){Canadarm.error("Failed to load Menu on Mac",a)}});try{U.setMenuItemState("View","Calendar","on"),MacApp.Menu.addItem({label:"Calendar",index:3});var B=MacApp.Menu.getItem("Calendar").submenu;B.addItem({label:"Month View",keys:"alt+m",state:"on"}),B.addItem({label:"Week View",keys:"alt+w"},function(){b.openWeekView()}),B.addSeparator(),B.addItem({label:"Show Today",keys:"alt+t"},function(){b.setToday()})}catch(C){Canadarm.error("Failed to load Menu on Mac",C)}}else{var F=angular.element(g),H=function(){F.width()<=685&&!b.showFull?(b.showFull=!0,b.$$phase||b.$apply()):F.width()>685&&b.showFull&&(b.showFull=!1,b.$$phase||b.$apply())};H(),F.bind("resize",H),b.$on("$destroy",function(){F.unbind("resize",H),w(),y(),A(),v()})}l.fetchRewardeMoment().then(function(a){l.showMomentWindow(b,a).then(function(){J.debugLog("Show moment success!")}),function(){J.debugLog("Show moment fail!")}},function(a){console.log(a)})}]),ra.controller("WeekCalendarCtrl",["$rootScope","$scope","$routeParams","$filter","dateFilter","$location","$modal","$timeout","$document",function(a,b,c,d,e,f,g,h,i){function k(c){for(var f=[],g=0;7>g;g++){var h=new Date(b.weekStartDate);h.setDate(h.getDate()+g),h&&f.push({date:h,isToday:e(h,"yyyyMMdd")==s,items:[],collapsed:0==g||6==g?!0:!1})}var i=d("filter")(c,function(a){if(a.repeats&&a.repeatDates){var b=!1;return E(a.repeatDates,function(a){!b&&a>=q&&r>=a&&(b=!0)}),b}return a.calendarDayFormat>=q&&a.calendarDayFormat<=r}),j=d("filter")(a.userRegularEvents,function(a){if(a.repeats&&a.repeatDates){var b=!1;return E(a.repeatDates,function(a){!b&&a>=q&&r>=a&&(b=!0)}),b}return a.calendarDayFormat>=q&&a.calendarDayFormat<=r});j.length&&E(j,function(a){i.push(a)}),b.noWeekHomework=i&&i.length?!1:!0,E(i,function(a){a.repeats?E(a.repeatDates,function(b){if(b>=q&&r>=b){var c=K.dateFromDateFormat(b),d=angular.copy(a);L.updateRepeatHomeworkStatus(d,c),f[d.dueDate.getDay()].items.push(d)}}):a.dueDate&&f[a.dueDate.getDay()].items.push(a)}),E(f,function(a){a.items.length>1&&L.sortUIHomeworks(a.items,!0)}),b.week=f}function l(a,b){if(a.isEvent)return void g.open({templateUrl:"templates/events/add-edit.html",controller:"AddEventCtrl",title:"Edit Event",analyticsTitle:"Edit Event",size:"medium",params:{regularEvent:a,editType:b}});var c=a.type&&"13"!=a.type.id?"Edit "+a.type.display:"Edit Homework";g.open({templateUrl:"templates/homework/add-edit.html",controller:"AddHomeworkCtrl",title:c,analyticsTitle:"Edit Homework",size:"medium",params:{homework:a,editType:b}})}function m(b,c){function d(){C.deleteEvent(b.id,F.getUserID(a),!0).then(function(b){ua.sendAppView("Delete Event Success"),angular.element(c.target).closest("li").addClass("closed"),h(function(){R.loadEvents(a,!0)},600)},function(a){ua.sendAppView("Delete Event Failed"),J.logError(a)})}function f(d){"undefined"==typeof d&&(d=[e(b.eventDate,"yyyyMMdd")]),C.deleteRepeatingEventDates(b.dbID,d,!0).then(function(b){ua.sendAppView("Delete Event Success"),angular.element(c.target).closest("li").addClass("closed"),h(function(){R.loadEvents(a,!0)},600)},function(a){ua.sendAppView("Delete Event Failed"),J.logError(a)})}ua.sendAppView("Delete Event"),b.repeats&&b.isManual?nAlert({title:"This repeats",html:"<p>Which occurrence do you want to remove?</p>",confirmButtonText:"Only "+e(b.eventDate,"MMMM d"),altButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0},function(a,b){a?f():b&&d()}):a.userSettings.dontPromptDelete?d():nAlert({title:"Delete Event",html:"<p>Are you sure you want to delete <strong>"+b.title+"</strong>?</p>",confirmButtonText:"Delete",closeOnConfirm:!1,showCancelButton:!0},function(a){a&&(d(),nAlert.close())})}a.bodyClass=null,a.nav="calendar";var n=new Date;if(b.seletedDate=new Date,c.date){var p=J.parseISO8601(c.date);p&&(b.seletedDate=p)}b.weekStartDate=K.dateFirstDayOfTheWeek(b.seletedDate),b.weekEndDate=K.dateLastDayOfTheWeek(b.seletedDate);for(var q=e(b.weekStartDate,"yyyyMMdd"),r=e(b.weekEndDate,"yyyyMMdd"),s=e(n,"yyyyMMdd"),t=!0,u=[],v=0;7>v;v++){var w=new Date(b.weekStartDate);w.setDate(w.getDate()+v),w&&u.push({date:w,isToday:e(w,"yyyyMMdd")==s,items:[],collapsed:0==v||6==v?!0:!1})}b.noWeekHomework=!0,b.week=u;var x=a.$watch("userHomeworks",function(a){a&&k(a)});b.expandWeek=function(a){0==a?(b.week[0].collapsed=!1,b.week[1].collapsed=!1,b.week[5].collapsed=!0,b.week[6].collapsed=!0):6==a?(b.week[5].collapsed=!1,b.week[6].collapsed=!1,b.week[0].collapsed=!0,b.week[1].collapsed=!0):(1==a||5==a)&&(b.week[1].collapsed=!1,b.week[5].collapsed=!1,b.week[0].collapsed=!0,b.week[6].collapsed=!0)},b.addHomework=function(){g.open({templateUrl:"templates/homework/add-edit.html",controller:"AddHomeworkCtrl",title:"Add Homework",size:"medium",params:{initDate:b.seletedDate}})},b.openHomework=function(b){if(b.isHallPass)return void a.openViewHallPass(b.id);if(b.isEvent)return void g.open({templateUrl:"templates/events/view-event.html",controller:"ViewEventCtrl",title:"View Event",analyticsTitle:"View Event",size:"medium",params:{regularEvent:b}});var c=b.type&&"13"!=b.type.id?b.type.display+" Details":"Homework Details";g.open({templateUrl:"templates/homework/view-homework.html",controller:"ViewHomeworkCtrl",title:c,analyticsTitle:"View Homework",size:"medium",params:{homework:b}})},b.editHomework=function(a,b){b.preventDefault(),b.stopPropagation(),a.repeats&&a.isManual?nAlert({title:"This repeats",html:"<p>Which occurrence do you want to edit?</p>",confirmButtonText:"Only "+e(a.dueDate,"MMMM d"),altButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0},function(b,c){b?l(a,"edit-one"):c&&l(a,"edit-all")}):l(a,null)},b.deleteHomework=function(b,c){function d(){o.deleteHw(b.id,F.getUserID(a),!0).then(function(b){ua.sendAppView("Delete Homework Success"),angular.element(c.target).closest("li").addClass("closed"),h(function(){L.loadHomeworks(a,!0)},600)},function(a){ua.sendAppView("Delete Homework Failed"),J.logError(a)})}function f(c){"undefined"!=typeof c&&c||(c=[e(b.dueDate,"yyyyMMdd")]),o.deleteRepeatingHomeworkDates(b.dbID,c,!0).then(function(b){ua.sendAppView("Delete Homework Success"),h(function(){L.loadHomeworks(a,!0)},600)},function(a){ua.sendAppView("Delete Homework Failed"),J.logError(a)})}if(c.preventDefault(),c.stopPropagation(),!b.isDeletable)return void L.loadHomeworks(a);if(b.isEvent)return void m(b,c);var g="Homework";b.type&&"13"!=b.type.id&&(g=b.type.display),ua.sendAppView("Delete Homework"),b.repeats&&b.isManual?nAlert({title:"This repeats",html:"<p>Which occurrence do you want to remove?</p>",confirmButtonText:"Only "+e(b.dueDate,"MMMM d"),altButtonText:"All",cancelButtonText:"Cancel",showCancelButton:!0,showAltButton:!0},function(a,b){a?f():b&&d()}):a.userSettings.dontPromptDelete?d():nAlert({title:"Delete "+g,html:"<p>Are you sure you want to delete <strong>"+b.title+"</strong>?</p>",confirmButtonText:"Delete",closeOnConfirm:!1,showCancelButton:!0},function(a){a&&(d(),nAlert.close())})},b.completeHomework=function(b,c){function f(){b.isComplete&&b.isUncompleteable?(b.complete=!1,b.isComplete=!1,b.isCompleteable=!0,b.isUncompleteable=!1,ua.sendEvent("Homework","Quick Link","Uncomplete")):b.isCompleteable&&(b.complete=!0,b.isComplete=!0,b.isCompleteable=!1,b.isUncompleteable=b.isNeverLateType?!b.isPastHwDueDate:!0,ua.sendEvent("Homework","Quick Link","Complete")),b.displayClasses=L.homeworkDisplayClasses(b),o.setHomeworkStatus(b.dbID,b.complete,!0)}function g(a,c){var d=!1;a.isComplete&&a.isUncompleteable?(ua.sendEvent("Homework","Quick Link","Uncomplete"),a.complete=!1,a.isComplete=!1,a.isCompleteable=!0,a.isUncompleteable=!1,a.displayClasses=L.homeworkDisplayClasses(a)):a.isCompleteable&&(d=!0,ua.sendEvent("Homework","Quick Link","Complete"),a.complete=!0,a.isComplete=!0,a.isCompleteable=!1,a.isUncompleteable=b.isNeverLateType?!b.isPastHwDueDate:!0,a.displayClasses=L.homeworkDisplayClasses(a)),"undefined"==typeof c&&(c=[e(a.dueDate,"yyyyMMdd")]),o.setRepeatHomeworkStatus(a.dbID,c,d,!0)}function i(c,d){if(c&&c.repeats){var f=c.repeatCompleted?c.repeatCompleted:[];"undefined"==typeof d&&(d=[e(b.dueDate,"yyyyMMdd")]),E(d,function(a){b.isComplete&&b.isUncompleteable&&f.indexOf(a)>=0?f.splice(f.indexOf(a),1):b.isCompleteable&&f.indexOf(a)<0&&f.push(a)}),c.repeatCompleted=f,L.updateRepeatHomeworkDate(c),a.$$phase||a.$apply(),L.resortUIHomework(a,!0),h(function(){k(a.userHomeworks)},500)}}if(c.preventDefault(),c.stopPropagation(),b.repeats){var j=d("filter")(a.userHomeworks,{id:b.id},!0),l=j&&j.length?j[0]:null;l&&i(l),g(b)}else f()},b.openPreviousWeek=function(){var c=new Date(b.weekStartDate);c.setDate(c.getDate()-6),b.seletedDate=c,b.weekStartDate=K.dateFirstDayOfTheWeek(b.seletedDate),b.weekEndDate=K.dateLastDayOfTheWeek(b.seletedDate),q=e(b.weekStartDate,"yyyyMMdd"),r=e(b.weekEndDate,"yyyyMMdd"),q>=s&&s>=r&&(b.seletedDate=n),k(a.userHomeworks)},b.openNextWeek=function(){var c=new Date(b.weekEndDate);c.setDate(c.getDate()+2),b.seletedDate=c,b.weekStartDate=K.dateFirstDayOfTheWeek(b.seletedDate),b.weekEndDate=K.dateLastDayOfTheWeek(b.seletedDate),q=e(b.weekStartDate,"yyyyMMdd"),r=e(b.weekEndDate,"yyyyMMdd"),q>=s&&s>=r&&(b.seletedDate=n),k(a.userHomeworks)},b.openMonthView=function(){D.setLocalItem("defaultCalFilter","month"),f.url("/calendar/"+J.formatISO8601(b.seletedDate,1)),b.$$phase||b.$apply()};var y=function(c){c&&(c.preventDefault(),c.stopPropagation()),b.showHomemeworkAddOptions=!1,i.unbind("click",y),b.$$phase||a.$$phase||b.$apply()};b.showHomemeworkAddOptions=!1,b.toggleHomeworkAddOptions=function(c){c&&(c.preventDefault(),c.stopPropagation()),b.showHomemeworkAddOptions?(b.showHomemeworkAddOptions=!1,i.unbind("click",y)):(b.showHomemeworkAddOptions=!0,i.bind("click",y)),b.$$phase||a.$$phase||b.$apply()};var z=a.$watch("userRegularEvents",function(b){if(b){if(t)return void(t=!1);k(a.userHomeworks)}});if(b.addEvent=function(){g.open({templateUrl:"templates/events/add-edit.html",controller:"AddEventCtrl",title:"Add Event",size:"medium",params:{initDate:b.seletedDate}})},b.$on("$destroy",function(){if(x(),z(),j.isMacApp)try{U.setMenuItemState("View","Calendar","off"),MacApp.Menu.getItem("Calendar")&&MacApp.Menu.getItem("Calendar").remove()}catch(a){Canadarm.error("Failed to load Menu on Mac",a)}}),j.isMacApp)try{U.setMenuItemState("View","Calendar","on"),MacApp.Menu.addItem({label:"Calendar",index:3});var A=MacApp.Menu.getItem("Calendar").submenu;
A.addItem({label:"Month View",keys:"alt+m"},function(){b.openMonthView()}),A.addItem({label:"Week View",keys:"alt+w",state:"on"}),A.addSeparator(),A.addItem({label:"Show Today",keys:"alt+t",enabled:!1},function(){})}catch(B){Canadarm.error("Failed to load Menu on Mac",B)}}]),ra.controller("LoginCtrl",["$rootScope","$scope","$routeParams","$location","$timeout","hwSync",function(a,b,c,d,f,g){function h(a){nAlert({title:"You are already logged in.",text:"Please log in with a different account."},function(){f(function(){angular.element("#username-field").focus()},100)}),b.login={},a&&(a.$setPristine(),a.$setUntouched()),b.$apply()}if(a.bodyClass="centered-layout small",a.showTheme=!1,a.users&&a.users.length>=3)if(a.users.length>=7)d.url("/");else{var i=!1;E(a.users,function(a){a.isPremiumAccount&&(i=!0)}),i||d.url("/")}b.signin=function(c,i){if(c.$valid){var j=i.username.replace(/\s/g,""),k=i.password.replace(/\s/g,"");w.hasUserWithUsername(j).then(function(i){return i?void h(c):(b.spinnerText="Signing in",b.showSpinner=!0,ua.sendAppView("Login with myHomework"),void g.signin(j,k).then(function(b){D.unloadUserData(a,!1),e(),F.loadUser(a,b.usrID,!0).then(function(){G.loadSchools(a,!0).then(function(){a.startGoogleAnalyticsSession(),ua.sendAppView("Login with myHomework - Success"),a.themeBanner=null,a.mainSpinner={show:!0,type:"login-sync",text:"Syncing"},d.url("/"),a.$$phase||a.$apply()})})},function(a){if(a&&a.userExists)return b.showSpinner=!1,void h(c);ua.sendAppView("Login with myHomework - Failed");var d="We were unable to sign you in at this time. Please make sure you are connected to the internet and try again.";a&&404==a.status?(d="That username/email or password didn't match a myHomework user.",b.login.password=""):a&&503==a.status?d="myHomework is currently down for maintenance. Try again later.":a&&420==a.status?(d="There were too many sign in attempts from your location. Try again in a few minutes.",b.login={}):a&&a.status&&(d="We were unable to sign you in at this time. Please make sure you are connected to the internet and try again. ("+a.status+")"),nAlert({title:"Failed to Sign in",text:d},function(){f(function(){angular.element("#username-field").focus()},100)}),b.showSpinner=!1,c.$setPristine(),c.$setUntouched(),b.$apply()}))})}},b.signinWithGoogle=function(){ua.sendAppView("Login with Google"),j.isWebApp||(b.spinnerText="Signing in with Google",b.showSpinner=!0),g.signinWithGoogle(b).then(function(c){e(),F.loadUser(a,c.usrID,!0).then(function(){G.loadSchools(a,!0).then(function(){a.startGoogleAnalyticsSession(),ua.sendAppView("Login with Google - Success"),a.mainSpinner={show:!0,type:"login-sync",text:"Syncing"},d.url("/"),b.$apply()})})},function(a){if(a&&a.userExists)return b.showSpinner=!1,void h();ua.sendAppView("Login with Google - Failed");var c=a&&a.cancel?null:"We were unable to sign you in at this time. Please make sure you are connected to the internet and try again.";a&&404==a.status?(c=null,nAlert({html:"We were unable to find a myHomework user associated with this Google account. Please sign in with your myHomework account or sign up.",confirmButtonText:"Sign up",cancelButtonText:"Close",closeOnConfirm:!1,showCancelButton:!0},function(a){a&&(nAlert.close(),d.url("/signup"),b.$apply())})):a&&503==a.status?c="myHomework is currently down for maintenance. Try again later.":a&&420==a.status?c="There were too many sign in attempts from your location. Try again in a few minutes.":a&&a.status&&!a.cancel&&(c="We were unable to sign you in at this time. Please make sure you are connected to the internet and try again. ("+a.status+")"),c&&nAlert({title:"Failed to Sign in",text:c}),b.showSpinner=!1,b.$apply()})},b.signinWithFacebook=function(){ua.sendAppView("Login with Facebook"),j.isChromeApp||(b.spinnerText="Signing in with Facebook",b.showSpinner=!0),g.signinWithFacebook(b).then(function(c){e(),F.loadUser(a,c.usrID,!0).then(function(){G.loadSchools(a,!0).then(function(){a.startGoogleAnalyticsSession(),ua.sendAppView("Login with Facebook - Success"),a.mainSpinner={show:!0,type:"login-sync",text:"Syncing"},d.url("/"),b.$apply()})})},function(c){if(c&&c.userExists)return b.showSpinner=!1,void h();ua.sendAppView("Login with Facebook - Failed");var e=c&&c.cancel?null:"We were unable to sign you in at this time. Please make sure you are connected to the internet and try again.";c&&404==c.status?(e=null,nAlert({html:"We were unable to find a myHomework user associated with this Facebook account. Please sign in with your myHomework account or sign up.",confirmButtonText:"Sign up",cancelButtonText:"Close",closeOnConfirm:!1,showCancelButton:!0},function(a){a&&(nAlert.close(),d.url("/signup"),b.$apply())})):c&&503==c.status?e="myHomework is currently down for maintenance. Try again later.":c&&420==c.status?e="There were too many sign in attempts from your location. Try again in a few minutes.":c&&c.status&&!c.cancel?e="We were unable to sign you in at this time. Please make sure you are connected to the internet and try again. ("+c.status+")":a.isKioskApp&&(e="Unable to sign in: "+c),e&&nAlert({title:"Failed to Sign in",text:e}),b.showSpinner=!1,b.$apply()})},b.$on("$destroy",function(){a.mainSpinner&&"login-sync"==a.mainSpinner.type?a.showTheme=!1:a.showTheme=a.user&&a.user.theme?!0:!1})}]),ra.controller("SignupCtrl",["$rootScope","$scope","$routeParams","$modal","$location","$window","hwSync",function(a,b,c,d,e,f,g){if(a.bodyClass="centered-layout small",a.showTheme=!1,a.users&&a.users.length>=3)if(a.users.length>=7)e.url("/");else{var h=!1;E(a.users,function(a){a.isPremiumAccount&&(h=!0)}),h||e.url("/")}b.signupWithGoogle=function(){ua.sendAppView("Sign up with Google"),j.isWebApp||(b.spinnerText="Signing up with Google",b.showSpinner=!0),g.signupWithGoogle(b).then(function(c){F.loadUser(a,c.usrID,!0).then(function(){ua.sendAppView("Sign up with Google - Success"),a.mainSpinner={show:!0,type:"login-sync",text:"Syncing"},e.url("/signup/account-choice"),b.$apply()})},function(a){ua.sendAppView("Sign up with Google - Failed");var c=a&&a.cancel?null:"We were unable to sign you up at this time. Please make sure you are connected to the internet and try again.";a&&503==a.status?c="myHomework is currently down for maintenance. Try again later.":a&&420==a.status?c="There were too many sign in attempts from your location. Try again in a few minutes.":a&&400==a.status&&a.data.error_description?c=a.data.error_description:a&&a.status&&!a.cancel&&(c="We were unable to sign you up at this time. Please make sure you are connected to the internet and try again. ("+a.status+")"),c&&nAlert({title:"Failed to Sign up",text:c}),b.showSpinner=!1,b.$apply()})},b.signupWithFacebook=function(){ua.sendAppView("Sign up with Facebook"),j.isChromeApp||(b.spinnerText="Signing up with Facebook",b.showSpinner=!0),g.signupWithFacebook(b).then(function(c){F.loadUser(a,c.usrID,!0).then(function(){ua.sendAppView("Sign up with Facebook - Success"),a.mainSpinner={show:!0,type:"login-sync",text:"Syncing"},e.url("/signup/account-choice"),b.$apply()})},function(a){ua.sendAppView("Sign up with Facebook - Failed");var c=a&&a.cancel?null:"We were unable to sign you up at this time. Please make sure you are connected to the internet and try again.";a&&503==a.status?c="myHomework is currently down for maintenance. Try again later.":a&&420==a.status?c="There were too many sign in attempts from your location. Try again in a few minutes.":a&&400==a.status&&a.data.error_description?c=a.data.error_description:a&&a.status&&!a.cancel&&(c="We were unable to sign you up at this time. Please make sure you are connected to the internet and try again. ("+a.status+")"),c&&nAlert({title:"Failed to Sign up",text:c}),b.showSpinner=!1,b.$apply()})},b.createAccount=function(){ua.sendAppView("Sign up with myHomework"),e.url("/signup/myHomework")},b.validateEmail=function(a){return a.email.$error.email||a.email.$error.reallyRequired||!b.newAccount.email?void(a.emailValidationError=null):void g.validateEmail(b.newAccount.email).then(function(c){204==c.status?a.emailValidationError="Email not available. Choose another or sign in with your existing account.":400==c.status&&c.data&&c.data.error_description?a.emailValidationError=c.data.error_description:a.emailValidationError=null,b.$$phase||b.$apply()},function(c){a.emailValidationError=null,b.$$phase||b.$apply()})},b.resetEmailValidation=function(a){a.emailValidationError=null,b.$$phase||b.$apply()},b.signup=function(c){c.$valid&&(ua.sendAppView("Sign up with myHomework"),b.spinnerText="Signing up",b.showSpinner=!0,g.signupWithmyHomework(b).then(function(c){F.loadUser(a,c.usrID,!0).then(function(){ua.sendAppView("Sign up with myHomework - Success"),b.showSpinner=!1,a.mainSpinner={show:!0,type:"login-sync",text:"Syncing"},e.url("/signup/account-choice"),b.$apply()})},function(a){ua.sendAppView("Sign up with myHomework - Failed");var c=a&&a.cancel?null:"We were unable to sign you up at this time. Please make sure you are connected to the internet and try again.";a&&503==a.status?c="myHomework is currently down for maintenance. Try again later.":a&&420==a.status?c="There were too many sign up attempts from your location. Try again in a few minutes.":a&&400==a.status&&a.data.error_description?c=a.data.error_description:a&&a.status&&(c="We were unable to sign you up at this time. Please make sure you are connected to the internet and try again. ("+a.status+")"),c&&nAlert({title:"Failed to Sign up",text:c}),b.showSpinner=!1,b.$apply()}))},b.$on("$destroy",function(){a.mainSpinner&&"login-sync"==a.mainSpinner.type?a.showTheme=!1:a.showTheme=a.user&&a.user.theme?!0:!1})}]),ra.controller("CreateAccountCtrl",["$rootScope","$scope","$routeParams","$location","$window","hwSync",function(a,b,c,d,e,f){if(a.bodyClass="centered-layout small",a.showTheme=!1,b.newAccount={},a.users&&a.users.length>=3)if(a.users.length>=7)d.url("/");else{var g=!1;E(a.users,function(a){a.isPremiumAccount&&(g=!0)}),g||d.url("/")}b.validateEmail=function(a){return a.email.$error.email||a.email.$error.reallyRequired||!b.newAccount.email?void(a.emailValidationError=null):void f.validateEmail(b.newAccount.email).then(function(c){204==c.status?a.emailValidationError="Email not available. Choose another or sign in with your existing account.":400==c.status&&c.data&&c.data.error_description?a.emailValidationError=c.data.error_description:a.emailValidationError=null,b.$$phase||b.$apply()},function(c){a.emailValidationError=null,b.$$phase||b.$apply()})},b.resetEmailValidation=function(a){a.emailValidationError=null,b.$$phase||b.$apply()},b.signup=function(c){c.$valid&&(ua.sendAppView("Sign up with myHomework"),b.spinnerText="Signing up",b.showSpinner=!0,f.signupWithmyHomework(b).then(function(b){F.loadUser(a,b.usrID,!0).then(function(){ua.sendAppView("Sign up with myHomework - Success"),a.mainSpinner={show:!0,type:"login-sync",text:"Syncing"},$modal.close(),$modal.open({templateUrl:"templates/signup/account-choice.html",controller:"AccountChoiceCtrl",title:"Choose Plan",size:"medium"})})},function(a){ua.sendAppView("Sign up with myHomework - Failed");var c=a&&a.cancel?null:"We were unable to sign you up at this time. Please make sure you are connected to the internet and try again.";a&&503==a.status?c="myHomework is currently down for maintenance. Try again later.":a&&420==a.status?c="There were too many sign up attempts from your location. Try again in a few minutes.":a&&400==a.status&&a.data.error_description?c=a.data.error_description:a&&a.status&&(c="We were unable to sign you up at this time. Please make sure you are connected to the internet and try again. ("+a.status+")"),c&&nAlert({title:"Failed to Sign up",text:c}),b.showSpinner=!1,b.$apply()}))},b.$on("$destroy",function(){a.mainSpinner&&"login-sync"==a.mainSpinner.type?a.showTheme=!1:a.showTheme=a.user&&a.user.theme?!0:!1})}]),ra.controller("AccountChoiceCtrl",["$rootScope","$scope","$modal","$location","$window","$http","hwSync","accountAPI",function(a,b,c,d,e,f,g,h){a.bodyClass="centered-layout medium",a.showTheme=!1;var i="web";j.isMacApp&&(i="mac"),j.isChromeApp&&(i="chrome"),j.isWindowsApp&&(i="windows"),f({method:"GET",url:j.wurl+"account/app/account-choices?av="+j.av+"&at="+i,headers:{"Content-Type":"application/json; charset=utf-8"}}).success(function(a,c,d,e){b.title=a.title,b.freeplanname=a.freeplanname,b.premiumplanname=a.premiumplanname,b.freeitems=a.freeitems,b.premiumitems=a.premiumitems,b.premiumaction=a.premiumaction,b.freeaction=a.freeaction,b.analyticsAccountChoiceEventId=a.analyticsAccountChoiceEventId,a.videourl&&(b.videourl=a.videourl,b.vidoectatext=a.vidoectatext),ua.sendEvent("accountchoice","page-view","page-view"+b.analyticsAccountChoiceEventId)}).error(function(a,c,d,e){b.title="Choose a Plan",b.freeplanname="Basic",b.premiumplanname="Premium",b.freeitems=["Track assignments, projects, exams, and more","Track classes","Receive due date reminders","Sync between devices"],b.premiumitems=[b.freeplanname+" features+","No Ads or Banners","Personalize with Themes","Attach Pictures & Files","Enhanced App Widgets","View in External Calendars","Upgrades All Devices"],b.premiumaction="Choose Premium",b.freeaction="Choose Basic",b.analyticsAccountChoiceEventId="test123",b.videourl=void 0,b.vidoectatext=void 0,ua.sendEvent("accountchoice","page-view","page-view"+b.analyticsAccountChoiceEventId)}),h.fetchUpgradePrice().then(function(a){b.upgradePrice=a,b.$$phase||b.$apply()}),b.chooseFree=function(){ua.sendAppView("Account Choice - Chose Free"),ua.sendEvent("accountchoice","chose-free","chose-free"+b.analyticsAccountChoiceEventId),d.url("/")},b.goHome=function(){d.url("/")},b.choosePremium=function(){ua.sendAppView("Account Choice - Chose Premium"),ua.sendEvent("accountchoice","chose-premium","chose-premium"+b.analyticsAccountChoiceEventId),j.isChromeApp||j.isWebApp?chrome.app.window.create("myHomework Chrome/webview.html",{hidden:!0,width:500,height:608},function(c){c.contentWindow.addEventListener("DOMContentLoaded",function(d){var e=c.contentWindow.document.querySelector("webview");e.src=j.wurl+"account/upgrade-chrome/?isapp=t&_u="+a.user.id,e.addEventListener("close",function(){c.contentWindow.close()}),e.addEventListener("loadredirect",function(a){var d=a.newUrl.split("success");if(d&&d.length>1)c.contentWindow.close(),b.goHome(),b.$apply();else{var d=a.newUrl.split("login");d&&d.length>1&&c.contentWindow.close()}}),c.show()})}):h.upgradeAccount(b.upgradePrice,!1,b).then(function(){return ua.sendEvent("accountchoice","chose-premium","premium-success"+b.analyticsAccountChoiceEventId),ua.sendAppView("Upgrade New Account Success"),j.isWebApp?void(b.upgradeSpinner.show=!1):void F.loadUser(a,a.user.id,!0).then(function(){b.upgradeSpinner.show=!1,b.$$phase||b.$apply(),nAlert({text:"Account is now Premium!",closeOnConfirm:!1},function(){j.isMacApp||a.forceSync(),d.url("/"),b.$apply(),nAlert.close()})})},function(a,d){ua.sendEvent("accountchoice","chose-premium","premium-upgrade-failed"+b.analyticsAccountChoiceEventId),b.upgradeSpinner.show=!1,b.$apply(),"cancel"!=a&&ua.sendAppView("Upgrade New Account Failed"),"close"==a?c.close():"purchase"==a?nAlert("An error occurred when trying to make the purchase. Please try again in a few minutes."):"validate"==a?nAlert("We couldn't validate your purchase. Please contact us with a copy of your receipt."):"message"==a?nAlert(d):"cancel"!=a&&nAlert("Something went wrong. Please try again")})}}]),ra.controller("AccountCtrl",["$rootScope","$scope","$window","$modal","$timeout","hwSync","accountAPI",function(b,c,d,e,f,g,h){b.user.localAvatar&&!j.isWebApp&&f(function(){function b(){e.height()>e.width()?(f.css("width",e.height()+"px"),f.css("height",e.height()+"px")):(f.css("width",e.width()+"px"),f.css("height",e.width()+"px")),g.css("width",e.width()+"px"),g.css("height",e.height()+"px")}if(j.isMacApp){var e=angular.element(d),f=angular.element("#user-avatar-canvas"),g=angular.element("#account-details");e.bind("resize",b),c.$on("$destroy",function(){e.unbind("resize",b)})}a("user-avatar-bg","user-avatar-canvas",26,!1,470)},200),h.getUserInfo().then(function(){F.loadUser(b,b.user.id,!0).then(function(){G.loadSchools(b,!0).then(function(){U.adjustModalHeight()})})}),c.changePicture=function(){e.close(),e.open({templateUrl:"templates/account/edit-picture.html",controller:"EditPictureCtrl",title:"Edit Picture",size:"medium"})},c.editAccount=function(){e.close(),e.open({templateUrl:"templates/account/edit-account.html",controller:"EditAccountCtrl",title:"Edit Account",size:"medium"})},c.upgradeAccount=function(){e.close(),e.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"})},c.upgradePoints=function(){e.close(),e.open({templateUrl:"templates/account/upgrade-points.html",controller:"UpgradePointsCtrl",title:"Upgrade Points",size:"small"})},c.renewAccount=function(){e.close(),e.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Renew Account",size:"small",params:{isRenew:!0}})},c.connectWithGoogle=function(){ua.sendAppView("Connect with Google"),j.isWebApp||(c.spinnerText="Connecting with Google",c.showSpinner=!0),g.connectinWithGoogle(c).then(function(a){F.loadUser(b,a.usrID,!0).then(function(){ua.sendAppView("Connect with Google - Success"),nAlert({title:"Connected to Google!",text:"Your myHomework account is now connected with Google. You are now able to sign in using only your google account.",closeOnConfirm:!1},function(){nAlert.close(),e.close()})})},function(a){ua.sendAppView("Connect with Google - Failed");var b=a&&a.cancel?null:"We were unable to connect your account with Google. Please make sure you are connected to the internet and try again.";a&&400==a.status&&a.data&&a.data.error_description?b=a.data.error_description:a&&503==a.status&&(b="myHomework is currently down for maintenance. Try again later."),b&&nAlert({title:"Failed to Connect",text:b}),c.showSpinner=!1,c.$apply()})},c.connectWithFacebook=function(){ua.sendAppView("Connect with Facebook"),j.isChromeApp||(c.spinnerText="Connecting in with Facebook",c.showSpinner=!0),g.connectWithFacebook(c).then(function(a){F.loadUser(b,a.usrID,!0).then(function(){ua.sendAppView("Connect with Facebook - Success"),nAlert({title:"Connected to Facebook!",text:"Your myHomework account is now connected with Facebook. You are now able to sign in using only facebook.",closeOnConfirm:!1},function(){nAlert.close(),e.close()})})},function(a){ua.sendAppView("Connect with Facebook - Failed");var b=a&&a.cancel?null:"We were unable to connect your account with Facebook. Please make sure you are connected to the internet and try again.";a&&400==a.status&&a.data&&a.data.error_description?b=a.data.error_description:a&&503==a.status&&(b="myHomework is currently down for maintenance. Try again later."),b&&nAlert({title:"Failed to Connect",text:b}),c.showSpinner=!1,c.$apply()})},c.cancel=function(){e.close()}}]),ra.controller("GuardianAddCtrl",["$rootScope","$scope","$modal","$document","accountAPI",function(a,b,c,d,e){b.account=angular.copy(a.user),b.saveSpinner={show:!1,text:"Updating Account"},b.save=function(d,f){if(d.$valid){var g=a.user,h={},i=!1;if(f.firstName&&(h.f=f.firstName,i=!0),f.lastName&&(h.l=f.lastName,i=!0),f.email&&(h.e=f.email,i=!0),!i)return void c.close();b.saveSpinner.show=!0,e.addGuardian(h).then(function(d){ua.sendAppView("Add Parent Success"),F.loadUser(a,g.id,!0).then(function(){b.saveSpinner.show=!1,nAlert({text:"Parent or guardian was added. Have them check their email.",closeOnConfirm:!1},function(){nAlert.close(),c.close()})})},function(a,c){if(ua.sendAppView("Add Parent Failed"),b.saveSpinner.show=!1,b.$$phase||b.$apply(),a&&c){if(400==c&&a.error_description)return void nAlert(a.error_description);if(503==c)return void nAlert("Oops! Our server is unavailable right now. Please try again later.");if(500==c)return void nAlert("Oops! An error occurred when trying to update your account. Please try again later.")}navigator.onLine?nAlert("An error occurred while trying to update your account. Please try again in a few minutes."):nAlert("An error occurred while trying to update your account. Please make sure you have internet connection and try again.")})}},b.cancel=function(){c.close()}}]),ra.controller("EditAccountCtrl",["$rootScope","$scope","$modal","$document","accountAPI",function(a,b,c,d,e){b.account=angular.copy(a.user),b.saveSpinner={show:!1,text:"Updating Account"},b.openDatePicker=function(a){a.preventDefault(),a.stopPropagation(),b.datepicker={opened:!0}},b.changePicture=function(){c.close(),c.open({templateUrl:"templates/account/edit-picture.html",controller:"EditPictureCtrl",title:"Edit Picture",size:"medium"})},b.save=function(d,f){if(d.$valid){var g=a.user,h={},i=!1;if((g.firstName||f.firstName)&&g.firstName!=f.firstName&&(h.f=f.firstName,i=!0),(g.lastName||f.lastName)&&g.lastName!=f.lastName&&(h.l=f.lastName,i=!0),(g.gender||f.gender)&&g.gender!=f.gender&&(h.g=f.gender.length?f.gender:null,i=!0),(g.email||f.email)&&g.email!=f.email&&(h.e=f.email,i=!0),f.dateOfBirth){var j="";g.dateOfBirth&&(j=J.formatISO8601(g.dateOfBirth,1));var k=J.formatISO8601(f.dateOfBirth,1);j!=k&&(h.dob=k,i=!0)}if(!i)return void c.close();b.saveSpinner.show=!0,e.editUserInfo(h).then(function(d){ua.sendAppView("Edit Account Success"),F.loadUser(a,g.id,!0).then(function(){b.saveSpinner.show=!1,c.close()})},function(a,c){if(ua.sendAppView("Edit Account Failed"),b.saveSpinner.show=!1,b.$$phase||b.$apply(),a&&c){if(400==c&&a.error_description)return void nAlert(a.error_description);if(503==c)return void nAlert("Oops! Our server is unavailable right now. Please try again later.");if(500==c)return void nAlert("Oops! An error occurred when trying to update your account. Please try again later.")}navigator.onLine?nAlert("An error occurred while trying to update your account. Please try again in a few minutes."):nAlert("An error occurred while trying to update your account. Please make sure you have internet connection and try again.")})}},b.cancel=function(){c.close()};var f=function(a){9===a.which&&b.datepicker&&b.datepicker.opened&&(b.datepicker={opened:!1},b.$$phase||b.$apply())};d.bind("keydown",f),b.$on("$destroy",function(){d.unbind("keydown",f)})}]),ra.controller("EditPictureCtrl",["$rootScope","$scope","$modal","accountAPI",function(a,b,c,d){b.account=angular.copy(a.user),b.saveSpinner={show:!1,text:"Saving Picture"},b.isCropPicture=!1;var e=b.$watch("manualPicture",function(c){c&&(c.url?(b.isCropPicture=!1,b.saveSpinner={show:!0,text:"Saving Picture"},b.$$phase||b.$apply(),U.adjustModalHeight(),d.editUserInfo({a:c.url}).then(function(c){ua.sendAppView("Edit Picture Success"),F.loadUser(a,a.user.id,!0).then(function(){b.account=angular.copy(a.user),b.saveSpinner.show=!1,b.$$phase||b.$apply(),U.adjustModalHeight()})})):c.base64?(b.isCropPicture=!0,b.$$phase||b.$apply(),U.adjustModalHeight()):(b.isCropPicture=!1,b.$$phase||b.$apply(),U.adjustModalHeight()))});b.$on("$destroy",function(){e()}),b.deletePicture=function(){ua.sendAppView("Delete Picture"),nAlert({title:"Delete Picture",text:"Are you sure you want to delete this picture?",confirmButtonText:"Delete",showCancelButton:!0},function(c){c&&(b.saveSpinner={show:!0,text:"Deleting Picture"},b.$$phase||b.$apply(),d.editUserInfo({a:null}).then(function(c){ua.sendAppView("Delete Picture Success"),b.saveSpinner.show=!1,b.account.localAvatar=null,a.user.localAvatar=null,a.$$phase||a.$apply()}))})},b.useFacebookPicture=function(){b.user.facebookAvatar&&(b.saveSpinner={show:!0,text:"Saving Picture"},b.$$phase||b.$apply(),ua.sendAppView("Use Facebook Picture"),d.editUserInfo({a:b.user.facebookAvatar}).then(function(c){F.loadUser(a,a.user.id,!0).then(function(){b.account=angular.copy(a.user),b.saveSpinner.show=!1,b.$$phase||b.$apply()})}))},b.useGooglePicture=function(){b.user.googleAvatar&&(b.saveSpinner={show:!0,text:"Saving Picture"},b.$$phase||b.$apply(),ua.sendAppView("Use Google Picture"),d.editUserInfo({a:b.user.googleAvatar}).then(function(c){F.loadUser(a,a.user.id,!0).then(function(){b.account=angular.copy(a.user),b.saveSpinner.show=!1,b.$$phase||b.$apply()})}))},b.cancel=function(){c.close()}}]),ra.controller("KiipViewCtrl",["$rootScope","$scope","$location","$modal","$modalParams","$locale","$http","$window","accountAPI","kiipUtils",function(a,b,c,d,e,f,g,h,i,j){b.kiipData=e.kiipData,b.kiip_body_url=b.kiipData.view.modal.body_url,h.uploadDone=function(a){a.src&&console.log(a.src),b.kiipData.myhw_is_reward&&j.rewardShown()},b.cancel=function(){d.close()}}]),ra.controller("UpgradePointsCtrl",["$rootScope","$scope","$location","$modal","$modalParams","$locale","$http","$window","$timeout","accountAPI","kiipUtils",function(a,b,c,d,e,f,g,h,i,k,l){b.rewardAvailable=null,b.momentdata=null,b.settings=angular.copy(a.userSettings),b.saveChange=function(c){a.user.id&&(a.user.settings=b.settings),a.userSettings=b.settings;var d=F.toDBSettings(b.settings);w.setUserSettings(a.user.id,d,!0),j.isMacApp?MacApp.reloadStorage():D.reloadStorage(a,!0)},b.showReward=function(){b.momentdata&&b.momentdata.view&&b.momentdata.view.modal&&b.momentdata.view.modal.body_url?l.showMomentWindow(b,b.momentdata).then(function(a){J.debugLog(a),l.fetchMoment().then(function(a){b.rewardAvailable=!0,b.momentdata=a,b.$apply()},function(){})},function(a){J.debugLog(a)}):l.fetchMoment().then(function(a){b.rewardAvailable=!0,b.momentdata=a,b.$apply()},function(){}),b.rewardAvailable=!1,b.$apply()},l.fetchMoment().then(function(a){b.rewardAvailable=!0,b.momentdata=a,b.$apply()},function(){}),b.cancel=function(){d.close()}}]),ra.controller("UpgradeAccountCtrl",["$rootScope","$scope","$location","$modal","$modalParams","accountAPI",function(a,b,c,d,e,f){b.upgradePrice=null,b.isRenew=e.isRenew?!0:!1,b.upgradeSpinner={show:!1,text:b.isRenew?"Renewing Account":"Upgrading Account"},f.fetchUpgradePrice().then(function(a){b.upgradePrice=a,U.adjustModalHeight(),b.$$phase||b.$apply()},function(){b.isRenew?nAlert("We were unable to get the renew price information. Please make sure you are connected to the internet and try again."):nAlert("We were unable to get the upgrade price information. Please make sure you are connected to the internet and try again.")}),b.upgradeAccount=function(){b.upgradePrice&&(j.isWebapp?J.openURL($window,j.wurl+"account/upgrade-chrome/?isapp=t&_u="+a.user.id):j.isChromeApp||j.isWebApp?chrome.app.window.create("myHomework Chrome/webview.html",{hidden:!0,width:500,height:608},function(b){b.contentWindow.addEventListener("DOMContentLoaded",function(c){var e=b.contentWindow.document.querySelector("webview");e.src=j.wurl+"account/upgrade-chrome/?isapp=t&_u="+a.user.id,e.addEventListener("close",function(){b.contentWindow.close()}),e.addEventListener("loadredirect",function(a){var c=a.newUrl.split("success");if(c&&c.length>1)b.contentWindow.close(),d.close();else{var c=a.newUrl.split("login");c&&c.length>1&&b.contentWindow.close()}}),b.show()})}):(b.upgradeSpinner.show=j.isChromeApp?!1:!0,f.upgradeAccount(b.upgradePrice,b.isRenew,b).then(function(){return ua.sendAppView(b.isRenew?"Renew Account Success":"Upgrade Account Success"),j.isWebApp?(b.upgradeSpinner.show=!1,void d.close()):void F.loadUser(a,a.user.id,!0).then(function(){b.upgradeSpinner.show=!1,b.$$phase||b.$apply(),j.isMacApp&&MacApp.forceSync(),nAlert({text:b.isRenew?"Account Renewed!":"Account Upgraded!",closeOnConfirm:!1},function(){j.isMacApp||a.forceSync(),nAlert.close(),d.close()})})},function(a,c){b.upgradeSpinner.show=!1,b.$apply(),"cancel"!=a&&ua.sendAppView(b.isRenew?"Renew Account Failed":"Upgrade Account Failed"),"close"==a?d.close():"purchase"==a?nAlert("An error occurred when trying to make the purchase. Please try again in a few minutes."):"validate"==a?nAlert("We couldn't validate your purchase. Please contact us with a copy of your receipt."):"message"==a?nAlert(c):"cancel"!=a&&nAlert("Something went wrong. Please try again")})))},b.switchToStandard=function(){b.isRenew&&(b.upgradeSpinner={show:!0,text:"Switching to Standard Account"},f.switchAccountToStandard().then(function(){F.loadUser(a,a.user.id,!0).then(function(){b.upgradeSpinner.show=!1,b.$$phase||b.$apply(),j.isMacApp&&MacApp.forceSync(),nAlert({text:"Your account has been switched to a standard account.",closeOnConfirm:!1},function(){j.isMacApp||a.forceSync(),nAlert.close(),d.close()})})},function(a){b.upgradeSpinner.show=!1,b.$apply(),a?nAlert(a):navigator.onLine?nAlert("We were unable to switch your account to a standard account at this time. Please try again later."):nAlert("We were unable to switch your account to a standard account at this time. Please make sure you have internet connection and try again.")}))},b.cancel=function(){d.close()}}]),ra.factory("accountAPI",["$rootScope","$http","$window","$location",function(a,b,c,d){function e(){return new Promise(function(c,d){b({method:"GET",url:j.aurl+"user-auth-info",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"}}).success(function(b,e,f,g){if(200==e){var h=angular.copy(b);if(h.sc&&h.sc.length){var i=[];E(h.sc,function(a){y.ensureSchool(a),i.push(a.s)}),h.scg=i,delete h.sc}else h.scg=null;return void w.setUserInfo(a.user.id,h).then(function(){c(h)},function(){d()})}d(b,e)}).error(function(a,b,c,e){d(a,b)})})}function f(){return new Promise(function(c,d){b({method:"GET",url:j.aurl+"guardians",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"}}).success(function(b,e,f,g){if(200==e){var h=angular.copy(b);return void w.setGuardianInfo(a.user.id,h.grds).then(function(){c(h)},function(){d()})}d(b,e)}).error(function(a,b,c,e){d(a,b)})})}function g(c){return new Promise(function(d,e){D.getLocalItem("dvid").then(function(f){var g=angular.copy(c);g.av=j.av,g.di=f,b({method:"POST",url:j.aurl+"guardians",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:g}).success(function(b,c,f,g){if(200==c){var h=angular.copy(b);return void w.setGuardianInfo(a.user.id,h.grds).then(function(){d(h)},function(){e()})}e(b,c)}).error(function(a,b,c,d){e(a,b)})})})}function h(c){return new Promise(function(d,e){D.getLocalItem("dvid").then(function(f){var g={};g.av=j.av,g.di=f,b({method:"POST",url:j.aurl+"guardians/"+c+"/remove",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:g}).success(function(b,c,f,g){if(200==c){var h=angular.copy(b);return void w.setGuardianInfo(a.user.id,h.grds).then(function(){d(h)},function(){e()})}e(b,c)}).error(function(a,b,c,d){e(a,b)})})})}function i(c){return new Promise(function(d,e){var f=angular.copy(c);f.av=j.av,b({method:"POST",url:j.aurl+"user-auth-info",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:f}).success(function(b,f,g,h){return 200==f?void w.setUserInfo(a.user.id,c).then(function(){d(b)},function(){e()}):void e(b,f)}).error(function(a,b,c,d){e(a,b)})})}function k(){return new Promise(function(a,b){var c=new Date,d="account.premium."+c.getFullYear();if(11==c.getMonth()&&(d="account.premium."+(c.getFullYear()+1)),j.isChromeApp)google.payments.inapp.getSkuDetails({parameters:{env:"prod"},success:function(c){var e=c.response.details.inAppProducts,f=null;for(var g in e)e[g].sku==d&&(f=e[g]);f?a("$"+parseInt(f.prices[0].valueMicros,10)/1e6):b()},failure:function(c){c&&c.response&&"TOKEN_MISSING_ERROR"==c.response.errorType?a("$4.99"):b()}});else if(j.isMacApp)MacApp.Store.getProducts(["account.premium"],function(c){c["account.premium"]?a(c["account.premium"]):b()},b);else if(j.isWindowsApp){var e=Windows.ApplicationModel.Store.CurrentApp;e.loadListingInformationAsync().done(function(c){var e=c.productListings.lookup(d);e?a(e.formattedPrice):b()},b)}else a("$4.99")})}function l(b){return new Promise(function(b,c){var e=new Date,f="account.premium."+e.getFullYear();
if(11==e.getMonth()&&(f="account.premium."+(e.getFullYear()+1)),j.isChromeApp||j.isWebApp)d.url("/signup/account-upgrade-on-web"),c("Visit the account page to check on your upgrade status.");else if(j.isMacApp)ua.sendEvent("accountupgrade","purchase-initiated","purchase-initiated"),MacApp.Store.buyProduct("account.premium",a.user.username,function(a){b(a)},function(a,b){c(a,b)});else if(j.isWindowsApp){ua.sendEvent("accountupgrade","purchase-initiated","purchase-initiated");var g=Windows.ApplicationModel.Store.CurrentApp;g.requestProductPurchaseAsync(f).done(function(a){return a.status==Windows.ApplicationModel.Store.ProductPurchaseStatus.succeeded||a.status==Windows.ApplicationModel.Store.ProductPurchaseStatus.alreadyPurchased?void b():a.status==Windows.ApplicationModel.Store.ProductPurchaseStatus.notPurchased?void c("cancel"):void c("purchase")},function(){c("purchase")})}})}function m(c,d,e){return new Promise(function(f,g){l(d,e).then(function(h){return j.isWebApp?void f():(j.isChromeApp&&(e.upgradeSpinner.show=!0,e.$$phase||e.$apply()),void D.getLocalItem("dvid").then(function(e){var i={av:j.av,di:e,m:c};h&&j.isMacApp&&(i.rcpt=h,j.isDebug&&(i.rcpt_t=!0)),b({method:"POST",url:j.aurl+"renewals",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:i}).success(function(b,c,e,h){return 200==c&&b.rdt?void w.setUserInfo(a.user.id,{rdt:b.rdt}).then(function(){f(b)},function(){g("message","Something went wrong. Please sign out and sign back in.")}):void g("message",d?"We were unable to renew your account at this time. Please try again later.":"We were unable to upgrade your account at this time. Please try again later.")}).error(function(a,b,c,e){500==b?g("message",d?"Oops! An error occurred when trying to renew your account. Please try again later.":"Oops! An error occurred when trying to upgrade your account. Please try again later."):503==b?g("message","Oops! Our server is unavailable right now. Please try again later."):403==b?g("message","Something went wrong. Please sign out and sign back in."):400==b&&a.error_description?g("message",a.error_description):g("message",d?"We were unable to renew your account at this time. Please try again later.":"We were unable to upgrade your account at this time. Please try again later.")})},g))},g)})}function n(){return new Promise(function(c,d){D.getLocalItem("dvid").then(function(e){var f={av:j.av,di:e,rwa:!0};b({method:"POST",url:j.aurl+"renewals",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:f}).success(function(b,e,f,g){return 200==e?void w.setUserInfo(a.user.id,{rdt:null}).then(function(){c(b)},function(){d("Something went wrong. Please sign out and sign back in.")}):void d("We were unable to switch your account to a standard account at this time. Please try again later.")}).error(function(a,b,c,e){d(500==b?"Oops! An error occurred when trying to switch your account to standard. Please try again later.":503==b?"Oops! Our server is unavailable right now. Please try again later.":403==b?"Something went wrong. Please sign out and sign back in.":400==b&&a.error_description?a.error_description:"We were unable to switch your account to a standard account at this time. Please try again later.")})},d)})}return{getUserInfo:function(){return e()},getGuardiansInfo:function(){return f()},addGuardian:function(a){return g(a)},removeGuardian:function(a){return h(a)},editUserInfo:function(a){return i(a)},fetchUpgradePrice:function(){return k()},upgradeAccount:function(a,b,c){return m(a,b,c)},switchAccountToStandard:function(){return n()}}}]),ra.controller("TeachersCtrl",["$rootScope","$scope","$routeParams","$modal","$filter","$location","$window","teachersAPI","dateFilter",function(a,b,c,d,e,f,g,h,i){function k(){b.activeTeacher&&!b.teacherTerms&&(b.fetchSpinner.show||(b.fetchSpinner={show:!0,text:"Loading Classes"}),ua.sendEvent("Fetch","Teacher Classes","Start"),h.fetchTeacherClasses(b.activeTeacher.id).then(function(a){ua.sendEvent("Fetch","Teacher Classes","Success"),b.fetchSpinner.show=!1,b.teacherTerms=a,b.$$phase||b.$apply()},function(d){ua.sendEvent("Fetch","Teacher Classes","Failed");var e=!0;if(a.userClasses&&a.userClasses.length>0){var f={};E(a.userClasses,function(a){if(a.teacherId&&a.isTeachersIOClass&&a.teacherId==b.activeTeacher.id&&a.termId){if(a.starts&&a.ends){var c=new Date;a.ends<c?a.dates="Ended "+i(a.ends,"longDate"):a.dates=i(a.starts,"longDate")+" - "+i(a.ends,"longDate")}if(a.hideJoinOption=!0,f[a.termId]){var d=f[a.termId];d.classes.push(a),f[a.termId]=d}else f[a.termId]={id:a.termId,title:a.termDisplay?a.termDisplay:"",termSlug:a.termSlug,classes:[a],starts:a.starts?a.starts:null,ends:a.ends?a.ends:null}}});var g=[];E(f,function(a,b){g.push(a)}),g.length>0&&(b.teacherTerms=g,e=!1)}if(b.fetchSpinner.show=!1,b.$$phase||b.$apply(),e){var h=c.teacherId?"/teachers/id/"+b.activeTeacher.id:"/teachers/"+b.activeTeacher.username;404==d?l("Teacher not found.","/"):500==d?l("Oops! An error occurred when trying to get this teacher's classes. Please try again later.",h):503==d?l("Oops! Our server is unavailable right now. Please try again later.",h):403==d?l("Something went wrong. Please sign out and sign back in.","/"):navigator.onLine?l("We were unable to get this teacher's classes at this time.<br>Please try again later.",h):l("We were unable to get this teacher's classes at this time.<br>Please make sure you have internet connection and try again.",h)}}))}function l(a,c){nAlert({title:a.length<25?a:null,html:a.length>=25?a:null,closeOnConfirm:!1},function(){nAlert.close(),c==f.path()?b.activeTab="contact":f.url(c),b.$apply()})}a.bodyClass=null,a.nav="teachers",b.activeTab=c.tab||"contact",b.macAlwaysRight=!0;var m="classes"==b.activeTab?!0:!1;b.isUserTeacher=!1,b.teacherTerms=null,b.fetchSpinner={show:!1,text:m?"Loading Classes":"Loading Teacher"};var n=!1,o=a.$watch("userClasses",function(d){if("undefined"!=typeof d){var f=[];d&&E(d,function(a){a.teacherId&&a.isTeachersIOClass&&f.indexOf(a.teacherId)<0&&f.push(a.teacherId)});var i=angular.element(g),o=null,p=0,q=e("filter")(a.teachers,function(a){return(c.username&&c.username==a.username||c.teacherId&&c.teacherId==a.id)&&(o=a),f.length&&f.indexOf(a.id)>=0?(c.username||c.teacherId||0!=p||o?c.username==a.username&&(b.isUserTeacher=!0):(i.width()<=685&&!j.isMacApp?b.isSmallSize=!0:o=a,b.isUserTeacher=!0,b.macAlwaysRight=!1),p++,!0):!1});b.userTeachers=q&&q.length>0?q:new Array,b.activeTeacher=o||null;var r=o?o.id:c.teacherId;a.user&&r&&!n&&(n=!0,!o&&c.teacherId&&(b.fetchSpinner.show=!0,b.$$phase||b.$apply()),ua.sendEvent("Fetch","Teacher Details","Start"),h.fetchTeacherDetails(r).then(function(a){if(m||(b.fetchSpinner.show=!1),ua.sendEvent("Fetch","Teacher Details","Success"),b.activeTeacher=a,b.userTeachers&&b.userTeachers.length){var c=new Array;E(b.userTeachers,function(b){b.id==a.id?c.push(a):c.push(b)}),b.userTeachers=c}m&&k(),b.$$phase||b.$apply()},function(a){ua.sendEvent("Fetch","Teacher Details","Failed"),b.fetchSpinner.show&&(404==a?l("Teacher not found.","/teachers"):500==a?l("Oops! An error occurred when trying to get this teacher's information. Please try again later.","/teachers"):503==a?l("Oops! Our server is unavailable right now. Please try again later.","/teachers"):403==a?l("Something went wrong. Please sign out and sign back in.","/"):navigator.onLine?l("We were unable to get this teacher's information at this time.<br>Please try again later.","/teachers"):l("We were unable to get this teacher's information at this time.<br>Please make sure you have internet connection and try again.","/teachers"))}))}});b.addTeacher=function(){d.open({templateUrl:"templates/classes/add-or-join.html",controller:"AddOrJoinClassCtrl",title:"Add or Join Class",size:a.userSchools?"medium":"medium-large"})},b.openTeacher=function(a){f.url("/teachers/"+a.username)},b.changeTab=function(a){b.activeTab=a,"classes"==a&&k()},b.$on("$destroy",function(){o(),U.setMenuItemState("View","Teachers","off")}),U.setMenuItemState("View","Teachers","on")}]),ra.factory("teachersAPI",["$rootScope","$http",function(a,b){function c(c){return new Promise(function(d,e){b({method:"GET",url:j.aurl+"teachers/"+c,headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"}}).success(function(a,b,c,f){return 200==b&&a.i?void A.ensureTeacher(a).then(function(){I.loadTeacher(a).then(function(a){d(a)},e)},e):void e(b)}).error(function(a,b,c,d){e(b)})})}function d(c){return new Promise(function(d,e){b({method:"GET",url:j.aurl+"teachers/"+c+"/classes",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"}}).success(function(a,b,c,f){if(200==b){if(a.at){var g=Q.toUITermClasses(a.at);if(g.length)return void d(g)}return void d(null)}e(b)}).error(function(a,b,c,d){e(b)})})}function e(c,d){return new Promise(function(e,f){b({method:"GET",url:j.aurl+"teachers/"+c+"/classes/"+d,headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"}}).success(function(b,c,d,g){return 200==c&&b.i?void Q.loadClass(a,b).then(function(a){e(a)}):void f(c)}).error(function(a,b,c,d){f(b)})})}function f(c,d){return new Promise(function(e,f){b({method:"POST",url:j.aurl+"teachers/"+c+"/classes/"+d.id+"/join",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:{av:j.av}}).success(function(a,b,c,g){if(200==b){var h=new Array,i=F.getUserID(),j=Q.toDBClass(d);return h.push(function(){return q.ensureClass(j,i)}),a.hw&&E(a.hw,function(a){h.push(function(){return o.ensureHw(a,i)})}),a.an&&E(a.an,function(a){h.push(function(){return u.ensureAnnouncement(a,i)})}),void Promise.loop(h).then(function(){e()},function(a){J.logError(a),f(b)})}f(b)}).error(function(a,b,c,d){f(b)})})}return{fetchTeacherDetails:function(a){return c(a)},fetchTeacherClasses:function(a){return d(a)},fetchTeacherClass:function(a,b){return e(a,b)},joinTeacherClass:function(a,b){return f(a,b)}}}]),ra.directive("teacherInfo",function(){return{restrict:"E",replace:!0,templateUrl:"templates/teachers/teacher-info.html"}}),ra.directive("teacherContact",function(){return{restrict:"E",replace:!0,templateUrl:"templates/teachers/view-contact.html",link:function(a,b,c){ua.sendAppView("Teacher Contact")}}}),ra.directive("teacherAbout",function(){return{restrict:"E",replace:!0,templateUrl:"templates/teachers/view-about.html",link:function(a,b,c){ua.sendAppView("Teacher About")}}}),ra.directive("teacherClasses",["$rootScope","$location","teachersAPI","schoolsAPI",function(a,b,c,d){return{restrict:"E",replace:!0,templateUrl:"templates/teachers/view-classes.html",link:function(e,f,g){function h(b,c){D.reloadStorage(a,!1).then(function(){a.mainSpinner.show=!1,a.$$phase||a.$apply(),c&&a.manualSync(),j("Class Joined Successfully!","/classes/"+b)})}function i(b){a.mainSpinner.show=!1,j(404==b?"Class not found.":500==b?"Oops! An error occurred when trying to join this class. Please try again later.":503==b?"Oops! Our server is unavailable right now. Please try again later.":403==b?"Something went wrong. Please sign out and sign back in.":navigator.onLine?"We were unable to join this class at this time.<br>Please try again later.":"We were unable to join this class at this time.<br>Please make sure you have internet connection and try again.")}function j(c,d){nAlert({title:c.length<25?c:null,html:c.length>=25?c:null,closeOnConfirm:!1},function(){nAlert.close(),b.url(d?d:"/"),a.$apply()})}ua.sendAppView("Teacher Classes"),e.toggleGroup=function(a){var b=angular.element(".group-row.group-"+a.id);b.toggleClass("closed");var c=angular.element(".class-row.group-"+a.id);E(c,function(a){var b=angular.element(a);b.hasClass("closed")?b.removeClass("closed").addClass("opened"):b.removeClass("opened").addClass("closed")})},e.joinClass=function(b){a.mainSpinner={type:"classes",text:"Joining Class",show:!0},ua.sendEvent("Classes","Join","Start"),ua.sendEvent("Fetch","Teacher Class","Start");var f=e.$parent.activeTeacher.id;c.fetchTeacherClass(f,b.id).then(function(e){ua.sendEvent("Fetch","Teacher Class","Success"),c.joinTeacherClass(f,e).then(function(){if(ua.sendEvent("Classes","Join","Success"),b.schoolSlug&&(!a.user.schoolSlugs||a.user.schoolSlugs.indexOf(b.schoolSlug)<0)){var c=a.user.schoolSlugs?a.user.schoolSlugs:[];c.push(b.schoolSlug),d.fetchSchoolDetails(b.schoolSlug).then(function(b){w.setUserSchools(a.user.id,c).then(function(){h(e.id,!0)})},function(){h(e.id,!1)})}else h(e.id,!1)},function(a){ua.sendEvent("Classes","Join","Failed"),i(a)})},function(a){ua.sendEvent("Fetch","Teacher Class","Failed"),i(a)})},e.leaveClass=function(c){ua.sendAppView("Leave Class"),nAlert({title:"Leave Class",html:"<p>Do you really want to leave <strong>"+c.name+"</strong>?</p>",confirmButtonText:"Leave Class",closeOnConfirm:!1,showCancelButton:!0},function(d){var e=F.getUserID(a);d&&u.deleteClassAnnouncements(c.id,e).then(function(){o.deleteClassHws(c.id,e,!1).then(function(){q.deleteClass(c.id,e,!0,!1).then(function(){ua.sendAppView("Leave Class Success"),nAlert.close(),D.loadStorageForUser(a,e,!1).then(function(){b.url("/"),a.$apply()})})})})})}}}}]),ra.directive("teacherAnnouncements",["$rootScope","$filter",function(a,b){return{restrict:"E",replace:!0,templateUrl:"templates/teachers/view-announcements.html",link:function(c,d,e){ua.sendAppView("Teacher Announcements");var f=c.$parent.activeTeacher;if(a.userAnnouncements&&f){var g=b("filter")(a.userAnnouncements,{teacherId:f.id},!0);c.announcements=g.length?g:null;var h=b("filter")(g,{isRead:!1},!0);if(h.length){var i=a.unreadAnnouncements||0;i>0&&(i-=h.length,a.unreadAnnouncements=i,a.$$phase||a.$apply());var j=[];E(h,function(a){j.push(a.id)});var k=F.getUserID(a);u.markAnnouncementsAsRead(j,k)}c.$on("$destroy",function(){T.loadAnnouncements(a,!0)})}}}}]),ra.directive("teachersList",function(){return{restrict:"E",replace:!0,templateUrl:"templates/teachers/teachers-list.html",scope:{teachers:"=teachers",findButtonDisabled:"=?findButtonDisabled"},link:function(a,b,c){a.openTeacher=function(b){a.$parent&&"function"==typeof a.$parent.openTeacher&&a.$parent.openTeacher(b)}}}}),ra.controller("AnnouncementsCtrl",["$rootScope","$scope","$location","$filter",function(a,b,c,d){if(a.bodyClass=null,a.nav="announcements",a.unreadAnnouncements>=0&&(a.unreadAnnouncements=0,a.$$phase||a.$apply()),a.userAnnouncements){var e=d("filter")(a.userAnnouncements,{isRead:!1},!0);if(e.length){var f=[];E(e,function(a){f.push(a.id)});var g=F.getUserID(a);u.markAnnouncementsAsRead(f,g)}}b.openSender=function(a){1==a.fromType&&a.teacher&&a.teacher.id?(ua.sendAppView("Open Teacher from Announcement"),c.url("/teachers/id/"+a.teacher.id)):2==a.fromType&&a.schoolSlug&&(ua.sendAppView("Open School from Announcement"),c.url("/schools/"+a.schoolSlug))},b.$on("$destroy",function(){T.loadAnnouncements(a,!0),U.setMenuItemState("View","Announcements","off")}),U.setMenuItemState("View","Announcements","on")}]),ra.controller("SchoolCtrl",["$rootScope","$scope","$routeParams","$location","$interval","$modal","$filter","$document","schoolsAPI",function(a,b,c,d,e,f,g,h,i){function j(){var c=L.filterHomeworksBy(a.userHomeworks,"late",!0,1e4);c&&c.groups&&c.groups.length>0&&c.groups[0].items&&(b.lateHomeworkCount=c.groups[0].items.length);var d=L.filterHomeworksBy(a.userHomeworks,"upcoming",!0,1e4);if(d&&d.groups&&d.groups.length>0&&d.groups[0].items){for(var e=[],f=[],g=0;g<d.groups[0].items.length;g++){var h=d.groups[0].items[g];h.isUpcoming?e.push(h):h.isImportant&&h.isDueWithinAWeek&&f.push(h)}if(e&&e.length>0){var i={title:"Upcoming",id:"z-upcoming",items:e};b.upcomingHomework={groups:[i]}}if(f&&f.length>0){var i={title:"Important",id:"z-important",items:f};b.importantHomework={groups:[i]}}}}function k(){var c=angular.f("filter"),d=[],e=c(a.userRegularEvents,{showOnSchoolPage:!0},!0);if(e&&e.length){b.upcomingHallPasses=e;for(var f=0;f<e.length;f++)d.push(e[f].i)}var g=c(a.userRegularEvents,{startsInNext4days:!0},!0);if(g&&g.length){for(var h=[],f=0;f<g.length;f++){for(var i=!1,j=0;j<d.length;j++)i||g[f].id==d[j]&&(i=!0);i||h.push(g[f])}h.length>0&&(b.upcomingEvents={groups:[{title:"Events",id:"upcoming-events",items:h}]})}}function l(){var c=new Array;a.userClassOptions&&(E(a.userClassOptions,function(a){(a.isCurrent||a.isFuture)&&c.push(angular.copy(a))}),b.classOptions=c)}function m(){ua.sendEvent("Fetch","School Details","Start"),i.fetchSchoolDetails(c.slug).then(function(c){ua.sendEvent("Fetch","School Details","Success"),b.fetchSpinner.show=!1,c.attending=a.user.schoolSlugs&&a.user.schoolSlugs.indexOf(c.slug)>=0?!0:!1,b.school=c,b.$$phase||b.$apply()},function(a){ua.sendEvent("Fetch","School Details","Failed"),b.fetchSpinner.show&&(b.fetchSpinner.show=!1,b.$$phase||b.$apply(),n(404==a?"School not found.":500==a?"Oops! An error occurred when trying to get this school's information. Please try again later.":503==a?"Oops! Our server is unavailable right now. Please try again later.":403==a?"Something went wrong. Please sign out and sign back in.":navigator.onLine?"We were unable to get this school's information at this time.<br>Please try again later.":"We were unable to get this school's information at this time.<br>Please make sure you have internet connection and try again."))})}function n(a){return b.school?(b.fetchFailed=!0,b.$$phase||b.$apply(),void nAlert({title:a.length<25?a:null,html:a.length>=25?a:null})):void nAlert({title:a.length<25?a:null,html:a.length>=25?a:null,closeOnConfirm:!1},function(){nAlert.close(),d.url("/"),b.$apply()})}a.bodyClass=null,a.nav=null,b.hwFiltersEnabled=!0,b.hwFilters={active:null},b.boxAlreadyScrolls=!0,b.fetchSpinner={show:!1,text:"Loading School",type:"school"},a.schools&&E(a.schools,function(d){d.slug==c.slug&&(d.attending=a.user.schoolSlugs&&a.user.schoolSlugs.indexOf(d.slug)>=0?!0:!1,b.school=d,b.premiumSchool=a.premiumSchool)});var o=e(a.silentSync(),3e4);j(),k(),l(),a.syncIfTooLong();var p=(a.$watch("lastSyncDate",function(c){if(b.lastSyncDate=a.lastSyncDate,b.lastSyncDate){var d=K.minutesInBetween(new Date,b.lastSyncDate);d>=3?b.tooLongSinceSync=!0:b.tooLongSinceSync=!1}}),a.$watch("userClassOptions",function(a){l()})),q=a.$watch("userHomeworks",function(a){j()}),r=a.$watch("userRegularEvents",function(a){k()}),s=a.$watch("userSchools",function(a){if(a&&b.school){var c=!1;E(a,function(a){a.slug==b.school.slug&&(c=!0)}),b.school.attending!=c&&(b.school.attending=c)}}),t="details";if(b.school&&b.school.files&&(E(b.school.files,function(a){-1!=a.displayText.toLowerCase().indexOf("handbook")&&(t="files")}),"details"==t&&E(b.school.links,function(a){-1!=a.displayText.toLowerCase().indexOf("handbook")&&(t="links")})),b.activeTab=c.tab||t,!b.school||"details"!=b.activeTab&&"teachers"!=b.activeTab)if("info"==b.activeTab&&b.school)m();else{b.fetchSpinner.show=!0,b.$$phase||b.$apply();var v=a.$watch("user",function(a){a&&(m(),v())});b.$on("$destroy",function(){v(),q(),p(),r(),s(),angular.isDefined(o)&&(e.cancel(o),o=void 0)})}else b.fetchSpinner={show:!0,text:"Loading Teachers",type:"teachers"},b.$$phase||b.$apply(),m();b.addHomework=function(){f.open({templateUrl:"templates/homework/add-edit.html",controller:"AddHomeworkCtrl",title:"Add Homework",size:"medium"})},b.addEvent=function(){f.open({templateUrl:"templates/events/add-edit.html",controller:"AddEventCtrl",title:"Add Event",size:"medium"})};var x=function(c){c&&(c.preventDefault(),c.stopPropagation()),b.showHomemeworkAddOptions=!1,h.unbind("click",x),b.$$phase||a.$$phase||b.$apply()};b.showHomemeworkAddOptions=!1,b.toggleHomeworkAddOptions=function(c){c&&(c.preventDefault(),c.stopPropagation()),b.showHomemeworkAddOptions?(b.showHomemeworkAddOptions=!1,h.unbind("click",x)):(b.showHomemeworkAddOptions=!0,h.bind("click",x)),b.$$phase||a.$$phase||b.$apply()},b.openTeacher=function(a){ua.sendAppView("Open Teacher from School"),d.url("/teachers/id/"+a.id)},b.changeTab=function(a){b.activeTab=a},b.changeAttendSchool=function(c){var d=[];a.user.schoolSlugs&&E(a.user.schoolSlugs,function(a){a!=c.slug&&d.push(a)}),b.fetchSpinner={show:!0,text:"Updating User Schools",type:"school"},c.attending&&d.push(c.slug),ua.sendEvent("School","Attend",c.attending?"True":"False"),ua.sendEvent("School","Save Attend","Start");var e=a.user.id;i.postCurrentSchools(d).then(function(f){ua.sendEvent("School","Save Attend","Success");var h=new Array;if(h.push(function(){return w.setUserSchools(e,d)}),!c.attending){var i=g("filter")(a.userAnnouncements,{schoolSlug:c.slug},!0);if(i&&i.length){var j=[];E(i,function(a){j.push(a.id)}),h.push(function(){return u.deleteAnnouncements(j,e)})}}f.length&&E(f,function(a){h.push(function(){return u.ensureAnnouncement(a,e)})}),h.push(function(){return F.loadUser(a,e,!1)}),h.push(function(){return G.loadSchools(a,!1)}),h.push(function(){return T.loadAnnouncements(a,!1)}),Promise.loop(h).then(function(){"info"!=b.activeTab&&(b.activeTab="info"),b.fetchSpinner.show=!1,a.$$phase||a.$apply(),b.$$phase||b.$apply()},function(a){ua.sendEvent("School","Save Attend","Failed"),J.logError(a),b.school.attending=c.attending?!1:!0,b.fetchSpinner.show=!1,b.$$phase||b.$apply(),nAlert({html:"Oops! An error occurred when trying to update your schools. Please try again later."})})},function(){ua.sendEvent("School","Save Attend","Failed"),b.school.attending=c.attending?!1:!0,b.fetchSpinner.show=!1,b.$$phase||b.$apply(),500==status?nAlert({html:"Oops! An error occurred when trying to update your schools. Please try again later."}):503==status?nAlert({html:"Oops! Our server is unavailable right now. Please try again later."}):403==status?n("Something went wrong. Please sign out and sign back in."):navigator.onLine?nAlert({html:"We were unable to update your schools.<br>Please try again later."}):nAlert({html:"We were unable to update your schools.<br>Please make sure you have internet connection and try again."})})}}]),ra.factory("schoolsAPI",["$rootScope","$http",function(a,b){function c(c){return new Promise(function(d,e){b({method:"GET",url:j.aurl+"schools/"+c+"?lnk=t&fls=t&tchr=t&an=t",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"}}).success(function(a,b,c,f){return 200==b&&a.s?void y.ensureSchool(a).then(function(){G.loadSchool(a).then(function(a){d(a)},e)},e):void e(b)}).error(function(a,b,c,d){e(b)})})}function d(c){return new Promise(function(d,e){b({method:"POST",url:j.aurl+"current-schools",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"},data:{av:j.av,k:c}}).success(function(a,b,c,f){if(200==b){var g=a.an||[];return void d(g)}e(b)}).error(function(a,b,c,d){e(b)})})}function e(){return new Promise(function(c,d){D.getLocalItem("usrgeo").then(function(e){b({method:"GET",url:j.aurl+"schools/nearby?l="+e+"&fb=t&ps=t",headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"}}).success(function(a,b,e,f){if(200==b){var g=[],h=[],i=[];return a.fb&&E(a.fb,function(a){var b=G.toUISchool(a);b&&g.push(b)}),a.ps&&E(a.ps,function(a){var b=G.toUISchool(a);b&&h.push(b)}),a.nb&&E(a.nb,function(a){var b=G.toUISchool(a);b&&i.push(b)}),void c({facebookSchools:g,possibleSchools:h,nearbySchools:i})}d(b)}).error(function(a,b,c,e){d(b)})})})}function f(c){return new Promise(function(d,e){D.getLocalItem("usrgeo").then(function(f){var g="?q="+c;f&&(g+="&l="+f),b({method:"GET",url:j.aurl+"schools-and-teachers/search"+g,headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"}}).success(function(a,b,c,f){if(200==b){var g=[],h=[];return a.sc&&E(a.sc,function(a){var b=G.toUISchool(a);b&&g.push(b)}),a.tc&&E(a.tc,function(a){var b=I.toUITeacher(a);b&&h.push(b)}),void d({schools:g,teachers:h,"default":a.dflt&&"sc"==a.dflt?"schools":"teachers",hasMoreSchools:a.scm||!1,hasMoreTeachers:a.tcm||!1})}e(b)}).error(function(a,b,c,d){e(b)})})})}function g(c){return new Promise(function(d,e){D.getLocalItem("usrgeo").then(function(f){var g="?q="+c;f&&(g+="&l="+f),b({method:"GET",url:j.aurl+"schools/search"+g,headers:{Authorization:"OAuth "+a.user.accessToken,"Content-Type":"application/json; charset=utf-8"}}).success(function(a,b,c,f){if(200==b){var g=[];return a.sc&&E(a.sc,function(a){var b=G.toUISchool(a);b&&g.push(b)}),void d(g)}e(b)}).error(function(a,b,c,d){e(b)})})})}return{fetchSchoolDetails:function(a){return c(a)},postCurrentSchools:function(a){return d(a)},fetchNearbySchools:function(){return e()},searchSchoolsAndTeachers:function(a){return f(a)},searchSchools:function(a){return g(a)}}}]),ra.directive("schoolDetails",function(){return{restrict:"E",replace:!0,templateUrl:"templates/schools/view-details.html",link:function(a,b,c){var d,e=a.$watch("school",function(c){var e=angular.rootScope();if(e.premiumSchool&&e.premiumSchool.slug==c.slug);else if(c&&c.geo){if(d&&d==c.latitude)return;if(d=c.latitude,ua.sendAppView("Schools - "+c.name),j.isChromeApp)a.mapSandbox="templates/schools/map-sandbox.html?lat="+c.latitude+"&lon="+c.longitude;else if(j.isWindowsApp)Microsoft.Maps.loadModule("Microsoft.Maps.Map",{callback:function(){var a={credentials:"AkwzPj1-cHhLa82j0Qp8mu8crasB5RsLjq3rKm0PQc46VW8cXeclfdKVqLS-gfme",mapTypeId:Microsoft.Maps.MapTypeId.birdseye,zoom:16,width:320,height:300,showDashboard:!1,showMapTypeSelector:!1,showScalebar:!1,showBreadcrumb:!1,showNavigationBar:!1},d=new Microsoft.Maps.Map(b[0].querySelector(".map"),a),e=c.latitude,f=Microsoft.Maps.Location.normalizeLongitude(c.longitude),g=new Microsoft.Maps.Location(e,f);d.setView({center:g});var h=new Microsoft.Maps.EntityCollection;d.entities.push(h),h.push(new Microsoft.Maps.Pushpin(g))},culture:"en - us",homeRegion:"US"});else{var f=new google.maps.LatLng(c.latitude,c.longitude),g=new google.maps.Map(b[0].querySelector(".map"),{zoom:16,center:f,mapTypeId:google.maps.MapTypeId.SATELLITE,disableDefaultUI:!0});new google.maps.Marker({position:f,map:g})}}});a.$on("$destroy",function(){e()})}}}),ra.directive("schoolTeachers",function(){return{restrict:"E",replace:!0,templateUrl:"templates/schools/view-teachers.html",link:function(a,b,c){ua.sendAppView("School Teachers")}}}),ra.directive("schoolLinks",function(){return{restrict:"E",replace:!0,templateUrl:"templates/schools/view-links.html",link:function(a,b,c){ua.sendAppView("School Links")}}}),ra.directive("schoolFiles",function(){return{restrict:"E",replace:!0,templateUrl:"templates/schools/view-files.html",link:function(a,b,c){ua.sendAppView("School Files")}}}),ra.directive("schoolAnnouncements",["$rootScope","$filter",function(a,b){return{restrict:"E",replace:!0,templateUrl:"templates/schools/view-announcements.html",link:function(c,d,e){ua.sendAppView("School Announcements");var f=c.$parent.school;if(f&&f.announcements&&f.attending){var g=b("filter")(a.userAnnouncements,{schoolSlug:f.slug},!0);g&&g.length&&E(g,function(a){E(f.announcements,function(b){a.id==b.id&&a.isRead&&!b.isRead&&(b.isRead=!0)})});var h=b("filter")(f.announcements,{isRead:!1},!0);if(h&&h.length){var i=a.unreadAnnouncements||0;i>0&&(i-=h.length,a.unreadAnnouncements=i,a.$$phase||a.$apply());var j=[];E(h,function(a){j.push(a.id)});var k=F.getUserID(a);u.markAnnouncementsAsRead(j,k),c.$on("$destroy",function(){T.loadAnnouncements(a,!0)})}}}}}]),ra.directive("schoolsList",function(){return{restrict:"E",replace:!0,templateUrl:"templates/schools/schools-list.html",scope:{schools:"=schools",findButtonDisabled:"=?findButtonDisabled",addButtonEnabled:"=?addButtonEnabled"},link:function(a,b,c){a.openSchool=function(b){a.$parent&&"function"==typeof a.$parent.openSchool&&a.$parent.openSchool(b)},a.addSchool=function(b,c){a.$parent&&"function"==typeof a.$parent.addSchool&&(b.preventDefault(),b.stopPropagation(),a.$parent.addSchool(c))}}}}),ra.controller("FindSchoolCtrl",["$rootScope","$scope","$modal","$timeout","$location","schoolsAPI",function(a,b,c,d,e,f){function g(){J.getGeolocation().then(function(a){b.fetchSpinner.show=!1,b.$$phase||b.$apply(),a&&h()})}function h(){b.fetchSpinner={show:!0,text:"Fetching Nearby Schools"},b.$$phase||b.$apply(),ua.sendEvent("Fetch","Neaby Schools","Start"),f.fetchNearbySchools().then(function(a){ua.sendEvent("Fetch","Neaby Schools","Success"),b.geoSchools=a,b.fetchSpinner.show=!1,b.$$phase||b.$apply(),U.adjustModalHeight()},function(a){ua.sendEvent("Fetch","Neaby Schools","Failed"),b.fetchSpinner.show=!1,b.$$phase||b.$apply(),500==a?i("Oops! An error occurred when trying to get nearby schools. Please try again later."):503==a?i("Oops! Our server is unavailable right now. Please try again later."):403==a?i("Something went wrong. Please sign out and sign back in."):k("We were unable to get nearby schools.<br>Please try searching.")})}function i(a){nAlert({html:a,closeOnConfirm:!1},function(){nAlert.close(),c.close()})}function k(a){nAlert({html:a,closeOnConfirm:!1},function(){nAlert.close()})}ua.sendAppView("School Prompt - Find School"),b.searchQuery=null,b.fetchSpinner={show:!0,text:"Determining Location"},d(g,100),b.searchSchools=function(a){a.$valid&&(b.fetchSpinner={show:!0,text:"Searching Schools"},b.$$phase||b.$apply(),ua.sendEvent("Search","Schools","Start"),f.searchSchoolsAndTeachers(b.searchQuery).then(function(a){ua.sendEvent("Search","Schools","Success"),b.geoSchools=null,b.searchResult=a,b.fetchSpinner.show=!1,b.$$phase||b.$apply(),U.adjustModalHeight()},function(a){ua.sendEvent("Search","Schools","Failed"),b.fetchSpinner.show=!1,b.$$phase||b.$apply(),i(500==a?"Oops! An error occurred when trying find schools. Please try again later.":503==a?"Oops! Our server is unavailable right now. Please try again later.":403==a?"Something went wrong. Please sign out and sign back in.":navigator.onLine?"We were unable to find schools.<br>Please try again later.":"We were unable to find schools.<br>Please make sure you have internet connection and try again.")}))},b.openSchool=function(a){ua.sendAppView("Open School from Find School"),J.openAppURL(e,"/schools/"+a.slug),c.close()},b.addSchool=function(e){var g=[];a.user.schoolSlugs&&E(a.user.schoolSlugs,function(a){a!=e.slug&&g.push(a)}),b.fetchSpinner={show:!0,text:"Updating User Schools"},b.$$phase||b.$apply(),g.push(e.slug),ua.sendEvent("School","Attend","True"),ua.sendEvent("School","Save Attend","Start");var h=a.user.id;f.postCurrentSchools(g).then(function(f){ua.sendEvent("School","Save Attend","Success");var i=new Array;e.dbschl&&i.push(function(){return y.ensureSchool(e.dbschl)}),i.push(function(){return w.setUserSchools(h,g)}),f.length&&E(f,function(a){i.push(function(){return u.ensureAnnouncement(a,h)})}),i.push(function(){return F.loadUser(a,h,!1)}),i.push(function(){return G.loadSchools(a,!1)}),i.push(function(){return T.loadAnnouncements(a,!1)}),Promise.loop(i).then(function(){d(function(){b.fetchSpinner.show=!1,a.$$phase||a.$apply(),b.$$phase||b.$apply(),nAlert({text:"School Added Successfully.",closeOnConfirm:!1},function(){j.isMacApp?MacApp.sync():a.manualSync(),nAlert.close(),c.close()})},1e3)},function(a){ua.sendEvent("School","Save Attend","Failed"),J.logError(a),b.fetchSpinner.show=!1,b.$$phase||b.$apply(),nAlert({html:"Oops! An error occurred when trying to update your schools. Please try again later."})})},function(){ua.sendEvent("School","Save Attend","Failed"),b.fetchSpinner.show=!1,b.$$phase||b.$apply(),500==status?nAlert({html:"Oops! An error occurred when trying to update your schools. Please try again later."}):503==status?nAlert({html:"Oops! Our server is unavailable right now. Please try again later."}):403==status?_alertAndRedirect("Something went wrong. Please sign out and sign back in."):navigator.onLine?nAlert({html:"We were unable to update your schools.<br>Please try again later."}):nAlert({html:"We were unable to update your schools.<br>Please make sure you have internet connection and try again."})})},b.cancel=function(){c.close()}}]),ra.controller("UserSettingsCtrl",["$rootScope","$scope","$modal",function(a,b,c){
b.activeTab="homework",b.saveSpinner={show:!1},b.changeTab=function(a){b.activeTab=a},b.cancel=function(){c.close()}}]),ra.directive("homeworkSettings",["$rootScope","$filter",function(a,b){return{restrict:"E",replace:!0,templateUrl:"templates/settings/homework-settings.html",link:function(c,d,e){ua.sendAppView("Homework Settings");var f=a.user?a.user.id:null;if(c.settings=angular.copy(a.userSettings),c.hasCompletedHomework=!1,U.adjustModalHeight(),a.userHomeworks){var g=b("filter")(a.userHomeworks,{isManual:!0,isComplete:!0},!0);g&&g.length&&(c.hasCompletedHomework=!0)}c.saveChange=function(b){f&&(a.user.settings=c.settings),a.userSettings=c.settings;var d=F.toDBSettings(c.settings);w.setUserSettings(f,d,!0),j.isMacApp?MacApp.reloadStorage():D.reloadStorage(a,!0)},c.removeAll=function(){ua.sendAppView("Remove All Assignments"),nAlert({title:"Remove all assignments",text:"Are you sure you want to remove all assignments?",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,showCancelButton:!0},function(c){if(c){ua.sendAppView("Remove All Assignments Success");var d=b("filter")(a.userHomeworks,{isManual:!0},!0),e=[],g=!1;d.length&&(E(d,function(a){e.push(a.id)}),g=d.length==a.userHomeworks.length?!1:!0),e.length?o.deleteHws(e,f,!0).then(function(){L.loadHomeworks(a,!0),g?nAlert("Only assignments you've entered will be deleted. Assignments your teachers entered will stay until you leave their class."):nAlert("All assignments have been removed!")},function(){nAlert.close()}):nAlert.close()}})},c.removeCompleted=function(){ua.sendAppView("Remove All Completed"),nAlert({title:"Remove completed assignments",text:"Are you sure you want to remove all completed assignments?",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,showCancelButton:!0},function(c){if(c){ua.sendAppView("Remove All Completed Success");var d=b("filter")(a.userHomeworks,{isComplete:!0},!0),e=[],g=!1;d.length&&E(d,function(a){a.isManual?e.push(a.id):g=!0}),e.length?o.deleteHws(e,f,!0).then(function(){L.loadHomeworks(a,!0),g?nAlert("Only the completed assignments you've entered will be deleted. Assignments your teachers entered will stay until you leave their class."):nAlert("All completed assignments have been removed!")},function(){nAlert.close()}):nAlert.close()}})}}}}]),BLOCK_OPTIONS=[{id:"1",label:"Day A",placeholder:"e.g. Day A or Purple Day",day:1},{id:"2",label:"Day B",placeholder:"e.g. Day B or Black Day",day:2},{id:"3",label:"Day C",placeholder:"e.g. Day C or Red Day",day:3},{id:"4",label:"Day D",placeholder:"e.g. Day D or Blue Day",day:4},{id:"5",label:"Day E",placeholder:"e.g. Day E or Green Day",day:5},{id:"6",label:"Day F",placeholder:"e.g. Day F or Yellow Day",day:6},{id:"7",label:"Day G",placeholder:"e.g. Day G or White Day",day:7},{id:"8",label:"Day H",placeholder:"e.g. Day H or Gray Day",day:8},{id:"9",label:"Day I",placeholder:"e.g. Day I or Gold Day",day:9},{id:"10",label:"Day J",placeholder:"e.g. Day J or Pink Day",day:10},{id:"11",label:"Day K",placeholder:"e.g. Day K or Orange Day",day:11},{id:"12",label:"Day L",placeholder:"e.g. Day L or Brown Day",day:12}];var ya={ffffff:"White Day",cccccc:"Gray Day",999999:"Gray Day",666666:"Gray Day",333333:"Black Day","99cc99":"Green Day",669966:"Green Day",336633:"Green Day","00ccff":"Blue Day","66ccff":"Blue Day","0099cc":"Blue Day","006699":"Blue Day","003399":"Blue Day","9966cc":"Purple Day",663399:"Purple Day",330066:"Purple Day",ff66ff:"Pink Day",cc66cc:"Pink Day",993399:"Pink Day",660066:"Pink Day",ff9999:"Red Day",cc6666:"Red Day",cc3333:"Red Day",990000:"Red Day",f8ee32:"Yellow Day",ffd700:"Yellow Day",f8941d:"Orange Day",ff6600:"Orange Day",c69c6d:"Brown Day","8c6239":"Brown Day","754c24":"Brown Day",603913:"Brown Day"};ra.directive("classSettings",["$rootScope","$filter","$window","$location","$timeout",function(a,b,c,d,e){return{restrict:"E",replace:!0,templateUrl:"templates/settings/class-settings.html",link:function(b,c,f){ua.sendAppView("Class Settings");var g=a.user?a.user.id:null;b.settings=angular.copy(a.userSettings),b.settings.dayAStartDate||(b.settings.dayAStartDate=new Date);var h=[],i=1;E(BLOCK_OPTIONS,function(a){var c=null;(1==i||2==i)&&(c=angular.copy(a)),b.settings.blocks&&E(b.settings.blocks,function(b){b.day==i.toString()&&(1==i||2==i?$.extend(c,b):(c=angular.copy(a),$.extend(c,b)))}),c&&h.push(c),i++}),b.blockOptions=h,U.adjustModalHeight(),b.openColorPicker=function(a,c){a.preventDefault(),a.stopPropagation(),b.blockOptions[parseInt(c)-1].opened=!0},b.addBlockDay=function(){var a=!1;E(BLOCK_OPTIONS,function(c){var d=!1;E(b.blockOptions,function(a){a.id==c.id&&(d=!0)}),0!=d||a||(b.blockOptions.push(angular.copy(c)),a=!0)}),b.blockOptions.length==BLOCK_OPTIONS.length&&(b.hideAddMoreDays=!0),U.adjustModalHeight()};var k=!1;b.removeBlockDay=function(a,c){a.preventDefault(),a.stopPropagation();var d=[];E(b.blockOptions,function(a){a.id==c?"1"==c?d.push(angular.copy(BLOCK_OPTIONS[0])):"2"==c&&d.push(angular.copy(BLOCK_OPTIONS[1])):d.push(a)}),k=!0,b.blockOptions=d,"1"!=c&&"2"!=c&&U.adjustModalHeight()},b.saveChanges=function(){g&&(a.user.settings=b.settings),a.userSettings=b.settings;var c=F.toDBSettings(b.settings);w.setUserSettings(g,c,!0),j.isMacApp?e(function(){MacApp.reloadStorage()},700):D.reloadStorage(a,!0)},b.applyDayLabelChanges=function(){b.settings.blocks=angular.copy(b.blockOptions)};var l=!0,m=b.$watch("blockOptions",function(a,c){if(!l){if(c&&a.length==c.length){if(c&&a.length==c.length){var d=[],e=[];E(a,function(a){a.color&&!a.text&&(a.text=ya[a.color.h]),d.push(a.text?a.text:""),e.push(a.opened?!0:!1)});var f=[],g=[];E(c,function(a){f.push(a.text?a.text:""),g.push(a.opened?!0:!1)}),angular.equals(e,g)&&angular.equals(d,f)&&!k||(b.settings.blocks=angular.copy(b.blockOptions))}}else b.settings.blocks=angular.copy(b.blockOptions);k=!1}a&&l&&(l=!1)},!0),n=b.$watch("settings",function(a,c){a&&c&&a!=c&&!l&&b.saveChanges()},!0);b.$on("$destroy",function(){m(),n()}),b.removeAllClasses=function(){ua.sendAppView("Remove All Classes"),nAlert({title:"Remove all classes",html:"<p>Are you sure you want to remove all classes and homework?<br>They will be gone forever!</p>",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,showCancelButton:!0},function(b){b&&o.deleteAllHws(g,!0).then(function(){q.deleteClasses(g,!0).then(function(){ua.sendAppView("Remove All Classes Success"),j.isMacApp||D.reloadStorage(a,!0),J.openAppURL(d,"/"),nAlert("All classes and homework have been removed!")})})})}}}}]),ra.directive("calendarSettings",["$rootScope","$modal","$window",function(a,b,c){return{restrict:"E",replace:!0,templateUrl:"templates/settings/calendar-settings.html",link:function(b,c,d){ua.sendAppView("Calendar Settings");var e=a.user?a.user.id:null;b.settings=angular.copy(a.userSettings),U.adjustModalHeight(),b.saveChange=function(c){e&&(a.user.settings=b.settings),a.userSettings=b.settings;var d=F.toDBSettings(b.settings);w.setUserSettings(e,d,!0),j.isMacApp?MacApp.reloadStorage():D.reloadStorage(a,!0)}}}}]),ra.directive("schoolSettings",["$rootScope","$modal","$location","$filter","schoolsAPI","accountAPI",function(a,b,c,d,e,f){return{restrict:"E",replace:!0,templateUrl:"templates/settings/school-settings.html",link:function(g,h,i){function j(b){l.saveSpinner={show:!0,text:"Updating User Schools"},l.$apply();var c=[];a.user.schoolSlugs&&E(a.user.schoolSlugs,function(a){a!=b.slug&&c.push(a)});var f=a.user.id;e.postCurrentSchools(c).then(function(e){ua.sendAppView("Remove School Success");var g=new Array;g.push(function(){return w.setUserSchools(f,c)});var h=d("filter")(a.userAnnouncements,{schoolSlug:b.slug},!0);if(h&&h.length){var i=[];E(h,function(a){i.push(a.id)}),g.push(function(){return u.deleteAnnouncements(i,f)})}e.length&&E(e,function(a){g.push(function(){return u.ensureAnnouncement(a,f)})}),g.push(function(){return F.loadUser(a,f,!1)}),g.push(function(){return G.loadSchools(a,!1)}),g.push(function(){return T.loadAnnouncements(a,!1)}),Promise.loop(g).then(function(){l.saveSpinner.show=!1,a.$$phase||a.$apply(),l.$$phase||l.$apply()},function(a){J.logError(a),l.saveSpinner.show=!1,l.$$phase||l.$apply(),nAlert({html:"Oops! An error occurred when trying to update your schools. Please try again later."})})},function(){ua.sendAppView("Remove School Failed"),l.saveSpinner.show=!1,l.$$phase||l.$apply(),500==status?nAlert({html:"Oops! An error occurred when trying to update your schools. Please try again later."}):503==status?nAlert({html:"Oops! Our server is unavailable right now. Please try again later."}):403==status?k("Something went wrong. Please sign out and sign back in."):navigator.onLine?nAlert({html:"We were unable to update your schools.<br>Please try again later."}):nAlert({html:"We were unable to update your schools.<br>Please make sure you have internet connection and try again."})})}function k(a){nAlert({title:a.length<25?a:null,html:a.length>=25?a:null,closeOnConfirm:!1},function(){nAlert.close(),J.openAppURL(c,"/"),b.close()})}ua.sendAppView("School Settings");var l=g.$parent;U.adjustModalHeight(),f.getUserInfo().then(function(){F.loadUser(a,a.user.id,!0).then(function(){G.loadSchools(a,!0).then(function(){U.adjustModalHeight()})})}),g.openSchool=function(a){ua.sendAppView("Open School from School Settings"),J.openAppURL(c,"/schools/"+a.slug),b.close()},g.removeSchool=function(a){ua.sendAppView("Remove School"),nAlert({title:"Remove school",html:"<p>Are you sure you want to remove <strong>"+a.name+"</strong> from your attending schools?</p>",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,showCancelButton:!0},function(b){b&&(nAlert.close(),j(a))})},g.queries={},g.searchSchools=function(a){a.$valid&&(l.saveSpinner={show:!0,text:"Searching Schools"},l.$$phase||l.$apply(),ua.sendEvent("Search","Schools","Start"),e.searchSchools(g.queries.search).then(function(b){ua.sendEvent("Search","Schools","Success"),g.searchResult=b,l.saveSpinner.show=!1,a.$setPristine(),a.$setUntouched(),l.$$phase||l.$apply(),U.adjustModalHeight()},function(a){ua.sendEvent("Search","Schools","Failed"),l.saveSpinner.show=!1,l.$$phase||l.$apply(),500==a?nAlert("Oops! An error occurred when trying find schools. Please try again later."):503==a?nAlert("Oops! Our server is unavailable right now. Please try again later."):403==a?k("Something went wrong. Please sign out and sign back in."):navigator.onLine?nAlert({html:"We were unable to find schools.<br>Please try again later."}):nAlert({html:"We were unable to find schools.<br>Please make sure you have internet connection and try again."})}))},g.addSchool=function(b){var c=[];a.user.schoolSlugs&&E(a.user.schoolSlugs,function(a){a!=b.slug&&c.push(a)}),l.saveSpinner={show:!0,text:"Updating User Schools"},l.$$phase||l.$apply(),c.push(b.slug),ua.sendEvent("School","Attend","True"),ua.sendEvent("School","Save Attend","Start");var d=a.user.id;e.postCurrentSchools(c).then(function(e){ua.sendEvent("School","Save Attend","Success");var f=new Array;b.dbschl&&f.push(function(){return y.ensureSchool(b.dbschl)}),f.push(function(){return w.setUserSchools(d,c)}),e.length&&E(e,function(a){f.push(function(){return u.ensureAnnouncement(a,d)})}),f.push(function(){return F.loadUser(a,d,!1)}),f.push(function(){return G.loadSchools(a,!1)}),f.push(function(){return T.loadAnnouncements(a,!1)}),Promise.loop(f).then(function(){l.saveSpinner.show=!1,g.searchResult=null,g.queries={},a.$$phase||a.$apply(),l.$$phase||l.$apply(),U.adjustModalHeight()},function(a){ua.sendEvent("School","Save Attend","Failed"),J.logError(a),l.saveSpinner.show=!1,l.$$phase||l.$apply(),nAlert({html:"Oops! An error occurred when trying to update your schools. Please try again later."})})},function(){ua.sendEvent("School","Save Attend","Failed"),l.saveSpinner.show=!1,l.$$phase||l.$apply(),500==status?nAlert({html:"Oops! An error occurred when trying to update your schools. Please try again later."}):503==status?nAlert({html:"Oops! Our server is unavailable right now. Please try again later."}):403==status?k("Something went wrong. Please sign out and sign back in."):navigator.onLine?nAlert({html:"We were unable to update your schools.<br>Please try again later."}):nAlert({html:"We were unable to update your schools.<br>Please make sure you have internet connection and try again."})})},g.signin=function(){J.openAppURL(c,"/login"),b.close()},g.signup=function(){J.openAppURL(c,"/signup"),b.close()}}}}]),ra.directive("accountSettings",["$rootScope","$modal","$location","schoolsAPI","accountAPI",function(a,b,c,d,e){return{restrict:"E",replace:!0,templateUrl:"templates/settings/account-settings.html",link:function(d,f,g){ua.sendAppView("Accounts Settings"),U.adjustModalHeight(),e.getUserInfo().then(function(){F.loadUser(a,a.user.id,!0).then(function(){G.loadSchools(a,!0).then(function(){a.premiumSchool?e.getGuardiansInfo().then(function(){F.loadUser(a,a.user.id,!0).then(function(){U.adjustModalHeight()})}):U.adjustModalHeight()})})}),a.user&&D.getLocalItem("lsyncdt").then(function(a){a&&(d.lastSyncDate=J.parseISO8601(a),d.$$phase||d.$apply())}),d.openAccount=function(c){j.isMacApp?MacApp.changeUser(c.id):a.changeUser(c.id),b.close()},d.signOutUser=function(c){ua.sendAppView("Logout"),nAlert({title:"Sign out",text:"Are you sure you want to sign out?",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,showCancelButton:!0},function(d){d&&(ua.sendAppView("Logout Success"),nAlert.close(),j.isMacApp?MacApp.signUserOut(c.id):a.performSignout(c.id),b.close())})},d.addGuardian=function(c){return c.id!=a.user.id?void b.close():(b.close(),void b.open({templateUrl:"templates/account/guardian-add.html",controller:"GuardianAddCtrl",title:"Add Parent or Guardian",size:"small"}))},d.removeGuardian=function(c,d){return c.id!=a.user.id?void b.close():(ua.sendAppView("Remove Guardian"),void nAlert({title:"Remove this parent or guardian?",html:"<p>Are you sure you want to remove "+d.e+"?</p>",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,showCancelButton:!0},function(b){b&&e.removeGuardian(d.ui).then(function(){ua.sendAppView("Remove Guardian Success"),j.isMacApp||D.reloadStorage(a,!0),nAlert("Parent or guardian has been removed!")},function(a){ua.sendAppView("Remove Guardian Error:"+a.error_description),a&&"cant_remove_guardian"==a.error?nAlert("Only a teacher can remove that parent or guardian!"):nAlert("There was a problem. Try again later.")})}))},d.addAccount=function(){if(a.users&&a.users.length>=3&&a.users.length<7){var d=!1;if(E(a.users,function(a){a.isPremiumAccount&&(d=!0)}),!d)return void nAlert("At least one of your accounts needs to be a Premium account to continue adding accounts.")}J.openAppURL(c,"/login"),b.close()},d.signin=function(){J.openAppURL(c,"/login"),b.close()},d.signup=function(){J.openAppURL(c,"/signup"),b.close()},d.upgradeUser=function(c){return c.id!=a.user.id?j.isMacApp?(MacApp.changeUserAndOpenUpgrade(c.id),void b.close()):(a.changeUser(c.id,!0),void b.close()):(b.close(),void b.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Upgrade Account",size:"small"}))},d.renewUser=function(c){return c.id!=a.user.id?j.isMacApp?(MacApp.changeUserAndOpenUpgrade(c.id),void b.close()):(a.changeUser(c.id,!0),void b.close()):(b.close(),void b.open({templateUrl:"templates/account/upgrade-account.html",controller:"UpgradeAccountCtrl",title:"Renew Account",size:"small",params:{isRenew:!0}}))}}}}]),ra.directive("aboutSettings",["$rootScope","$modal","$window",function(a,b,c){return{restrict:"E",replace:!0,templateUrl:"templates/settings/about-settings.html",link:function(a,b,d){ua.sendAppView("About"),a.appVersion=j.av,U.adjustModalHeight(),a.openRatemyHomework=function(){j.isChromeApp?J.openURL(c,"https://chrome.google.com/webstore/detail/myhomework-student-planner/pembccdigcahnckbjcbehhcacplbbomj/reviews"):j.isWindowsApp?J.openURL(c,"http://apps.microsoft.com/windows/en-us/app/myhomework/438f2bec-f200-4b9d-96ad-7f95fbe93409"):j.isMacApp&&J.openURL(c,"macappstore://itunes.apple.com/app/id970610831")}}}}]),ra.controller("AboutCtrl",["$scope","$modal",function(a,b){a.cancel=function(){b.close()}}]),ra.controller("WelcomeOrientationCtrl",["$rootScope","$scope","$modal","$location",function(a,b,c,d){D.setLocalItem("r1Orientation",!0),b.platform=j.platform,b.openSignin=function(){ua.sendEvent("Orientation","R1Welcome","Signin"),J.openAppURL(d,"/login"),c.close()},b.openSignup=function(){ua.sendEvent("Orientation","R1Welcome","Signup"),J.openAppURL(d,"/signup"),c.close()},b.cancel=function(){ua.sendEvent("Orientation","R1Welcome","Close"),c.close()}}]);